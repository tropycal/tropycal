<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>tropycal.recon.dataset &mdash; tropycal </title>
      <link rel="stylesheet" href="../../../_static/pygments.css" type="text/css" />
      <link rel="stylesheet" href="../../../_static/css/theme.css" type="text/css" />
      <link rel="stylesheet" href="../../../_static/plot_directive.css" type="text/css" />
      <link rel="stylesheet" href="../../../_static/sg_gallery.css" type="text/css" />
      <link rel="stylesheet" href="../../../_static/sg_gallery-binder.css" type="text/css" />
      <link rel="stylesheet" href="../../../_static/sg_gallery-dataframe.css" type="text/css" />
      <link rel="stylesheet" href="../../../_static/sg_gallery-rendered-html.css" type="text/css" />
      <link rel="stylesheet" href="../../../_static/css/theme.css" type="text/css" />
    <link rel="shortcut icon" href="../../../_static/logo_32.ico"/>
  <!--[if lt IE 9]>
    <script src="../../../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
        <script data-url_root="../../../" id="documentation_options" src="../../../_static/documentation_options.js"></script>
        <script src="../../../_static/jquery.js"></script>
        <script src="../../../_static/underscore.js"></script>
        <script src="../../../_static/_sphinx_javascript_frameworks_compat.js"></script>
        <script src="../../../_static/doctools.js"></script>
        <script src="../../../_static/sphinx_highlight.js"></script>
    <script src="../../../_static/js/theme.js"></script>
    <link rel="index" title="Index" href="../../../genindex.html" />
    <link rel="search" title="Search" href="../../../search.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >

          
          
          <a href="../../../index.html" class="icon icon-home">
            tropycal
              <img src="../../../_static/logo.png" class="logo" alt="Logo"/>
          </a>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <ul>
<li class="toctree-l1"><a class="reference internal" href="../../../install.html">Installation Guide</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../support.html">Support</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../examples/index.html">Example Scripts</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../api/index.html">API Reference</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../sample_usage.html">Example Gallery</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../data.html">Data Sources</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../../index.html">tropycal</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../../../index.html" class="icon icon-home" aria-label="Home"></a></li>
          <li class="breadcrumb-item"><a href="../../index.html">Module code</a></li>
      <li class="breadcrumb-item active">tropycal.recon.dataset</li>
      <li class="wy-breadcrumbs-aside">
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <h1>Source code for tropycal.recon.dataset</h1><div class="highlight"><pre>
<span></span><span class="kn">import</span> <span class="nn">os</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">from</span> <span class="nn">datetime</span> <span class="kn">import</span> <span class="n">datetime</span> <span class="k">as</span> <span class="n">dt</span><span class="p">,</span> <span class="n">timedelta</span>
<span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>
<span class="kn">import</span> <span class="nn">requests</span>
<span class="kn">import</span> <span class="nn">pickle</span>
<span class="kn">import</span> <span class="nn">copy</span>
<span class="kn">import</span> <span class="nn">urllib3</span>

<span class="kn">from</span> <span class="nn">scipy.interpolate</span> <span class="kn">import</span> <span class="n">interp1d</span>
<span class="kn">from</span> <span class="nn">scipy.ndimage</span> <span class="kn">import</span> <span class="n">gaussian_filter1d</span> <span class="k">as</span> <span class="n">gfilt1d</span>
<span class="kn">from</span> <span class="nn">scipy.ndimage</span> <span class="kn">import</span> <span class="n">minimum_filter</span>
<span class="kn">import</span> <span class="nn">matplotlib.dates</span> <span class="k">as</span> <span class="nn">mdates</span>

<span class="k">try</span><span class="p">:</span>
    <span class="kn">import</span> <span class="nn">matplotlib.colors</span> <span class="k">as</span> <span class="nn">mcolors</span>
    <span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>
    <span class="kn">import</span> <span class="nn">cartopy.crs</span> <span class="k">as</span> <span class="nn">ccrs</span>
<span class="k">except</span> <span class="ne">ImportError</span><span class="p">:</span>
    <span class="n">warnings</span><span class="o">.</span><span class="n">warn</span><span class="p">(</span>
        <span class="s2">&quot;Warning: Matplotlib is not installed in your python environment. Plotting functions will not work.&quot;</span><span class="p">)</span>

<span class="kn">from</span> <span class="nn">.plot</span> <span class="kn">import</span> <span class="o">*</span>
<span class="kn">from</span> <span class="nn">..tracks.plot</span> <span class="kn">import</span> <span class="n">TrackPlot</span>
<span class="kn">from</span> <span class="nn">.realtime</span> <span class="kn">import</span> <span class="n">Mission</span>

<span class="c1"># Import tools</span>
<span class="kn">from</span> <span class="nn">.tools</span> <span class="kn">import</span> <span class="o">*</span>
<span class="kn">from</span> <span class="nn">..utils</span> <span class="kn">import</span> <span class="o">*</span>


<div class="viewcode-block" id="ReconDataset"><a class="viewcode-back" href="../../../api/generated/tropycal.recon.ReconDataset.html#tropycal.recon.ReconDataset">[docs]</a><span class="k">class</span> <span class="nc">ReconDataset</span><span class="p">:</span>

<span class="w">    </span><span class="sa">r</span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Creates an instance of a ReconDataset object containing all recon data for a single storm.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    storm : tropycal.tracks.Storm</span>
<span class="sd">        Requested Storm object.</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    ReconDataset</span>
<span class="sd">        An instance of ReconDataset.</span>

<span class="sd">    Notes</span>
<span class="sd">    -----</span>
<span class="sd">    .. warning::</span>

<span class="sd">        Recon data is currently only available from 1989 onwards.</span>

<span class="sd">    ReconDataset and its subclasses (hdobs, dropsondes and vdms) consist the **storm-centric** part of the recon module, meaning that recon data is retrieved specifically for tropical cyclones, and all recon missions for the requested storm are additionally transformed to storm-centric coordinates. This differs from realtime recon functionality, which is **mission-centric**.</span>

<span class="sd">    This storm-centric functionality allows for additional recon analysis and visualization functions, such as derived hovmollers and spatial maps for example. As of Tropycal v0.4, Recon data can only be retrieved for tropical cyclones, not for invests.</span>

<span class="sd">    ReconDataset will contain nothing the first time it&#39;s initialized, but contains methods to retrieve the three sub-classes of recon:</span>

<span class="sd">    .. list-table:: </span>
<span class="sd">       :widths: 25 75</span>
<span class="sd">       :header-rows: 1</span>

<span class="sd">       * - Class</span>
<span class="sd">         - Description</span>
<span class="sd">       * - hdobs</span>
<span class="sd">         - Class containing all High Density Observations (HDOBs) for this Storm.</span>
<span class="sd">       * - dropsondes</span>
<span class="sd">         - Class containing all dropsondes for this Storm.</span>
<span class="sd">       * - vdms</span>
<span class="sd">         - Class containing all Vortex Data Messages (VDMs) for this Storm.</span>

<span class="sd">    Each of these sub-classes can be initialized as a sub-class of ReconDataset as follows. Note that this may take some time, especially for storms with many recon missions.</span>

<span class="sd">    .. code-block:: python</span>

<span class="sd">        #Retrieve Hurricane Michael (2018) from TrackDataset</span>
<span class="sd">        basin = tracks.TrackDataset()</span>
<span class="sd">        storm = basin.get_storm((&#39;michael&#39;,2018))</span>

<span class="sd">        #Retrieve all HDOBs for this storm</span>
<span class="sd">        storm.recon.get_hdobs()</span>

<span class="sd">        #Retrieve all dropsondes for this storm</span>
<span class="sd">        storm.recon.get_dropsondes()</span>

<span class="sd">        #Retrieve all VDMs for this storm</span>
<span class="sd">        storm.recon.get_vdms()</span>

<span class="sd">    Once this data has been read in, these subclasses and their associated methods and attributes can be accessed from within the `recon` object as follows, using HDOBs for example:</span>

<span class="sd">    .. code-block:: python</span>

<span class="sd">        #Retrieve Pandas DataFrame of all HDOB observations</span>
<span class="sd">        storm.recon.hdobs.data</span>

<span class="sd">        #Plot all HDOB points</span>
<span class="sd">        storm.recon.hdobs.plot_points()</span>

<span class="sd">        #Plot derived hovmoller from HDOB points</span>
<span class="sd">        storm.recon.hdobs.plot_hovmoller()</span>

<span class="sd">    Individual missions can also be retrieved as ``Mission`` objects. For example, this code retrieves a ``Mission`` object for the second mission of this storm:</span>

<span class="sd">    .. code-block:: python</span>

<span class="sd">        #This line prints all available mission IDs from this storm</span>
<span class="sd">        print(storm.recon.find_mission())</span>

<span class="sd">        #This line retrieves the 2nd mission from this storm</span>
<span class="sd">        mission = storm.recon.get_mission(2)</span>

<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="fm">__repr__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>

        <span class="n">info</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">name</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;hdobs&#39;</span><span class="p">,</span> <span class="s1">&#39;dropsondes&#39;</span><span class="p">,</span> <span class="s1">&#39;vdms&#39;</span><span class="p">]:</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">info</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="vm">__dict__</span><span class="p">[</span><span class="n">name</span><span class="p">]</span><span class="o">.</span><span class="fm">__repr__</span><span class="p">())</span>
            <span class="k">except</span><span class="p">:</span>
                <span class="n">info</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">&#39;&#39;</span><span class="p">)</span>
        <span class="k">return</span> <span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">info</span><span class="p">)</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">storm</span><span class="p">):</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">source</span> <span class="o">=</span> <span class="s1">&#39;https://www.nhc.noaa.gov/archive/recon/&#39;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">storm</span> <span class="o">=</span> <span class="n">storm</span>

<div class="viewcode-block" id="ReconDataset.get_hdobs"><a class="viewcode-back" href="../../../api/generated/tropycal.recon.ReconDataset.get_hdobs.html#tropycal.recon.ReconDataset.get_hdobs">[docs]</a>    <span class="k">def</span> <span class="nf">get_hdobs</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
<span class="w">        </span><span class="sa">r</span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Retrieve High Density Observations (HDOBs) for this storm.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        data : str, optional</span>
<span class="sd">            String representing the path of a pickle file containing HDOBs data, saved via ``hdobs.to_pickle()``. If none, data is read from NHC.</span>

<span class="sd">        Notes</span>
<span class="sd">        -----</span>
<span class="sd">        This function has no return value, but stores the resulting HDOBs object within this ReconDataset instance. All of its methods can then be accessed as follows, for the following example storm:</span>

<span class="sd">        .. code-block:: python</span>

<span class="sd">            from tropycal import tracks</span>

<span class="sd">            #Read basin dataset</span>
<span class="sd">            basin = tracks.TrackDataset()</span>

<span class="sd">            #Read storm object</span>
<span class="sd">            storm = basin.get_storm((&#39;michael&#39;,2018))</span>

<span class="sd">            #Read hdobs data</span>
<span class="sd">            storm.recon.get_hdobs()</span>

<span class="sd">            #Plot all HDOB points</span>
<span class="sd">            storm.recon.hdobs.plot_points()</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">hdobs</span> <span class="o">=</span> <span class="n">hdobs</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">storm</span><span class="p">,</span> <span class="n">data</span><span class="p">)</span></div>

<div class="viewcode-block" id="ReconDataset.get_dropsondes"><a class="viewcode-back" href="../../../api/generated/tropycal.recon.ReconDataset.get_dropsondes.html#tropycal.recon.ReconDataset.get_dropsondes">[docs]</a>    <span class="k">def</span> <span class="nf">get_dropsondes</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
<span class="w">        </span><span class="sa">r</span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Retrieve dropsondes for this storm.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        data : str, optional</span>
<span class="sd">            String representing the path of a pickle file containing dropsonde data, saved via ``dropsondes.to_pickle()``. If none, data is read from NHC.</span>

<span class="sd">        Notes</span>
<span class="sd">        -----</span>
<span class="sd">        This function has no return value, but stores the resulting dropsondes object within this ReconDataset instance. All of its methods can then be accessed as follows, for the following example storm:</span>

<span class="sd">        .. code-block:: python</span>

<span class="sd">            from tropycal import tracks</span>

<span class="sd">            #Read basin dataset</span>
<span class="sd">            basin = tracks.TrackDataset()</span>

<span class="sd">            #Read storm object</span>
<span class="sd">            storm = basin.get_storm((&#39;michael&#39;,2018))</span>

<span class="sd">            #Read dropsondes data</span>
<span class="sd">            storm.recon.get_dropsondes()</span>

<span class="sd">            #Plot all dropsonde points</span>
<span class="sd">            storm.recon.dropsondes.plot_points()</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">dropsondes</span> <span class="o">=</span> <span class="n">dropsondes</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">storm</span><span class="p">,</span> <span class="n">data</span><span class="p">)</span></div>

<div class="viewcode-block" id="ReconDataset.get_vdms"><a class="viewcode-back" href="../../../api/generated/tropycal.recon.ReconDataset.get_vdms.html#tropycal.recon.ReconDataset.get_vdms">[docs]</a>    <span class="k">def</span> <span class="nf">get_vdms</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
<span class="w">        </span><span class="sa">r</span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Retrieve Vortex Data Messages (VDMs) for this storm.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        data : str, optional</span>
<span class="sd">            String representing the path of a pickle file containing VDM data, saved via ``vdms.to_pickle()``. If none, data is read from NHC.</span>

<span class="sd">        Notes</span>
<span class="sd">        -----</span>
<span class="sd">        This function has no return value, but stores the resulting VDMs object within this ReconDataset instance. All of its methods can then be accessed as follows, for the following example storm:</span>

<span class="sd">        .. code-block:: python</span>

<span class="sd">            from tropycal import tracks</span>

<span class="sd">            #Read basin dataset</span>
<span class="sd">            basin = tracks.TrackDataset()</span>

<span class="sd">            #Read storm object</span>
<span class="sd">            storm = basin.get_storm((&#39;michael&#39;,2018))</span>

<span class="sd">            #Read VDM data</span>
<span class="sd">            storm.recon.get_vdms()</span>

<span class="sd">            #Plot all VDM points</span>
<span class="sd">            storm.recon.vdms.plot_points()</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">vdms</span> <span class="o">=</span> <span class="n">vdms</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">storm</span><span class="p">,</span> <span class="n">data</span><span class="p">)</span></div>

<div class="viewcode-block" id="ReconDataset.get_mission"><a class="viewcode-back" href="../../../api/generated/tropycal.recon.ReconDataset.get_mission.html#tropycal.recon.ReconDataset.get_mission">[docs]</a>    <span class="k">def</span> <span class="nf">get_mission</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">number</span><span class="p">):</span>
<span class="w">        </span><span class="sa">r</span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Retrieve a Mission object for a given mission number for this storm.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        number : int or str</span>
<span class="sd">            Requested mission number. Can be an integer (1) or a string with two characters (&quot;01&quot;).</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        Mission</span>
<span class="sd">            Instance of a Mission object for the requested mission.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">def</span> <span class="nf">str2</span><span class="p">(</span><span class="n">number</span><span class="p">):</span>
            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">number</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
                <span class="k">return</span> <span class="n">number</span>
            <span class="k">if</span> <span class="n">number</span> <span class="o">&lt;</span> <span class="mi">10</span><span class="p">:</span>
                <span class="k">return</span> <span class="sa">f</span><span class="s2">&quot;0</span><span class="si">{</span><span class="n">number</span><span class="si">}</span><span class="s2">&quot;</span>
            <span class="k">return</span> <span class="nb">str</span><span class="p">(</span><span class="n">number</span><span class="p">)</span>

        <span class="c1"># Automatically retrieve data if not already available</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">vdms</span>
        <span class="k">except</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">get_vdms</span><span class="p">()</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">hdobs</span>
        <span class="k">except</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">get_hdobs</span><span class="p">()</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">dropsondes</span>
        <span class="k">except</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">get_dropsondes</span><span class="p">()</span>

        <span class="c1"># Search through all missions to find the full mission ID</span>
        <span class="n">missions</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">mission</span> <span class="ow">in</span> <span class="n">np</span><span class="o">.</span><span class="n">unique</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">hdobs</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;mission&#39;</span><span class="p">]):</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">missions</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">mission</span><span class="p">))</span>
            <span class="k">except</span><span class="p">:</span>
                <span class="k">pass</span>
        <span class="n">missions</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">sort</span><span class="p">(</span><span class="n">missions</span><span class="p">))</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">number</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
            <span class="n">missions</span> <span class="o">=</span> <span class="p">[</span><span class="n">str2</span><span class="p">(</span><span class="n">i</span><span class="p">)</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">missions</span><span class="p">]</span>
        <span class="k">if</span> <span class="n">number</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">missions</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Requested mission ID is not available.&quot;</span><span class="p">)</span>

        <span class="c1"># Retrieve data for mission</span>
        <span class="n">hdobs_mission</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">hdobs</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">hdobs</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;mission&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="n">str2</span><span class="p">(</span>
            <span class="n">number</span><span class="p">)]</span>
        <span class="n">mission_id</span> <span class="o">=</span> <span class="n">hdobs_mission</span><span class="p">[</span><span class="s1">&#39;mission_id&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">vdms_mission</span> <span class="o">=</span> <span class="p">[</span>
            <span class="n">i</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">vdms</span><span class="o">.</span><span class="n">data</span> <span class="k">if</span> <span class="n">i</span><span class="p">[</span><span class="s1">&#39;mission_id&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="n">mission_id</span><span class="p">]</span>
        <span class="n">dropsondes_mission</span> <span class="o">=</span> <span class="p">[</span>
            <span class="n">i</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">dropsondes</span><span class="o">.</span><span class="n">data</span> <span class="k">if</span> <span class="n">i</span><span class="p">[</span><span class="s1">&#39;mission_id&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="n">mission_id</span><span class="p">]</span>

        <span class="n">mission_dict</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s1">&#39;hdobs&#39;</span><span class="p">:</span> <span class="n">hdobs_mission</span><span class="p">,</span>
            <span class="s1">&#39;vdms&#39;</span><span class="p">:</span> <span class="n">vdms_mission</span><span class="p">,</span>
            <span class="s1">&#39;dropsondes&#39;</span><span class="p">:</span> <span class="n">dropsondes_mission</span><span class="p">,</span>
            <span class="s1">&#39;aircraft&#39;</span><span class="p">:</span> <span class="n">mission_id</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;-&quot;</span><span class="p">)[</span><span class="mi">0</span><span class="p">],</span>
            <span class="s1">&#39;storm_name&#39;</span><span class="p">:</span> <span class="n">mission_id</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;-&quot;</span><span class="p">)[</span><span class="mi">2</span><span class="p">]</span>
        <span class="p">}</span>

        <span class="c1"># Get sources</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">sources</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span>
                <span class="n">np</span><span class="o">.</span><span class="n">unique</span><span class="p">([</span><span class="bp">self</span><span class="o">.</span><span class="n">vdms</span><span class="o">.</span><span class="n">source</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">hdobs</span><span class="o">.</span><span class="n">source</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">dropsondes</span><span class="o">.</span><span class="n">source</span><span class="p">]))</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">sources</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
                <span class="n">sources</span> <span class="o">=</span> <span class="n">sources</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="k">except</span><span class="p">:</span>
            <span class="n">sources</span> <span class="o">=</span> <span class="s1">&#39;National Hurricane Center (NHC)&#39;</span>
        <span class="n">mission_dict</span><span class="p">[</span><span class="s1">&#39;source&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">sources</span>

        <span class="k">return</span> <span class="n">Mission</span><span class="p">(</span><span class="n">mission_dict</span><span class="p">,</span> <span class="n">mission_id</span><span class="p">)</span></div>

<div class="viewcode-block" id="ReconDataset.update"><a class="viewcode-back" href="../../../api/generated/tropycal.recon.ReconDataset.update.html#tropycal.recon.ReconDataset.update">[docs]</a>    <span class="k">def</span> <span class="nf">update</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sa">r</span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Update with the latest data for an ongoing storm.</span>

<span class="sd">        Notes</span>
<span class="sd">        -----</span>
<span class="sd">        This function has no return value, but simply updates all existing sub-classes of ReconDataset.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">for</span> <span class="n">name</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;hdobs&#39;</span><span class="p">,</span> <span class="s1">&#39;dropsondes&#39;</span><span class="p">,</span> <span class="s1">&#39;vdms&#39;</span><span class="p">]:</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="vm">__dict__</span><span class="p">[</span><span class="n">name</span><span class="p">]</span><span class="o">.</span><span class="n">update</span><span class="p">()</span>
            <span class="k">except</span><span class="p">:</span>
                <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;No </span><span class="si">{</span><span class="n">name</span><span class="si">}</span><span class="s1"> object to update&#39;</span><span class="p">)</span></div>

<div class="viewcode-block" id="ReconDataset.get_track"><a class="viewcode-back" href="../../../api/generated/tropycal.recon.ReconDataset.get_track.html#tropycal.recon.ReconDataset.get_track">[docs]</a>    <span class="k">def</span> <span class="nf">get_track</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">time</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
<span class="w">        </span><span class="sa">r</span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Retrieve coordinates of recon track for one or more times.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        time : datetime.datetime or list, optional</span>
<span class="sd">            Datetime object or list of datetime objects representing the requested time.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        tuple</span>
<span class="sd">            (lon,lat) coordinates.</span>

<span class="sd">        Notes</span>
<span class="sd">        -----</span>
<span class="sd">        The track from which coordinate(s) are returned is generated by an optimal combination of Best Track and Recon (VDMs and/or HDOBs) tracks.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">if</span> <span class="n">time</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">or</span> <span class="s1">&#39;trackfunc&#39;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="vm">__dict__</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
            <span class="n">btk</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">storm</span><span class="o">.</span><span class="n">to_dataframe</span><span class="p">()[[</span><span class="s1">&#39;time&#39;</span><span class="p">,</span> <span class="s1">&#39;lon&#39;</span><span class="p">,</span> <span class="s1">&#39;lat&#39;</span><span class="p">]]</span>

            <span class="k">try</span><span class="p">:</span>
                <span class="k">if</span> <span class="s1">&#39;vdms&#39;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="vm">__dict__</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
                    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Getting VDMs for track&#39;</span><span class="p">)</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">get_vdms</span><span class="p">()</span>
                <span class="n">rec</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span>
                    <span class="p">[{</span><span class="n">k</span><span class="p">:</span> <span class="n">d</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="p">(</span><span class="s1">&#39;time&#39;</span><span class="p">,</span> <span class="s1">&#39;lon&#39;</span><span class="p">,</span> <span class="s1">&#39;lat&#39;</span><span class="p">)}</span> <span class="k">for</span> <span class="n">d</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">vdms</span><span class="o">.</span><span class="n">data</span><span class="p">])</span>
            <span class="k">except</span><span class="p">:</span>
                <span class="k">try</span><span class="p">:</span>
                    <span class="n">rec</span> <span class="o">=</span> <span class="n">storm</span><span class="o">.</span><span class="n">recon</span><span class="o">.</span><span class="n">hdobs</span><span class="o">.</span><span class="n">sel</span><span class="p">(</span><span class="n">iscenter</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span><span class="o">.</span><span class="n">data</span>
                <span class="k">except</span><span class="p">:</span>
                    <span class="n">rec</span> <span class="o">=</span> <span class="kc">None</span>

            <span class="k">if</span> <span class="n">rec</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">track</span> <span class="o">=</span> <span class="n">copy</span><span class="o">.</span><span class="n">copy</span><span class="p">(</span><span class="n">btk</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">track</span> <span class="o">=</span> <span class="n">copy</span><span class="o">.</span><span class="n">copy</span><span class="p">(</span><span class="n">rec</span><span class="p">)</span>
                <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">row</span> <span class="ow">in</span> <span class="n">btk</span><span class="o">.</span><span class="n">iterrows</span><span class="p">():</span>
                    <span class="k">if</span> <span class="nb">min</span><span class="p">(</span><span class="nb">abs</span><span class="p">(</span><span class="n">row</span><span class="p">[</span><span class="s1">&#39;time&#39;</span><span class="p">]</span> <span class="o">-</span> <span class="n">rec</span><span class="p">[</span><span class="s1">&#39;time&#39;</span><span class="p">]))</span> <span class="o">&gt;</span> <span class="n">timedelta</span><span class="p">(</span><span class="n">hours</span><span class="o">=</span><span class="mi">3</span><span class="p">):</span>
                        <span class="n">track</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="nb">len</span><span class="p">(</span><span class="n">track</span><span class="o">.</span><span class="n">index</span><span class="p">)]</span> <span class="o">=</span> <span class="n">row</span>
            <span class="n">track</span> <span class="o">=</span> <span class="n">track</span><span class="o">.</span><span class="n">sort_values</span><span class="p">(</span><span class="n">by</span><span class="o">=</span><span class="s1">&#39;time&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">reset_index</span><span class="p">(</span><span class="n">drop</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

            <span class="c1"># Interpolate center position to time of each ob</span>
            <span class="n">datenum</span> <span class="o">=</span> <span class="p">[</span><span class="n">mdates</span><span class="o">.</span><span class="n">date2num</span><span class="p">(</span><span class="n">t</span><span class="p">)</span> <span class="k">for</span> <span class="n">t</span> <span class="ow">in</span> <span class="n">track</span><span class="p">[</span><span class="s1">&#39;time&#39;</span><span class="p">]]</span>
            <span class="n">f1</span> <span class="o">=</span> <span class="n">interp1d</span><span class="p">(</span>
                <span class="n">datenum</span><span class="p">,</span> <span class="n">track</span><span class="p">[</span><span class="s1">&#39;lon&#39;</span><span class="p">],</span> <span class="n">fill_value</span><span class="o">=</span><span class="s1">&#39;extrapolate&#39;</span><span class="p">,</span> <span class="n">kind</span><span class="o">=</span><span class="s1">&#39;quadratic&#39;</span><span class="p">)</span>
            <span class="n">f2</span> <span class="o">=</span> <span class="n">interp1d</span><span class="p">(</span>
                <span class="n">datenum</span><span class="p">,</span> <span class="n">track</span><span class="p">[</span><span class="s1">&#39;lat&#39;</span><span class="p">],</span> <span class="n">fill_value</span><span class="o">=</span><span class="s1">&#39;extrapolate&#39;</span><span class="p">,</span> <span class="n">kind</span><span class="o">=</span><span class="s1">&#39;quadratic&#39;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">trackfunc</span> <span class="o">=</span> <span class="p">(</span><span class="n">f1</span><span class="p">,</span> <span class="n">f2</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">time</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">datenum</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="k">for</span> <span class="n">t</span> <span class="ow">in</span> <span class="n">time</span><span class="p">:</span>
                <span class="k">try</span><span class="p">:</span>
                    <span class="n">datenum</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">mdates</span><span class="o">.</span><span class="n">date2num</span><span class="p">(</span><span class="n">t</span><span class="p">))</span>
                <span class="k">except</span><span class="p">:</span>
                    <span class="n">datenum</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">nan</span><span class="p">)</span>
            <span class="n">track</span> <span class="o">=</span> <span class="nb">tuple</span><span class="p">([</span><span class="n">f</span><span class="p">(</span><span class="n">datenum</span><span class="p">)</span> <span class="k">for</span> <span class="n">f</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">trackfunc</span><span class="p">])</span>
            <span class="k">return</span> <span class="n">track</span></div>

<div class="viewcode-block" id="ReconDataset.find_mission"><a class="viewcode-back" href="../../../api/generated/tropycal.recon.ReconDataset.find_mission.html#tropycal.recon.ReconDataset.find_mission">[docs]</a>    <span class="k">def</span> <span class="nf">find_mission</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">time</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">distance</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
<span class="w">        </span><span class="sa">r</span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Returns the name of a mission or list of recon missions for this storm.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        time : datetime.datetime or list, optional</span>
<span class="sd">            Datetime object or list of datetime objects representing the time of the requested mission. If none, all missions will be returned.</span>
<span class="sd">        distance : int, optional</span>
<span class="sd">            Distance from storm center, in kilometers.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        list</span>
<span class="sd">            The IDs of any/all missions that had in-storm observations during the specified time.</span>

<span class="sd">        Notes</span>
<span class="sd">        -----</span>
<span class="sd">        Especially in earlier years, missions are not always numbered sequentially (e.g., the first mission might not have an ID of &quot;01&quot;).</span>

<span class="sd">        To get a ``Mission`` object for one or more mission IDs, use the mission ID as an argument in ``ReconDataset.get_mission()``. For example, to retrieve a Mission object for every mission valid at a requested time, assuming that ``ReconDataset`` is linked to a Storm object:</span>

<span class="sd">        .. code-block:: python</span>

<span class="sd">            #Enter a requested time here</span>
<span class="sd">            import datetime as dt</span>
<span class="sd">            requested_time = dt.datetime(2020,8,12,12) #enter your requested time here</span>

<span class="sd">            #Get all active mission ID(s), if any, for this time</span>
<span class="sd">            mission_ids = storm.recon.find_mission(requested_time)</span>

<span class="sd">            #Get Mission object for each mission</span>
<span class="sd">            for mission_id in mission_ids:</span>
<span class="sd">                mission = storm.recon.get_mission(mission_id)</span>
<span class="sd">                print(mission)</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="c1"># Return all missions if time is None</span>
        <span class="k">if</span> <span class="n">time</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">distance</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">data</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">hdobs</span><span class="o">.</span><span class="n">data</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">data</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">hdobs</span><span class="o">.</span><span class="n">sel</span><span class="p">(</span><span class="n">distance</span><span class="o">=</span><span class="n">distance</span><span class="p">)</span><span class="o">.</span><span class="n">data</span>
            <span class="n">missions</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">unique</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;mission&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="p">)</span>
            <span class="k">return</span> <span class="nb">list</span><span class="p">(</span><span class="n">missions</span><span class="p">)</span>

        <span class="c1"># Filter temporally</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">time</span><span class="p">,</span> <span class="nb">list</span><span class="p">):</span>
            <span class="n">t1</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="n">time</span><span class="p">)</span>
            <span class="n">t2</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="n">time</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">t1</span> <span class="o">=</span> <span class="n">t2</span> <span class="o">=</span> <span class="n">time</span>

        <span class="c1"># Filter spatially</span>
        <span class="k">if</span> <span class="n">distance</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">data</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">hdobs</span><span class="o">.</span><span class="n">data</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">data</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">hdobs</span><span class="o">.</span><span class="n">sel</span><span class="p">(</span><span class="n">distance</span><span class="o">=</span><span class="n">distance</span><span class="p">)</span><span class="o">.</span><span class="n">data</span>

        <span class="c1"># Find and return missions</span>
        <span class="n">selected</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">mission_groups</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="s1">&#39;mission&#39;</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">g</span> <span class="ow">in</span> <span class="n">mission_groups</span><span class="p">:</span>
            <span class="n">t_start</span><span class="p">,</span> <span class="n">t_end</span> <span class="o">=</span> <span class="p">(</span><span class="nb">min</span><span class="p">(</span><span class="n">g</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="s1">&#39;time&#39;</span><span class="p">]),</span> <span class="nb">max</span><span class="p">(</span><span class="n">g</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="s1">&#39;time&#39;</span><span class="p">]))</span>
            <span class="k">if</span> <span class="n">t_start</span> <span class="o">&lt;=</span> <span class="n">t1</span> <span class="o">&lt;=</span> <span class="n">t_end</span> <span class="ow">or</span> <span class="n">t_start</span> <span class="o">&lt;=</span> <span class="n">t2</span> <span class="o">&lt;=</span> <span class="n">t_end</span> <span class="ow">or</span> <span class="n">t1</span> <span class="o">&lt;</span> <span class="n">t_start</span> <span class="o">&lt;</span> <span class="n">t2</span><span class="p">:</span>
                <span class="n">selected</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">g</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
        <span class="k">return</span> <span class="n">selected</span></div>

<div class="viewcode-block" id="ReconDataset.plot_summary"><a class="viewcode-back" href="../../../api/generated/tropycal.recon.ReconDataset.plot_summary.html#tropycal.recon.ReconDataset.plot_summary">[docs]</a>    <span class="k">def</span> <span class="nf">plot_summary</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">mission</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">save_path</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
<span class="w">        </span><span class="sa">r</span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Plot summary map of all recon data.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        mission : str, optional</span>
<span class="sd">            String with mission name. Will plot summary for the specified mission, otherwise plots for all missions (default).</span>
<span class="sd">        save_path : str</span>
<span class="sd">            Relative or full path of directory to save the image in. If none, image will not be saved.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        ax</span>
<span class="sd">            Instance of axes containing the plot.</span>

<span class="sd">        Notes</span>
<span class="sd">        -----</span>
<span class="sd">        HDOB data needs to be read into the recon object to use this function. To do so, use the ``ReconDataset.get_hdobs()`` function.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="c1"># Error check</span>
        <span class="k">if</span> <span class="s1">&#39;hdobs&#39;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="vm">__dict__</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
            <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span>
                <span class="s2">&quot;hdobs needs to be read into the &#39;recon&#39; object first. Use the &#39;ReconDataset.get_hdobs()&#39; method to read in HDOBs data.&quot;</span><span class="p">)</span>

        <span class="n">prop</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s1">&#39;hdobs&#39;</span><span class="p">:</span> <span class="p">{</span><span class="s1">&#39;ms&#39;</span><span class="p">:</span> <span class="mi">5</span><span class="p">,</span> <span class="s1">&#39;marker&#39;</span><span class="p">:</span> <span class="s1">&#39;o&#39;</span><span class="p">},</span>
            <span class="s1">&#39;dropsondes&#39;</span><span class="p">:</span> <span class="p">{</span><span class="s1">&#39;ms&#39;</span><span class="p">:</span> <span class="mi">25</span><span class="p">,</span> <span class="s1">&#39;marker&#39;</span><span class="p">:</span> <span class="s1">&#39;v&#39;</span><span class="p">},</span>
            <span class="s1">&#39;vdms&#39;</span><span class="p">:</span> <span class="p">{</span><span class="s1">&#39;ms&#39;</span><span class="p">:</span> <span class="mi">100</span><span class="p">,</span> <span class="s1">&#39;marker&#39;</span><span class="p">:</span> <span class="s1">&#39;s&#39;</span><span class="p">}</span>
        <span class="p">}</span>

        <span class="n">hdobs</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">hdobs</span><span class="o">.</span><span class="n">sel</span><span class="p">(</span><span class="n">mission</span><span class="o">=</span><span class="n">mission</span><span class="p">)</span>
        <span class="n">ax</span> <span class="o">=</span> <span class="n">hdobs</span><span class="o">.</span><span class="n">plot_points</span><span class="p">(</span><span class="s1">&#39;pkwnd&#39;</span><span class="p">,</span> <span class="n">prop</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;cmap&#39;</span><span class="p">:</span> <span class="p">{</span>
                               <span class="mi">1</span><span class="p">:</span> <span class="s1">&#39;firebrick&#39;</span><span class="p">,</span> <span class="mi">2</span><span class="p">:</span> <span class="s1">&#39;tomato&#39;</span><span class="p">,</span> <span class="mi">4</span><span class="p">:</span> <span class="s1">&#39;gold&#39;</span><span class="p">,</span> <span class="mi">6</span><span class="p">:</span> <span class="s1">&#39;lemonchiffon&#39;</span><span class="p">},</span> <span class="s1">&#39;levels&#39;</span><span class="p">:</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">200</span><span class="p">),</span> <span class="s1">&#39;ms&#39;</span><span class="p">:</span> <span class="mi">2</span><span class="p">})</span>

        <span class="k">if</span> <span class="s1">&#39;dropsondes&#39;</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="vm">__dict__</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
            <span class="n">dropsondes</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">dropsondes</span><span class="o">.</span><span class="n">sel</span><span class="p">(</span><span class="n">mission</span><span class="o">=</span><span class="n">mission</span><span class="p">)</span>
            <span class="n">drop_lons</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="n">drop_lats</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="k">for</span> <span class="n">drop</span> <span class="ow">in</span> <span class="n">dropsondes</span><span class="o">.</span><span class="n">data</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">isnan</span><span class="p">(</span><span class="n">drop</span><span class="p">[</span><span class="s1">&#39;TOPlon&#39;</span><span class="p">]):</span>
                    <span class="n">drop_lons</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">drop</span><span class="p">[</span><span class="s1">&#39;lon&#39;</span><span class="p">])</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">drop_lons</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">drop</span><span class="p">[</span><span class="s1">&#39;TOPlon&#39;</span><span class="p">])</span>
                <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">isnan</span><span class="p">(</span><span class="n">drop</span><span class="p">[</span><span class="s1">&#39;TOPlat&#39;</span><span class="p">]):</span>
                    <span class="n">drop_lats</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">drop</span><span class="p">[</span><span class="s1">&#39;lat&#39;</span><span class="p">])</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">drop_lats</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">drop</span><span class="p">[</span><span class="s1">&#39;TOPlat&#39;</span><span class="p">])</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">drop_lons</span><span class="p">,</span> <span class="n">drop_lats</span><span class="p">,</span> <span class="n">s</span><span class="o">=</span><span class="mi">50</span><span class="p">,</span> <span class="n">marker</span><span class="o">=</span><span class="s1">&#39;v&#39;</span><span class="p">,</span> <span class="n">edgecolor</span><span class="o">=</span><span class="s1">&#39;w&#39;</span><span class="p">,</span>
                       <span class="n">linewidth</span><span class="o">=</span><span class="mf">0.5</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;darkblue&#39;</span><span class="p">,</span> <span class="n">transform</span><span class="o">=</span><span class="n">ccrs</span><span class="o">.</span><span class="n">PlateCarree</span><span class="p">())</span>

        <span class="k">if</span> <span class="s1">&#39;vdms&#39;</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="vm">__dict__</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
            <span class="n">vdms</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">vdms</span><span class="o">.</span><span class="n">sel</span><span class="p">(</span><span class="n">mission</span><span class="o">=</span><span class="n">mission</span><span class="p">)</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="o">*</span><span class="nb">zip</span><span class="p">(</span><span class="o">*</span><span class="p">[(</span><span class="n">d</span><span class="p">[</span><span class="s1">&#39;lon&#39;</span><span class="p">],</span> <span class="n">d</span><span class="p">[</span><span class="s1">&#39;lat&#39;</span><span class="p">])</span> <span class="k">for</span> <span class="n">d</span> <span class="ow">in</span> <span class="n">vdms</span><span class="o">.</span><span class="n">data</span><span class="p">]),</span> <span class="n">s</span><span class="o">=</span><span class="mi">80</span><span class="p">,</span> <span class="n">marker</span><span class="o">=</span><span class="s1">&#39;H&#39;</span><span class="p">,</span>
                       <span class="n">edgecolor</span><span class="o">=</span><span class="s1">&#39;w&#39;</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;k&#39;</span><span class="p">,</span> <span class="n">transform</span><span class="o">=</span><span class="n">ccrs</span><span class="o">.</span><span class="n">PlateCarree</span><span class="p">())</span>

        <span class="n">title_left</span> <span class="o">=</span> <span class="n">ax</span><span class="o">.</span><span class="n">get_title</span><span class="p">(</span><span class="n">loc</span><span class="o">=</span><span class="s1">&#39;left&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>
        <span class="n">newtitle</span> <span class="o">=</span> <span class="n">title_left</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="s1">&#39;</span><span class="se">\n</span><span class="s1">Recon summary&#39;</span> <span class="o">+</span> \
            <span class="p">[</span><span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="sa">f</span><span class="s1">&#39; for mission </span><span class="si">{</span><span class="n">mission</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">][</span><span class="n">mission</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">]</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="n">newtitle</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">17</span><span class="p">,</span> <span class="n">fontweight</span><span class="o">=</span><span class="s1">&#39;bold&#39;</span><span class="p">,</span> <span class="n">loc</span><span class="o">=</span><span class="s1">&#39;left&#39;</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">save_path</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">save_path</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="n">save_path</span><span class="p">,</span> <span class="n">bbox_inches</span><span class="o">=</span><span class="s1">&#39;tight&#39;</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">ax</span></div></div>


<div class="viewcode-block" id="hdobs"><a class="viewcode-back" href="../../../api/generated/tropycal.recon.hdobs.html#tropycal.recon.hdobs">[docs]</a><span class="k">class</span> <span class="nc">hdobs</span><span class="p">:</span>

<span class="w">    </span><span class="sa">r</span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Creates an instance of an HDOBs object containing all recon High Density Observations (HDOBs) for a single storm.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    storm : tropycal.tracks.Storm</span>
<span class="sd">        Requested storm.</span>
<span class="sd">    data : str, optional</span>
<span class="sd">        Filepath of pickle file containing HDOBs data retrieved from ``hdobs.to_pickle()``. If provided, data will be retrieved from the local pickle file instead of the NHC server.</span>
<span class="sd">    update : bool</span>
<span class="sd">        If True, search for new data, following existing data in the dropsonde object, and concatenate. Default is False.</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    Dataset</span>
<span class="sd">        An instance of HDOBs, initialized with a dataframe of HDOB.</span>

<span class="sd">    Notes</span>
<span class="sd">    -----</span>
<span class="sd">    .. warning::</span>

<span class="sd">        Recon data is currently only available from 1989 onwards.</span>

<span class="sd">    There are two recommended ways of retrieving an hdob object. Since the ``ReconDataset``, ``hdobs``, ``dropsondes`` and ``vdms`` classes are **storm-centric**, a Storm object is required for both methods.</span>

<span class="sd">    .. code-block:: python</span>

<span class="sd">        #Retrieve Hurricane Michael (2018) from TrackDataset</span>
<span class="sd">        basin = tracks.TrackDataset()</span>
<span class="sd">        storm = basin.get_storm((&#39;michael&#39;,2018))</span>

<span class="sd">    The first method is to use the empty instance of ReconDataset already initialized in the Storm object, which has a ``get_hdobs()`` method thus allowing all of the hdobs attributes and methods to be accessed from the Storm object. As a result, a Storm object does not need to be provided as an argument.</span>

<span class="sd">    .. code-block:: python</span>

<span class="sd">        #Retrieve all HDOBs for this storm</span>
<span class="sd">        storm.recon.get_hdobs()</span>

<span class="sd">        #Retrieve the raw HDOBs data</span>
<span class="sd">        storm.recon.hdobs.data</span>

<span class="sd">        #Use the plot_points() method of hdobs</span>
<span class="sd">        storm.recon.hdobs.plot_points()</span>

<span class="sd">    The second method is to use the hdobs class independently of the other recon classes:</span>

<span class="sd">    .. code-block:: python</span>

<span class="sd">        from tropycal.recon import hdobs</span>

<span class="sd">        #Retrieve all HDOBs for this storm, passing the Storm object as an argument</span>
<span class="sd">        hdobs_obj = hdobs(storm)</span>

<span class="sd">        #Retrieve the raw HDOBs data</span>
<span class="sd">        hdobs_obj.data</span>

<span class="sd">        #Use the plot_points() method of hdobs</span>
<span class="sd">        hdobs_obj.plot_points()</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="fm">__repr__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>

        <span class="n">summary</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;&lt;tropycal.recon.hdobs&gt;&quot;</span><span class="p">]</span>

        <span class="c1"># Find maximum wind and minimum pressure</span>
        <span class="n">max_wspd</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nanmax</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;wspd&#39;</span><span class="p">])</span>
        <span class="n">max_pkwnd</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nanmax</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;pkwnd&#39;</span><span class="p">])</span>
        <span class="n">max_sfmr</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nanmax</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;sfmr&#39;</span><span class="p">])</span>
        <span class="n">min_psfc</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nanmin</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;p_sfc&#39;</span><span class="p">])</span>
        <span class="n">time_range</span> <span class="o">=</span> <span class="p">[</span><span class="n">pd</span><span class="o">.</span><span class="n">to_datetime</span><span class="p">(</span><span class="n">t</span><span class="p">)</span> <span class="k">for</span> <span class="n">t</span> <span class="ow">in</span> <span class="p">(</span>
            <span class="n">np</span><span class="o">.</span><span class="n">nanmin</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;time&#39;</span><span class="p">]),</span> <span class="n">np</span><span class="o">.</span><span class="n">nanmax</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;time&#39;</span><span class="p">]))]</span>

        <span class="c1"># Add general summary</span>
        <span class="n">emdash</span> <span class="o">=</span> <span class="s1">&#39;</span><span class="se">\u2014</span><span class="s1">&#39;</span>
        <span class="n">summary_keys</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s1">&#39;Storm&#39;</span><span class="p">:</span> <span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">storm</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s1"> </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">storm</span><span class="o">.</span><span class="n">year</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">,</span>
            <span class="s1">&#39;Missions&#39;</span><span class="p">:</span> <span class="nb">len</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;mission&#39;</span><span class="p">])),</span>
            <span class="s1">&#39;Time range&#39;</span><span class="p">:</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">time_range</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="si">:</span><span class="s2">%b-%d %H:%M</span><span class="si">}</span><span class="s2"> </span><span class="si">{</span><span class="n">emdash</span><span class="si">}</span><span class="s2"> </span><span class="si">{</span><span class="n">time_range</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="si">:</span><span class="s2">%b-%d %H:%M</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span>
            <span class="s1">&#39;Max 30sec flight level wind&#39;</span><span class="p">:</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">max_wspd</span><span class="si">}</span><span class="s2"> knots&quot;</span><span class="p">,</span>
            <span class="s1">&#39;Max 10sec flight level wind&#39;</span><span class="p">:</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">max_pkwnd</span><span class="si">}</span><span class="s2"> knots&quot;</span><span class="p">,</span>
            <span class="s1">&#39;Max SFMR wind&#39;</span><span class="p">:</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">max_sfmr</span><span class="si">}</span><span class="s2"> knots&quot;</span><span class="p">,</span>
            <span class="s1">&#39;Min surface pressure&#39;</span><span class="p">:</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">min_psfc</span><span class="si">}</span><span class="s2"> hPa&quot;</span><span class="p">,</span>
            <span class="s1">&#39;Source&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">source</span>
        <span class="p">}</span>

        <span class="c1"># Add dataset summary</span>
        <span class="n">summary</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;Dataset Summary:&quot;</span><span class="p">)</span>
        <span class="n">add_space</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">([</span><span class="nb">len</span><span class="p">(</span><span class="n">key</span><span class="p">)</span> <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="n">summary_keys</span><span class="o">.</span><span class="n">keys</span><span class="p">()])</span> <span class="o">+</span> <span class="mi">3</span>
        <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="n">summary_keys</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
            <span class="n">key_name</span> <span class="o">=</span> <span class="n">key</span> <span class="o">+</span> <span class="s2">&quot;:&quot;</span>
            <span class="n">summary</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
                <span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="s2">&quot; &quot;</span><span class="o">*</span><span class="mi">4</span><span class="si">}{</span><span class="n">key_name</span><span class="si">:</span><span class="s1">&lt;</span><span class="si">{</span><span class="n">add_space</span><span class="si">}}{</span><span class="n">summary_keys</span><span class="p">[</span><span class="n">key</span><span class="p">]</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>

        <span class="k">return</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">summary</span><span class="p">)</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">storm</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">update</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">storm</span> <span class="o">=</span> <span class="n">storm</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">data</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">format</span> <span class="o">=</span> <span class="mi">1</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">source</span> <span class="o">=</span> <span class="s1">&#39;National Hurricane Center (NHC)&#39;</span>

        <span class="c1"># Get URL based on storm year</span>
        <span class="k">if</span> <span class="n">storm</span><span class="o">.</span><span class="n">year</span> <span class="o">&gt;=</span> <span class="mi">2012</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">format</span> <span class="o">=</span> <span class="mi">1</span>
            <span class="k">if</span> <span class="n">storm</span><span class="o">.</span><span class="n">basin</span> <span class="o">==</span> <span class="s1">&#39;north_atlantic&#39;</span><span class="p">:</span>
                <span class="n">archive_url</span> <span class="o">=</span> <span class="p">[</span>
                    <span class="sa">f</span><span class="s1">&#39;https://www.nhc.noaa.gov/archive/recon/</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">storm</span><span class="o">.</span><span class="n">year</span><span class="si">}</span><span class="s1">/AHONT1/&#39;</span><span class="p">]</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">archive_url</span> <span class="o">=</span> <span class="p">[</span>
                    <span class="sa">f</span><span class="s1">&#39;https://www.nhc.noaa.gov/archive/recon/</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">storm</span><span class="o">.</span><span class="n">year</span><span class="si">}</span><span class="s1">/AHOPN1/&#39;</span><span class="p">]</span>
        <span class="k">elif</span> <span class="n">storm</span><span class="o">.</span><span class="n">year</span> <span class="o">&lt;=</span> <span class="mi">2011</span> <span class="ow">and</span> <span class="n">storm</span><span class="o">.</span><span class="n">year</span> <span class="o">&gt;=</span> <span class="mi">2008</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">format</span> <span class="o">=</span> <span class="mi">2</span>
            <span class="k">if</span> <span class="n">storm</span><span class="o">.</span><span class="n">basin</span> <span class="o">==</span> <span class="s1">&#39;north_atlantic&#39;</span><span class="p">:</span>
                <span class="n">archive_url</span> <span class="o">=</span> <span class="p">[</span><span class="sa">f</span><span class="s1">&#39;https://www.nhc.noaa.gov/archive/recon/</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">storm</span><span class="o">.</span><span class="n">year</span><span class="si">}</span><span class="s1">/HDOB/NOAA/URNT15/&#39;</span><span class="p">,</span>
                               <span class="sa">f</span><span class="s1">&#39;https://www.nhc.noaa.gov/archive/recon/</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">storm</span><span class="o">.</span><span class="n">year</span><span class="si">}</span><span class="s1">/HDOB/USAF/URNT15/&#39;</span><span class="p">]</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">archive_url</span> <span class="o">=</span> <span class="p">[</span><span class="sa">f</span><span class="s1">&#39;https://www.nhc.noaa.gov/archive/recon/</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">storm</span><span class="o">.</span><span class="n">year</span><span class="si">}</span><span class="s1">/HDOB/NOAA/URPN15/&#39;</span><span class="p">,</span>
                               <span class="sa">f</span><span class="s1">&#39;https://www.nhc.noaa.gov/archive/recon/</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">storm</span><span class="o">.</span><span class="n">year</span><span class="si">}</span><span class="s1">/HDOB/USAF/URPN15/&#39;</span><span class="p">]</span>
        <span class="k">elif</span> <span class="n">storm</span><span class="o">.</span><span class="n">year</span> <span class="o">==</span> <span class="mi">2007</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">format</span> <span class="o">=</span> <span class="mi">3</span>
            <span class="n">archive_url</span> <span class="o">=</span> <span class="p">[</span><span class="sa">f</span><span class="s1">&#39;https://www.nhc.noaa.gov/archive/recon/</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">storm</span><span class="o">.</span><span class="n">year</span><span class="si">}</span><span class="s1">/HDOB/NOAA/&#39;</span><span class="p">,</span>
                           <span class="sa">f</span><span class="s1">&#39;https://www.nhc.noaa.gov/archive/recon/</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">storm</span><span class="o">.</span><span class="n">year</span><span class="si">}</span><span class="s1">/HDOB/USAF/&#39;</span><span class="p">]</span>
        <span class="k">elif</span> <span class="n">storm</span><span class="o">.</span><span class="n">year</span> <span class="o">==</span> <span class="mi">2006</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">format</span> <span class="o">=</span> <span class="mi">4</span>
            <span class="n">archive_url</span> <span class="o">=</span> <span class="p">[</span>
                <span class="sa">f</span><span class="s1">&#39;https://www.nhc.noaa.gov/archive/recon/</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">storm</span><span class="o">.</span><span class="n">year</span><span class="si">}</span><span class="s1">/HDOB/&#39;</span><span class="p">]</span>
        <span class="k">elif</span> <span class="n">storm</span><span class="o">.</span><span class="n">year</span> <span class="o">&gt;=</span> <span class="mi">2002</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">format</span> <span class="o">=</span> <span class="mi">5</span>
            <span class="n">archive_url</span> <span class="o">=</span> <span class="p">[</span>
                <span class="sa">f</span><span class="s1">&#39;https://www.nhc.noaa.gov/archive/recon/</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">storm</span><span class="o">.</span><span class="n">year</span><span class="si">}</span><span class="s1">/</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">storm</span><span class="o">.</span><span class="n">name</span><span class="o">.</span><span class="n">upper</span><span class="p">()</span><span class="si">}</span><span class="s1">/&#39;</span><span class="p">]</span>
        <span class="k">elif</span> <span class="n">storm</span><span class="o">.</span><span class="n">year</span> <span class="o">&lt;=</span> <span class="mi">2001</span> <span class="ow">and</span> <span class="n">storm</span><span class="o">.</span><span class="n">year</span> <span class="o">&gt;=</span> <span class="mi">1989</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">format</span> <span class="o">=</span> <span class="mi">6</span>
            <span class="n">archive_url</span> <span class="o">=</span> <span class="p">[</span>
                <span class="sa">f</span><span class="s1">&#39;https://www.nhc.noaa.gov/archive/recon/</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">storm</span><span class="o">.</span><span class="n">year</span><span class="si">}</span><span class="s1">/</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">storm</span><span class="o">.</span><span class="n">name</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span><span class="si">}</span><span class="s1">/&#39;</span><span class="p">]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span><span class="s2">&quot;Recon data is not available prior to 1989.&quot;</span><span class="p">)</span>

        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
            <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="s1">&#39;rb&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">data</span> <span class="o">=</span> <span class="n">pickle</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">f</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">data</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">data</span> <span class="o">=</span> <span class="n">data</span>

        <span class="k">if</span> <span class="n">data</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">or</span> <span class="n">update</span><span class="p">:</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">start_time</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;time&#39;</span><span class="p">])</span>
            <span class="k">except</span><span class="p">:</span>
                <span class="n">start_time</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">storm</span><span class="o">.</span><span class="n">dict</span><span class="p">[</span><span class="s1">&#39;time&#39;</span><span class="p">])</span> <span class="o">-</span> <span class="n">timedelta</span><span class="p">(</span><span class="n">hours</span><span class="o">=</span><span class="mi">12</span><span class="p">)</span>
            <span class="n">end_time</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">storm</span><span class="o">.</span><span class="n">dict</span><span class="p">[</span><span class="s1">&#39;time&#39;</span><span class="p">])</span> <span class="o">+</span> <span class="n">timedelta</span><span class="p">(</span><span class="n">hours</span><span class="o">=</span><span class="mi">12</span><span class="p">)</span>

            <span class="n">timestr</span> <span class="o">=</span> <span class="p">[</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">start_time</span><span class="si">:</span><span class="s1">%Y%m%d</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">]</span> <span class="o">+</span>\
                      <span class="p">[</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">t</span><span class="si">:</span><span class="s1">%Y%m%d</span><span class="si">}</span><span class="s1">&#39;</span> <span class="k">for</span> <span class="n">t</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">storm</span><span class="o">.</span><span class="n">dict</span><span class="p">[</span><span class="s1">&#39;time&#39;</span><span class="p">]</span> <span class="k">if</span> <span class="n">t</span> <span class="o">&gt;</span> <span class="n">start_time</span><span class="p">]</span> <span class="o">+</span>\
                      <span class="p">[</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">end_time</span><span class="si">:</span><span class="s1">%Y%m%d</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">]</span>

            <span class="c1"># Retrieve list of files in URL(s) and filter by storm dates</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">format</span> <span class="ow">in</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">]:</span>
                <span class="n">page</span> <span class="o">=</span> <span class="n">requests</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">archive_url</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span><span class="o">.</span><span class="n">text</span>
                <span class="n">content</span> <span class="o">=</span> <span class="n">page</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
                <span class="n">files</span> <span class="o">=</span> <span class="p">[]</span>
                <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="n">content</span><span class="p">:</span>
                    <span class="k">if</span> <span class="s2">&quot;.txt&quot;</span> <span class="ow">in</span> <span class="n">line</span><span class="p">:</span>
                        <span class="n">files</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
                            <span class="p">((</span><span class="n">line</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;txt&quot;&gt;&#39;</span><span class="p">)[</span><span class="mi">1</span><span class="p">])</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;&lt;/a&gt;&quot;</span><span class="p">)[</span><span class="mi">0</span><span class="p">])</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;.&quot;</span><span class="p">))</span>
                <span class="k">del</span> <span class="n">content</span>
                <span class="n">files</span> <span class="o">=</span> <span class="nb">sorted</span><span class="p">([</span><span class="n">i</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">files</span> <span class="k">if</span> <span class="n">i</span><span class="p">[</span><span class="mi">1</span><span class="p">][:</span><span class="mi">8</span><span class="p">]</span>
                               <span class="ow">in</span> <span class="n">timestr</span><span class="p">],</span> <span class="n">key</span><span class="o">=</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
                <span class="n">linksub</span> <span class="o">=</span> <span class="p">[</span><span class="n">archive_url</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="s1">&#39;.&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">l</span><span class="p">)</span> <span class="k">for</span> <span class="n">l</span> <span class="ow">in</span> <span class="n">files</span><span class="p">]</span>
            <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">format</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>
                <span class="n">linksub</span> <span class="o">=</span> <span class="p">[]</span>
                <span class="k">for</span> <span class="n">url</span> <span class="ow">in</span> <span class="n">archive_url</span><span class="p">:</span>
                    <span class="n">files</span> <span class="o">=</span> <span class="p">[]</span>
                    <span class="n">page</span> <span class="o">=</span> <span class="n">requests</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">url</span><span class="p">)</span><span class="o">.</span><span class="n">text</span>
                    <span class="n">content</span> <span class="o">=</span> <span class="n">page</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
                    <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="n">content</span><span class="p">:</span>
                        <span class="k">if</span> <span class="s2">&quot;.txt&quot;</span> <span class="ow">in</span> <span class="n">line</span><span class="p">:</span>
                            <span class="n">files</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
                                <span class="p">((</span><span class="n">line</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;txt&quot;&gt;&#39;</span><span class="p">)[</span><span class="mi">1</span><span class="p">])</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;&lt;/a&gt;&quot;</span><span class="p">)[</span><span class="mi">0</span><span class="p">])</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;.&quot;</span><span class="p">))</span>
                    <span class="k">del</span> <span class="n">content</span>
                    <span class="n">linksub</span> <span class="o">+=</span> <span class="nb">sorted</span><span class="p">([</span><span class="n">url</span> <span class="o">+</span> <span class="s1">&#39;.&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">i</span><span class="p">)</span>
                                      <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">files</span> <span class="k">if</span> <span class="n">i</span><span class="p">[</span><span class="mi">1</span><span class="p">][:</span><span class="mi">8</span><span class="p">]</span> <span class="ow">in</span> <span class="n">timestr</span><span class="p">],</span> <span class="n">key</span><span class="o">=</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
                <span class="n">linksub</span> <span class="o">=</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">linksub</span><span class="p">)</span>
            <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">format</span> <span class="o">==</span> <span class="mi">5</span><span class="p">:</span>
                <span class="n">page</span> <span class="o">=</span> <span class="n">requests</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">archive_url</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span><span class="o">.</span><span class="n">text</span>
                <span class="n">content</span> <span class="o">=</span> <span class="n">page</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
                <span class="n">files</span> <span class="o">=</span> <span class="p">[]</span>
                <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="n">content</span><span class="p">:</span>
                    <span class="k">if</span> <span class="s2">&quot;.txt&quot;</span> <span class="ow">in</span> <span class="n">line</span> <span class="ow">and</span> <span class="s1">&#39;HDOBS&#39;</span> <span class="ow">in</span> <span class="n">line</span><span class="p">:</span>
                        <span class="n">files</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
                            <span class="p">((</span><span class="n">line</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;txt&quot;&gt;&#39;</span><span class="p">)[</span><span class="mi">1</span><span class="p">])</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;&lt;/a&gt;&quot;</span><span class="p">)[</span><span class="mi">0</span><span class="p">]))</span>
                <span class="k">del</span> <span class="n">content</span>
                <span class="n">linksub</span> <span class="o">=</span> <span class="p">[</span><span class="n">archive_url</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="n">l</span> <span class="k">for</span> <span class="n">l</span> <span class="ow">in</span> <span class="n">files</span><span class="p">]</span>
            <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">format</span> <span class="o">==</span> <span class="mi">6</span><span class="p">:</span>
                <span class="n">page</span> <span class="o">=</span> <span class="n">requests</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">archive_url</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span><span class="o">.</span><span class="n">text</span>
                <span class="n">content</span> <span class="o">=</span> <span class="n">page</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
                <span class="n">files</span> <span class="o">=</span> <span class="p">[]</span>
                <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="n">content</span><span class="p">:</span>
                    <span class="k">if</span> <span class="s2">&quot;.txt&quot;</span> <span class="ow">in</span> <span class="n">line</span><span class="p">:</span>
                        <span class="n">files</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
                            <span class="p">((</span><span class="n">line</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;txt&quot;&gt;&#39;</span><span class="p">)[</span><span class="mi">1</span><span class="p">])</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;&lt;/a&gt;&quot;</span><span class="p">)[</span><span class="mi">0</span><span class="p">]))</span>
                <span class="k">del</span> <span class="n">content</span>
                <span class="n">linksub</span> <span class="o">=</span> <span class="p">[</span><span class="n">archive_url</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="n">l</span> <span class="k">for</span> <span class="n">l</span> <span class="ow">in</span> <span class="n">files</span> <span class="k">if</span> <span class="n">l</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
                           <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;H&#39;</span><span class="p">,</span> <span class="s1">&#39;h&#39;</span><span class="p">,</span> <span class="s1">&#39;M&#39;</span><span class="p">,</span> <span class="s1">&#39;m&#39;</span><span class="p">]]</span>

            <span class="c1"># Initiate urllib3</span>
            <span class="n">urllib3</span><span class="o">.</span><span class="n">disable_warnings</span><span class="p">()</span>
            <span class="n">http</span> <span class="o">=</span> <span class="n">urllib3</span><span class="o">.</span><span class="n">PoolManager</span><span class="p">()</span>

            <span class="c1"># Read through all files</span>
            <span class="n">timer_start</span> <span class="o">=</span> <span class="n">dt</span><span class="o">.</span><span class="n">now</span><span class="p">()</span>
            <span class="nb">print</span><span class="p">(</span>
                <span class="sa">f</span><span class="s1">&#39;Searching through recon HDOB files between </span><span class="si">{</span><span class="n">timestr</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="si">}</span><span class="s1"> and </span><span class="si">{</span><span class="n">timestr</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="si">}</span><span class="s1"> ...&#39;</span><span class="p">)</span>
            <span class="n">filecount</span><span class="p">,</span> <span class="n">unreadable</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span>
            <span class="n">found</span> <span class="o">=</span> <span class="kc">False</span>
            <span class="k">for</span> <span class="n">link</span> <span class="ow">in</span> <span class="n">linksub</span><span class="p">:</span>

                <span class="c1"># Read URL</span>
                <span class="n">response</span> <span class="o">=</span> <span class="n">http</span><span class="o">.</span><span class="n">request</span><span class="p">(</span><span class="s1">&#39;GET&#39;</span><span class="p">,</span> <span class="n">link</span><span class="p">)</span>
                <span class="n">content</span> <span class="o">=</span> <span class="n">response</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">decode</span><span class="p">(</span><span class="s1">&#39;utf-8&#39;</span><span class="p">)</span>

                <span class="c1"># Find mission name line</span>
                <span class="n">row</span> <span class="o">=</span> <span class="mi">3</span> <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">format</span> <span class="o">&lt;=</span> <span class="mi">4</span> <span class="k">else</span> <span class="mi">0</span>
                <span class="k">while</span> <span class="nb">len</span><span class="p">(</span><span class="n">content</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)[</span><span class="n">row</span><span class="p">])</span> <span class="o">&lt;</span> <span class="mi">3</span> <span class="ow">or</span> <span class="n">content</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)[</span><span class="n">row</span><span class="p">][:</span><span class="mi">3</span><span class="p">]</span> <span class="ow">in</span> <span class="p">[</span><span class="s2">&quot;SXX&quot;</span><span class="p">,</span> <span class="s2">&quot;URN&quot;</span><span class="p">,</span> <span class="s2">&quot;URP&quot;</span><span class="p">,</span> <span class="s2">&quot;YYX&quot;</span><span class="p">]:</span>
                    <span class="n">row</span> <span class="o">+=</span> <span class="mi">1</span>
                    <span class="k">if</span> <span class="n">row</span> <span class="o">&gt;=</span> <span class="mi">100</span><span class="p">:</span>
                        <span class="k">break</span>
                <span class="k">if</span> <span class="n">row</span> <span class="o">&gt;=</span> <span class="mi">100</span><span class="p">:</span>
                    <span class="k">continue</span>
                <span class="n">missionname</span> <span class="o">=</span> <span class="p">[</span><span class="n">i</span><span class="o">.</span><span class="n">split</span><span class="p">()</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">content</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)][</span><span class="n">row</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span>

                <span class="c1"># Check for mission name to storm match by format</span>
                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">format</span> <span class="o">!=</span> <span class="mi">6</span><span class="p">:</span>
                    <span class="n">check</span> <span class="o">=</span> <span class="n">missionname</span><span class="p">[</span><span class="mi">2</span><span class="p">:</span><span class="mi">5</span><span class="p">]</span> <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">storm</span><span class="o">.</span><span class="n">operational_id</span><span class="p">[</span><span class="mi">2</span><span class="p">:</span><span class="mi">4</span><span class="p">]</span> <span class="o">+</span> \
                        <span class="bp">self</span><span class="o">.</span><span class="n">storm</span><span class="o">.</span><span class="n">operational_id</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">check</span> <span class="o">=</span> <span class="kc">True</span>

                <span class="c1"># Read HDOBs if this file matches the requested storm</span>
                <span class="k">if</span> <span class="n">check</span><span class="p">:</span>
                    <span class="n">filecount</span> <span class="o">+=</span> <span class="mi">1</span>

                    <span class="k">try</span><span class="p">:</span>

                        <span class="c1"># Decode HDOBs by format</span>
                        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">format</span> <span class="o">&lt;=</span> <span class="mi">3</span><span class="p">:</span>
                            <span class="n">iter_hdob</span> <span class="o">=</span> <span class="n">decode_hdob</span><span class="p">(</span><span class="n">content</span><span class="p">,</span> <span class="n">mission_row</span><span class="o">=</span><span class="n">row</span><span class="p">)</span>
                        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">format</span> <span class="o">==</span> <span class="mi">4</span><span class="p">:</span>
                            <span class="n">strdate</span> <span class="o">=</span> <span class="p">(</span><span class="n">link</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;.&#39;</span><span class="p">)[</span><span class="o">-</span><span class="mi">2</span><span class="p">])[:</span><span class="mi">8</span><span class="p">]</span>
                            <span class="n">iter_hdob</span> <span class="o">=</span> <span class="n">decode_hdob_2006</span><span class="p">(</span>
                                <span class="n">content</span><span class="p">,</span> <span class="n">strdate</span><span class="p">,</span> <span class="n">mission_row</span><span class="o">=</span><span class="n">row</span><span class="p">)</span>
                        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">format</span> <span class="o">==</span> <span class="mi">6</span><span class="p">:</span>
                            <span class="c1"># Check for date</span>
                            <span class="n">day</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">content</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)[</span>
                                      <span class="n">row</span> <span class="o">-</span> <span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">split</span><span class="p">()[</span><span class="mi">2</span><span class="p">][:</span><span class="mi">2</span><span class="p">])</span>
                            <span class="k">for</span> <span class="n">iter_date</span> <span class="ow">in</span> <span class="n">storm</span><span class="o">.</span><span class="n">dict</span><span class="p">[</span><span class="s1">&#39;time&#39;</span><span class="p">]:</span>
                                <span class="n">found_date</span> <span class="o">=</span> <span class="kc">False</span>
                                <span class="k">if</span> <span class="n">iter_date</span><span class="o">.</span><span class="n">day</span> <span class="o">==</span> <span class="n">day</span><span class="p">:</span>
                                    <span class="n">date</span> <span class="o">=</span> <span class="n">dt</span><span class="p">(</span><span class="n">iter_date</span><span class="o">.</span><span class="n">year</span><span class="p">,</span>
                                              <span class="n">iter_date</span><span class="o">.</span><span class="n">month</span><span class="p">,</span> <span class="n">iter_date</span><span class="o">.</span><span class="n">day</span><span class="p">)</span>
                                    <span class="n">strdate</span> <span class="o">=</span> <span class="n">date</span><span class="o">.</span><span class="n">strftime</span><span class="p">(</span><span class="s1">&#39;%Y%m</span><span class="si">%d</span><span class="s1">&#39;</span><span class="p">)</span>
                                    <span class="n">found_date</span> <span class="o">=</span> <span class="kc">True</span>
                                    <span class="k">break</span>
                            <span class="k">if</span> <span class="ow">not</span> <span class="n">found_date</span><span class="p">:</span>
                                <span class="k">continue</span>
                            <span class="n">iter_hdob</span> <span class="o">=</span> <span class="n">decode_hdob_2006</span><span class="p">(</span>
                                <span class="n">content</span><span class="p">,</span> <span class="n">strdate</span><span class="p">,</span> <span class="n">mission_row</span><span class="o">=</span><span class="n">row</span><span class="p">)</span>
                        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">format</span> <span class="o">==</span> <span class="mi">5</span><span class="p">:</span>
                            <span class="c1"># Split content by 10/20 minute blocks</span>
                            <span class="n">strdate</span> <span class="o">=</span> <span class="p">(</span><span class="n">link</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;.&#39;</span><span class="p">)[</span><span class="o">-</span><span class="mi">3</span><span class="p">])</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;_&quot;</span><span class="p">)[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
                            <span class="n">content_split</span> <span class="o">=</span> <span class="n">content</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;NNNN&quot;</span><span class="p">)</span>
                            <span class="n">iter_hdob</span> <span class="o">=</span> <span class="kc">None</span>
                            <span class="k">for</span> <span class="n">iter_content</span> <span class="ow">in</span> <span class="n">content_split</span><span class="p">:</span>
                                <span class="n">iter_split</span> <span class="o">=</span> <span class="n">iter_content</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
                                <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">iter_split</span><span class="p">)</span> <span class="o">&lt;</span> <span class="mi">10</span><span class="p">:</span>
                                    <span class="k">continue</span>

                                <span class="c1"># Search for starting line of data within sub-block</span>
                                <span class="n">found</span> <span class="o">=</span> <span class="kc">False</span>
                                <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="n">iter_split</span><span class="p">:</span>
                                    <span class="k">if</span> <span class="n">missionname</span> <span class="ow">in</span> <span class="n">line</span><span class="p">:</span>
                                        <span class="n">found</span> <span class="o">=</span> <span class="kc">True</span>
                                <span class="n">temp_row</span> <span class="o">=</span> <span class="mi">0</span>
                                <span class="k">while</span> <span class="nb">len</span><span class="p">(</span><span class="n">iter_split</span><span class="p">[</span><span class="n">temp_row</span><span class="p">])</span> <span class="o">&lt;</span> <span class="mi">3</span> <span class="ow">or</span> <span class="n">iter_split</span><span class="p">[</span><span class="n">temp_row</span><span class="p">][:</span><span class="mi">3</span><span class="p">]</span> <span class="ow">in</span> <span class="p">[</span><span class="s2">&quot;SXX&quot;</span><span class="p">,</span> <span class="s2">&quot;URN&quot;</span><span class="p">,</span> <span class="s2">&quot;URP&quot;</span><span class="p">]:</span>
                                    <span class="n">temp_row</span> <span class="o">+=</span> <span class="mi">1</span>
                                    <span class="k">if</span> <span class="n">temp_row</span> <span class="o">&gt;=</span> <span class="mi">100</span><span class="p">:</span>
                                        <span class="k">break</span>
                                <span class="k">if</span> <span class="n">temp_row</span> <span class="o">&gt;=</span> <span class="mi">100</span><span class="p">:</span>
                                    <span class="k">break</span>

                                <span class="c1"># Parse data by format</span>
                                <span class="k">if</span> <span class="s1">&#39;NOAA&#39;</span> <span class="ow">in</span> <span class="n">link</span><span class="p">:</span>
                                    <span class="n">iter_hdob_loop</span> <span class="o">=</span> <span class="n">decode_hdob_2005_noaa</span><span class="p">(</span>
                                        <span class="n">iter_content</span><span class="p">,</span> <span class="n">strdate</span><span class="p">,</span> <span class="n">temp_row</span><span class="p">)</span>
                                <span class="k">else</span><span class="p">:</span>
                                    <span class="n">iter_hdob_loop</span> <span class="o">=</span> <span class="n">decode_hdob_2006</span><span class="p">(</span>
                                        <span class="n">iter_content</span><span class="p">,</span> <span class="n">strdate</span><span class="p">,</span> <span class="n">temp_row</span><span class="p">)</span>

                                <span class="c1"># Append HDOBs to full data</span>
                                <span class="k">if</span> <span class="n">iter_hdob</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                                    <span class="n">iter_hdob</span> <span class="o">=</span> <span class="n">copy</span><span class="o">.</span><span class="n">copy</span><span class="p">(</span><span class="n">iter_hdob_loop</span><span class="p">)</span>
                                <span class="k">elif</span> <span class="nb">max</span><span class="p">(</span><span class="n">iter_hdob_loop</span><span class="p">[</span><span class="s1">&#39;time&#39;</span><span class="p">])</span> <span class="o">&gt;</span> <span class="n">start_time</span><span class="p">:</span>
                                    <span class="n">iter_hdob</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">(</span>
                                        <span class="p">[</span><span class="n">iter_hdob</span><span class="p">,</span> <span class="n">iter_hdob_loop</span><span class="p">])</span>
                                <span class="k">else</span><span class="p">:</span>
                                    <span class="k">pass</span>

                        <span class="c1"># Append HDOBs to full data</span>
                        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                            <span class="bp">self</span><span class="o">.</span><span class="n">data</span> <span class="o">=</span> <span class="n">copy</span><span class="o">.</span><span class="n">copy</span><span class="p">(</span><span class="n">iter_hdob</span><span class="p">)</span>
                        <span class="k">elif</span> <span class="nb">max</span><span class="p">(</span><span class="n">iter_hdob</span><span class="p">[</span><span class="s1">&#39;time&#39;</span><span class="p">])</span> <span class="o">&gt;</span> <span class="n">start_time</span><span class="p">:</span>
                            <span class="bp">self</span><span class="o">.</span><span class="n">data</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">([</span><span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">,</span> <span class="n">iter_hdob</span><span class="p">])</span>
                        <span class="k">else</span><span class="p">:</span>
                            <span class="k">pass</span>

                    <span class="k">except</span><span class="p">:</span>
                        <span class="n">unreadable</span> <span class="o">+=</span> <span class="mi">1</span>

            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;--&gt; Completed reading in recon HDOB files (</span><span class="si">{</span><span class="p">(</span><span class="n">dt</span><span class="o">.</span><span class="n">now</span><span class="p">()</span><span class="o">-</span><span class="n">timer_start</span><span class="p">)</span><span class="o">.</span><span class="n">total_seconds</span><span class="p">()</span><span class="si">:</span><span class="s1">.1f</span><span class="si">}</span><span class="s1"> seconds)&#39;</span> <span class="o">+</span>
                  <span class="sa">f</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">Read </span><span class="si">{</span><span class="n">filecount</span><span class="si">}</span><span class="s1"> files&#39;</span> <span class="o">+</span>
                  <span class="sa">f</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">Unable to decode </span><span class="si">{</span><span class="n">unreadable</span><span class="si">}</span><span class="s1"> files&#39;</span><span class="p">)</span>

        <span class="c1"># This code will crash if no HDOBs are available</span>
        <span class="k">try</span><span class="p">:</span>

            <span class="c1"># Sort data by time</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">sort_values</span><span class="p">([</span><span class="s1">&#39;time&#39;</span><span class="p">],</span> <span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

            <span class="c1"># Recenter</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_recenter</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">keys</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span>

        <span class="k">except</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">keys</span> <span class="o">=</span> <span class="p">[]</span>

<div class="viewcode-block" id="hdobs.update"><a class="viewcode-back" href="../../../api/generated/tropycal.recon.hdobs.update.html#tropycal.recon.hdobs.update">[docs]</a>    <span class="k">def</span> <span class="nf">update</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sa">r</span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Update with the latest data for an ongoing storm.</span>

<span class="sd">        Notes</span>
<span class="sd">        -----</span>
<span class="sd">        This function has no return value, but simply updates the internal HDOB data with new observations since the object was created.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="bp">self</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">storm</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">storm</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">,</span> <span class="n">update</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span></div>

    <span class="k">def</span> <span class="nf">_find_centers</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>

        <span class="k">if</span> <span class="n">data</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">data</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span>
        <span class="n">data</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">sort_values</span><span class="p">([</span><span class="s1">&#39;mission&#39;</span><span class="p">,</span> <span class="s1">&#39;time&#39;</span><span class="p">])</span>

        <span class="k">def</span> <span class="nf">fill_nan</span><span class="p">(</span><span class="n">A</span><span class="p">):</span>
            <span class="c1"># Interpolate to fill nan values</span>
            <span class="n">A</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">A</span><span class="p">)</span>
            <span class="n">inds</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">A</span><span class="p">))</span>
            <span class="n">good</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">isfinite</span><span class="p">(</span><span class="n">A</span><span class="p">))</span>
            <span class="n">good_grad</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">interp</span><span class="p">(</span><span class="n">inds</span><span class="p">,</span> <span class="n">good</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">np</span><span class="o">.</span><span class="n">gradient</span><span class="p">(</span><span class="n">good</span><span class="p">[</span><span class="mi">0</span><span class="p">]))</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">good</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span> <span class="o">&gt;=</span> <span class="mi">3</span><span class="p">:</span>
                <span class="n">f</span> <span class="o">=</span> <span class="n">interp1d</span><span class="p">(</span><span class="n">inds</span><span class="p">[</span><span class="n">good</span><span class="p">],</span> <span class="n">A</span><span class="p">[</span><span class="n">good</span><span class="p">],</span>
                             <span class="n">bounds_error</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">kind</span><span class="o">=</span><span class="s1">&#39;quadratic&#39;</span><span class="p">)</span>
                <span class="n">B</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">((</span><span class="n">np</span><span class="o">.</span><span class="n">isfinite</span><span class="p">(</span><span class="n">A</span><span class="p">)[</span><span class="n">good</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">]:</span><span class="n">good</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="mi">1</span><span class="p">])</span> <span class="o">|</span> <span class="p">(</span><span class="n">good_grad</span><span class="p">[</span><span class="n">good</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">]:</span><span class="n">good</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="mi">1</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mi">3</span><span class="p">),</span>
                             <span class="n">A</span><span class="p">[</span><span class="n">good</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">]:</span><span class="n">good</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="mi">1</span><span class="p">],</span>
                             <span class="n">f</span><span class="p">(</span><span class="n">inds</span><span class="p">[</span><span class="n">good</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">]:</span><span class="n">good</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="mi">1</span><span class="p">]))</span>
                <span class="k">return</span> <span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">nan</span><span class="p">]</span> <span class="o">*</span> <span class="n">good</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="nb">list</span><span class="p">(</span><span class="n">B</span><span class="p">)</span> <span class="o">+</span> <span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">nan</span><span class="p">]</span> <span class="o">*</span> <span class="p">(</span><span class="n">inds</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="n">good</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">return</span> <span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">nan</span><span class="p">]</span> <span class="o">*</span> <span class="nb">len</span><span class="p">(</span><span class="n">A</span><span class="p">)</span>

        <span class="n">missiondata</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="s1">&#39;mission&#39;</span><span class="p">)</span>
        <span class="n">dfs</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">group</span> <span class="ow">in</span> <span class="n">missiondata</span><span class="p">:</span>
            <span class="n">mdata</span> <span class="o">=</span> <span class="n">group</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
            <span class="c1"># Check that sfc pressure spread is big enough to identify real minima</span>
            <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">nanpercentile</span><span class="p">(</span><span class="n">mdata</span><span class="p">[</span><span class="s1">&#39;p_sfc&#39;</span><span class="p">],</span> <span class="mi">95</span><span class="p">)</span> <span class="o">-</span> <span class="n">np</span><span class="o">.</span><span class="n">nanpercentile</span><span class="p">(</span><span class="n">mdata</span><span class="p">[</span><span class="s1">&#39;p_sfc&#39;</span><span class="p">],</span> <span class="mi">5</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">8</span><span class="p">:</span>
                <span class="c1"># Interp p_sfc across missing data</span>
                <span class="n">p_sfc_interp</span> <span class="o">=</span> <span class="n">fill_nan</span><span class="p">(</span><span class="n">mdata</span><span class="p">[</span><span class="s1">&#39;p_sfc&#39;</span><span class="p">])</span>
                <span class="c1"># Interp wspd across missing data</span>
                <span class="n">wspd_interp</span> <span class="o">=</span> <span class="n">fill_nan</span><span class="p">(</span><span class="n">mdata</span><span class="p">[</span><span class="s1">&#39;wspd&#39;</span><span class="p">])</span>
                <span class="c1"># Smooth p_sfc and wspd</span>
                <span class="n">p_sfc_smooth</span> <span class="o">=</span> <span class="p">[</span>
                    <span class="n">np</span><span class="o">.</span><span class="n">nan</span><span class="p">]</span> <span class="o">*</span> <span class="mi">1</span> <span class="o">+</span> <span class="nb">list</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">convolve</span><span class="p">(</span><span class="n">p_sfc_interp</span><span class="p">,</span> <span class="p">[</span><span class="mi">1</span> <span class="o">/</span> <span class="mi">3</span><span class="p">]</span> <span class="o">*</span> <span class="mi">3</span><span class="p">,</span> <span class="n">mode</span><span class="o">=</span><span class="s1">&#39;valid&#39;</span><span class="p">))</span> <span class="o">+</span> <span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">nan</span><span class="p">]</span> <span class="o">*</span> <span class="mi">1</span>
                <span class="n">wspd_smooth</span> <span class="o">=</span> <span class="p">[</span>
                    <span class="n">np</span><span class="o">.</span><span class="n">nan</span><span class="p">]</span> <span class="o">*</span> <span class="mi">1</span> <span class="o">+</span> <span class="nb">list</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">convolve</span><span class="p">(</span><span class="n">wspd_interp</span><span class="p">,</span> <span class="p">[</span><span class="mi">1</span> <span class="o">/</span> <span class="mi">3</span><span class="p">]</span> <span class="o">*</span> <span class="mi">3</span><span class="p">,</span> <span class="n">mode</span><span class="o">=</span><span class="s1">&#39;valid&#39;</span><span class="p">))</span> <span class="o">+</span> <span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">nan</span><span class="p">]</span> <span class="o">*</span> <span class="mi">1</span>
                <span class="c1"># Add wspd to p_sfc to encourage finding p mins with wspd mins</span>
                <span class="c1"># and prevent finding p mins in intense thunderstorms</span>
                <span class="n">pw_test</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">p_sfc_smooth</span><span class="p">)</span> <span class="o">+</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">wspd_smooth</span><span class="p">)</span> <span class="o">*</span> <span class="mf">.1</span>
                <span class="c1"># Find mins in 20-minute windows</span>
                <span class="n">imin</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nonzero</span><span class="p">(</span><span class="n">pw_test</span> <span class="o">==</span> <span class="n">minimum_filter</span><span class="p">(</span><span class="n">pw_test</span><span class="p">,</span> <span class="mi">40</span><span class="p">))[</span><span class="mi">0</span><span class="p">]</span>
                <span class="c1"># Only use mins if below 10th %ile of mission p_sfc data and when plane p is 550-950mb</span>
                <span class="c1"># and not in takeoff and landing time windows</span>
                <span class="n">plane_p</span> <span class="o">=</span> <span class="n">fill_nan</span><span class="p">(</span><span class="n">mdata</span><span class="p">[</span><span class="s1">&#39;plane_p&#39;</span><span class="p">])</span>
                <span class="n">imin</span> <span class="o">=</span> <span class="p">[</span><span class="n">i</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">imin</span> <span class="k">if</span> <span class="mi">800</span> <span class="o">&lt;</span> <span class="n">p_sfc_interp</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">&lt;</span> <span class="n">np</span><span class="o">.</span><span class="n">nanpercentile</span><span class="p">(</span><span class="n">mdata</span><span class="p">[</span><span class="s1">&#39;p_sfc&#39;</span><span class="p">],</span> <span class="mi">10</span><span class="p">)</span> <span class="ow">and</span>
                        <span class="mi">550</span> <span class="o">&lt;</span> <span class="n">plane_p</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">&lt;</span> <span class="mi">950</span> <span class="ow">and</span> <span class="n">i</span> <span class="o">&gt;</span> <span class="mi">60</span> <span class="ow">and</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="nb">len</span><span class="p">(</span><span class="n">mdata</span><span class="p">)</span> <span class="o">-</span> <span class="mi">60</span><span class="p">]</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">imin</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="n">mdata</span><span class="p">[</span><span class="s1">&#39;iscenter&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span>
                <span class="p">[</span><span class="mi">1</span> <span class="k">if</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">imin</span> <span class="k">else</span> <span class="mi">0</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">mdata</span><span class="p">))])</span>
            <span class="n">dfs</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">mdata</span><span class="p">)</span>

        <span class="n">data</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">(</span><span class="n">dfs</span><span class="p">)</span>
        <span class="n">numcenters</span> <span class="o">=</span> <span class="nb">sum</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;iscenter&#39;</span><span class="p">])</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Found </span><span class="si">{</span><span class="n">numcenters</span><span class="si">}</span><span class="s1"> center passes&#39;</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">data</span>

    <span class="k">def</span> <span class="nf">_recenter</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">data</span> <span class="o">=</span> <span class="n">copy</span><span class="o">.</span><span class="n">copy</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">)</span>
        <span class="c1"># Interpolate center position to time of each ob</span>
        <span class="n">interp_clon</span><span class="p">,</span> <span class="n">interp_clat</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">storm</span><span class="o">.</span><span class="n">recon</span><span class="o">.</span><span class="n">get_track</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;time&#39;</span><span class="p">])</span>

        <span class="c1"># Get x,y distance of each ob from coinciding interped center position</span>
        <span class="n">data</span><span class="p">[</span><span class="s1">&#39;xdist&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="n">great_circle</span><span class="p">((</span><span class="n">interp_clat</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">interp_clon</span><span class="p">[</span><span class="n">i</span><span class="p">]),</span>
                                      <span class="p">(</span><span class="n">interp_clat</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">data</span><span class="p">[</span><span class="s1">&#39;lon&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="p">[</span><span class="n">i</span><span class="p">]))</span><span class="o">.</span><span class="n">kilometers</span> <span class="o">*</span>
                         <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">][</span><span class="nb">int</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;lon&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">&lt;</span> <span class="n">interp_clon</span><span class="p">[</span><span class="n">i</span><span class="p">])]</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">data</span><span class="p">))]</span>
        <span class="n">data</span><span class="p">[</span><span class="s1">&#39;ydist&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="n">great_circle</span><span class="p">((</span><span class="n">interp_clat</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">interp_clon</span><span class="p">[</span><span class="n">i</span><span class="p">]),</span>
                                      <span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;lat&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">interp_clon</span><span class="p">[</span><span class="n">i</span><span class="p">]))</span><span class="o">.</span><span class="n">kilometers</span> <span class="o">*</span>
                         <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">][</span><span class="nb">int</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;lat&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">&lt;</span> <span class="n">interp_clat</span><span class="p">[</span><span class="n">i</span><span class="p">])]</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">data</span><span class="p">))]</span>
        <span class="n">data</span><span class="p">[</span><span class="s1">&#39;distance&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[(</span><span class="n">i</span><span class="o">**</span><span class="mi">2</span> <span class="o">+</span> <span class="n">j</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span><span class="o">**</span><span class="mf">.5</span> <span class="k">for</span> <span class="n">i</span><span class="p">,</span>
                            <span class="n">j</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;xdist&#39;</span><span class="p">],</span> <span class="n">data</span><span class="p">[</span><span class="s1">&#39;ydist&#39;</span><span class="p">])]</span>

        <span class="n">imin</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nonzero</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;distance&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">values</span> <span class="o">==</span>
                          <span class="n">minimum_filter</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;distance&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="p">,</span> <span class="mi">40</span><span class="p">))[</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">data</span><span class="p">[</span><span class="s1">&#39;iscenter&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span>
            <span class="p">[</span><span class="mi">1</span> <span class="k">if</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">imin</span> <span class="ow">and</span> <span class="n">data</span><span class="p">[</span><span class="s1">&#39;distance&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">&lt;</span> <span class="mi">10</span> <span class="k">else</span> <span class="mi">0</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">data</span><span class="p">))])</span>

        <span class="c1"># print(&#39;Completed hdob center-relative coordinates&#39;)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">data</span> <span class="o">=</span> <span class="n">data</span>

<div class="viewcode-block" id="hdobs.sel"><a class="viewcode-back" href="../../../api/generated/tropycal.recon.hdobs.sel.html#tropycal.recon.hdobs.sel">[docs]</a>    <span class="k">def</span> <span class="nf">sel</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">mission</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">time</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">domain</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">plane_p</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">plane_z</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">p_sfc</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
            <span class="n">temp</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">dwpt</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">wdir</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">wspd</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">pkwnd</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">sfmr</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">noflag</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
            <span class="n">iscenter</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">distance</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
<span class="w">        </span><span class="sa">r</span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Select a subset of HDOBs by any of its parameters and return a new hdobs object.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        mission : str</span>
<span class="sd">            Mission name (number + storm id), e.g. mission 7 for AL05 is &#39;0705L&#39;</span>
<span class="sd">        time : list/tuple of datetimes</span>
<span class="sd">            list/tuple of start time and end time datetime objects.</span>
<span class="sd">            Default is None, which returns all points</span>
<span class="sd">        domain : dict</span>
<span class="sd">            dictionary with keys &#39;n&#39;, &#39;s&#39;, &#39;e&#39;, &#39;w&#39; corresponding to boundaries of domain</span>
<span class="sd">        plane_p : list/tuple of float/int</span>
<span class="sd">            list/tuple of plane_p bounds (min,max).</span>
<span class="sd">            None in either position of a tuple means it is boundless on that side. </span>
<span class="sd">        plane_z : list/tuple of float/int</span>
<span class="sd">            list/tuple of plane_z bounds (min,max).</span>
<span class="sd">            None in either position of a tuple means it is boundless on that side.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        hdobs object</span>
<span class="sd">            A new hdobs object that satisfies the intersection of all subsetting.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">NEW_DATA</span> <span class="o">=</span> <span class="n">copy</span><span class="o">.</span><span class="n">copy</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">)</span>

        <span class="c1"># Apply mission filter</span>
        <span class="k">if</span> <span class="n">mission</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">mission</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">mission</span><span class="p">)</span>
            <span class="n">NEW_DATA</span> <span class="o">=</span> <span class="n">NEW_DATA</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">NEW_DATA</span><span class="p">[</span><span class="s1">&#39;mission&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="n">mission</span><span class="p">]</span>

        <span class="c1"># Apply time filter</span>
        <span class="k">if</span> <span class="n">time</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">bounds</span> <span class="o">=</span> <span class="n">get_bounds</span><span class="p">(</span><span class="n">NEW_DATA</span><span class="p">[</span><span class="s1">&#39;time&#39;</span><span class="p">],</span> <span class="n">time</span><span class="p">)</span>
            <span class="n">NEW_DATA</span> <span class="o">=</span> <span class="n">NEW_DATA</span><span class="o">.</span><span class="n">loc</span><span class="p">[(</span><span class="n">NEW_DATA</span><span class="p">[</span><span class="s1">&#39;time&#39;</span><span class="p">]</span> <span class="o">&gt;</span> <span class="n">bounds</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span> <span class="o">&amp;</span> <span class="p">(</span>
                <span class="n">NEW_DATA</span><span class="p">[</span><span class="s1">&#39;time&#39;</span><span class="p">]</span> <span class="o">&lt;</span> <span class="n">bounds</span><span class="p">[</span><span class="mi">1</span><span class="p">])]</span>

        <span class="c1"># Apply domain filter</span>
        <span class="k">if</span> <span class="n">domain</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">tmp</span> <span class="o">=</span> <span class="p">{</span><span class="n">k</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">lower</span><span class="p">():</span> <span class="n">v</span> <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">domain</span><span class="o">.</span><span class="n">items</span><span class="p">()}</span>
            <span class="n">domain</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;n&#39;</span><span class="p">:</span> <span class="mi">90</span><span class="p">,</span> <span class="s1">&#39;s&#39;</span><span class="p">:</span> <span class="o">-</span><span class="mi">90</span><span class="p">,</span> <span class="s1">&#39;e&#39;</span><span class="p">:</span> <span class="mf">359.99</span><span class="p">,</span> <span class="s1">&#39;w&#39;</span><span class="p">:</span> <span class="mi">0</span><span class="p">}</span>
            <span class="n">domain</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">tmp</span><span class="p">)</span>
            <span class="n">bounds</span> <span class="o">=</span> <span class="n">get_bounds</span><span class="p">(</span>
                <span class="n">NEW_DATA</span><span class="p">[</span><span class="s1">&#39;lon&#39;</span><span class="p">]</span> <span class="o">%</span> <span class="mi">360</span><span class="p">,</span> <span class="p">(</span><span class="n">domain</span><span class="p">[</span><span class="s1">&#39;w&#39;</span><span class="p">]</span> <span class="o">%</span> <span class="mi">360</span><span class="p">,</span> <span class="n">domain</span><span class="p">[</span><span class="s1">&#39;e&#39;</span><span class="p">]</span> <span class="o">%</span> <span class="mi">360</span><span class="p">))</span>
            <span class="n">NEW_DATA</span> <span class="o">=</span> <span class="n">NEW_DATA</span><span class="o">.</span><span class="n">loc</span><span class="p">[(</span><span class="n">NEW_DATA</span><span class="p">[</span><span class="s1">&#39;lon&#39;</span><span class="p">]</span> <span class="o">%</span> <span class="mi">360</span> <span class="o">&gt;=</span> <span class="n">bounds</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span> <span class="o">&amp;</span> <span class="p">(</span>
                <span class="n">NEW_DATA</span><span class="p">[</span><span class="s1">&#39;lon&#39;</span><span class="p">]</span> <span class="o">%</span> <span class="mi">360</span> <span class="o">&lt;=</span> <span class="n">bounds</span><span class="p">[</span><span class="mi">1</span><span class="p">])]</span>
            <span class="n">bounds</span> <span class="o">=</span> <span class="n">get_bounds</span><span class="p">(</span><span class="n">NEW_DATA</span><span class="p">[</span><span class="s1">&#39;lat&#39;</span><span class="p">],</span> <span class="p">(</span><span class="n">domain</span><span class="p">[</span><span class="s1">&#39;s&#39;</span><span class="p">],</span> <span class="n">domain</span><span class="p">[</span><span class="s1">&#39;n&#39;</span><span class="p">]))</span>
            <span class="n">NEW_DATA</span> <span class="o">=</span> <span class="n">NEW_DATA</span><span class="o">.</span><span class="n">loc</span><span class="p">[(</span><span class="n">NEW_DATA</span><span class="p">[</span><span class="s1">&#39;lat&#39;</span><span class="p">]</span> <span class="o">&gt;=</span> <span class="n">bounds</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span> <span class="o">&amp;</span> <span class="p">(</span>
                <span class="n">NEW_DATA</span><span class="p">[</span><span class="s1">&#39;lat&#39;</span><span class="p">]</span> <span class="o">&lt;=</span> <span class="n">bounds</span><span class="p">[</span><span class="mi">1</span><span class="p">])]</span>

        <span class="c1"># Apply flight pressure filter</span>
        <span class="k">if</span> <span class="n">plane_p</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">bounds</span> <span class="o">=</span> <span class="n">get_bounds</span><span class="p">(</span><span class="n">NEW_DATA</span><span class="p">[</span><span class="s1">&#39;plane_p&#39;</span><span class="p">],</span> <span class="n">plane_p</span><span class="p">)</span>
            <span class="n">NEW_DATA</span> <span class="o">=</span> <span class="n">NEW_DATA</span><span class="o">.</span><span class="n">loc</span><span class="p">[(</span><span class="n">NEW_DATA</span><span class="p">[</span><span class="s1">&#39;plane_p&#39;</span><span class="p">]</span> <span class="o">&gt;</span> <span class="n">bounds</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span> <span class="o">&amp;</span> <span class="p">(</span>
                <span class="n">NEW_DATA</span><span class="p">[</span><span class="s1">&#39;plane_p&#39;</span><span class="p">]</span> <span class="o">&lt;</span> <span class="n">bounds</span><span class="p">[</span><span class="mi">1</span><span class="p">])]</span>

        <span class="c1"># Apply flight height filter</span>
        <span class="k">if</span> <span class="n">plane_z</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">bounds</span> <span class="o">=</span> <span class="n">get_bounds</span><span class="p">(</span><span class="n">NEW_DATA</span><span class="p">[</span><span class="s1">&#39;plane_z&#39;</span><span class="p">],</span> <span class="n">plane_z</span><span class="p">)</span>
            <span class="n">NEW_DATA</span> <span class="o">=</span> <span class="n">NEW_DATA</span><span class="o">.</span><span class="n">loc</span><span class="p">[(</span><span class="n">NEW_DATA</span><span class="p">[</span><span class="s1">&#39;plane_z&#39;</span><span class="p">]</span> <span class="o">&gt;</span> <span class="n">bounds</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span> <span class="o">&amp;</span> <span class="p">(</span>
                <span class="n">NEW_DATA</span><span class="p">[</span><span class="s1">&#39;plane_z&#39;</span><span class="p">]</span> <span class="o">&lt;</span> <span class="n">bounds</span><span class="p">[</span><span class="mi">1</span><span class="p">])]</span>

        <span class="c1"># Apply surface pressure filter</span>
        <span class="k">if</span> <span class="n">p_sfc</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">bounds</span> <span class="o">=</span> <span class="n">get_bounds</span><span class="p">(</span><span class="n">NEW_DATA</span><span class="p">[</span><span class="s1">&#39;p_sfc&#39;</span><span class="p">],</span> <span class="n">p_sfc</span><span class="p">)</span>
            <span class="n">NEW_DATA</span> <span class="o">=</span> <span class="n">NEW_DATA</span><span class="o">.</span><span class="n">loc</span><span class="p">[(</span><span class="n">NEW_DATA</span><span class="p">[</span><span class="s1">&#39;p_sfc&#39;</span><span class="p">]</span> <span class="o">&gt;</span> <span class="n">bounds</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span> <span class="o">&amp;</span> <span class="p">(</span>
                <span class="n">NEW_DATA</span><span class="p">[</span><span class="s1">&#39;p_sfc&#39;</span><span class="p">]</span> <span class="o">&lt;</span> <span class="n">bounds</span><span class="p">[</span><span class="mi">1</span><span class="p">])]</span>

        <span class="c1"># Apply temperature filter</span>
        <span class="k">if</span> <span class="n">temp</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">bounds</span> <span class="o">=</span> <span class="n">get_bounds</span><span class="p">(</span><span class="n">NEW_DATA</span><span class="p">[</span><span class="s1">&#39;temp&#39;</span><span class="p">],</span> <span class="n">temp</span><span class="p">)</span>
            <span class="n">NEW_DATA</span> <span class="o">=</span> <span class="n">NEW_DATA</span><span class="o">.</span><span class="n">loc</span><span class="p">[(</span><span class="n">NEW_DATA</span><span class="p">[</span><span class="s1">&#39;temp&#39;</span><span class="p">]</span> <span class="o">&gt;</span> <span class="n">bounds</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span> <span class="o">&amp;</span> <span class="p">(</span>
                <span class="n">NEW_DATA</span><span class="p">[</span><span class="s1">&#39;temp&#39;</span><span class="p">]</span> <span class="o">&lt;</span> <span class="n">bounds</span><span class="p">[</span><span class="mi">1</span><span class="p">])]</span>

        <span class="c1"># Apply dew point filter</span>
        <span class="k">if</span> <span class="n">dwpt</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">bounds</span> <span class="o">=</span> <span class="n">get_bounds</span><span class="p">(</span><span class="n">NEW_DATA</span><span class="p">[</span><span class="s1">&#39;dwpt&#39;</span><span class="p">],</span> <span class="n">dwpt</span><span class="p">)</span>
            <span class="n">NEW_DATA</span> <span class="o">=</span> <span class="n">NEW_DATA</span><span class="o">.</span><span class="n">loc</span><span class="p">[(</span><span class="n">NEW_DATA</span><span class="p">[</span><span class="s1">&#39;dwpt&#39;</span><span class="p">]</span> <span class="o">&gt;</span> <span class="n">bounds</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span> <span class="o">&amp;</span> <span class="p">(</span>
                <span class="n">NEW_DATA</span><span class="p">[</span><span class="s1">&#39;dwpt&#39;</span><span class="p">]</span> <span class="o">&lt;</span> <span class="n">bounds</span><span class="p">[</span><span class="mi">1</span><span class="p">])]</span>

        <span class="c1"># Apply wind direction filter</span>
        <span class="k">if</span> <span class="n">wdir</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">bounds</span> <span class="o">=</span> <span class="n">get_bounds</span><span class="p">(</span><span class="n">NEW_DATA</span><span class="p">[</span><span class="s1">&#39;wdir&#39;</span><span class="p">],</span> <span class="n">wdir</span><span class="p">)</span>
            <span class="n">NEW_DATA</span> <span class="o">=</span> <span class="n">NEW_DATA</span><span class="o">.</span><span class="n">loc</span><span class="p">[(</span><span class="n">NEW_DATA</span><span class="p">[</span><span class="s1">&#39;wdir&#39;</span><span class="p">]</span> <span class="o">&gt;</span> <span class="n">bounds</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span> <span class="o">&amp;</span> <span class="p">(</span>
                <span class="n">NEW_DATA</span><span class="p">[</span><span class="s1">&#39;wdir&#39;</span><span class="p">]</span> <span class="o">&lt;</span> <span class="n">bounds</span><span class="p">[</span><span class="mi">1</span><span class="p">])]</span>

        <span class="c1"># Apply wind speed filter</span>
        <span class="k">if</span> <span class="n">wspd</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">bounds</span> <span class="o">=</span> <span class="n">get_bounds</span><span class="p">(</span><span class="n">NEW_DATA</span><span class="p">[</span><span class="s1">&#39;wspd&#39;</span><span class="p">],</span> <span class="n">wspd</span><span class="p">)</span>
            <span class="n">NEW_DATA</span> <span class="o">=</span> <span class="n">NEW_DATA</span><span class="o">.</span><span class="n">loc</span><span class="p">[(</span><span class="n">NEW_DATA</span><span class="p">[</span><span class="s1">&#39;wspd&#39;</span><span class="p">]</span> <span class="o">&gt;</span> <span class="n">bounds</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span> <span class="o">&amp;</span> <span class="p">(</span>
                <span class="n">NEW_DATA</span><span class="p">[</span><span class="s1">&#39;wspd&#39;</span><span class="p">]</span> <span class="o">&lt;</span> <span class="n">bounds</span><span class="p">[</span><span class="mi">1</span><span class="p">])]</span>

        <span class="c1"># Apply peak wind filter</span>
        <span class="k">if</span> <span class="n">pkwnd</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">bounds</span> <span class="o">=</span> <span class="n">get_bounds</span><span class="p">(</span><span class="n">NEW_DATA</span><span class="p">[</span><span class="s1">&#39;pkwnd&#39;</span><span class="p">],</span> <span class="n">pkwnd</span><span class="p">)</span>
            <span class="n">NEW_DATA</span> <span class="o">=</span> <span class="n">NEW_DATA</span><span class="o">.</span><span class="n">loc</span><span class="p">[(</span><span class="n">NEW_DATA</span><span class="p">[</span><span class="s1">&#39;pkwnd&#39;</span><span class="p">]</span> <span class="o">&gt;</span> <span class="n">bounds</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span> <span class="o">&amp;</span> <span class="p">(</span>
                <span class="n">NEW_DATA</span><span class="p">[</span><span class="s1">&#39;pkwnd&#39;</span><span class="p">]</span> <span class="o">&lt;</span> <span class="n">bounds</span><span class="p">[</span><span class="mi">1</span><span class="p">])]</span>

        <span class="c1"># Apply sfmr filter</span>
        <span class="k">if</span> <span class="n">sfmr</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">bounds</span> <span class="o">=</span> <span class="n">get_bounds</span><span class="p">(</span><span class="n">NEW_DATA</span><span class="p">[</span><span class="s1">&#39;sfmr&#39;</span><span class="p">],</span> <span class="n">sfmr</span><span class="p">)</span>
            <span class="n">NEW_DATA</span> <span class="o">=</span> <span class="n">NEW_DATA</span><span class="o">.</span><span class="n">loc</span><span class="p">[(</span><span class="n">NEW_DATA</span><span class="p">[</span><span class="s1">&#39;sfmr&#39;</span><span class="p">]</span> <span class="o">&gt;</span> <span class="n">bounds</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span> <span class="o">&amp;</span> <span class="p">(</span>
                <span class="n">NEW_DATA</span><span class="p">[</span><span class="s1">&#39;sfmr&#39;</span><span class="p">]</span> <span class="o">&lt;</span> <span class="n">bounds</span><span class="p">[</span><span class="mi">1</span><span class="p">])]</span>

        <span class="c1"># Apply iscenter filter</span>
        <span class="k">if</span> <span class="n">iscenter</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">NEW_DATA</span> <span class="o">=</span> <span class="n">NEW_DATA</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">NEW_DATA</span><span class="p">[</span><span class="s1">&#39;iscenter&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="n">iscenter</span><span class="p">]</span>

        <span class="c1"># Apply distance filter</span>
        <span class="k">if</span> <span class="n">distance</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">NEW_DATA</span> <span class="o">=</span> <span class="n">NEW_DATA</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">NEW_DATA</span><span class="p">[</span><span class="s1">&#39;distance&#39;</span><span class="p">]</span> <span class="o">&lt;</span> <span class="n">distance</span><span class="p">]</span>

        <span class="n">NEW_OBJ</span> <span class="o">=</span> <span class="n">hdobs</span><span class="p">(</span><span class="n">storm</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">storm</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="n">NEW_DATA</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">NEW_OBJ</span></div>

<div class="viewcode-block" id="hdobs.to_pickle"><a class="viewcode-back" href="../../../api/generated/tropycal.recon.hdobs.to_pickle.html#tropycal.recon.hdobs.to_pickle">[docs]</a>    <span class="k">def</span> <span class="nf">to_pickle</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">filename</span><span class="p">):</span>
<span class="w">        </span><span class="sa">r</span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Save HDOB data (Pandas dataframe) to a pickle file.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        filename : str</span>
<span class="sd">            name of file to save pickle file to.</span>

<span class="sd">        Notes</span>
<span class="sd">        -----</span>
<span class="sd">        This method saves the HDOBs data as a pickle within the current working directory, given a filename as an argument.</span>

<span class="sd">        For example, assume ``hdobs`` was retrieved from a Storm object (using the first method described in the ``hdobs`` class documentation). The HDOBs data would be saved to a pickle file as follows:</span>

<span class="sd">        &gt;&gt;&gt; storm.recon.hdobs.to_pickle(&quot;mystorm_hdobs.pickle&quot;)</span>

<span class="sd">        Now the HDOBs data is saved locally, and next time recon data for this storm needs to be analyzed, this allows to bypass re-reading the HDOBs data from the NHC server by providing the pickle file as an argument:</span>

<span class="sd">        &gt;&gt;&gt; storm.recon.get_hdobs(&quot;mystorm_hdobs.pickle&quot;)</span>

<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">filename</span><span class="p">,</span> <span class="s1">&#39;wb&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
            <span class="n">pickle</span><span class="o">.</span><span class="n">dump</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">,</span> <span class="n">f</span><span class="p">)</span></div>

<div class="viewcode-block" id="hdobs.plot_time_series"><a class="viewcode-back" href="../../../api/generated/tropycal.recon.hdobs.plot_time_series.html#tropycal.recon.hdobs.plot_time_series">[docs]</a>    <span class="k">def</span> <span class="nf">plot_time_series</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">varname</span><span class="o">=</span><span class="p">(</span><span class="s1">&#39;p_sfc&#39;</span><span class="p">,</span> <span class="s1">&#39;wspd&#39;</span><span class="p">),</span> <span class="n">mission</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">time</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">realtime</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
<span class="w">        </span><span class="sa">r</span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Plots a time series of one or two variables on an axis.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        varname : str or tuple</span>
<span class="sd">            If one variable to plot, varname is a string of the variable name. If two variables to plot, varname is a tuple of the left and right variable names, respectively. Available varnames are:</span>

<span class="sd">            * **p_sfc** - Mean Sea Level Pressure (hPa)</span>
<span class="sd">            * **temp** - Flight Level Temperature (C)</span>
<span class="sd">            * **dwpt** - Flight Level Dewpoint (C)</span>
<span class="sd">            * **wspd** - Flight Level Wind (kt)</span>
<span class="sd">            * **sfmr** - Surface Wind (kt)</span>
<span class="sd">            * **pkwnd** - Peak Wind Gust (kt)</span>
<span class="sd">            * **rain** - Rain Rate (mm/hr)</span>
<span class="sd">            * **plane_z** - Geopotential Height (m)</span>
<span class="sd">            * **plane_p** - Pressure (hPa)</span>
<span class="sd">        mission : int</span>
<span class="sd">            Mission number to plot. If None, all missions for this storm are plotted.</span>
<span class="sd">        time : tuple</span>
<span class="sd">            Tuple of start and end times (datetime.datetime) to plot. If None, all times available are plotted.</span>
<span class="sd">        realtime : bool</span>
<span class="sd">            If True, the most recent 2 hours of the mission will plot, overriding the time argument. Default is False.</span>

<span class="sd">        Other Parameters</span>
<span class="sd">        ----------------</span>
<span class="sd">        left_prop : dict</span>
<span class="sd">            Dictionary of properties for the left line. Scroll down for more information.</span>
<span class="sd">        right_prop : dict</span>
<span class="sd">            Dictionary of properties for the right line. Scroll down for more information.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        ax</span>
<span class="sd">            Instance of axes containing the plot is returned.</span>

<span class="sd">        Notes</span>
<span class="sd">        -----</span>
<span class="sd">        The following properties are available for customizing the plot, via ``left_prop`` and ``right_prop``.</span>

<span class="sd">        .. list-table:: </span>
<span class="sd">           :widths: 25 75</span>
<span class="sd">           :header-rows: 1</span>

<span class="sd">           * - Property</span>
<span class="sd">             - Description</span>
<span class="sd">           * - ms</span>
<span class="sd">             - Marker size. If zero, none will be plotted. Default is zero.</span>
<span class="sd">           * - color</span>
<span class="sd">             - Color of lines (and markers if used). Default varies per varname.</span>
<span class="sd">           * - linewidth</span>
<span class="sd">             - Line width. Default is 1.0.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="c1"># Pop kwargs</span>
        <span class="n">left_prop</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;left_prop&#39;</span><span class="p">,</span> <span class="p">{})</span>
        <span class="n">right_prop</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;right_prop&#39;</span><span class="p">,</span> <span class="p">{})</span>

        <span class="c1"># Retrieve variables</span>
        <span class="n">twin_ax</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">varname</span><span class="p">,</span> <span class="nb">tuple</span><span class="p">):</span>
            <span class="n">varname_right</span> <span class="o">=</span> <span class="n">varname</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
            <span class="n">varname</span> <span class="o">=</span> <span class="n">varname</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
            <span class="n">twin_ax</span> <span class="o">=</span> <span class="kc">True</span>
            <span class="n">varname_right_info</span> <span class="o">=</span> <span class="n">time_series_plot</span><span class="p">(</span><span class="n">varname_right</span><span class="p">)</span>
        <span class="n">varname_info</span> <span class="o">=</span> <span class="n">time_series_plot</span><span class="p">(</span><span class="n">varname</span><span class="p">)</span>

        <span class="c1"># Filter by mission</span>
        <span class="k">def</span> <span class="nf">str2</span><span class="p">(</span><span class="n">number</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">number</span> <span class="o">&lt;</span> <span class="mi">10</span><span class="p">:</span>
                <span class="k">return</span> <span class="sa">f</span><span class="s1">&#39;0</span><span class="si">{</span><span class="n">number</span><span class="si">}</span><span class="s1">&#39;</span>
            <span class="k">return</span> <span class="nb">str</span><span class="p">(</span><span class="n">number</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">mission</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">df</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;mission&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="n">str2</span><span class="p">(</span><span class="n">mission</span><span class="p">)]</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">df</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Mission number provided is invalid.&quot;</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">df</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span>

        <span class="c1"># Filter by time or realtime flag</span>
        <span class="k">if</span> <span class="n">realtime</span><span class="p">:</span>
            <span class="n">end_time</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">to_datetime</span><span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;time&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span>
            <span class="n">df</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[(</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;time&#39;</span><span class="p">]</span> <span class="o">&gt;=</span> <span class="n">end_time</span> <span class="o">-</span> <span class="n">timedelta</span><span class="p">(</span><span class="n">hours</span><span class="o">=</span><span class="mi">2</span><span class="p">))</span>
                        <span class="o">&amp;</span> <span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;time&#39;</span><span class="p">]</span> <span class="o">&lt;=</span> <span class="n">end_time</span><span class="p">)]</span>
        <span class="k">elif</span> <span class="n">time</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">df</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[(</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;time&#39;</span><span class="p">]</span> <span class="o">&gt;=</span> <span class="n">time</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;time&#39;</span><span class="p">]</span> <span class="o">&lt;=</span> <span class="n">time</span><span class="p">[</span><span class="mi">1</span><span class="p">])]</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">df</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Time range provided is invalid.&quot;</span><span class="p">)</span>

        <span class="c1"># Filter by default kwargs</span>
        <span class="n">left_prop_default</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s1">&#39;ms&#39;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span>
            <span class="s1">&#39;color&#39;</span><span class="p">:</span> <span class="n">varname_info</span><span class="p">[</span><span class="s1">&#39;color&#39;</span><span class="p">],</span>
            <span class="s1">&#39;linewidth&#39;</span><span class="p">:</span> <span class="mi">1</span>
        <span class="p">}</span>
        <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="n">left_prop</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
            <span class="n">left_prop_default</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="n">left_prop</span><span class="p">[</span><span class="n">key</span><span class="p">]</span>
        <span class="n">left_prop</span> <span class="o">=</span> <span class="n">left_prop_default</span>
        <span class="k">if</span> <span class="n">twin_ax</span><span class="p">:</span>
            <span class="n">right_prop_default</span> <span class="o">=</span> <span class="p">{</span>
                <span class="s1">&#39;ms&#39;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span>
                <span class="s1">&#39;color&#39;</span><span class="p">:</span> <span class="n">varname_right_info</span><span class="p">[</span><span class="s1">&#39;color&#39;</span><span class="p">],</span>
                <span class="s1">&#39;linewidth&#39;</span><span class="p">:</span> <span class="mi">1</span>
            <span class="p">}</span>
            <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="n">right_prop</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
                <span class="n">right_prop_default</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="n">right_prop</span><span class="p">[</span><span class="n">key</span><span class="p">]</span>
            <span class="n">right_prop</span> <span class="o">=</span> <span class="n">right_prop_default</span>

        <span class="c1"># ----------------------------------------------------------------------------------</span>

        <span class="c1"># Create figure</span>
        <span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">9</span><span class="p">,</span> <span class="mi">6</span><span class="p">),</span> <span class="n">dpi</span><span class="o">=</span><span class="mi">200</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">twin_ax</span><span class="p">:</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="s1">&#39;x&#39;</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">grid</span><span class="p">()</span>

        <span class="c1"># Plot line</span>
        <span class="n">line1</span> <span class="o">=</span> <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;time&#39;</span><span class="p">],</span> <span class="n">df</span><span class="p">[</span><span class="n">varname</span><span class="p">],</span> <span class="n">color</span><span class="o">=</span><span class="n">left_prop</span><span class="p">[</span><span class="s1">&#39;color&#39;</span><span class="p">],</span>
                        <span class="n">linewidth</span><span class="o">=</span><span class="n">left_prop</span><span class="p">[</span><span class="s1">&#39;linewidth&#39;</span><span class="p">],</span> <span class="n">label</span><span class="o">=</span><span class="n">varname_info</span><span class="p">[</span><span class="s1">&#39;name&#39;</span><span class="p">])</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="n">varname_info</span><span class="p">[</span><span class="s1">&#39;full_name&#39;</span><span class="p">])</span>

        <span class="c1"># Plot dots</span>
        <span class="k">if</span> <span class="n">left_prop</span><span class="p">[</span><span class="s1">&#39;ms&#39;</span><span class="p">]</span> <span class="o">&gt;=</span> <span class="mi">1</span><span class="p">:</span>
            <span class="n">plot_times</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="s1">&#39;time&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">values</span>
            <span class="n">plot_var</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="n">varname</span><span class="p">]</span><span class="o">.</span><span class="n">values</span>
            <span class="n">plot_times</span> <span class="o">=</span> <span class="p">[</span><span class="n">plot_times</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span>
                <span class="nb">len</span><span class="p">(</span><span class="n">plot_times</span><span class="p">))</span> <span class="k">if</span> <span class="n">varname</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">df</span><span class="p">[</span><span class="s1">&#39;flag&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="p">[</span><span class="n">i</span><span class="p">]]</span>
            <span class="n">plot_var</span> <span class="o">=</span> <span class="p">[</span><span class="n">plot_var</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span>
                <span class="nb">len</span><span class="p">(</span><span class="n">plot_var</span><span class="p">))</span> <span class="k">if</span> <span class="n">varname</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">df</span><span class="p">[</span><span class="s1">&#39;flag&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="p">[</span><span class="n">i</span><span class="p">]]</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">plot_times</span><span class="p">,</span> <span class="n">plot_var</span><span class="p">,</span> <span class="s1">&#39;o&#39;</span><span class="p">,</span>
                    <span class="n">color</span><span class="o">=</span><span class="n">left_prop</span><span class="p">[</span><span class="s1">&#39;color&#39;</span><span class="p">],</span> <span class="n">ms</span><span class="o">=</span><span class="n">left_prop</span><span class="p">[</span><span class="s1">&#39;ms&#39;</span><span class="p">])</span>

        <span class="c1"># Format x-axis dates</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">xaxis</span><span class="o">.</span><span class="n">set_major_formatter</span><span class="p">(</span><span class="n">mdates</span><span class="o">.</span><span class="n">DateFormatter</span><span class="p">(</span><span class="s1">&#39;%H:%Mz</span><span class="se">\n</span><span class="s1">%m/</span><span class="si">%d</span><span class="s1">&#39;</span><span class="p">))</span>

        <span class="c1"># Add twin axis</span>
        <span class="k">if</span> <span class="n">twin_ax</span><span class="p">:</span>
            <span class="n">ax2</span> <span class="o">=</span> <span class="n">ax</span><span class="o">.</span><span class="n">twinx</span><span class="p">()</span>

            <span class="c1"># Plot line</span>
            <span class="n">line2</span> <span class="o">=</span> <span class="n">ax2</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;time&#39;</span><span class="p">],</span> <span class="n">df</span><span class="p">[</span><span class="n">varname_right</span><span class="p">],</span> <span class="n">color</span><span class="o">=</span><span class="n">right_prop</span><span class="p">[</span><span class="s1">&#39;color&#39;</span><span class="p">],</span>
                             <span class="n">linewidth</span><span class="o">=</span><span class="n">right_prop</span><span class="p">[</span><span class="s1">&#39;linewidth&#39;</span><span class="p">],</span> <span class="n">label</span><span class="o">=</span><span class="n">varname_right_info</span><span class="p">[</span><span class="s1">&#39;name&#39;</span><span class="p">])</span>
            <span class="n">ax2</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="n">varname_right_info</span><span class="p">[</span><span class="s1">&#39;full_name&#39;</span><span class="p">])</span>

            <span class="c1"># Plot dots</span>
            <span class="k">if</span> <span class="n">right_prop</span><span class="p">[</span><span class="s1">&#39;ms&#39;</span><span class="p">]</span> <span class="o">&gt;=</span> <span class="mi">1</span><span class="p">:</span>
                <span class="n">plot_times</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="s1">&#39;time&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">values</span>
                <span class="n">plot_var</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="n">varname_right</span><span class="p">]</span><span class="o">.</span><span class="n">values</span>
                <span class="n">plot_times</span> <span class="o">=</span> <span class="p">[</span><span class="n">plot_times</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span>
                    <span class="nb">len</span><span class="p">(</span><span class="n">plot_times</span><span class="p">))</span> <span class="k">if</span> <span class="n">varname_right</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">df</span><span class="p">[</span><span class="s1">&#39;flag&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="p">[</span><span class="n">i</span><span class="p">]]</span>
                <span class="n">plot_var</span> <span class="o">=</span> <span class="p">[</span><span class="n">plot_var</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span>
                    <span class="nb">len</span><span class="p">(</span><span class="n">plot_var</span><span class="p">))</span> <span class="k">if</span> <span class="n">varname_right</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">df</span><span class="p">[</span><span class="s1">&#39;flag&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="p">[</span><span class="n">i</span><span class="p">]]</span>
                <span class="n">ax2</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">plot_times</span><span class="p">,</span> <span class="n">plot_var</span><span class="p">,</span> <span class="s1">&#39;o&#39;</span><span class="p">,</span>
                         <span class="n">color</span><span class="o">=</span><span class="n">right_prop</span><span class="p">[</span><span class="s1">&#39;color&#39;</span><span class="p">],</span> <span class="n">ms</span><span class="o">=</span><span class="n">right_prop</span><span class="p">[</span><span class="s1">&#39;ms&#39;</span><span class="p">])</span>

            <span class="c1"># Add legend</span>
            <span class="n">lines</span> <span class="o">=</span> <span class="n">line1</span> <span class="o">+</span> <span class="n">line2</span>
            <span class="n">labels</span> <span class="o">=</span> <span class="p">[</span><span class="n">l</span><span class="o">.</span><span class="n">get_label</span><span class="p">()</span> <span class="k">for</span> <span class="n">l</span> <span class="ow">in</span> <span class="n">lines</span><span class="p">]</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">lines</span><span class="p">,</span> <span class="n">labels</span><span class="p">)</span>

            <span class="c1"># Special handling if both are in units of Celsius</span>
            <span class="n">same_unit</span> <span class="o">=</span> <span class="kc">False</span>
            <span class="k">if</span> <span class="n">varname</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;temp&#39;</span><span class="p">,</span> <span class="s1">&#39;dwpt&#39;</span><span class="p">]</span> <span class="ow">and</span> <span class="n">varname_right</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;temp&#39;</span><span class="p">,</span> <span class="s1">&#39;dwpt&#39;</span><span class="p">]:</span>
                <span class="n">same_unit</span> <span class="o">=</span> <span class="kc">True</span>
            <span class="k">if</span> <span class="n">varname</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;sfmr&#39;</span><span class="p">,</span> <span class="s1">&#39;wspd&#39;</span><span class="p">,</span> <span class="s1">&#39;pkwnd&#39;</span><span class="p">]</span> <span class="ow">and</span> <span class="n">varname_right</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;sfmr&#39;</span><span class="p">,</span> <span class="s1">&#39;wspd&#39;</span><span class="p">,</span> <span class="s1">&#39;pkwnd&#39;</span><span class="p">]:</span>
                <span class="n">same_unit</span> <span class="o">=</span> <span class="kc">True</span>
            <span class="k">if</span> <span class="n">same_unit</span><span class="p">:</span>
                <span class="n">min_val</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nanmin</span><span class="p">(</span>
                    <span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">nanmin</span><span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="n">varname</span><span class="p">]),</span> <span class="n">np</span><span class="o">.</span><span class="n">nanmin</span><span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="n">varname_right</span><span class="p">])])</span>
                <span class="n">max_val</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nanmax</span><span class="p">(</span>
                    <span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">nanmax</span><span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="n">varname</span><span class="p">]),</span> <span class="n">np</span><span class="o">.</span><span class="n">nanmax</span><span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="n">varname_right</span><span class="p">])])</span> <span class="o">*</span> <span class="mf">1.05</span>
                <span class="n">min_val</span> <span class="o">=</span> <span class="n">min_val</span> <span class="o">*</span> <span class="mf">1.05</span> <span class="k">if</span> <span class="n">min_val</span> <span class="o">&lt;</span> <span class="mi">0</span> <span class="k">else</span> <span class="n">min_val</span> <span class="o">*</span> <span class="mf">0.95</span>
                <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">isnan</span><span class="p">(</span><span class="n">min_val</span><span class="p">):</span>
                    <span class="n">min_val</span> <span class="o">=</span> <span class="mi">0</span>
                <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">isnan</span><span class="p">(</span><span class="n">max_val</span><span class="p">):</span>
                    <span class="n">max_val</span> <span class="o">=</span> <span class="mi">0</span>
                <span class="k">if</span> <span class="n">min_val</span> <span class="o">==</span> <span class="n">max_val</span><span class="p">:</span>
                    <span class="n">min_val</span> <span class="o">=</span> <span class="mi">0</span>
                    <span class="n">max_val</span> <span class="o">=</span> <span class="mi">10</span>
                <span class="n">ax</span><span class="o">.</span><span class="n">set_ylim</span><span class="p">(</span><span class="n">min_val</span><span class="p">,</span> <span class="n">max_val</span><span class="p">)</span>
                <span class="n">ax2</span><span class="o">.</span><span class="n">set_ylim</span><span class="p">(</span><span class="n">min_val</span><span class="p">,</span> <span class="n">max_val</span><span class="p">)</span>

        <span class="c1"># Add titles</span>
        <span class="n">storm_data</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">storm</span><span class="o">.</span><span class="n">dict</span>
        <span class="n">type_array</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">storm_data</span><span class="p">[</span><span class="s1">&#39;type&#39;</span><span class="p">])</span>
        <span class="n">idx</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">((</span><span class="n">type_array</span> <span class="o">==</span> <span class="s1">&#39;SD&#39;</span><span class="p">)</span> <span class="o">|</span> <span class="p">(</span><span class="n">type_array</span> <span class="o">==</span> <span class="s1">&#39;SS&#39;</span><span class="p">)</span> <span class="o">|</span> <span class="p">(</span><span class="n">type_array</span> <span class="o">==</span> <span class="s1">&#39;TD&#39;</span><span class="p">)</span> <span class="o">|</span> <span class="p">(</span>
            <span class="n">type_array</span> <span class="o">==</span> <span class="s1">&#39;TS&#39;</span><span class="p">)</span> <span class="o">|</span> <span class="p">(</span><span class="n">type_array</span> <span class="o">==</span> <span class="s1">&#39;HU&#39;</span><span class="p">)</span> <span class="o">|</span> <span class="p">(</span><span class="n">type_array</span> <span class="o">==</span> <span class="s1">&#39;TY&#39;</span><span class="p">)</span> <span class="o">|</span> <span class="p">(</span><span class="n">type_array</span> <span class="o">==</span> <span class="s1">&#39;ST&#39;</span><span class="p">))</span>
        <span class="k">if</span> <span class="p">(</span><span class="s1">&#39;invest&#39;</span> <span class="ow">in</span> <span class="n">storm_data</span><span class="o">.</span><span class="n">keys</span><span class="p">()</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">storm_data</span><span class="p">[</span><span class="s1">&#39;invest&#39;</span><span class="p">])</span> <span class="ow">or</span> <span class="nb">len</span><span class="p">(</span><span class="n">idx</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">tropical_vmax</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">storm_data</span><span class="p">[</span><span class="s1">&#39;vmax&#39;</span><span class="p">])[</span><span class="n">idx</span><span class="p">]</span>

            <span class="n">add_ptc_flag</span> <span class="o">=</span> <span class="kc">False</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">tropical_vmax</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                <span class="n">add_ptc_flag</span> <span class="o">=</span> <span class="kc">True</span>
                <span class="n">idx</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">((</span><span class="n">type_array</span> <span class="o">==</span> <span class="s1">&#39;LO&#39;</span><span class="p">)</span> <span class="o">|</span> <span class="p">(</span><span class="n">type_array</span> <span class="o">==</span> <span class="s1">&#39;DB&#39;</span><span class="p">))</span>
            <span class="n">tropical_vmax</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">storm_data</span><span class="p">[</span><span class="s1">&#39;vmax&#39;</span><span class="p">])[</span><span class="n">idx</span><span class="p">]</span>

            <span class="n">subtrop</span> <span class="o">=</span> <span class="n">classify_subtropical</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">storm_data</span><span class="p">[</span><span class="s1">&#39;type&#39;</span><span class="p">]))</span>
            <span class="n">peak_idx</span> <span class="o">=</span> <span class="n">storm_data</span><span class="p">[</span><span class="s1">&#39;vmax&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">nanmax</span><span class="p">(</span><span class="n">tropical_vmax</span><span class="p">))</span>
            <span class="n">peak_basin</span> <span class="o">=</span> <span class="n">storm_data</span><span class="p">[</span><span class="s1">&#39;wmo_basin&#39;</span><span class="p">][</span><span class="n">peak_idx</span><span class="p">]</span>
            <span class="n">storm_type</span> <span class="o">=</span> <span class="n">get_storm_classification</span><span class="p">(</span>
                <span class="n">np</span><span class="o">.</span><span class="n">nanmax</span><span class="p">(</span><span class="n">tropical_vmax</span><span class="p">),</span> <span class="n">subtrop</span><span class="p">,</span> <span class="n">peak_basin</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">add_ptc_flag</span><span class="p">:</span>
                <span class="n">storm_type</span> <span class="o">=</span> <span class="s2">&quot;Potential Tropical Cyclone&quot;</span>

        <span class="c1"># Plot title</span>
        <span class="n">title_string</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">storm_type</span><span class="si">}</span><span class="s2"> </span><span class="si">{</span><span class="n">storm_data</span><span class="p">[</span><span class="s1">&#39;name&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2">&quot;</span>
        <span class="k">if</span> <span class="n">mission</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">title_string</span> <span class="o">+=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">Recon Aircraft HDOBs | All Missions&quot;</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">title_string</span> <span class="o">+=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">Recon Aircraft HDOBs | Mission #</span><span class="si">{</span><span class="n">mission</span><span class="si">}</span><span class="s2">&quot;</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="n">title_string</span><span class="p">,</span> <span class="n">loc</span><span class="o">=</span><span class="s1">&#39;left&#39;</span><span class="p">,</span> <span class="n">fontweight</span><span class="o">=</span><span class="s1">&#39;bold&#39;</span><span class="p">)</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s2">&quot;Plot generated using Tropycal&quot;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">8</span><span class="p">,</span> <span class="n">loc</span><span class="o">=</span><span class="s1">&#39;right&#39;</span><span class="p">)</span>

        <span class="c1"># Return plot</span>
        <span class="k">return</span> <span class="n">ax</span></div>

<div class="viewcode-block" id="hdobs.plot_points"><a class="viewcode-back" href="../../../api/generated/tropycal.recon.hdobs.plot_points.html#tropycal.recon.hdobs.plot_points">[docs]</a>    <span class="k">def</span> <span class="nf">plot_points</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">varname</span><span class="o">=</span><span class="s1">&#39;wspd&#39;</span><span class="p">,</span> <span class="n">domain</span><span class="o">=</span><span class="s2">&quot;dynamic&quot;</span><span class="p">,</span> <span class="n">radlim</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">barbs</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">ax</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">cartopy_proj</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
<span class="w">        </span><span class="sa">r</span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Creates a plot of recon data points.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        varname : str</span>
<span class="sd">            Variable to plot. Can be one of the following keys in dataframe:</span>

<span class="sd">            * **&quot;sfmr&quot;** = SFMR surface wind</span>
<span class="sd">            * **&quot;wspd&quot;** = 30-second flight level wind (default)</span>
<span class="sd">            * **&quot;pkwnd&quot;** = 10-second flight level wind</span>
<span class="sd">            * **&quot;p_sfc&quot;** = extrapolated surface pressure</span>
<span class="sd">        domain : str</span>
<span class="sd">            Domain for the plot. Default is &quot;dynamic&quot;. Please refer to :ref:`options-domain` for available domain options.</span>
<span class="sd">        radlim : int</span>
<span class="sd">            Radius (in km) away from storm center to include points. If none (default), all points are plotted.</span>
<span class="sd">        barbs : bool</span>
<span class="sd">            If True, plots wind barbs. If False (default), plots dots.</span>
<span class="sd">        ax : axes</span>
<span class="sd">            Instance of axes to plot on. If none, one will be generated. Default is none.</span>
<span class="sd">        cartopy_proj : ccrs</span>
<span class="sd">            Instance of a cartopy projection to use. If none, one will be generated. Default is none.</span>

<span class="sd">        Other Parameters</span>
<span class="sd">        ----------------</span>
<span class="sd">        prop : dict</span>
<span class="sd">            Customization properties of recon plot. Please refer to :ref:`options-prop-recon-plot` for available options.</span>
<span class="sd">        map_prop : dict</span>
<span class="sd">            Customization properties of Cartopy map. Please refer to :ref:`options-map-prop` for available options.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        ax</span>
<span class="sd">            Instance of axes containing the plot is returned.</span>

<span class="sd">        Notes</span>
<span class="sd">        -----</span>
<span class="sd">        1. Plotting wind barbs only works for wind related variables. ``barbs`` will be automatically set to False for non-wind variables.</span>

<span class="sd">        2. The special colormap **category_recon** can be used in the prop dict (``prop={&#39;cmap&#39;:&#39;category_recon&#39;}``). This uses the standard SSHWS colormap, but with a new color for wind between 50 and 64 knots.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="c1"># Change barbs</span>
        <span class="k">if</span> <span class="n">varname</span> <span class="o">==</span> <span class="s1">&#39;p_sfc&#39;</span><span class="p">:</span>
            <span class="n">barbs</span> <span class="o">=</span> <span class="kc">False</span>

        <span class="c1"># Pop kwargs</span>
        <span class="n">prop</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;prop&#39;</span><span class="p">,</span> <span class="p">{})</span>
        <span class="n">map_prop</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;map_prop&#39;</span><span class="p">,</span> <span class="p">{})</span>

        <span class="c1"># Get plot data</span>
        <span class="n">dfRecon</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span>

        <span class="c1"># Create instance of plot object</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">plot_obj</span> <span class="o">=</span> <span class="n">ReconPlot</span><span class="p">()</span>

        <span class="c1"># Create cartopy projection</span>
        <span class="k">if</span> <span class="n">cartopy_proj</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">plot_obj</span><span class="o">.</span><span class="n">create_cartopy</span><span class="p">(</span>
                <span class="n">proj</span><span class="o">=</span><span class="s1">&#39;PlateCarree&#39;</span><span class="p">,</span> <span class="n">central_longitude</span><span class="o">=</span><span class="mf">0.0</span><span class="p">)</span>
            <span class="n">cartopy_proj</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">plot_obj</span><span class="o">.</span><span class="n">proj</span>

        <span class="c1"># Plot recon</span>
        <span class="n">plot_ax</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">plot_obj</span><span class="o">.</span><span class="n">plot_points</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">storm</span><span class="p">,</span> <span class="n">dfRecon</span><span class="p">,</span> <span class="n">domain</span><span class="p">,</span> <span class="n">varname</span><span class="o">=</span><span class="n">varname</span><span class="p">,</span> <span class="n">radlim</span><span class="o">=</span><span class="n">radlim</span><span class="p">,</span> <span class="n">barbs</span><span class="o">=</span><span class="n">barbs</span><span class="p">,</span> <span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">,</span> <span class="n">prop</span><span class="o">=</span><span class="n">prop</span><span class="p">,</span> <span class="n">map_prop</span><span class="o">=</span><span class="n">map_prop</span><span class="p">)</span>

        <span class="c1"># Return axis</span>
        <span class="k">return</span> <span class="n">plot_ax</span></div>

<div class="viewcode-block" id="hdobs.plot_hovmoller"><a class="viewcode-back" href="../../../api/generated/tropycal.recon.hdobs.plot_hovmoller.html#tropycal.recon.hdobs.plot_hovmoller">[docs]</a>    <span class="k">def</span> <span class="nf">plot_hovmoller</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">varname</span><span class="o">=</span><span class="s1">&#39;wspd&#39;</span><span class="p">,</span> <span class="n">radlim</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">window</span><span class="o">=</span><span class="mi">6</span><span class="p">,</span> <span class="n">align</span><span class="o">=</span><span class="s1">&#39;center&#39;</span><span class="p">,</span> <span class="n">ax</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
<span class="w">        </span><span class="sa">r</span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Creates a hovmoller plot of azimuthally-averaged recon data.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        varname : str</span>
<span class="sd">            Variable to average and plot. Available variable names are:</span>

<span class="sd">            * **&quot;sfmr&quot;** = SFMR surface wind</span>
<span class="sd">            * **&quot;wspd&quot;** = 30-second flight level wind (default)</span>
<span class="sd">            * **&quot;pkwnd&quot;** = 10-second flight level wind</span>
<span class="sd">            * **&quot;p_sfc&quot;** = extrapolated surface pressure</span>
<span class="sd">        radlim : int, optional</span>
<span class="sd">            Radius from storm center, in kilometers, to plot in hovmoller. Default is 200 km.</span>
<span class="sd">        window : int, optional</span>
<span class="sd">            Window of hours to interpolate between observations. Default is 6 hours.</span>
<span class="sd">        align : str, optional</span>
<span class="sd">            Alignment of window. Default is &#39;center&#39;.</span>
<span class="sd">        ax : axes, optional</span>
<span class="sd">            Instance of axes to plot on. If none, one will be generated. Default is none.</span>

<span class="sd">        Other Parameters</span>
<span class="sd">        ----------------</span>
<span class="sd">        prop : dict</span>
<span class="sd">            Customization properties for recon plot. Please refer to :ref:`options-prop-recon-hovmoller` for available options.</span>
<span class="sd">        track_dict : dict, optional</span>
<span class="sd">            Storm track dictionary. If None (default), internal storm center track is used.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        ax</span>
<span class="sd">            Axes instance containing the plot.</span>

<span class="sd">        Notes</span>
<span class="sd">        -----</span>
<span class="sd">        The special colormap **category_recon** can be used in the prop dict (``prop={&#39;cmap&#39;:&#39;category_recon&#39;}``). This uses the standard SSHWS colormap, but with a new color for wind between 50 and 64 knots.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="c1"># Pop kwargs</span>
        <span class="n">track_dict</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;track_dict&#39;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
        <span class="n">prop</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;prop&#39;</span><span class="p">,</span> <span class="p">{})</span>
        <span class="n">default_prop</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s1">&#39;cmap&#39;</span><span class="p">:</span> <span class="s1">&#39;category&#39;</span><span class="p">,</span>
            <span class="s1">&#39;levels&#39;</span><span class="p">:</span> <span class="kc">None</span><span class="p">,</span>
            <span class="s1">&#39;smooth_contourf&#39;</span><span class="p">:</span> <span class="kc">False</span>
        <span class="p">}</span>
        <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="n">default_prop</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
            <span class="k">if</span> <span class="n">key</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">prop</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
                <span class="n">prop</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="n">default_prop</span><span class="p">[</span><span class="n">key</span><span class="p">]</span>

        <span class="c1"># Get recon data</span>
        <span class="n">dfRecon</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span>

        <span class="c1"># Retrieve track dictionary if none is specified</span>
        <span class="k">if</span> <span class="n">track_dict</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">track_dict</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">storm</span><span class="o">.</span><span class="n">dict</span>

        <span class="c1"># Interpolate recon data to a hovmoller</span>
        <span class="n">iRecon</span> <span class="o">=</span> <span class="n">interpRecon</span><span class="p">(</span><span class="n">dfRecon</span><span class="p">,</span> <span class="n">varname</span><span class="p">,</span> <span class="n">radlim</span><span class="p">,</span>
                             <span class="n">window</span><span class="o">=</span><span class="n">window</span><span class="p">,</span> <span class="n">align</span><span class="o">=</span><span class="n">align</span><span class="p">)</span>
        <span class="n">Hov_dict</span> <span class="o">=</span> <span class="n">iRecon</span><span class="o">.</span><span class="n">interpHovmoller</span><span class="p">(</span><span class="n">track_dict</span><span class="p">)</span>

        <span class="c1"># title = get_recon_title(varname) #may not be necessary</span>
        <span class="c1"># If no contour levels specified, generate levels based on data min and max</span>
        <span class="k">if</span> <span class="n">prop</span><span class="p">[</span><span class="s1">&#39;levels&#39;</span><span class="p">]</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">prop</span><span class="p">[</span><span class="s1">&#39;levels&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">nanmin</span><span class="p">(</span><span class="n">Hov_dict</span><span class="p">[</span><span class="s1">&#39;hovmoller&#39;</span><span class="p">]),</span>
                              <span class="n">np</span><span class="o">.</span><span class="n">nanmax</span><span class="p">(</span><span class="n">Hov_dict</span><span class="p">[</span><span class="s1">&#39;hovmoller&#39;</span><span class="p">]))</span>

        <span class="c1"># Retrieve updated contour levels and colormap based on input arguments and variable type</span>
        <span class="n">cmap</span><span class="p">,</span> <span class="n">clevs</span> <span class="o">=</span> <span class="n">get_cmap_levels</span><span class="p">(</span><span class="n">varname</span><span class="p">,</span> <span class="n">prop</span><span class="p">[</span><span class="s1">&#39;cmap&#39;</span><span class="p">],</span> <span class="n">prop</span><span class="p">[</span><span class="s1">&#39;levels&#39;</span><span class="p">])</span>

        <span class="c1"># Retrieve hovmoller times, radii and data</span>
        <span class="n">time</span> <span class="o">=</span> <span class="n">Hov_dict</span><span class="p">[</span><span class="s1">&#39;time&#39;</span><span class="p">]</span>
        <span class="n">radius</span> <span class="o">=</span> <span class="n">Hov_dict</span><span class="p">[</span><span class="s1">&#39;radius&#39;</span><span class="p">]</span>
        <span class="n">vardata</span> <span class="o">=</span> <span class="n">Hov_dict</span><span class="p">[</span><span class="s1">&#39;hovmoller&#39;</span><span class="p">]</span>

        <span class="c1"># Error check time</span>
        <span class="n">time</span> <span class="o">=</span> <span class="p">[</span><span class="n">dt</span><span class="o">.</span><span class="n">strptime</span><span class="p">((</span><span class="n">i</span><span class="o">.</span><span class="n">strftime</span><span class="p">(</span><span class="s1">&#39;%Y%m</span><span class="si">%d</span><span class="s1">%H%M&#39;</span><span class="p">)),</span> <span class="s1">&#39;%Y%m</span><span class="si">%d</span><span class="s1">%H%M&#39;</span><span class="p">)</span>
                <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">time</span><span class="p">]</span>

        <span class="c1"># ------------------------------------------------------------------------------</span>

        <span class="c1"># Create plot</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">9</span><span class="p">,</span> <span class="mi">9</span><span class="p">),</span> <span class="n">dpi</span><span class="o">=</span><span class="mi">150</span><span class="p">)</span>
        <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplot</span><span class="p">()</span>

        <span class="c1"># Plot surface category colors individually, necessitating normalizing colormap</span>
        <span class="k">if</span> <span class="n">varname</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;vmax&#39;</span><span class="p">,</span> <span class="s1">&#39;sfmr&#39;</span><span class="p">,</span> <span class="s1">&#39;wspd&#39;</span><span class="p">,</span> <span class="s1">&#39;fl_to_sfc&#39;</span><span class="p">]</span> <span class="ow">and</span> <span class="n">prop</span><span class="p">[</span><span class="s1">&#39;cmap&#39;</span><span class="p">]</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;category&#39;</span><span class="p">,</span> <span class="s1">&#39;category_recon&#39;</span><span class="p">]:</span>
            <span class="n">norm</span> <span class="o">=</span> <span class="n">mcolors</span><span class="o">.</span><span class="n">BoundaryNorm</span><span class="p">(</span><span class="n">clevs</span><span class="p">,</span> <span class="n">cmap</span><span class="o">.</span><span class="n">N</span><span class="p">)</span>
            <span class="n">cf</span> <span class="o">=</span> <span class="n">ax</span><span class="o">.</span><span class="n">contourf</span><span class="p">(</span><span class="n">radius</span><span class="p">,</span> <span class="n">time</span><span class="p">,</span> <span class="n">gfilt1d</span><span class="p">(</span><span class="n">vardata</span><span class="p">,</span> <span class="n">sigma</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">),</span>
                             <span class="n">levels</span><span class="o">=</span><span class="n">clevs</span><span class="p">,</span> <span class="n">cmap</span><span class="o">=</span><span class="n">cmap</span><span class="p">,</span> <span class="n">norm</span><span class="o">=</span><span class="n">norm</span><span class="p">)</span>

        <span class="c1"># Multiple clevels or without smooth contouring</span>
        <span class="k">elif</span> <span class="nb">len</span><span class="p">(</span><span class="n">prop</span><span class="p">[</span><span class="s1">&#39;levels&#39;</span><span class="p">])</span> <span class="o">&gt;</span> <span class="mi">2</span> <span class="ow">or</span> <span class="ow">not</span> <span class="n">prop</span><span class="p">[</span><span class="s1">&#39;smooth_contourf&#39;</span><span class="p">]:</span>
            <span class="n">cf</span> <span class="o">=</span> <span class="n">ax</span><span class="o">.</span><span class="n">contourf</span><span class="p">(</span><span class="n">radius</span><span class="p">,</span> <span class="n">time</span><span class="p">,</span> <span class="n">gfilt1d</span><span class="p">(</span><span class="n">vardata</span><span class="p">,</span> <span class="n">sigma</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">),</span>
                             <span class="n">levels</span><span class="o">=</span><span class="n">clevs</span><span class="p">,</span> <span class="n">cmap</span><span class="o">=</span><span class="n">cmap</span><span class="p">)</span>

        <span class="c1"># Automatically generated levels with smooth contouring</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">cf</span> <span class="o">=</span> <span class="n">ax</span><span class="o">.</span><span class="n">contourf</span><span class="p">(</span><span class="n">radius</span><span class="p">,</span> <span class="n">time</span><span class="p">,</span> <span class="n">gfilt1d</span><span class="p">(</span><span class="n">vardata</span><span class="p">,</span> <span class="n">sigma</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">),</span>
                             <span class="n">cmap</span><span class="o">=</span><span class="n">cmap</span><span class="p">,</span> <span class="n">levels</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="nb">min</span><span class="p">(</span><span class="n">prop</span><span class="p">[</span><span class="s1">&#39;levels&#39;</span><span class="p">]),</span> <span class="nb">max</span><span class="p">(</span><span class="n">prop</span><span class="p">[</span><span class="s1">&#39;levels&#39;</span><span class="p">]),</span> <span class="mi">256</span><span class="p">))</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">axis</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span> <span class="nb">max</span><span class="p">(</span><span class="n">radius</span><span class="p">),</span> <span class="nb">min</span><span class="p">(</span><span class="n">time</span><span class="p">),</span> <span class="nb">max</span><span class="p">(</span><span class="n">time</span><span class="p">)])</span>

        <span class="c1"># Plot colorbar</span>
        <span class="n">cbar</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">colorbar</span><span class="p">(</span><span class="n">cf</span><span class="p">,</span> <span class="n">orientation</span><span class="o">=</span><span class="s1">&#39;horizontal&#39;</span><span class="p">,</span> <span class="n">pad</span><span class="o">=</span><span class="mf">0.1</span><span class="p">)</span>

        <span class="c1"># Format y-label ticks and labels as dates</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">yaxis</span><span class="o">.</span><span class="n">set_major_formatter</span><span class="p">(</span><span class="n">mdates</span><span class="o">.</span><span class="n">DateFormatter</span><span class="p">(</span><span class="s1">&#39;%m-</span><span class="si">%d</span><span class="s1"> %H&#39;</span><span class="p">))</span>
        <span class="k">for</span> <span class="n">tick</span> <span class="ow">in</span> <span class="n">ax</span><span class="o">.</span><span class="n">xaxis</span><span class="o">.</span><span class="n">get_major_ticks</span><span class="p">():</span>
            <span class="n">tick</span><span class="o">.</span><span class="n">label</span><span class="o">.</span><span class="n">set_fontsize</span><span class="p">(</span><span class="mi">14</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">tick</span> <span class="ow">in</span> <span class="n">ax</span><span class="o">.</span><span class="n">yaxis</span><span class="o">.</span><span class="n">get_major_ticks</span><span class="p">():</span>
            <span class="n">tick</span><span class="o">.</span><span class="n">label</span><span class="o">.</span><span class="n">set_fontsize</span><span class="p">(</span><span class="mi">14</span><span class="p">)</span>

        <span class="c1"># Set axes labels</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;UTC Time (MM-DD HH)&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">15</span><span class="p">)</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;Radius (km)&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">15</span><span class="p">)</span>

        <span class="c1"># --------------------------------------------------------------------------------------</span>

        <span class="c1"># Generate left and right title strings</span>
        <span class="n">title_left</span><span class="p">,</span> <span class="n">title_right</span> <span class="o">=</span> <span class="n">hovmoller_plot_title</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">storm</span><span class="p">,</span> <span class="n">Hov_dict</span><span class="p">,</span> <span class="n">varname</span><span class="p">)</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="n">title_left</span><span class="p">,</span> <span class="n">loc</span><span class="o">=</span><span class="s1">&#39;left&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">16</span><span class="p">,</span> <span class="n">fontweight</span><span class="o">=</span><span class="s1">&#39;bold&#39;</span><span class="p">)</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="n">title_right</span><span class="p">,</span> <span class="n">loc</span><span class="o">=</span><span class="s1">&#39;right&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">12</span><span class="p">)</span>

        <span class="c1"># Return axis</span>
        <span class="k">return</span> <span class="n">ax</span></div>

<div class="viewcode-block" id="hdobs.plot_maps"><a class="viewcode-back" href="../../../api/generated/tropycal.recon.hdobs.plot_maps.html#tropycal.recon.hdobs.plot_maps">[docs]</a>    <span class="k">def</span> <span class="nf">plot_maps</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">time</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">varname</span><span class="o">=</span><span class="s1">&#39;wspd&#39;</span><span class="p">,</span> <span class="n">recon_stats</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">domain</span><span class="o">=</span><span class="s2">&quot;dynamic&quot;</span><span class="p">,</span>
                  <span class="n">window</span><span class="o">=</span><span class="mi">6</span><span class="p">,</span> <span class="n">align</span><span class="o">=</span><span class="s1">&#39;center&#39;</span><span class="p">,</span> <span class="n">radlim</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">ax</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">cartopy_proj</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">save_dir</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
<span class="w">        </span><span class="sa">r</span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Creates maps of interpolated recon data. </span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        time : datetime.datetime or list</span>
<span class="sd">            Single datetime object, or list/tuple of datetime objects containing the start and end times to plot between. If None (default), all times will be plotted.</span>
<span class="sd">        varname : str or tuple</span>
<span class="sd">            Variable to plot. Can be one of the following keys in dataframe:</span>

<span class="sd">            * **&quot;sfmr&quot;** = SFMR surface wind</span>
<span class="sd">            * **&quot;wspd&quot;** = 30-second flight level wind (default)</span>
<span class="sd">            * **&quot;pkwnd&quot;** = 10-second flight level wind</span>
<span class="sd">            * **&quot;p_sfc&quot;** = extrapolated surface pressure</span>
<span class="sd">        domain : str</span>
<span class="sd">            Domain for the plot. Default is &quot;dynamic&quot;. Please refer to :ref:`options-domain` for available domain options.</span>
<span class="sd">        radlim : int, optional</span>
<span class="sd">            Radius from storm center, in kilometers, to plot. Default is 200 km.</span>
<span class="sd">        window : int, optional</span>
<span class="sd">            Window of hours to interpolate between observations. Default is 6 hours.</span>
<span class="sd">        align : str, optional</span>
<span class="sd">            Alignment of window. Default is &#39;center&#39;.</span>
<span class="sd">        ax : axes, optional</span>
<span class="sd">            Instance of axes to plot on. If none, one will be generated. Default is none.</span>
<span class="sd">        cartopy_proj : ccrs, optional</span>
<span class="sd">            Instance of a cartopy projection to use. If none, one will be generated. Default is none.</span>
<span class="sd">        save_dir : str, optional</span>
<span class="sd">            Directory to save output images in. If None, images will not be saved. Default is None.</span>

<span class="sd">        Other Parameters</span>
<span class="sd">        ----------------</span>
<span class="sd">        prop : dict</span>
<span class="sd">            Customization properties of recon plot. Please refer to :ref:`options-prop-recon-swath` for available options.</span>
<span class="sd">        map_prop : dict</span>
<span class="sd">            Customization properties of Cartopy map. Please refer to :ref:`options-map-prop` for available options.</span>
<span class="sd">        track_dict : dict, optional</span>
<span class="sd">            Storm track dictionary. If None (default), internal storm center track is used.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="c1"># Pop kwargs</span>
        <span class="n">prop</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;prop&#39;</span><span class="p">,</span> <span class="p">{})</span>
        <span class="n">map_prop</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;map_prop&#39;</span><span class="p">,</span> <span class="p">{})</span>
        <span class="n">track_dict</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;track_dict&#39;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>

        <span class="c1"># Get plot data</span>
        <span class="n">ONE_MAP</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="k">if</span> <span class="n">time</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">dfRecon</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span>
        <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">time</span><span class="p">,</span> <span class="p">(</span><span class="nb">tuple</span><span class="p">,</span> <span class="nb">list</span><span class="p">)):</span>
            <span class="n">dfRecon</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">sel</span><span class="p">(</span><span class="n">time</span><span class="o">=</span><span class="n">time</span><span class="p">)</span><span class="o">.</span><span class="n">data</span>
        <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">time</span><span class="p">,</span> <span class="n">dt</span><span class="p">):</span>
            <span class="n">dfRecon</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">sel</span><span class="p">(</span>
                <span class="n">time</span><span class="o">=</span><span class="p">(</span><span class="n">time</span> <span class="o">-</span> <span class="n">timedelta</span><span class="p">(</span><span class="n">hours</span><span class="o">=</span><span class="mi">6</span><span class="p">),</span> <span class="n">time</span> <span class="o">+</span> <span class="n">timedelta</span><span class="p">(</span><span class="n">hours</span><span class="o">=</span><span class="mi">6</span><span class="p">)))</span><span class="o">.</span><span class="n">data</span>
            <span class="n">ONE_MAP</span> <span class="o">=</span> <span class="kc">True</span>

        <span class="n">MULTIVAR</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">varname</span><span class="p">,</span> <span class="p">(</span><span class="nb">tuple</span><span class="p">,</span> <span class="nb">list</span><span class="p">)):</span>
            <span class="n">MULTIVAR</span> <span class="o">=</span> <span class="kc">True</span>

        <span class="k">if</span> <span class="n">track_dict</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">track_dict</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">storm</span><span class="o">.</span><span class="n">dict</span>

            <span class="c1"># Error check for time dimension name</span>
            <span class="k">if</span> <span class="s1">&#39;time&#39;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">track_dict</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
                <span class="n">track_dict</span><span class="p">[</span><span class="s1">&#39;time&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">track_dict</span><span class="p">[</span><span class="s1">&#39;time&#39;</span><span class="p">]</span>

        <span class="k">if</span> <span class="n">ONE_MAP</span><span class="p">:</span>
            <span class="n">f</span> <span class="o">=</span> <span class="n">interp1d</span><span class="p">(</span><span class="n">mdates</span><span class="o">.</span><span class="n">date2num</span><span class="p">(</span>
                <span class="n">track_dict</span><span class="p">[</span><span class="s1">&#39;time&#39;</span><span class="p">]),</span> <span class="n">track_dict</span><span class="p">[</span><span class="s1">&#39;lon&#39;</span><span class="p">],</span> <span class="n">fill_value</span><span class="o">=</span><span class="s1">&#39;extrapolate&#39;</span><span class="p">)</span>
            <span class="n">clon</span> <span class="o">=</span> <span class="n">f</span><span class="p">(</span><span class="n">mdates</span><span class="o">.</span><span class="n">date2num</span><span class="p">(</span><span class="n">time</span><span class="p">))</span>
            <span class="n">f</span> <span class="o">=</span> <span class="n">interp1d</span><span class="p">(</span><span class="n">mdates</span><span class="o">.</span><span class="n">date2num</span><span class="p">(</span>
                <span class="n">track_dict</span><span class="p">[</span><span class="s1">&#39;time&#39;</span><span class="p">]),</span> <span class="n">track_dict</span><span class="p">[</span><span class="s1">&#39;lat&#39;</span><span class="p">],</span> <span class="n">fill_value</span><span class="o">=</span><span class="s1">&#39;extrapolate&#39;</span><span class="p">)</span>
            <span class="n">clat</span> <span class="o">=</span> <span class="n">f</span><span class="p">(</span><span class="n">mdates</span><span class="o">.</span><span class="n">date2num</span><span class="p">(</span><span class="n">time</span><span class="p">))</span>

            <span class="c1"># clon = np.interp(mdates.date2num(recon_select),mdates.date2num(track_dict[&#39;time&#39;]),track_dict[&#39;lon&#39;])</span>
            <span class="c1"># clat = np.interp(mdates.date2num(recon_select),mdates.date2num(track_dict[&#39;time&#39;]),track_dict[&#39;lat&#39;])</span>
            <span class="n">track_dict</span> <span class="o">=</span> <span class="p">{</span>
                <span class="s1">&#39;time&#39;</span><span class="p">:</span> <span class="n">time</span><span class="p">,</span>
                <span class="s1">&#39;lon&#39;</span><span class="p">:</span> <span class="n">clon</span><span class="p">,</span>
                <span class="s1">&#39;lat&#39;</span><span class="p">:</span> <span class="n">clat</span>
            <span class="p">}</span>

        <span class="k">if</span> <span class="n">MULTIVAR</span><span class="p">:</span>
            <span class="n">Maps</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="k">for</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">varname</span><span class="p">:</span>
                <span class="n">iRecon</span> <span class="o">=</span> <span class="n">interpRecon</span><span class="p">(</span><span class="n">dfRecon</span><span class="p">,</span> <span class="n">v</span><span class="p">,</span> <span class="n">radlim</span><span class="p">,</span>
                                     <span class="n">window</span><span class="o">=</span><span class="n">window</span><span class="p">,</span> <span class="n">align</span><span class="o">=</span><span class="n">align</span><span class="p">)</span>
                <span class="n">tmpMaps</span> <span class="o">=</span> <span class="n">iRecon</span><span class="o">.</span><span class="n">interpMaps</span><span class="p">(</span><span class="n">track_dict</span><span class="p">)</span>
                <span class="n">Maps</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">tmpMaps</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">iRecon</span> <span class="o">=</span> <span class="n">interpRecon</span><span class="p">(</span><span class="n">dfRecon</span><span class="p">,</span> <span class="n">varname</span><span class="p">,</span> <span class="n">radlim</span><span class="p">,</span>
                                 <span class="n">window</span><span class="o">=</span><span class="n">window</span><span class="p">,</span> <span class="n">align</span><span class="o">=</span><span class="n">align</span><span class="p">)</span>
            <span class="n">Maps</span> <span class="o">=</span> <span class="n">iRecon</span><span class="o">.</span><span class="n">interpMaps</span><span class="p">(</span><span class="n">track_dict</span><span class="p">)</span>

        <span class="c1"># titlename,units = get_recon_title(varname)</span>

        <span class="k">if</span> <span class="s1">&#39;levels&#39;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">prop</span><span class="o">.</span><span class="n">keys</span><span class="p">()</span> <span class="ow">or</span> <span class="s1">&#39;levels&#39;</span> <span class="ow">in</span> <span class="n">prop</span><span class="o">.</span><span class="n">keys</span><span class="p">()</span> <span class="ow">and</span> <span class="n">prop</span><span class="p">[</span><span class="s1">&#39;levels&#39;</span><span class="p">]</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">prop</span><span class="p">[</span><span class="s1">&#39;levels&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">floor</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">nanmin</span><span class="p">(</span><span class="n">Maps</span><span class="p">[</span><span class="s1">&#39;maps&#39;</span><span class="p">])</span> <span class="o">/</span> <span class="mi">10</span><span class="p">)</span> <span class="o">*</span> <span class="mi">10</span><span class="p">,</span>
                                       <span class="n">np</span><span class="o">.</span><span class="n">ceil</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">nanmax</span><span class="p">(</span><span class="n">Maps</span><span class="p">[</span><span class="s1">&#39;maps&#39;</span><span class="p">])</span> <span class="o">/</span> <span class="mi">10</span><span class="p">)</span> <span class="o">*</span> <span class="mi">10</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">10</span><span class="p">)</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="n">ONE_MAP</span><span class="p">:</span>

            <span class="k">if</span> <span class="n">save_dir</span> <span class="ow">is</span> <span class="kc">True</span><span class="p">:</span>
                <span class="n">save_dir</span> <span class="o">=</span> <span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">storm</span><span class="si">}{</span><span class="bp">self</span><span class="o">.</span><span class="n">year</span><span class="si">}</span><span class="s1">_maps&#39;</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">os</span><span class="o">.</span><span class="n">system</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;mkdir </span><span class="si">{</span><span class="n">save_dir</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
            <span class="k">except</span><span class="p">:</span>
                <span class="k">pass</span>

            <span class="k">if</span> <span class="n">MULTIVAR</span><span class="p">:</span>
                <span class="n">Maps2</span> <span class="o">=</span> <span class="n">Maps</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
                <span class="n">Maps</span> <span class="o">=</span> <span class="n">Maps</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>

                <span class="nb">print</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">nanmax</span><span class="p">(</span><span class="n">Maps</span><span class="p">[</span><span class="s1">&#39;maps&#39;</span><span class="p">]),</span> <span class="n">np</span><span class="o">.</span><span class="n">nanmin</span><span class="p">(</span><span class="n">Maps2</span><span class="p">[</span><span class="s1">&#39;maps&#39;</span><span class="p">]))</span>

            <span class="n">figs</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">t</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">Maps</span><span class="p">[</span><span class="s1">&#39;time&#39;</span><span class="p">]):</span>
                <span class="n">Maps_sub</span> <span class="o">=</span> <span class="p">{</span>
                    <span class="s1">&#39;time&#39;</span><span class="p">:</span> <span class="n">t</span><span class="p">,</span>
                    <span class="s1">&#39;grid_x&#39;</span><span class="p">:</span> <span class="n">Maps</span><span class="p">[</span><span class="s1">&#39;grid_x&#39;</span><span class="p">],</span>
                    <span class="s1">&#39;grid_y&#39;</span><span class="p">:</span> <span class="n">Maps</span><span class="p">[</span><span class="s1">&#39;grid_y&#39;</span><span class="p">],</span>
                    <span class="s1">&#39;maps&#39;</span><span class="p">:</span> <span class="n">Maps</span><span class="p">[</span><span class="s1">&#39;maps&#39;</span><span class="p">][</span><span class="n">i</span><span class="p">],</span>
                    <span class="s1">&#39;center_lon&#39;</span><span class="p">:</span> <span class="n">Maps</span><span class="p">[</span><span class="s1">&#39;center_lon&#39;</span><span class="p">][</span><span class="n">i</span><span class="p">],</span>
                    <span class="s1">&#39;center_lat&#39;</span><span class="p">:</span> <span class="n">Maps</span><span class="p">[</span><span class="s1">&#39;center_lat&#39;</span><span class="p">][</span><span class="n">i</span><span class="p">],</span>
                    <span class="s1">&#39;stats&#39;</span><span class="p">:</span> <span class="n">Maps</span><span class="p">[</span><span class="s1">&#39;stats&#39;</span><span class="p">]</span>
                <span class="p">}</span>

                <span class="c1"># Create instance of plot object</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">plot_obj</span> <span class="o">=</span> <span class="n">ReconPlot</span><span class="p">()</span>

                <span class="c1"># Create cartopy projection</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">plot_obj</span><span class="o">.</span><span class="n">create_cartopy</span><span class="p">(</span>
                    <span class="n">proj</span><span class="o">=</span><span class="s1">&#39;PlateCarree&#39;</span><span class="p">,</span> <span class="n">central_longitude</span><span class="o">=</span><span class="mf">0.0</span><span class="p">)</span>
                <span class="n">cartopy_proj</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">plot_obj</span><span class="o">.</span><span class="n">proj</span>

                <span class="c1"># Maintain the same lat / lon dimensions for all dynamic maps</span>
                <span class="c1"># Determined by the dynamic domain from the first map</span>
                <span class="k">if</span> <span class="n">i</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="ow">and</span> <span class="n">domain</span> <span class="o">==</span> <span class="s1">&#39;dynamic&#39;</span><span class="p">:</span>
                    <span class="n">d1</span> <span class="o">=</span> <span class="p">{</span>
                        <span class="s1">&#39;n&#39;</span><span class="p">:</span> <span class="n">Maps_sub</span><span class="p">[</span><span class="s1">&#39;center_lat&#39;</span><span class="p">]</span> <span class="o">+</span> <span class="n">dlat</span><span class="p">,</span>
                        <span class="s1">&#39;s&#39;</span><span class="p">:</span> <span class="n">Maps_sub</span><span class="p">[</span><span class="s1">&#39;center_lat&#39;</span><span class="p">]</span> <span class="o">-</span> <span class="n">dlat</span><span class="p">,</span>
                        <span class="s1">&#39;e&#39;</span><span class="p">:</span> <span class="n">Maps_sub</span><span class="p">[</span><span class="s1">&#39;center_lon&#39;</span><span class="p">]</span> <span class="o">+</span> <span class="n">dlon</span><span class="p">,</span>
                        <span class="s1">&#39;w&#39;</span><span class="p">:</span> <span class="n">Maps_sub</span><span class="p">[</span><span class="s1">&#39;center_lon&#39;</span><span class="p">]</span> <span class="o">-</span> <span class="n">dlon</span>
                    <span class="p">}</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">d1</span> <span class="o">=</span> <span class="n">domain</span>

                <span class="c1"># Plot recon</span>

                <span class="k">if</span> <span class="n">MULTIVAR</span><span class="p">:</span>
                    <span class="n">Maps_sub1</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="n">Maps_sub</span><span class="p">)</span>
                    <span class="n">Maps_sub2</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="n">Maps_sub</span><span class="p">)</span>
                    <span class="n">Maps_sub</span> <span class="o">=</span> <span class="p">[</span><span class="n">Maps_sub1</span><span class="p">,</span> <span class="n">Maps_sub2</span><span class="p">]</span>
                    <span class="n">Maps_sub</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="s1">&#39;maps&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">Maps2</span><span class="p">[</span><span class="s1">&#39;maps&#39;</span><span class="p">][</span><span class="n">i</span><span class="p">]</span>

                    <span class="nb">print</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">nanmax</span><span class="p">(</span><span class="n">Maps_sub</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="s1">&#39;maps&#39;</span><span class="p">]),</span>
                          <span class="n">np</span><span class="o">.</span><span class="n">nanmin</span><span class="p">(</span><span class="n">Maps_sub</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="s1">&#39;maps&#39;</span><span class="p">]))</span>

                <span class="n">plot_ax</span><span class="p">,</span> <span class="n">d0</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">plot_obj</span><span class="o">.</span><span class="n">plot_maps</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">storm</span><span class="p">,</span> <span class="n">Maps_sub</span><span class="p">,</span> <span class="n">varname</span><span class="p">,</span> <span class="n">recon_stats</span><span class="p">,</span>
                                                      <span class="n">domain</span><span class="o">=</span><span class="n">d1</span><span class="p">,</span> <span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">,</span> <span class="n">return_domain</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">prop</span><span class="o">=</span><span class="n">prop</span><span class="p">,</span> <span class="n">map_prop</span><span class="o">=</span><span class="n">map_prop</span><span class="p">)</span>

                <span class="c1"># Get domain dimensions from the first map</span>
                <span class="k">if</span> <span class="n">i</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                    <span class="n">dlat</span> <span class="o">=</span> <span class="mf">.5</span> <span class="o">*</span> <span class="p">(</span><span class="n">d0</span><span class="p">[</span><span class="s1">&#39;n&#39;</span><span class="p">]</span> <span class="o">-</span> <span class="n">d0</span><span class="p">[</span><span class="s1">&#39;s&#39;</span><span class="p">])</span>
                    <span class="n">dlon</span> <span class="o">=</span> <span class="mf">.5</span> <span class="o">*</span> <span class="p">(</span><span class="n">d0</span><span class="p">[</span><span class="s1">&#39;e&#39;</span><span class="p">]</span> <span class="o">-</span> <span class="n">d0</span><span class="p">[</span><span class="s1">&#39;w&#39;</span><span class="p">])</span>

                <span class="n">figs</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">plot_ax</span><span class="p">)</span>

                <span class="k">if</span> <span class="n">save_dir</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                    <span class="n">plt</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span>
                        <span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">save_dir</span><span class="si">}</span><span class="s1">/</span><span class="si">{</span><span class="n">t</span><span class="o">.</span><span class="n">strftime</span><span class="p">(</span><span class="s2">&quot;%Y%m</span><span class="si">%d</span><span class="s2">%H%M&quot;</span><span class="p">)</span><span class="si">}</span><span class="s1">.png&#39;</span><span class="p">,</span> <span class="n">bbox_inches</span><span class="o">=</span><span class="s1">&#39;tight&#39;</span><span class="p">)</span>
                <span class="n">plt</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>

            <span class="k">if</span> <span class="n">save_dir</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="k">return</span> <span class="n">figs</span>

        <span class="k">else</span><span class="p">:</span>
            <span class="c1"># Create instance of plot object</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">plot_obj</span> <span class="o">=</span> <span class="n">ReconPlot</span><span class="p">()</span>

            <span class="c1"># Create cartopy projection</span>
            <span class="k">if</span> <span class="n">cartopy_proj</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">plot_obj</span><span class="o">.</span><span class="n">create_cartopy</span><span class="p">(</span>
                    <span class="n">proj</span><span class="o">=</span><span class="s1">&#39;PlateCarree&#39;</span><span class="p">,</span> <span class="n">central_longitude</span><span class="o">=</span><span class="mf">0.0</span><span class="p">)</span>
                <span class="n">cartopy_proj</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">plot_obj</span><span class="o">.</span><span class="n">proj</span>

            <span class="c1"># Plot recon</span>
            <span class="n">plot_ax</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">plot_obj</span><span class="o">.</span><span class="n">plot_maps</span><span class="p">(</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">storm</span><span class="p">,</span> <span class="n">Maps</span><span class="p">,</span> <span class="n">varname</span><span class="p">,</span> <span class="n">recon_stats</span><span class="p">,</span> <span class="n">domain</span><span class="p">,</span> <span class="n">ax</span><span class="p">,</span> <span class="n">prop</span><span class="o">=</span><span class="n">prop</span><span class="p">,</span> <span class="n">map_prop</span><span class="o">=</span><span class="n">map_prop</span><span class="p">)</span>

            <span class="c1"># Return axis</span>
            <span class="k">return</span> <span class="n">plot_ax</span></div>

<div class="viewcode-block" id="hdobs.plot_swath"><a class="viewcode-back" href="../../../api/generated/tropycal.recon.hdobs.plot_swath.html#tropycal.recon.hdobs.plot_swath">[docs]</a>    <span class="k">def</span> <span class="nf">plot_swath</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">varname</span><span class="o">=</span><span class="s1">&#39;wspd&#39;</span><span class="p">,</span> <span class="n">domain</span><span class="o">=</span><span class="s2">&quot;dynamic&quot;</span><span class="p">,</span> <span class="n">ax</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">cartopy_proj</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
<span class="w">        </span><span class="sa">r</span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Creates a map plot of a swath of interpolated recon data.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        varname : str</span>
<span class="sd">            Variable to plot. Can be one of the following keys in dataframe:</span>

<span class="sd">            * **&quot;sfmr&quot;** = SFMR surface wind</span>
<span class="sd">            * **&quot;wspd&quot;** = 30-second flight level wind (default)</span>
<span class="sd">            * **&quot;pkwnd&quot;** = 10-second flight level wind</span>
<span class="sd">            * **&quot;p_sfc&quot;** = extrapolated surface pressure</span>

<span class="sd">        domain : str</span>
<span class="sd">            Domain for the plot. Default is &quot;dynamic&quot;. Please refer to :ref:`options-domain` for available domain options.</span>
<span class="sd">        ax : axes</span>
<span class="sd">            Instance of axes to plot on. If none, one will be generated. Default is none.</span>
<span class="sd">        cartopy_proj : ccrs</span>
<span class="sd">            Instance of a cartopy projection to use. If none, one will be generated. Default is none.</span>

<span class="sd">        Other Parameters</span>
<span class="sd">        ----------------</span>
<span class="sd">        prop : dict</span>
<span class="sd">            Customization properties of recon plot. Please refer to :ref:`options-prop-recon-swath` for available options.</span>
<span class="sd">        map_prop : dict</span>
<span class="sd">            Customization properties of Cartopy map. Please refer to :ref:`options-map-prop` for available options.</span>
<span class="sd">        track_dict : dict, optional</span>
<span class="sd">            Storm track dictionary. If None (default), internal storm center track is used.</span>
<span class="sd">        swathfunc : function</span>
<span class="sd">            Function to operate on interpolated recon data (e.g., np.max, np.min, or percentile function). Default is np.min for pressure, otherwise np.max.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="c1"># Pop kwargs</span>
        <span class="n">prop</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;prop&#39;</span><span class="p">,</span> <span class="p">{})</span>
        <span class="n">map_prop</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;map_prop&#39;</span><span class="p">,</span> <span class="p">{})</span>
        <span class="n">track_dict</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;track_dict&#39;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
        <span class="n">swathfunc</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;swathfunc&#39;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>

        <span class="c1"># Get plot data</span>
        <span class="n">dfRecon</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span>

        <span class="k">if</span> <span class="n">track_dict</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">track_dict</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">storm</span><span class="o">.</span><span class="n">dict</span>

        <span class="k">if</span> <span class="n">swathfunc</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">varname</span> <span class="o">==</span> <span class="s1">&#39;p_sfc&#39;</span><span class="p">:</span>
                <span class="n">swathfunc</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">min</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">swathfunc</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">max</span>

        <span class="n">iRecon</span> <span class="o">=</span> <span class="n">interpRecon</span><span class="p">(</span><span class="n">dfRecon</span><span class="p">,</span> <span class="n">varname</span><span class="p">)</span>
        <span class="n">Maps</span> <span class="o">=</span> <span class="n">iRecon</span><span class="o">.</span><span class="n">interpMaps</span><span class="p">(</span><span class="n">track_dict</span><span class="p">,</span> <span class="n">interval</span><span class="o">=</span><span class="mf">.2</span><span class="p">)</span>

        <span class="c1"># Create instance of plot object</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">plot_obj</span> <span class="o">=</span> <span class="n">ReconPlot</span><span class="p">()</span>

        <span class="c1"># Create cartopy projection</span>
        <span class="k">if</span> <span class="n">cartopy_proj</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">plot_obj</span><span class="o">.</span><span class="n">create_cartopy</span><span class="p">(</span>
                <span class="n">proj</span><span class="o">=</span><span class="s1">&#39;PlateCarree&#39;</span><span class="p">,</span> <span class="n">central_longitude</span><span class="o">=</span><span class="mf">0.0</span><span class="p">)</span>
            <span class="n">cartopy_proj</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">plot_obj</span><span class="o">.</span><span class="n">proj</span>

        <span class="c1"># Plot recon</span>
        <span class="n">plot_ax</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">plot_obj</span><span class="o">.</span><span class="n">plot_swath</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">storm</span><span class="p">,</span> <span class="n">Maps</span><span class="p">,</span> <span class="n">varname</span><span class="p">,</span> <span class="n">swathfunc</span><span class="p">,</span> <span class="n">track_dict</span><span class="p">,</span> <span class="n">domain</span><span class="p">,</span> <span class="n">ax</span><span class="p">,</span> <span class="n">prop</span><span class="o">=</span><span class="n">prop</span><span class="p">,</span> <span class="n">map_prop</span><span class="o">=</span><span class="n">map_prop</span><span class="p">)</span>

        <span class="c1"># Return axis</span>
        <span class="k">return</span> <span class="n">plot_ax</span></div>

<div class="viewcode-block" id="hdobs.gridded_stats"><a class="viewcode-back" href="../../../api/generated/tropycal.recon.hdobs.gridded_stats.html#tropycal.recon.hdobs.gridded_stats">[docs]</a>    <span class="k">def</span> <span class="nf">gridded_stats</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">request</span><span class="p">,</span> <span class="n">thresh</span><span class="o">=</span><span class="p">{},</span> <span class="n">binsize</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">domain</span><span class="o">=</span><span class="s2">&quot;dynamic&quot;</span><span class="p">,</span> <span class="n">ax</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                      <span class="n">return_array</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">cartopy_proj</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">prop</span><span class="o">=</span><span class="p">{},</span> <span class="n">map_prop</span><span class="o">=</span><span class="p">{}):</span>
<span class="w">        </span><span class="sa">r</span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Creates a plot of gridded statistics.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        request : str</span>
<span class="sd">            This string is a descriptor for what you want to plot.</span>
<span class="sd">            It will be used to define the variable (e.g. &#39;wind&#39; --&gt; &#39;vmax&#39;) and the function (e.g. &#39;maximum&#39; --&gt; np.max()).</span>
<span class="sd">            This string is also used as the plot title.</span>

<span class="sd">            Variable words to use in request:</span>

<span class="sd">            * **wind** - (kt). Sustained wind.</span>
<span class="sd">            * **pressure** - (hPa). Minimum pressure.</span>
<span class="sd">            * **wind change** - (kt/time). Must be followed by an integer value denoting the length of the time window &#39;__ hours&#39; (e.g., &quot;wind change in 24 hours&quot;).</span>
<span class="sd">            * **pressure change** - (hPa/time). Must be followed by an integer value denoting the length of the time window &#39;__ hours&#39; (e.g., &quot;pressure change in 24 hours&quot;).</span>
<span class="sd">            * **storm motion** - (km/hour). Can be followed a length of time window. Otherwise defaults to 24 hours.</span>

<span class="sd">            Units of all wind variables are knots and pressure variables are hPa. These are added into the title.</span>

<span class="sd">            Function words to use in request:</span>

<span class="sd">            * **maximum**</span>
<span class="sd">            * **minimum**</span>
<span class="sd">            * **average** </span>
<span class="sd">            * **percentile** - Percentile must be preceded by an integer [0,100].</span>
<span class="sd">            * **number** - Number of storms in grid box satisfying filter thresholds.</span>

<span class="sd">            Example usage: &quot;maximum wind change in 24 hours&quot;, &quot;50th percentile wind&quot;, &quot;number of storms&quot;</span>

<span class="sd">        thresh : dict, optional</span>
<span class="sd">            Keywords in self.keys</span>

<span class="sd">            Units of all wind variables = kt, and pressure variables = hPa. These are added to the subtitle.</span>

<span class="sd">        binsize : float, optional</span>
<span class="sd">            Grid resolution in degrees. Default is 1 degree.</span>
<span class="sd">        domain : str, optional</span>
<span class="sd">            Domain for the plot. Default is &quot;dynamic&quot;. Please refer to :ref:`options-domain` for available domain options.</span>
<span class="sd">        ax : axes, optional</span>
<span class="sd">            Instance of axes to plot on. If none, one will be generated. Default is none.</span>
<span class="sd">        return_array : bool, optional</span>
<span class="sd">            If True, returns the gridded 2D array used to generate the plot. Default is False.</span>
<span class="sd">        cartopy_proj : ccrs, optional</span>
<span class="sd">            Instance of a cartopy projection to use. If none, one will be generated. Default is none.</span>

<span class="sd">        Other Parameters</span>
<span class="sd">        ----------------</span>
<span class="sd">        prop : dict, optional</span>
<span class="sd">            Customization properties of plot. Please refer to :ref:`options-prop-gridded` for available options.</span>
<span class="sd">        map_prop : dict, optional</span>
<span class="sd">            Customization properties of Cartopy map. Please refer to :ref:`options-map-prop` for available options.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        By default, the plot axes is returned. If &quot;return_array&quot; are set to True, a dictionary is returned containing both the axes and data array.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">default_prop</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s1">&#39;smooth&#39;</span><span class="p">:</span> <span class="kc">None</span>
        <span class="p">}</span>
        <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="n">prop</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
            <span class="n">default_prop</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="n">prop</span><span class="p">[</span><span class="n">key</span><span class="p">]</span>
        <span class="n">prop</span> <span class="o">=</span> <span class="n">default_prop</span>

        <span class="c1"># Update thresh based on input</span>
        <span class="n">default_thresh</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s1">&#39;sample_min&#39;</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span>
            <span class="s1">&#39;p_max&#39;</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">nan</span><span class="p">,</span>
            <span class="s1">&#39;v_min&#39;</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">nan</span><span class="p">,</span>
            <span class="s1">&#39;dv_min&#39;</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">nan</span><span class="p">,</span>
            <span class="s1">&#39;dp_max&#39;</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">nan</span><span class="p">,</span>
            <span class="s1">&#39;dv_max&#39;</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">nan</span><span class="p">,</span>
            <span class="s1">&#39;dp_min&#39;</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">nan</span><span class="p">,</span>
            <span class="s1">&#39;dt_window&#39;</span><span class="p">:</span> <span class="mi">24</span><span class="p">,</span>
            <span class="s1">&#39;dt_align&#39;</span><span class="p">:</span> <span class="s1">&#39;middle&#39;</span>
        <span class="p">}</span>
        <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="n">thresh</span><span class="p">:</span>
            <span class="n">default_thresh</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="n">thresh</span><span class="p">[</span><span class="n">key</span><span class="p">]</span>
        <span class="n">thresh</span> <span class="o">=</span> <span class="n">default_thresh</span>

        <span class="c1"># Retrieve the requested function, variable for computing stats, and plot title. These modify thresh if necessary.</span>
        <span class="n">thresh</span><span class="p">,</span> <span class="n">func</span> <span class="o">=</span> <span class="n">find_func</span><span class="p">(</span><span class="n">request</span><span class="p">,</span> <span class="n">thresh</span><span class="p">)</span>
        <span class="n">thresh</span><span class="p">,</span> <span class="n">varname</span> <span class="o">=</span> <span class="n">find_var</span><span class="p">(</span><span class="n">request</span><span class="p">,</span> <span class="n">thresh</span><span class="p">)</span>

        <span class="c1"># ---------------------------------------------------------------------------------------------------</span>

        <span class="n">points</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span>
        <span class="c1"># Round lat/lon points down to nearest bin</span>
        <span class="k">def</span> <span class="nf">to_bin</span><span class="p">(</span><span class="n">x</span><span class="p">):</span> <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">floor</span><span class="p">(</span><span class="n">x</span> <span class="o">/</span> <span class="n">binsize</span><span class="p">)</span> <span class="o">*</span> <span class="n">binsize</span>
        <span class="n">points</span><span class="p">[</span><span class="s2">&quot;latbin&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">points</span><span class="o">.</span><span class="n">lat</span><span class="o">.</span><span class="n">map</span><span class="p">(</span><span class="n">to_bin</span><span class="p">)</span>
        <span class="n">points</span><span class="p">[</span><span class="s2">&quot;lonbin&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">points</span><span class="o">.</span><span class="n">lon</span><span class="o">.</span><span class="n">map</span><span class="p">(</span><span class="n">to_bin</span><span class="p">)</span>

        <span class="c1"># ---------------------------------------------------------------------------------------------------</span>

        <span class="c1"># Group by latbin,lonbin,stormid</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;--&gt; Grouping by lat/lon&quot;</span><span class="p">)</span>
        <span class="n">groups</span> <span class="o">=</span> <span class="n">points</span><span class="o">.</span><span class="n">groupby</span><span class="p">([</span><span class="s2">&quot;latbin&quot;</span><span class="p">,</span> <span class="s2">&quot;lonbin&quot;</span><span class="p">])</span>

        <span class="c1"># Loops through groups, and apply stat func to obs</span>
        <span class="c1"># Constructs a new dataframe containing the lat/lon bins and plotting variable</span>
        <span class="n">new_df</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s1">&#39;latbin&#39;</span><span class="p">:</span> <span class="p">[],</span>
            <span class="s1">&#39;lonbin&#39;</span><span class="p">:</span> <span class="p">[],</span>
            <span class="s1">&#39;varname&#39;</span><span class="p">:</span> <span class="p">[]</span>
        <span class="p">}</span>
        <span class="k">for</span> <span class="n">g</span> <span class="ow">in</span> <span class="n">groups</span><span class="p">:</span>
            <span class="n">new_df</span><span class="p">[</span><span class="n">varname</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">func</span><span class="p">(</span><span class="n">g</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="n">varname</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="p">))</span>
            <span class="n">new_df</span><span class="p">[</span><span class="s1">&#39;latbin&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">g</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">])</span>
            <span class="n">new_df</span><span class="p">[</span><span class="s1">&#39;lonbin&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">g</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">1</span><span class="p">])</span>
        <span class="n">new_df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="o">.</span><span class="n">from_dict</span><span class="p">(</span><span class="n">new_df</span><span class="p">)</span>

        <span class="c1"># ---------------------------------------------------------------------------------------------------</span>

        <span class="c1"># Group again by latbin,lonbin</span>
        <span class="c1"># Construct two 1D lists: zi (grid values) and coords, that correspond to the 2D grid</span>
        <span class="n">groups</span> <span class="o">=</span> <span class="n">new_df</span><span class="o">.</span><span class="n">groupby</span><span class="p">([</span><span class="s2">&quot;latbin&quot;</span><span class="p">,</span> <span class="s2">&quot;lonbin&quot;</span><span class="p">])</span>

        <span class="n">zi</span> <span class="o">=</span> <span class="p">[</span><span class="n">func</span><span class="p">(</span><span class="n">g</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="n">varname</span><span class="p">])</span> <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">g</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span> <span class="o">&gt;=</span>
              <span class="n">thresh</span><span class="p">[</span><span class="s1">&#39;sample_min&#39;</span><span class="p">]</span> <span class="k">else</span> <span class="n">np</span><span class="o">.</span><span class="n">nan</span> <span class="k">for</span> <span class="n">g</span> <span class="ow">in</span> <span class="n">groups</span><span class="p">]</span>

        <span class="c1"># Construct a 1D array of coordinates</span>
        <span class="n">coords</span> <span class="o">=</span> <span class="p">[</span><span class="n">g</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="k">for</span> <span class="n">g</span> <span class="ow">in</span> <span class="n">groups</span><span class="p">]</span>

        <span class="c1"># Construct a 2D longitude and latitude grid, using the specified binsize resolution</span>
        <span class="k">if</span> <span class="n">prop</span><span class="p">[</span><span class="s1">&#39;smooth&#39;</span><span class="p">]</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">all_lats</span> <span class="o">=</span> <span class="p">[(</span><span class="nb">round</span><span class="p">(</span><span class="n">l</span> <span class="o">/</span> <span class="n">binsize</span><span class="p">)</span> <span class="o">*</span> <span class="n">binsize</span><span class="p">)</span>
                        <span class="k">for</span> <span class="n">l</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;lat&#39;</span><span class="p">]]</span>
            <span class="n">all_lons</span> <span class="o">=</span> <span class="p">[(</span><span class="nb">round</span><span class="p">(</span><span class="n">l</span> <span class="o">/</span> <span class="n">binsize</span><span class="p">)</span> <span class="o">*</span> <span class="n">binsize</span><span class="p">)</span> <span class="o">%</span>
                        <span class="mi">360</span> <span class="k">for</span> <span class="n">l</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;lon&#39;</span><span class="p">]]</span>
            <span class="n">xi</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="nb">min</span><span class="p">(</span><span class="n">all_lons</span><span class="p">)</span> <span class="o">-</span> <span class="n">binsize</span><span class="p">,</span>
                           <span class="nb">max</span><span class="p">(</span><span class="n">all_lons</span><span class="p">)</span> <span class="o">+</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">binsize</span><span class="p">,</span> <span class="n">binsize</span><span class="p">)</span>
            <span class="n">yi</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="nb">min</span><span class="p">(</span><span class="n">all_lats</span><span class="p">)</span> <span class="o">-</span> <span class="n">binsize</span><span class="p">,</span>
                           <span class="nb">max</span><span class="p">(</span><span class="n">all_lats</span><span class="p">)</span> <span class="o">+</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">binsize</span><span class="p">,</span> <span class="n">binsize</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">xi</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">nanmin</span><span class="p">(</span>
                <span class="n">points</span><span class="p">[</span><span class="s2">&quot;lonbin&quot;</span><span class="p">])</span> <span class="o">-</span> <span class="n">binsize</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">nanmax</span><span class="p">(</span><span class="n">points</span><span class="p">[</span><span class="s2">&quot;lonbin&quot;</span><span class="p">])</span> <span class="o">+</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">binsize</span><span class="p">,</span> <span class="n">binsize</span><span class="p">)</span>
            <span class="n">yi</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">nanmin</span><span class="p">(</span>
                <span class="n">points</span><span class="p">[</span><span class="s2">&quot;latbin&quot;</span><span class="p">])</span> <span class="o">-</span> <span class="n">binsize</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">nanmax</span><span class="p">(</span><span class="n">points</span><span class="p">[</span><span class="s2">&quot;latbin&quot;</span><span class="p">])</span> <span class="o">+</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">binsize</span><span class="p">,</span> <span class="n">binsize</span><span class="p">)</span>
        <span class="n">grid_x</span><span class="p">,</span> <span class="n">grid_y</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">meshgrid</span><span class="p">(</span><span class="n">xi</span><span class="p">,</span> <span class="n">yi</span><span class="p">)</span>

        <span class="c1"># Construct a 2D grid for the z value, depending on whether vector or scalar quantity</span>
        <span class="n">grid_z</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">(</span><span class="n">grid_x</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">nan</span>
        <span class="k">for</span> <span class="n">c</span><span class="p">,</span> <span class="n">z</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">coords</span><span class="p">,</span> <span class="n">zi</span><span class="p">):</span>
            <span class="n">grid_z</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">((</span><span class="n">grid_y</span> <span class="o">==</span> <span class="n">c</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">grid_x</span> <span class="o">==</span> <span class="n">c</span><span class="p">[</span><span class="mi">1</span><span class="p">]))]</span> <span class="o">=</span> <span class="n">z</span>

        <span class="c1"># ---------------------------------------------------------------------------------------------------</span>

        <span class="c1"># Create instance of plot object</span>
        <span class="n">plot_obj</span> <span class="o">=</span> <span class="n">TrackPlot</span><span class="p">()</span>

        <span class="c1"># Create cartopy projection using basin</span>
        <span class="k">if</span> <span class="n">cartopy_proj</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">if</span> <span class="nb">max</span><span class="p">(</span><span class="n">points</span><span class="p">[</span><span class="s1">&#39;lon&#39;</span><span class="p">])</span> <span class="o">&gt;</span> <span class="mi">150</span> <span class="ow">or</span> <span class="nb">min</span><span class="p">(</span><span class="n">points</span><span class="p">[</span><span class="s1">&#39;lon&#39;</span><span class="p">])</span> <span class="o">&lt;</span> <span class="o">-</span><span class="mi">150</span><span class="p">:</span>
                <span class="n">plot_obj</span><span class="o">.</span><span class="n">create_cartopy</span><span class="p">(</span>
                    <span class="n">proj</span><span class="o">=</span><span class="s1">&#39;PlateCarree&#39;</span><span class="p">,</span> <span class="n">central_longitude</span><span class="o">=</span><span class="mf">180.0</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">plot_obj</span><span class="o">.</span><span class="n">create_cartopy</span><span class="p">(</span>
                    <span class="n">proj</span><span class="o">=</span><span class="s1">&#39;PlateCarree&#39;</span><span class="p">,</span> <span class="n">central_longitude</span><span class="o">=</span><span class="mf">0.0</span><span class="p">)</span>

        <span class="n">prop</span><span class="p">[</span><span class="s1">&#39;title_L&#39;</span><span class="p">],</span> <span class="n">prop</span><span class="p">[</span><span class="s1">&#39;title_R&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">storm</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="s1">&#39;things&#39;</span>

        <span class="k">if</span> <span class="n">domain</span> <span class="o">==</span> <span class="s2">&quot;dynamic&quot;</span><span class="p">:</span>
            <span class="n">domain</span> <span class="o">=</span> <span class="p">{</span>
                <span class="s1">&#39;W&#39;</span><span class="p">:</span> <span class="nb">min</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;lon&#39;</span><span class="p">]),</span>
                <span class="s1">&#39;E&#39;</span><span class="p">:</span> <span class="nb">max</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;lon&#39;</span><span class="p">]),</span>
                <span class="s1">&#39;S&#39;</span><span class="p">:</span> <span class="nb">min</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;lat&#39;</span><span class="p">]),</span>
                <span class="s1">&#39;N&#39;</span><span class="p">:</span> <span class="nb">max</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;lat&#39;</span><span class="p">])</span>
            <span class="p">}</span>

        <span class="c1"># Plot gridded field</span>
        <span class="n">plot_ax</span> <span class="o">=</span> <span class="n">plot_obj</span><span class="o">.</span><span class="n">plot_gridded</span><span class="p">(</span>
            <span class="n">grid_x</span><span class="p">,</span> <span class="n">grid_y</span><span class="p">,</span> <span class="n">grid_z</span><span class="p">,</span> <span class="n">varname</span><span class="p">,</span> <span class="n">domain</span><span class="o">=</span><span class="n">domain</span><span class="p">,</span> <span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">,</span> <span class="n">prop</span><span class="o">=</span><span class="n">prop</span><span class="p">,</span> <span class="n">map_prop</span><span class="o">=</span><span class="n">map_prop</span><span class="p">)</span>

        <span class="c1"># Format grid into xarray if specified</span>
        <span class="k">if</span> <span class="n">return_array</span><span class="p">:</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="c1"># Import xarray and construct DataArray, replacing NaNs with zeros</span>
                <span class="kn">import</span> <span class="nn">xarray</span> <span class="k">as</span> <span class="nn">xr</span>
                <span class="n">arr</span> <span class="o">=</span> <span class="n">xr</span><span class="o">.</span><span class="n">DataArray</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">nan_to_num</span><span class="p">(</span><span class="n">grid_z</span><span class="p">),</span> <span class="n">coords</span><span class="o">=</span><span class="p">[</span>
                                   <span class="n">grid_y</span><span class="o">.</span><span class="n">T</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">grid_x</span><span class="p">[</span><span class="mi">0</span><span class="p">]],</span> <span class="n">dims</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;lat&#39;</span><span class="p">,</span> <span class="s1">&#39;lon&#39;</span><span class="p">])</span>
                <span class="k">return</span> <span class="n">arr</span>
            <span class="k">except</span> <span class="ne">ImportError</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span>
                    <span class="s2">&quot;Error: xarray is not available. Install xarray in order to use the &#39;return_array&#39; flag.&quot;</span><span class="p">)</span> <span class="kn">from</span> <span class="nn">e</span>

        <span class="c1"># Return axis</span>
        <span class="k">if</span> <span class="n">return_array</span><span class="p">:</span>
            <span class="k">return</span> <span class="p">{</span><span class="s1">&#39;ax&#39;</span><span class="p">:</span> <span class="n">plot_ax</span><span class="p">,</span> <span class="s1">&#39;array&#39;</span><span class="p">:</span> <span class="n">arr</span><span class="p">}</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">plot_ax</span></div></div>


<div class="viewcode-block" id="dropsondes"><a class="viewcode-back" href="../../../api/generated/tropycal.recon.dropsondes.html#tropycal.recon.dropsondes">[docs]</a><span class="k">class</span> <span class="nc">dropsondes</span><span class="p">:</span>

<span class="w">    </span><span class="sa">r</span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Creates an instance of a Dropsondes object containing all dropsonde data for a single storm.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    storm : tropycal.tracks.Storm</span>
<span class="sd">        Requested storm.</span>
<span class="sd">    data : str, optional</span>
<span class="sd">        Filepath of pickle file containing dropsondes data retrieved from ``dropsondes.to_pickle()``. If provided, data will be retrieved from the local pickle file instead of the NHC server.</span>
<span class="sd">    update : bool</span>
<span class="sd">        True = search for new data, following existing data in the dropsonde object, and concatenate.</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    Dataset</span>
<span class="sd">        An instance of dropsondes.</span>

<span class="sd">    Notes</span>
<span class="sd">    -----</span>
<span class="sd">    .. warning::</span>

<span class="sd">        Recon data is currently only available from 2006 onwards.</span>

<span class="sd">    There are two recommended ways of retrieving a dropsondes object. Since the ``ReconDataset``, ``hdobs``, ``dropsondes`` and ``vdms`` classes are **storm-centric**, a Storm object is required for both methods.</span>

<span class="sd">    .. code-block:: python</span>

<span class="sd">        #Retrieve Hurricane Michael (2018) from TrackDataset</span>
<span class="sd">        basin = tracks.TrackDataset()</span>
<span class="sd">        storm = basin.get_storm((&#39;michael&#39;,2018))</span>

<span class="sd">    The first method is to use the empty instance of ReconDataset already initialized in the Storm object, which has a ``get_dropsondes()`` method thus allowing all of the dropsondes attributes and methods to be accessed from the Storm object. As a result, a Storm object does not need to be provided as an argument.</span>

<span class="sd">    .. code-block:: python</span>

<span class="sd">        #Retrieve all dropsondes for this storm</span>
<span class="sd">        storm.recon.get_dropsondes()</span>

<span class="sd">        #Retrieve the raw dropsondes data</span>
<span class="sd">        storm.recon.dropsondes.data</span>

<span class="sd">        #Use the plot_points() method of dropsondes</span>
<span class="sd">        storm.recon.dropsondes.plot_points()</span>

<span class="sd">    The second method is to use the dropsondes class independently of the other recon classes:</span>

<span class="sd">    .. code-block:: python</span>

<span class="sd">        from tropycal.recon import dropsondes</span>

<span class="sd">        #Retrieve all dropsondes for this storm, passing the Storm object as an argument</span>
<span class="sd">        dropsondes_obj = dropsondes(storm)</span>

<span class="sd">        #Retrieve the raw dropsondes data</span>
<span class="sd">        dropsondes_obj.data</span>

<span class="sd">        #Use the plot_points() method of dropsondes</span>
<span class="sd">        dropsondes_obj.plot_points()</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="fm">__repr__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>

        <span class="n">summary</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;&lt;tropycal.recon.dropsondes&gt;&quot;</span><span class="p">]</span>

        <span class="k">def</span> <span class="nf">isNA</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">units</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">isnan</span><span class="p">(</span><span class="n">x</span><span class="p">):</span>
                <span class="k">return</span> <span class="s1">&#39;N/A&#39;</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">return</span> <span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">x</span><span class="si">}</span><span class="s1"> </span><span class="si">{</span><span class="n">units</span><span class="si">}</span><span class="s1">&#39;</span>
        <span class="c1"># Find maximum wind and minimum pressure</span>
        <span class="n">max_MBLspd</span> <span class="o">=</span> <span class="n">isNA</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">nanmax</span><span class="p">([</span><span class="n">i</span><span class="p">[</span><span class="s1">&#39;MBLspd&#39;</span><span class="p">]</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">]),</span> <span class="s1">&#39;knots&#39;</span><span class="p">)</span>
        <span class="n">max_DLMspd</span> <span class="o">=</span> <span class="n">isNA</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">nanmax</span><span class="p">([</span><span class="n">i</span><span class="p">[</span><span class="s1">&#39;DLMspd&#39;</span><span class="p">]</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">]),</span> <span class="s1">&#39;knots&#39;</span><span class="p">)</span>
        <span class="n">max_WL150spd</span> <span class="o">=</span> <span class="n">isNA</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">nanmax</span><span class="p">([</span><span class="n">i</span><span class="p">[</span><span class="s1">&#39;WL150spd&#39;</span><span class="p">]</span>
                            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">]),</span> <span class="s1">&#39;knots&#39;</span><span class="p">)</span>
        <span class="n">min_slp</span> <span class="o">=</span> <span class="n">isNA</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">nanmin</span><span class="p">([</span><span class="n">i</span><span class="p">[</span><span class="s1">&#39;slp&#39;</span><span class="p">]</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">]),</span> <span class="s1">&#39;hPa&#39;</span><span class="p">)</span>
        <span class="n">missions</span> <span class="o">=</span> <span class="nb">set</span><span class="p">([</span><span class="n">i</span><span class="p">[</span><span class="s1">&#39;mission&#39;</span><span class="p">]</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">])</span>

        <span class="c1"># Add general summary</span>
        <span class="n">emdash</span> <span class="o">=</span> <span class="s1">&#39;</span><span class="se">\u2014</span><span class="s1">&#39;</span>
        <span class="n">summary_keys</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s1">&#39;Storm&#39;</span><span class="p">:</span> <span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">storm</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s1"> </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">storm</span><span class="o">.</span><span class="n">year</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">,</span>
            <span class="s1">&#39;Missions&#39;</span><span class="p">:</span> <span class="nb">len</span><span class="p">(</span><span class="n">missions</span><span class="p">),</span>
            <span class="s1">&#39;Dropsondes&#39;</span><span class="p">:</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">),</span>
            <span class="s1">&#39;Max 500m-avg wind&#39;</span><span class="p">:</span> <span class="n">max_MBLspd</span><span class="p">,</span>
            <span class="s1">&#39;Max 150m-avg wind&#39;</span><span class="p">:</span> <span class="n">max_WL150spd</span><span class="p">,</span>
            <span class="s1">&#39;Min sea level pressure&#39;</span><span class="p">:</span> <span class="n">min_slp</span><span class="p">,</span>
            <span class="s1">&#39;Source&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">source</span>
        <span class="p">}</span>

        <span class="c1"># Add dataset summary</span>
        <span class="n">summary</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;Dataset Summary:&quot;</span><span class="p">)</span>
        <span class="n">add_space</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">([</span><span class="nb">len</span><span class="p">(</span><span class="n">key</span><span class="p">)</span> <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="n">summary_keys</span><span class="o">.</span><span class="n">keys</span><span class="p">()])</span> <span class="o">+</span> <span class="mi">3</span>
        <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="n">summary_keys</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
            <span class="n">key_name</span> <span class="o">=</span> <span class="n">key</span> <span class="o">+</span> <span class="s2">&quot;:&quot;</span>
            <span class="n">summary</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
                <span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="s2">&quot; &quot;</span><span class="o">*</span><span class="mi">4</span><span class="si">}{</span><span class="n">key_name</span><span class="si">:</span><span class="s1">&lt;</span><span class="si">{</span><span class="n">add_space</span><span class="si">}}{</span><span class="n">summary_keys</span><span class="p">[</span><span class="n">key</span><span class="p">]</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>

        <span class="k">return</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">summary</span><span class="p">)</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">storm</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">update</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">storm</span> <span class="o">=</span> <span class="n">storm</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">source</span> <span class="o">=</span> <span class="s1">&#39;National Hurricane Center (NHC)&#39;</span>

        <span class="k">if</span> <span class="n">storm</span><span class="o">.</span><span class="n">year</span> <span class="o">&gt;=</span> <span class="mi">2006</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">format</span> <span class="o">=</span> <span class="mi">1</span>
            <span class="k">if</span> <span class="n">storm</span><span class="o">.</span><span class="n">basin</span> <span class="o">==</span> <span class="s1">&#39;north_atlantic&#39;</span><span class="p">:</span>
                <span class="n">archive_url</span> <span class="o">=</span> <span class="sa">f</span><span class="s1">&#39;https://www.nhc.noaa.gov/archive/recon/</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">storm</span><span class="o">.</span><span class="n">year</span><span class="si">}</span><span class="s1">/REPNT3/&#39;</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">archive_url</span> <span class="o">=</span> <span class="sa">f</span><span class="s1">&#39;https://www.nhc.noaa.gov/archive/recon/</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">storm</span><span class="o">.</span><span class="n">year</span><span class="si">}</span><span class="s1">/REPPN3/&#39;</span>
        <span class="k">elif</span> <span class="n">storm</span><span class="o">.</span><span class="n">year</span> <span class="o">&gt;=</span> <span class="mi">2002</span> <span class="ow">and</span> <span class="n">storm</span><span class="o">.</span><span class="n">year</span> <span class="o">&lt;=</span> <span class="mi">2005</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">format</span> <span class="o">=</span> <span class="mi">2</span>
            <span class="n">archive_url</span> <span class="o">=</span> <span class="sa">f</span><span class="s1">&#39;https://www.nhc.noaa.gov/archive/recon/</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">storm</span><span class="o">.</span><span class="n">year</span><span class="si">}</span><span class="s1">/</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">storm</span><span class="o">.</span><span class="n">name</span><span class="o">.</span><span class="n">upper</span><span class="p">()</span><span class="si">}</span><span class="s1">/&#39;</span>
        <span class="k">elif</span> <span class="n">storm</span><span class="o">.</span><span class="n">year</span> <span class="o">&gt;=</span> <span class="mi">1989</span> <span class="ow">and</span> <span class="n">storm</span><span class="o">.</span><span class="n">year</span> <span class="o">&lt;=</span> <span class="mi">2001</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">format</span> <span class="o">=</span> <span class="mi">3</span>
            <span class="n">archive_url</span> <span class="o">=</span> <span class="sa">f</span><span class="s1">&#39;https://www.nhc.noaa.gov/archive/recon/</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">storm</span><span class="o">.</span><span class="n">year</span><span class="si">}</span><span class="s1">/</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">storm</span><span class="o">.</span><span class="n">name</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span><span class="si">}</span><span class="s1">/&#39;</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span><span class="s2">&quot;Recon data is not available prior to 1989.&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">data</span> <span class="o">=</span> <span class="kc">None</span>

        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
            <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="s1">&#39;rb&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">data</span> <span class="o">=</span> <span class="n">pickle</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">f</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">data</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">data</span> <span class="o">=</span> <span class="n">data</span>

        <span class="k">if</span> <span class="n">data</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">or</span> <span class="n">update</span><span class="p">:</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">start_time</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;time&#39;</span><span class="p">])</span>
            <span class="k">except</span><span class="p">:</span>
                <span class="n">start_time</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">storm</span><span class="o">.</span><span class="n">dict</span><span class="p">[</span><span class="s1">&#39;time&#39;</span><span class="p">])</span> <span class="o">-</span> <span class="n">timedelta</span><span class="p">(</span><span class="n">days</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
            <span class="n">end_time</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">storm</span><span class="o">.</span><span class="n">dict</span><span class="p">[</span><span class="s1">&#39;time&#39;</span><span class="p">])</span> <span class="o">+</span> <span class="n">timedelta</span><span class="p">(</span><span class="n">days</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>

            <span class="n">timeboundstrs</span> <span class="o">=</span> <span class="p">[</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">t</span><span class="si">:</span><span class="s1">%Y%m%d%H%M</span><span class="si">}</span><span class="s1">&#39;</span> <span class="k">for</span> <span class="n">t</span> <span class="ow">in</span> <span class="p">(</span><span class="n">start_time</span><span class="p">,</span> <span class="n">end_time</span><span class="p">)]</span>

            <span class="c1"># Retrieve list of files in URL and filter by storm dates</span>
            <span class="n">page</span> <span class="o">=</span> <span class="n">requests</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">archive_url</span><span class="p">)</span><span class="o">.</span><span class="n">text</span>
            <span class="n">content</span> <span class="o">=</span> <span class="n">page</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
            <span class="n">files</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">format</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
                <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="n">content</span><span class="p">:</span>
                    <span class="k">if</span> <span class="s2">&quot;.txt&quot;</span> <span class="ow">in</span> <span class="n">line</span><span class="p">:</span>
                        <span class="n">files</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
                            <span class="p">((</span><span class="n">line</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;txt&quot;&gt;&#39;</span><span class="p">)[</span><span class="mi">1</span><span class="p">])</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;&lt;/a&gt;&quot;</span><span class="p">)[</span><span class="mi">0</span><span class="p">])</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;.&quot;</span><span class="p">))</span>
                <span class="k">del</span> <span class="n">content</span>
                <span class="n">files</span> <span class="o">=</span> <span class="nb">sorted</span><span class="p">([</span><span class="n">i</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">files</span> <span class="k">if</span> <span class="n">i</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">&gt;=</span> <span class="nb">min</span><span class="p">(</span>
                    <span class="n">timeboundstrs</span><span class="p">)</span> <span class="ow">and</span> <span class="n">i</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">&lt;=</span> <span class="nb">max</span><span class="p">(</span><span class="n">timeboundstrs</span><span class="p">)],</span> <span class="n">key</span><span class="o">=</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
                <span class="n">linksub</span> <span class="o">=</span> <span class="p">[</span><span class="n">archive_url</span> <span class="o">+</span> <span class="s1">&#39;.&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">l</span><span class="p">)</span> <span class="k">for</span> <span class="n">l</span> <span class="ow">in</span> <span class="n">files</span><span class="p">]</span>
            <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">format</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>
                <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="n">content</span><span class="p">:</span>
                    <span class="k">if</span> <span class="s2">&quot;.txt&quot;</span> <span class="ow">in</span> <span class="n">line</span> <span class="ow">and</span> <span class="s1">&#39;DROPS&#39;</span> <span class="ow">in</span> <span class="n">line</span><span class="p">:</span>
                        <span class="n">files</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
                            <span class="p">((</span><span class="n">line</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;txt&quot;&gt;&#39;</span><span class="p">)[</span><span class="mi">1</span><span class="p">])</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;&lt;/a&gt;&quot;</span><span class="p">)[</span><span class="mi">0</span><span class="p">]))</span>
                <span class="k">del</span> <span class="n">content</span>
                <span class="n">linksub</span> <span class="o">=</span> <span class="p">[</span><span class="n">archive_url</span> <span class="o">+</span> <span class="n">l</span> <span class="k">for</span> <span class="n">l</span> <span class="ow">in</span> <span class="n">files</span><span class="p">]</span>
            <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">format</span> <span class="o">==</span> <span class="mi">3</span><span class="p">:</span>
                <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="n">content</span><span class="p">:</span>
                    <span class="k">if</span> <span class="s2">&quot;.txt&quot;</span> <span class="ow">in</span> <span class="n">line</span><span class="p">:</span>
                        <span class="n">files</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
                            <span class="p">((</span><span class="n">line</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;txt&quot;&gt;&#39;</span><span class="p">)[</span><span class="mi">1</span><span class="p">])</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;&lt;/a&gt;&quot;</span><span class="p">)[</span><span class="mi">0</span><span class="p">]))</span>
                <span class="k">del</span> <span class="n">content</span>
                <span class="n">linksub</span> <span class="o">=</span> <span class="p">[</span><span class="n">archive_url</span> <span class="o">+</span>
                           <span class="n">l</span> <span class="k">for</span> <span class="n">l</span> <span class="ow">in</span> <span class="n">files</span> <span class="k">if</span> <span class="n">l</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;D&#39;</span><span class="p">,</span> <span class="s1">&#39;d&#39;</span><span class="p">]]</span>

            <span class="n">urllib3</span><span class="o">.</span><span class="n">disable_warnings</span><span class="p">()</span>
            <span class="n">http</span> <span class="o">=</span> <span class="n">urllib3</span><span class="o">.</span><span class="n">PoolManager</span><span class="p">()</span>

            <span class="n">timer_start</span> <span class="o">=</span> <span class="n">dt</span><span class="o">.</span><span class="n">now</span><span class="p">()</span>
            <span class="nb">print</span><span class="p">(</span>
                <span class="sa">f</span><span class="s1">&#39;Searching through recon dropsonde files between </span><span class="si">{</span><span class="n">timeboundstrs</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="si">}</span><span class="s1"> and </span><span class="si">{</span><span class="n">timeboundstrs</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="si">}</span><span class="s1"> ...&#39;</span><span class="p">)</span>
            <span class="n">filecount</span> <span class="o">=</span> <span class="mi">0</span>
            <span class="k">for</span> <span class="n">link</span> <span class="ow">in</span> <span class="n">linksub</span><span class="p">:</span>
                <span class="n">response</span> <span class="o">=</span> <span class="n">http</span><span class="o">.</span><span class="n">request</span><span class="p">(</span><span class="s1">&#39;GET&#39;</span><span class="p">,</span> <span class="n">link</span><span class="p">)</span>
                <span class="n">content</span> <span class="o">=</span> <span class="n">response</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">decode</span><span class="p">(</span><span class="s1">&#39;utf-8&#39;</span><span class="p">)</span>

                <span class="c1"># Post-2006 format</span>
                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">format</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
                    <span class="n">datestamp</span> <span class="o">=</span> <span class="n">dt</span><span class="o">.</span><span class="n">strptime</span><span class="p">(</span><span class="n">link</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;.&#39;</span><span class="p">)[</span><span class="o">-</span><span class="mi">2</span><span class="p">],</span> <span class="s1">&#39;%Y%m</span><span class="si">%d</span><span class="s1">%H%M&#39;</span><span class="p">)</span>
                    <span class="k">try</span><span class="p">:</span>
                        <span class="n">missionname</span><span class="p">,</span> <span class="n">tmp</span> <span class="o">=</span> <span class="n">decode_dropsonde</span><span class="p">(</span>
                            <span class="n">content</span><span class="p">,</span> <span class="n">date</span><span class="o">=</span><span class="n">datestamp</span><span class="p">)</span>
                    <span class="k">except</span><span class="p">:</span>
                        <span class="k">continue</span>

                    <span class="n">testkeys</span> <span class="o">=</span> <span class="p">(</span><span class="s1">&#39;TOPtime&#39;</span><span class="p">,</span> <span class="s1">&#39;lat&#39;</span><span class="p">,</span> <span class="s1">&#39;lon&#39;</span><span class="p">)</span>
                    <span class="k">if</span> <span class="n">missionname</span><span class="p">[</span><span class="mi">2</span><span class="p">:</span><span class="mi">5</span><span class="p">]</span> <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">storm</span><span class="o">.</span><span class="n">operational_id</span><span class="p">[</span><span class="mi">2</span><span class="p">:</span><span class="mi">4</span><span class="p">]</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">storm</span><span class="o">.</span><span class="n">operational_id</span><span class="p">[</span><span class="mi">0</span><span class="p">]:</span>
                        <span class="n">filecount</span> <span class="o">+=</span> <span class="mi">1</span>
                        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                            <span class="bp">self</span><span class="o">.</span><span class="n">data</span> <span class="o">=</span> <span class="p">[</span><span class="n">copy</span><span class="o">.</span><span class="n">copy</span><span class="p">(</span><span class="n">tmp</span><span class="p">)]</span>
                        <span class="k">elif</span> <span class="p">[</span><span class="n">tmp</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="n">testkeys</span><span class="p">]</span> <span class="ow">not</span> <span class="ow">in</span> <span class="p">[[</span><span class="n">d</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="n">testkeys</span><span class="p">]</span> <span class="k">for</span> <span class="n">d</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">]:</span>
                            <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">tmp</span><span class="p">)</span>
                        <span class="k">else</span><span class="p">:</span>
                            <span class="k">pass</span>

                <span class="c1"># Pre-2002 format</span>
                <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">format</span> <span class="o">==</span> <span class="mi">3</span><span class="p">:</span>

                    <span class="c1"># Check for date</span>
                    <span class="k">try</span><span class="p">:</span>
                        <span class="n">day</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">content</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">split</span><span class="p">()[</span><span class="mi">2</span><span class="p">][:</span><span class="mi">2</span><span class="p">])</span>
                        <span class="k">for</span> <span class="n">iter_date</span> <span class="ow">in</span> <span class="n">storm</span><span class="o">.</span><span class="n">dict</span><span class="p">[</span><span class="s1">&#39;time&#39;</span><span class="p">]:</span>
                            <span class="n">found_date</span> <span class="o">=</span> <span class="kc">False</span>
                            <span class="k">if</span> <span class="n">iter_date</span><span class="o">.</span><span class="n">day</span> <span class="o">==</span> <span class="n">day</span><span class="p">:</span>
                                <span class="n">date</span> <span class="o">=</span> <span class="n">dt</span><span class="p">(</span><span class="n">iter_date</span><span class="o">.</span><span class="n">year</span><span class="p">,</span>
                                          <span class="n">iter_date</span><span class="o">.</span><span class="n">month</span><span class="p">,</span> <span class="n">iter_date</span><span class="o">.</span><span class="n">day</span><span class="p">)</span>
                                <span class="n">found_date</span> <span class="o">=</span> <span class="kc">True</span>
                                <span class="k">break</span>
                        <span class="k">if</span> <span class="ow">not</span> <span class="n">found_date</span><span class="p">:</span>
                            <span class="k">continue</span>
                        <span class="n">missionname</span><span class="p">,</span> <span class="n">tmp</span> <span class="o">=</span> <span class="n">decode_dropsonde</span><span class="p">(</span>
                            <span class="n">content</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;;&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">),</span> <span class="n">date</span><span class="o">=</span><span class="n">date</span><span class="p">)</span>

                        <span class="c1"># Add date to mission</span>
                        <span class="n">hh</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">content</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">split</span><span class="p">()[</span><span class="mi">2</span><span class="p">][</span><span class="mi">2</span><span class="p">:</span><span class="mi">4</span><span class="p">])</span>
                        <span class="n">mm</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">content</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">split</span><span class="p">()[</span><span class="mi">2</span><span class="p">][</span><span class="mi">4</span><span class="p">:</span><span class="mi">6</span><span class="p">])</span>
                        <span class="n">tmp</span><span class="p">[</span><span class="s1">&#39;TOPtime&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">dt</span><span class="p">(</span>
                            <span class="n">iter_date</span><span class="o">.</span><span class="n">year</span><span class="p">,</span> <span class="n">iter_date</span><span class="o">.</span><span class="n">month</span><span class="p">,</span> <span class="n">iter_date</span><span class="o">.</span><span class="n">day</span><span class="p">,</span> <span class="n">hh</span><span class="p">,</span> <span class="n">mm</span><span class="p">)</span>
                        <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">isnan</span><span class="p">(</span><span class="n">tmp</span><span class="p">[</span><span class="s1">&#39;TOPlat&#39;</span><span class="p">]):</span>
                            <span class="n">tmp</span><span class="p">[</span><span class="s1">&#39;TOPlat&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">tmp</span><span class="p">[</span><span class="s1">&#39;lat&#39;</span><span class="p">]</span>
                        <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">isnan</span><span class="p">(</span><span class="n">tmp</span><span class="p">[</span><span class="s1">&#39;TOPlon&#39;</span><span class="p">]):</span>
                            <span class="n">tmp</span><span class="p">[</span><span class="s1">&#39;TOPlon&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">tmp</span><span class="p">[</span><span class="s1">&#39;lon&#39;</span><span class="p">]</span>

                        <span class="n">testkeys</span> <span class="o">=</span> <span class="p">(</span><span class="s1">&#39;TOPtime&#39;</span><span class="p">,</span> <span class="s1">&#39;lat&#39;</span><span class="p">,</span> <span class="s1">&#39;lon&#39;</span><span class="p">)</span>
                        <span class="n">filecount</span> <span class="o">+=</span> <span class="mi">1</span>
                        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                            <span class="bp">self</span><span class="o">.</span><span class="n">data</span> <span class="o">=</span> <span class="p">[</span><span class="n">copy</span><span class="o">.</span><span class="n">copy</span><span class="p">(</span><span class="n">tmp</span><span class="p">)]</span>
                        <span class="k">elif</span> <span class="p">[</span><span class="n">tmp</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="n">testkeys</span><span class="p">]</span> <span class="ow">not</span> <span class="ow">in</span> <span class="p">[[</span><span class="n">d</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="n">testkeys</span><span class="p">]</span> <span class="k">for</span> <span class="n">d</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">]:</span>
                            <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">tmp</span><span class="p">)</span>
                        <span class="k">else</span><span class="p">:</span>
                            <span class="k">pass</span>
                    <span class="k">except</span><span class="p">:</span>
                        <span class="k">pass</span>

                <span class="c1"># Pre-2006 format</span>
                <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">format</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>
                    <span class="n">strdate</span> <span class="o">=</span> <span class="p">(</span><span class="n">link</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;.&#39;</span><span class="p">)[</span><span class="o">-</span><span class="mi">3</span><span class="p">])</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;_&quot;</span><span class="p">)[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
                    <span class="n">content_split</span> <span class="o">=</span> <span class="n">content</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;NNNN&quot;</span><span class="p">)</span>

                    <span class="k">for</span> <span class="n">iter_content</span> <span class="ow">in</span> <span class="n">content_split</span><span class="p">:</span>

                        <span class="n">iter_split</span> <span class="o">=</span> <span class="n">iter_content</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
                        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">iter_split</span><span class="p">)</span> <span class="o">&lt;</span> <span class="mi">6</span><span class="p">:</span>
                            <span class="k">continue</span>

                        <span class="c1"># Format date</span>
                        <span class="n">found_date</span> <span class="o">=</span> <span class="kc">False</span>
                        <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="n">iter_split</span><span class="p">:</span>
                            <span class="k">if</span> <span class="s1">&#39;UZNT13&#39;</span> <span class="ow">in</span> <span class="n">line</span><span class="p">:</span>
                                <span class="n">date_string</span> <span class="o">=</span> <span class="n">line</span><span class="o">.</span><span class="n">split</span><span class="p">()[</span><span class="mi">2</span><span class="p">]</span>
                                <span class="n">found_date</span> <span class="o">=</span> <span class="kc">True</span>
                                <span class="n">datestamp</span> <span class="o">=</span> <span class="n">dt</span><span class="o">.</span><span class="n">strptime</span><span class="p">(</span><span class="n">strdate</span><span class="p">,</span> <span class="s1">&#39;%Y%m</span><span class="si">%d</span><span class="s1">&#39;</span><span class="p">)</span>
                                <span class="n">datestamp</span> <span class="o">=</span> <span class="n">datestamp</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="n">day</span><span class="o">=</span><span class="nb">int</span><span class="p">(</span><span class="n">date_string</span><span class="p">[:</span><span class="mi">2</span><span class="p">]),</span> <span class="n">hour</span><span class="o">=</span><span class="nb">int</span><span class="p">(</span>
                                    <span class="n">date_string</span><span class="p">[</span><span class="mi">2</span><span class="p">:</span><span class="mi">4</span><span class="p">]),</span> <span class="n">minute</span><span class="o">=</span><span class="nb">int</span><span class="p">(</span><span class="n">date_string</span><span class="p">[</span><span class="mi">4</span><span class="p">:</span><span class="mi">6</span><span class="p">]))</span>

                        <span class="c1"># Decode dropsondes</span>
                        <span class="k">if</span> <span class="ow">not</span> <span class="n">found_date</span><span class="p">:</span>
                            <span class="k">continue</span>
                        <span class="k">try</span><span class="p">:</span>
                            <span class="n">missionname</span><span class="p">,</span> <span class="n">tmp</span> <span class="o">=</span> <span class="n">decode_dropsonde</span><span class="p">(</span>
                                <span class="n">iter_content</span><span class="p">,</span> <span class="n">date</span><span class="o">=</span><span class="n">datestamp</span><span class="p">)</span>
                        <span class="k">except</span><span class="p">:</span>
                            <span class="k">continue</span>

                        <span class="n">testkeys</span> <span class="o">=</span> <span class="p">(</span><span class="s1">&#39;lat&#39;</span><span class="p">,</span> <span class="s1">&#39;lon&#39;</span><span class="p">)</span>
                        <span class="n">filecount</span> <span class="o">+=</span> <span class="mi">1</span>
                        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                            <span class="bp">self</span><span class="o">.</span><span class="n">data</span> <span class="o">=</span> <span class="p">[</span><span class="n">copy</span><span class="o">.</span><span class="n">copy</span><span class="p">(</span><span class="n">tmp</span><span class="p">)]</span>
                        <span class="k">elif</span> <span class="p">[</span><span class="n">tmp</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="n">testkeys</span><span class="p">]</span> <span class="ow">not</span> <span class="ow">in</span> <span class="p">[[</span><span class="n">d</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="n">testkeys</span><span class="p">]</span> <span class="k">for</span> <span class="n">d</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">]:</span>
                            <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">tmp</span><span class="p">)</span>
                        <span class="k">else</span><span class="p">:</span>
                            <span class="k">pass</span>

            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;--&gt; Completed reading in recon dropsonde files (</span><span class="si">{</span><span class="p">(</span><span class="n">dt</span><span class="o">.</span><span class="n">now</span><span class="p">()</span><span class="o">-</span><span class="n">timer_start</span><span class="p">)</span><span class="o">.</span><span class="n">total_seconds</span><span class="p">()</span><span class="si">:</span><span class="s1">.1f</span><span class="si">}</span><span class="s1"> seconds)&#39;</span> <span class="o">+</span>
                  <span class="sa">f</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">Read </span><span class="si">{</span><span class="n">filecount</span><span class="si">}</span><span class="s1"> files&#39;</span><span class="p">)</span>

        <span class="k">try</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_recenter</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">keys</span> <span class="o">=</span> <span class="nb">sorted</span><span class="p">(</span>
                <span class="nb">list</span><span class="p">(</span><span class="nb">set</span><span class="p">([</span><span class="n">k</span> <span class="k">for</span> <span class="n">d</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span> <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="n">d</span><span class="o">.</span><span class="n">keys</span><span class="p">()])))</span>
        <span class="k">except</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">keys</span> <span class="o">=</span> <span class="p">[]</span>

<div class="viewcode-block" id="dropsondes.update"><a class="viewcode-back" href="../../../api/generated/tropycal.recon.dropsondes.update.html#tropycal.recon.dropsondes.update">[docs]</a>    <span class="k">def</span> <span class="nf">update</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sa">r</span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Update with the latest data for an ongoing storm.</span>

<span class="sd">        Notes</span>
<span class="sd">        -----</span>
<span class="sd">        This function has no return value, but simply updates the internal dropsonde data with new observations since the object was created.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">newobj</span> <span class="o">=</span> <span class="n">dropsondes</span><span class="p">(</span><span class="n">storm</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">storm</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">,</span> <span class="n">update</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">newobj</span></div>

    <span class="k">def</span> <span class="nf">_recenter</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">data</span> <span class="o">=</span> <span class="n">copy</span><span class="o">.</span><span class="n">copy</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">)</span>

        <span class="c1"># Get x,y distance of each ob from coinciding interped center position</span>
        <span class="k">for</span> <span class="n">stage</span> <span class="ow">in</span> <span class="p">(</span><span class="s1">&#39;TOP&#39;</span><span class="p">,</span> <span class="s1">&#39;BOTTOM&#39;</span><span class="p">):</span>
            <span class="c1"># Interpolate center position to time of each ob</span>
            <span class="n">interp_clon</span><span class="p">,</span> <span class="n">interp_clat</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">storm</span><span class="o">.</span><span class="n">recon</span><span class="o">.</span><span class="n">get_track</span><span class="p">(</span>
                <span class="p">[</span><span class="n">d</span><span class="p">[</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">stage</span><span class="si">}</span><span class="s1">time&#39;</span><span class="p">]</span> <span class="k">for</span> <span class="n">d</span> <span class="ow">in</span> <span class="n">data</span><span class="p">])</span>

            <span class="c1"># Get x,y distance of each ob from coinciding interped center position</span>
            <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">d</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">data</span><span class="p">):</span>
                <span class="n">d</span><span class="o">.</span><span class="n">update</span><span class="p">({</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">stage</span><span class="si">}</span><span class="s1">xdist&#39;</span><span class="p">:</span> <span class="n">great_circle</span><span class="p">((</span><span class="n">interp_clat</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">interp_clon</span><span class="p">[</span><span class="n">i</span><span class="p">]),</span>
                                                        <span class="p">(</span><span class="n">interp_clat</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">d</span><span class="p">[</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">stage</span><span class="si">}</span><span class="s1">lon&#39;</span><span class="p">]))</span><span class="o">.</span><span class="n">kilometers</span> <span class="o">*</span>
                          <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">][</span><span class="nb">int</span><span class="p">(</span><span class="n">d</span><span class="p">[</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">stage</span><span class="si">}</span><span class="s1">lon&#39;</span><span class="p">]</span> <span class="o">&lt;</span> <span class="n">interp_clon</span><span class="p">[</span><span class="n">i</span><span class="p">])]})</span>
                <span class="n">d</span><span class="o">.</span><span class="n">update</span><span class="p">({</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">stage</span><span class="si">}</span><span class="s1">ydist&#39;</span><span class="p">:</span> <span class="n">great_circle</span><span class="p">((</span><span class="n">interp_clat</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">interp_clon</span><span class="p">[</span><span class="n">i</span><span class="p">]),</span>
                                                        <span class="p">(</span><span class="n">d</span><span class="p">[</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">stage</span><span class="si">}</span><span class="s1">lat&#39;</span><span class="p">],</span> <span class="n">interp_clon</span><span class="p">[</span><span class="n">i</span><span class="p">]))</span><span class="o">.</span><span class="n">kilometers</span> <span class="o">*</span>
                          <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">][</span><span class="nb">int</span><span class="p">(</span><span class="n">d</span><span class="p">[</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">stage</span><span class="si">}</span><span class="s1">lat&#39;</span><span class="p">]</span> <span class="o">&lt;</span> <span class="n">interp_clat</span><span class="p">[</span><span class="n">i</span><span class="p">])]})</span>
                <span class="n">d</span><span class="o">.</span><span class="n">update</span><span class="p">({</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">stage</span><span class="si">}</span><span class="s1">distance&#39;</span><span class="p">:</span> <span class="p">(</span>
                    <span class="n">d</span><span class="p">[</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">stage</span><span class="si">}</span><span class="s1">xdist&#39;</span><span class="p">]</span><span class="o">**</span><span class="mi">2</span> <span class="o">+</span> <span class="n">d</span><span class="p">[</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">stage</span><span class="si">}</span><span class="s1">ydist&#39;</span><span class="p">]</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span><span class="o">**</span><span class="mf">.5</span><span class="p">})</span>

        <span class="c1"># print(&#39;Completed dropsonde center-relative coordinates&#39;)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">data</span> <span class="o">=</span> <span class="n">data</span>

<div class="viewcode-block" id="dropsondes.isel"><a class="viewcode-back" href="../../../api/generated/tropycal.recon.dropsondes.isel.html#tropycal.recon.dropsondes.isel">[docs]</a>    <span class="k">def</span> <span class="nf">isel</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">index</span><span class="p">):</span>
<span class="w">        </span><span class="sa">r</span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Select a single dropsonde by index of the list.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        index : int</span>
<span class="sd">            Integer containing the index of the dropsonde.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        dropsondes</span>
<span class="sd">            Instance of Dropsondes for the single requested dropsonde.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">NEW_DATA</span> <span class="o">=</span> <span class="n">copy</span><span class="o">.</span><span class="n">copy</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">)</span>
        <span class="n">NEW_DATA</span> <span class="o">=</span> <span class="p">[</span><span class="n">NEW_DATA</span><span class="p">[</span><span class="n">index</span><span class="p">]]</span>
        <span class="n">NEW_OBJ</span> <span class="o">=</span> <span class="n">dropsondes</span><span class="p">(</span><span class="n">storm</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">storm</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="n">NEW_DATA</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">NEW_OBJ</span></div>

<div class="viewcode-block" id="dropsondes.sel"><a class="viewcode-back" href="../../../api/generated/tropycal.recon.dropsondes.sel.html#tropycal.recon.dropsondes.sel">[docs]</a>    <span class="k">def</span> <span class="nf">sel</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">mission</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">time</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">domain</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">location</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">top</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
            <span class="n">slp</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">MBLspd</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">WL150spd</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">DLMspd</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
<span class="w">        </span><span class="sa">r</span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Select a subset of dropsondes by any of its parameters and return a new dropsondes object.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        mission : str</span>
<span class="sd">            Mission name (number + storm id), e.g. mission 7 for AL05 is &#39;0705L&#39;</span>
<span class="sd">        time : list/tuple of datetimes</span>
<span class="sd">            list/tuple of start time and end time datetime objects.</span>
<span class="sd">            Default is None, which returns all points</span>
<span class="sd">        domain : dict</span>
<span class="sd">            dictionary with keys &#39;n&#39;, &#39;s&#39;, &#39;e&#39;, &#39;w&#39; corresponding to boundaries of domain.</span>
<span class="sd">        location : str</span>
<span class="sd">            Location of dropsonde. Can be &quot;eyewall&quot; or &quot;center&quot;.</span>
<span class="sd">        top : tuple</span>
<span class="sd">            Tuple containing range of pressures (in hPa) of the top of the dropsonde level.</span>
<span class="sd">        slp : tuple</span>
<span class="sd">            Tuple containing range of pressures (in hPa) of the bottom of the dropsonde near surface.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        dropsondes</span>
<span class="sd">            A new dropsondes object that satisfies the intersection of all subsetting.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">NEW_DATA</span> <span class="o">=</span> <span class="n">copy</span><span class="o">.</span><span class="n">copy</span><span class="p">(</span><span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">))</span>

        <span class="c1"># Apply mission filter</span>
        <span class="k">if</span> <span class="n">mission</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">mission</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">mission</span><span class="p">)</span>
            <span class="n">NEW_DATA</span> <span class="o">=</span> <span class="n">NEW_DATA</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">NEW_DATA</span><span class="p">[</span><span class="s1">&#39;mission&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="n">mission</span><span class="p">]</span>

        <span class="c1"># Apply time filter</span>
        <span class="k">if</span> <span class="n">time</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">time</span><span class="p">,</span> <span class="p">(</span><span class="nb">tuple</span><span class="p">,</span> <span class="nb">list</span><span class="p">)):</span>
                    <span class="n">bounds</span> <span class="o">=</span> <span class="n">get_bounds</span><span class="p">(</span><span class="n">NEW_DATA</span><span class="p">[</span><span class="s1">&#39;TOPtime&#39;</span><span class="p">],</span> <span class="n">time</span><span class="p">)</span>
                    <span class="n">NEW_DATA</span> <span class="o">=</span> <span class="n">NEW_DATA</span><span class="o">.</span><span class="n">loc</span><span class="p">[(</span><span class="n">NEW_DATA</span><span class="p">[</span><span class="s1">&#39;TOPtime&#39;</span><span class="p">]</span> <span class="o">&gt;=</span> <span class="n">bounds</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span> <span class="o">&amp;</span> <span class="p">(</span>
                        <span class="n">NEW_DATA</span><span class="p">[</span><span class="s1">&#39;TOPtime&#39;</span><span class="p">]</span> <span class="o">&lt;=</span> <span class="n">bounds</span><span class="p">[</span><span class="mi">1</span><span class="p">])]</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">i</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">argmin</span><span class="p">(</span><span class="nb">abs</span><span class="p">(</span><span class="n">time</span> <span class="o">-</span> <span class="n">NEW_DATA</span><span class="p">[</span><span class="s1">&#39;TOPtime&#39;</span><span class="p">]))</span>
                    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">isel</span><span class="p">(</span><span class="n">i</span><span class="p">)</span>
            <span class="k">except</span><span class="p">:</span>
                <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">time</span><span class="p">,</span> <span class="p">(</span><span class="nb">tuple</span><span class="p">,</span> <span class="nb">list</span><span class="p">)):</span>
                    <span class="n">bounds</span> <span class="o">=</span> <span class="n">get_bounds</span><span class="p">(</span><span class="n">NEW_DATA</span><span class="p">[</span><span class="s1">&#39;BOTTOMtime&#39;</span><span class="p">],</span> <span class="n">time</span><span class="p">)</span>
                    <span class="n">NEW_DATA</span> <span class="o">=</span> <span class="n">NEW_DATA</span><span class="o">.</span><span class="n">loc</span><span class="p">[(</span><span class="n">NEW_DATA</span><span class="p">[</span><span class="s1">&#39;BOTTOMtime&#39;</span><span class="p">]</span> <span class="o">&gt;=</span> <span class="n">bounds</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span> <span class="o">&amp;</span> <span class="p">(</span>
                        <span class="n">NEW_DATA</span><span class="p">[</span><span class="s1">&#39;BOTTOMtime&#39;</span><span class="p">]</span> <span class="o">&lt;=</span> <span class="n">bounds</span><span class="p">[</span><span class="mi">1</span><span class="p">])]</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">i</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">argmin</span><span class="p">(</span><span class="nb">abs</span><span class="p">(</span><span class="n">time</span> <span class="o">-</span> <span class="n">NEW_DATA</span><span class="p">[</span><span class="s1">&#39;BOTTOMtime&#39;</span><span class="p">]))</span>
                    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">isel</span><span class="p">(</span><span class="n">i</span><span class="p">)</span>

        <span class="c1"># Apply domain filter</span>
        <span class="k">if</span> <span class="n">domain</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">tmp</span> <span class="o">=</span> <span class="p">{</span><span class="n">k</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">lower</span><span class="p">():</span> <span class="n">v</span> <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">domain</span><span class="o">.</span><span class="n">items</span><span class="p">()}</span>
            <span class="n">domain</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;n&#39;</span><span class="p">:</span> <span class="mi">90</span><span class="p">,</span> <span class="s1">&#39;s&#39;</span><span class="p">:</span> <span class="o">-</span><span class="mi">90</span><span class="p">,</span> <span class="s1">&#39;e&#39;</span><span class="p">:</span> <span class="mf">359.99</span><span class="p">,</span> <span class="s1">&#39;w&#39;</span><span class="p">:</span> <span class="mi">0</span><span class="p">}</span>
            <span class="n">domain</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">tmp</span><span class="p">)</span>
            <span class="n">bounds</span> <span class="o">=</span> <span class="n">get_bounds</span><span class="p">(</span>
                <span class="n">NEW_DATA</span><span class="p">[</span><span class="s1">&#39;lon&#39;</span><span class="p">]</span> <span class="o">%</span> <span class="mi">360</span><span class="p">,</span> <span class="p">(</span><span class="n">domain</span><span class="p">[</span><span class="s1">&#39;w&#39;</span><span class="p">]</span> <span class="o">%</span> <span class="mi">360</span><span class="p">,</span> <span class="n">domain</span><span class="p">[</span><span class="s1">&#39;e&#39;</span><span class="p">]</span> <span class="o">%</span> <span class="mi">360</span><span class="p">))</span>
            <span class="n">NEW_DATA</span> <span class="o">=</span> <span class="n">NEW_DATA</span><span class="o">.</span><span class="n">loc</span><span class="p">[(</span><span class="n">NEW_DATA</span><span class="p">[</span><span class="s1">&#39;lon&#39;</span><span class="p">]</span> <span class="o">%</span> <span class="mi">360</span> <span class="o">&gt;=</span> <span class="n">bounds</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span> <span class="o">&amp;</span> <span class="p">(</span>
                <span class="n">NEW_DATA</span><span class="p">[</span><span class="s1">&#39;lon&#39;</span><span class="p">]</span> <span class="o">%</span> <span class="mi">360</span> <span class="o">&lt;=</span> <span class="n">bounds</span><span class="p">[</span><span class="mi">1</span><span class="p">])]</span>
            <span class="n">bounds</span> <span class="o">=</span> <span class="n">get_bounds</span><span class="p">(</span><span class="n">NEW_DATA</span><span class="p">[</span><span class="s1">&#39;lat&#39;</span><span class="p">],</span> <span class="p">(</span><span class="n">domain</span><span class="p">[</span><span class="s1">&#39;s&#39;</span><span class="p">],</span> <span class="n">domain</span><span class="p">[</span><span class="s1">&#39;n&#39;</span><span class="p">]))</span>
            <span class="n">NEW_DATA</span> <span class="o">=</span> <span class="n">NEW_DATA</span><span class="o">.</span><span class="n">loc</span><span class="p">[(</span><span class="n">NEW_DATA</span><span class="p">[</span><span class="s1">&#39;lat&#39;</span><span class="p">]</span> <span class="o">&gt;=</span> <span class="n">bounds</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span> <span class="o">&amp;</span> <span class="p">(</span>
                <span class="n">NEW_DATA</span><span class="p">[</span><span class="s1">&#39;lat&#39;</span><span class="p">]</span> <span class="o">&lt;=</span> <span class="n">bounds</span><span class="p">[</span><span class="mi">1</span><span class="p">])]</span>

        <span class="c1"># Apply location filter</span>
        <span class="k">if</span> <span class="n">location</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">NEW_DATA</span> <span class="o">=</span> <span class="n">NEW_DATA</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">NEW_DATA</span><span class="p">[</span><span class="s1">&#39;location&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="n">location</span><span class="o">.</span><span class="n">upper</span><span class="p">()]</span>

        <span class="c1"># Apply top standard level filter</span>
        <span class="k">if</span> <span class="n">top</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">bounds</span> <span class="o">=</span> <span class="n">get_bounds</span><span class="p">(</span><span class="n">NEW_DATA</span><span class="p">[</span><span class="s1">&#39;top&#39;</span><span class="p">],</span> <span class="n">top</span><span class="p">)</span>
            <span class="n">NEW_DATA</span> <span class="o">=</span> <span class="n">NEW_DATA</span><span class="o">.</span><span class="n">loc</span><span class="p">[(</span><span class="n">NEW_DATA</span><span class="p">[</span><span class="s1">&#39;top&#39;</span><span class="p">]</span> <span class="o">&gt;=</span> <span class="n">bounds</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span> <span class="o">&amp;</span> <span class="p">(</span>
                <span class="n">NEW_DATA</span><span class="p">[</span><span class="s1">&#39;top&#39;</span><span class="p">]</span> <span class="o">&lt;=</span> <span class="n">bounds</span><span class="p">[</span><span class="mi">1</span><span class="p">])]</span>

        <span class="c1"># Apply surface pressure filter</span>
        <span class="k">if</span> <span class="n">slp</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">bounds</span> <span class="o">=</span> <span class="n">get_bounds</span><span class="p">(</span><span class="n">NEW_DATA</span><span class="p">[</span><span class="s1">&#39;slp&#39;</span><span class="p">],</span> <span class="n">slp</span><span class="p">)</span>
            <span class="n">NEW_DATA</span> <span class="o">=</span> <span class="n">NEW_DATA</span><span class="o">.</span><span class="n">loc</span><span class="p">[(</span><span class="n">NEW_DATA</span><span class="p">[</span><span class="s1">&#39;slp&#39;</span><span class="p">]</span> <span class="o">&gt;=</span> <span class="n">bounds</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span> <span class="o">&amp;</span> <span class="p">(</span>
                <span class="n">NEW_DATA</span><span class="p">[</span><span class="s1">&#39;slp&#39;</span><span class="p">]</span> <span class="o">&lt;=</span> <span class="n">bounds</span><span class="p">[</span><span class="mi">1</span><span class="p">])]</span>

        <span class="c1"># Apply MBL wind speed filter</span>
        <span class="k">if</span> <span class="n">MBLspd</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">bounds</span> <span class="o">=</span> <span class="n">get_bounds</span><span class="p">(</span><span class="n">NEW_DATA</span><span class="p">[</span><span class="s1">&#39;MBLspd&#39;</span><span class="p">],</span> <span class="n">MBLspd</span><span class="p">)</span>
            <span class="n">NEW_DATA</span> <span class="o">=</span> <span class="n">NEW_DATA</span><span class="o">.</span><span class="n">loc</span><span class="p">[(</span><span class="n">NEW_DATA</span><span class="p">[</span><span class="s1">&#39;MBLspd&#39;</span><span class="p">]</span> <span class="o">&gt;=</span> <span class="n">bounds</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span> <span class="o">&amp;</span> <span class="p">(</span>
                <span class="n">NEW_DATA</span><span class="p">[</span><span class="s1">&#39;MBLspd&#39;</span><span class="p">]</span> <span class="o">&lt;=</span> <span class="n">bounds</span><span class="p">[</span><span class="mi">1</span><span class="p">])]</span>

        <span class="c1"># Apply DLM wind speed filter</span>
        <span class="k">if</span> <span class="n">DLMspd</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">bounds</span> <span class="o">=</span> <span class="n">get_bounds</span><span class="p">(</span><span class="n">NEW_DATA</span><span class="p">[</span><span class="s1">&#39;DLMspd&#39;</span><span class="p">],</span> <span class="n">DLMspd</span><span class="p">)</span>
            <span class="n">NEW_DATA</span> <span class="o">=</span> <span class="n">NEW_DATA</span><span class="o">.</span><span class="n">loc</span><span class="p">[(</span><span class="n">NEW_DATA</span><span class="p">[</span><span class="s1">&#39;DLMspd&#39;</span><span class="p">]</span> <span class="o">&gt;=</span> <span class="n">bounds</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span> <span class="o">&amp;</span> <span class="p">(</span>
                <span class="n">NEW_DATA</span><span class="p">[</span><span class="s1">&#39;DLMspd&#39;</span><span class="p">]</span> <span class="o">&lt;=</span> <span class="n">bounds</span><span class="p">[</span><span class="mi">1</span><span class="p">])]</span>

        <span class="c1"># Apply WL150 wind speed filter</span>
        <span class="k">if</span> <span class="n">WL150spd</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">bounds</span> <span class="o">=</span> <span class="n">get_bounds</span><span class="p">(</span><span class="n">NEW_DATA</span><span class="p">[</span><span class="s1">&#39;WL150spd&#39;</span><span class="p">],</span> <span class="n">WL150spd</span><span class="p">)</span>
            <span class="n">NEW_DATA</span> <span class="o">=</span> <span class="n">NEW_DATA</span><span class="o">.</span><span class="n">loc</span><span class="p">[(</span><span class="n">NEW_DATA</span><span class="p">[</span><span class="s1">&#39;WL150spd&#39;</span><span class="p">]</span> <span class="o">&gt;=</span> <span class="n">bounds</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span> <span class="o">&amp;</span> <span class="p">(</span>
                <span class="n">NEW_DATA</span><span class="p">[</span><span class="s1">&#39;WL150spd&#39;</span><span class="p">]</span> <span class="o">&lt;=</span> <span class="n">bounds</span><span class="p">[</span><span class="mi">1</span><span class="p">])]</span>

        <span class="n">NEW_OBJ</span> <span class="o">=</span> <span class="n">dropsondes</span><span class="p">(</span><span class="n">storm</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">storm</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="nb">list</span><span class="p">(</span>
            <span class="n">NEW_DATA</span><span class="o">.</span><span class="n">T</span><span class="o">.</span><span class="n">to_dict</span><span class="p">()</span><span class="o">.</span><span class="n">values</span><span class="p">()))</span>

        <span class="k">return</span> <span class="n">NEW_OBJ</span></div>

<div class="viewcode-block" id="dropsondes.to_pickle"><a class="viewcode-back" href="../../../api/generated/tropycal.recon.dropsondes.to_pickle.html#tropycal.recon.dropsondes.to_pickle">[docs]</a>    <span class="k">def</span> <span class="nf">to_pickle</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">filename</span><span class="p">):</span>
<span class="w">        </span><span class="sa">r</span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Save dropsonde data (list of dictionaries) to a pickle file</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        filename : str</span>
<span class="sd">            name of file to save pickle file to.</span>

<span class="sd">        Notes</span>
<span class="sd">        -----</span>
<span class="sd">        This method saves the dropsondes data as a pickle within the current working directory, given a filename as an argument.</span>

<span class="sd">        For example, assume ``dropsondes`` was retrieved from a Storm object (using the first method described in the ``dropsondes`` class documentation). The dropsondes data would be saved to a pickle file as follows:</span>

<span class="sd">        &gt;&gt;&gt; storm.recon.dropsondes.to_pickle(data=&quot;mystorm_dropsondes.pickle&quot;)</span>

<span class="sd">        Now the dropsondes data is saved locally, and next time recon data for this storm needs to be analyzed, this allows to bypass re-reading the dropsondes data from the NHC server by providing the pickle file as an argument:</span>

<span class="sd">        &gt;&gt;&gt; storm.recon.get_dropsondes(data=&quot;mystorm_dropsondes.pickle&quot;)</span>

<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">filename</span><span class="p">,</span> <span class="s1">&#39;wb&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
            <span class="n">pickle</span><span class="o">.</span><span class="n">dump</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">,</span> <span class="n">f</span><span class="p">)</span></div>

<div class="viewcode-block" id="dropsondes.plot_points"><a class="viewcode-back" href="../../../api/generated/tropycal.recon.dropsondes.plot_points.html#tropycal.recon.dropsondes.plot_points">[docs]</a>    <span class="k">def</span> <span class="nf">plot_points</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">varname</span><span class="o">=</span><span class="s1">&#39;slp&#39;</span><span class="p">,</span> <span class="n">level</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">domain</span><span class="o">=</span><span class="s2">&quot;dynamic&quot;</span><span class="p">,</span> <span class="n">ax</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">cartopy_proj</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
<span class="w">        </span><span class="sa">r</span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Creates a plot of dropsonde data points.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        varname : str</span>
<span class="sd">            Variable to plot. Can be one of the keys in the dropsonde dictionary (retrieved using ``recon.dropsondes.data``).</span>
<span class="sd">        level : int, optional</span>
<span class="sd">            Pressure level (in hPa) to plot varname for. Only valid if varname is in &quot;pres&quot;, &quot;hgt&quot;, &quot;temp&quot;, &quot;dwpt&quot;, &quot;wdir&quot;, &quot;wspd&quot;.</span>
<span class="sd">        domain : str/dict</span>
<span class="sd">            Domain for the plot. Default is &quot;dynamic&quot;. Please refer to :ref:`options-domain` for available domain options.</span>
<span class="sd">        ax : axes</span>
<span class="sd">            Instance of axes to plot on. If none, one will be generated. Default is none.</span>
<span class="sd">        cartopy_proj : ccrs</span>
<span class="sd">            Instance of a cartopy projection to use. If none, one will be generated. Default is none.</span>

<span class="sd">        Other Parameters</span>
<span class="sd">        ----------------</span>
<span class="sd">        prop : dict</span>
<span class="sd">            Customization properties of recon plot. Please refer to :ref:`options-prop-recon-plot` for available options.</span>
<span class="sd">        map_prop : dict</span>
<span class="sd">            Customization properties of Cartopy map. Please refer to :ref:`options-map-prop` for available options.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        ax</span>
<span class="sd">            Instance of axes containing the plot is returned.</span>

<span class="sd">        Notes</span>
<span class="sd">        -----</span>
<span class="sd">        To retrieve all possible varnames, check the ``data`` attribute of this Dropsonde object. For example, if ReconDataset was retrieved through a Storm object as in the example below, the possible varnames would be retrieved as follows:</span>

<span class="sd">        .. code-block:: python</span>

<span class="sd">            from tropycal import tracks</span>

<span class="sd">            #Get dataset object</span>
<span class="sd">            basin = tracks.TrackDataset()</span>

<span class="sd">            #Get storm object</span>
<span class="sd">            storm = basin.get_storm((&#39;michael&#39;,2018))</span>

<span class="sd">            #Get dropsondes for this storm</span>
<span class="sd">            storm.recon.get_dropsondes()</span>

<span class="sd">            #Retrieve list of all possible varnames</span>
<span class="sd">            print(storm.recon.dropsondes.data)</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="c1"># Pop kwargs</span>
        <span class="n">prop</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;prop&#39;</span><span class="p">,</span> <span class="p">{})</span>
        <span class="n">map_prop</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;map_prop&#39;</span><span class="p">,</span> <span class="p">{})</span>

        <span class="c1"># Get plot data</span>
        <span class="k">if</span> <span class="n">level</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">plotdata</span> <span class="o">=</span> <span class="p">[</span><span class="n">m</span><span class="p">[</span><span class="s1">&#39;levels&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">m</span><span class="p">[</span><span class="s1">&#39;levels&#39;</span><span class="p">][</span><span class="s1">&#39;pres&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="n">level</span><span class="p">][</span><span class="n">varname</span><span class="p">]</span><span class="o">.</span><span class="n">to_numpy</span><span class="p">()[</span><span class="mi">0</span><span class="p">]</span>
                        <span class="k">if</span> <span class="s1">&#39;levels&#39;</span> <span class="ow">in</span> <span class="n">m</span><span class="o">.</span><span class="n">keys</span><span class="p">()</span> <span class="ow">and</span> <span class="n">level</span> <span class="ow">in</span> <span class="n">m</span><span class="p">[</span><span class="s1">&#39;levels&#39;</span><span class="p">][</span><span class="s1">&#39;pres&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">to_numpy</span><span class="p">()</span> <span class="k">else</span> <span class="n">np</span><span class="o">.</span><span class="n">nan</span>
                        <span class="k">for</span> <span class="n">m</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">plotdata</span> <span class="o">=</span> <span class="p">[</span><span class="n">m</span><span class="p">[</span><span class="n">varname</span><span class="p">]</span> <span class="k">if</span> <span class="n">varname</span> <span class="ow">in</span> <span class="n">m</span><span class="o">.</span><span class="n">keys</span><span class="p">()</span>
                        <span class="k">else</span> <span class="n">np</span><span class="o">.</span><span class="n">nan</span> <span class="k">for</span> <span class="n">m</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">]</span>

        <span class="c1"># Make sure data doesn&#39;t have NaNs</span>
        <span class="n">check_data</span> <span class="o">=</span> <span class="p">[</span><span class="n">m</span><span class="p">[</span><span class="s1">&#39;BOTTOMlat&#39;</span><span class="p">]</span>
                      <span class="k">for</span> <span class="n">m</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span> <span class="k">if</span> <span class="ow">not</span> <span class="n">np</span><span class="o">.</span><span class="n">isnan</span><span class="p">(</span><span class="n">m</span><span class="p">[</span><span class="s1">&#39;BOTTOMlat&#39;</span><span class="p">])]</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">check_data</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">dfRecon</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="o">.</span><span class="n">from_dict</span><span class="p">({</span><span class="s1">&#39;time&#39;</span><span class="p">:</span> <span class="p">[</span><span class="n">m</span><span class="p">[</span><span class="s1">&#39;TOPtime&#39;</span><span class="p">]</span> <span class="k">for</span> <span class="n">m</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">],</span>
                                              <span class="s1">&#39;lat&#39;</span><span class="p">:</span> <span class="p">[</span><span class="n">m</span><span class="p">[</span><span class="s1">&#39;TOPlat&#39;</span><span class="p">]</span> <span class="k">for</span> <span class="n">m</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">],</span>
                                              <span class="s1">&#39;lon&#39;</span><span class="p">:</span> <span class="p">[</span><span class="n">m</span><span class="p">[</span><span class="s1">&#39;TOPlon&#39;</span><span class="p">]</span> <span class="k">for</span> <span class="n">m</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">],</span>
                                              <span class="n">varname</span><span class="p">:</span> <span class="n">plotdata</span><span class="p">})</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">dfRecon</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="o">.</span><span class="n">from_dict</span><span class="p">({</span><span class="s1">&#39;time&#39;</span><span class="p">:</span> <span class="p">[</span><span class="n">m</span><span class="p">[</span><span class="s1">&#39;BOTTOMtime&#39;</span><span class="p">]</span> <span class="k">for</span> <span class="n">m</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">],</span>
                                              <span class="s1">&#39;lat&#39;</span><span class="p">:</span> <span class="p">[</span><span class="n">m</span><span class="p">[</span><span class="s1">&#39;BOTTOMlat&#39;</span><span class="p">]</span> <span class="k">for</span> <span class="n">m</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">],</span>
                                              <span class="s1">&#39;lon&#39;</span><span class="p">:</span> <span class="p">[</span><span class="n">m</span><span class="p">[</span><span class="s1">&#39;BOTTOMlon&#39;</span><span class="p">]</span> <span class="k">for</span> <span class="n">m</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">],</span>
                                              <span class="n">varname</span><span class="p">:</span> <span class="n">plotdata</span><span class="p">})</span>

        <span class="c1"># Create instance of plot object</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">plot_obj</span> <span class="o">=</span> <span class="n">ReconPlot</span><span class="p">()</span>

        <span class="c1"># Create cartopy projection</span>
        <span class="k">if</span> <span class="n">cartopy_proj</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">plot_obj</span><span class="o">.</span><span class="n">create_cartopy</span><span class="p">(</span>
                <span class="n">proj</span><span class="o">=</span><span class="s1">&#39;PlateCarree&#39;</span><span class="p">,</span> <span class="n">central_longitude</span><span class="o">=</span><span class="mf">0.0</span><span class="p">)</span>
            <span class="n">cartopy_proj</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">plot_obj</span><span class="o">.</span><span class="n">proj</span>

        <span class="c1"># Plot recon</span>
        <span class="n">plot_ax</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">plot_obj</span><span class="o">.</span><span class="n">plot_points</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">storm</span><span class="p">,</span> <span class="n">dfRecon</span><span class="p">,</span> <span class="n">domain</span><span class="p">,</span> <span class="n">varname</span><span class="o">=</span><span class="p">(</span>
            <span class="n">varname</span><span class="p">,</span> <span class="n">level</span><span class="p">),</span> <span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">,</span> <span class="n">prop</span><span class="o">=</span><span class="n">prop</span><span class="p">,</span> <span class="n">map_prop</span><span class="o">=</span><span class="n">map_prop</span><span class="p">)</span>

        <span class="c1"># Return axis</span>
        <span class="k">return</span> <span class="n">plot_ax</span></div>

<div class="viewcode-block" id="dropsondes.plot_skewt"><a class="viewcode-back" href="../../../api/generated/tropycal.recon.dropsondes.plot_skewt.html#tropycal.recon.dropsondes.plot_skewt">[docs]</a>    <span class="k">def</span> <span class="nf">plot_skewt</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">time</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
<span class="w">        </span><span class="sa">r</span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Plot a Skew-T chart for selected dropsondes.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        time : datetime.datetime, optional</span>
<span class="sd">            Time closest to requested Skew-T. If none, all dropsondes will plot.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        list</span>
<span class="sd">            Returns a list of figures, or a single figure for a single plot.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">storm_data</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">storm</span><span class="o">.</span><span class="n">dict</span>

        <span class="k">if</span> <span class="n">time</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">dict_list</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">dict_list</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">sel</span><span class="p">(</span><span class="n">time</span><span class="o">=</span><span class="n">time</span><span class="p">)</span><span class="o">.</span><span class="n">data</span>

        <span class="c1"># Format storm name</span>
        <span class="n">storm_data</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">storm</span><span class="o">.</span><span class="n">dict</span>
        <span class="n">type_array</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">storm_data</span><span class="p">[</span><span class="s1">&#39;type&#39;</span><span class="p">])</span>
        <span class="n">idx</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">((</span><span class="n">type_array</span> <span class="o">==</span> <span class="s1">&#39;SD&#39;</span><span class="p">)</span> <span class="o">|</span> <span class="p">(</span><span class="n">type_array</span> <span class="o">==</span> <span class="s1">&#39;SS&#39;</span><span class="p">)</span> <span class="o">|</span> <span class="p">(</span><span class="n">type_array</span> <span class="o">==</span> <span class="s1">&#39;TD&#39;</span><span class="p">)</span> <span class="o">|</span> <span class="p">(</span>
            <span class="n">type_array</span> <span class="o">==</span> <span class="s1">&#39;TS&#39;</span><span class="p">)</span> <span class="o">|</span> <span class="p">(</span><span class="n">type_array</span> <span class="o">==</span> <span class="s1">&#39;HU&#39;</span><span class="p">)</span> <span class="o">|</span> <span class="p">(</span><span class="n">type_array</span> <span class="o">==</span> <span class="s1">&#39;TY&#39;</span><span class="p">)</span> <span class="o">|</span> <span class="p">(</span><span class="n">type_array</span> <span class="o">==</span> <span class="s1">&#39;ST&#39;</span><span class="p">))</span>
        <span class="k">if</span> <span class="p">(</span><span class="s1">&#39;invest&#39;</span> <span class="ow">in</span> <span class="n">storm_data</span><span class="o">.</span><span class="n">keys</span><span class="p">()</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">storm_data</span><span class="p">[</span><span class="s1">&#39;invest&#39;</span><span class="p">])</span> <span class="ow">or</span> <span class="nb">len</span><span class="p">(</span><span class="n">idx</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">tropical_vmax</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">storm_data</span><span class="p">[</span><span class="s1">&#39;vmax&#39;</span><span class="p">])[</span><span class="n">idx</span><span class="p">]</span>

            <span class="n">add_ptc_flag</span> <span class="o">=</span> <span class="kc">False</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">tropical_vmax</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                <span class="n">add_ptc_flag</span> <span class="o">=</span> <span class="kc">True</span>
                <span class="n">idx</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">((</span><span class="n">type_array</span> <span class="o">==</span> <span class="s1">&#39;LO&#39;</span><span class="p">)</span> <span class="o">|</span> <span class="p">(</span><span class="n">type_array</span> <span class="o">==</span> <span class="s1">&#39;DB&#39;</span><span class="p">))</span>
            <span class="n">tropical_vmax</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">storm_data</span><span class="p">[</span><span class="s1">&#39;vmax&#39;</span><span class="p">])[</span><span class="n">idx</span><span class="p">]</span>

            <span class="n">subtrop</span> <span class="o">=</span> <span class="n">classify_subtropical</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">storm_data</span><span class="p">[</span><span class="s1">&#39;type&#39;</span><span class="p">]))</span>
            <span class="n">peak_idx</span> <span class="o">=</span> <span class="n">storm_data</span><span class="p">[</span><span class="s1">&#39;vmax&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">nanmax</span><span class="p">(</span><span class="n">tropical_vmax</span><span class="p">))</span>
            <span class="n">peak_basin</span> <span class="o">=</span> <span class="n">storm_data</span><span class="p">[</span><span class="s1">&#39;wmo_basin&#39;</span><span class="p">][</span><span class="n">peak_idx</span><span class="p">]</span>
            <span class="n">storm_type</span> <span class="o">=</span> <span class="n">get_storm_classification</span><span class="p">(</span>
                <span class="n">np</span><span class="o">.</span><span class="n">nanmax</span><span class="p">(</span><span class="n">tropical_vmax</span><span class="p">),</span> <span class="n">subtrop</span><span class="p">,</span> <span class="n">peak_basin</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">add_ptc_flag</span><span class="p">:</span>
                <span class="n">storm_type</span> <span class="o">=</span> <span class="s2">&quot;Potential Tropical Cyclone&quot;</span>
        <span class="n">title_string</span> <span class="o">=</span> <span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">storm_type</span><span class="si">}</span><span class="s1"> </span><span class="si">{</span><span class="n">storm_data</span><span class="p">[</span><span class="s2">&quot;name&quot;</span><span class="p">]</span><span class="si">}</span><span class="se">\n</span><span class="s1">Dropsonde DDD, Mission MMM&#39;</span>

        <span class="c1"># Plot Skew-T</span>
        <span class="k">return</span> <span class="n">plot_skewt</span><span class="p">(</span><span class="n">dict_list</span><span class="p">,</span> <span class="n">title_string</span><span class="p">)</span></div></div>


<div class="viewcode-block" id="vdms"><a class="viewcode-back" href="../../../api/generated/tropycal.recon.vdms.html#tropycal.recon.vdms">[docs]</a><span class="k">class</span> <span class="nc">vdms</span><span class="p">:</span>

<span class="w">    </span><span class="sa">r</span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Creates an instance of a VDMs object containing all Vortex Data Message (VDM) data for a single storm.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    storm : tropycal.tracks.Storm</span>
<span class="sd">        Requested storm.</span>
<span class="sd">    data : str, optional</span>
<span class="sd">        Filepath of pickle file containing VDM data retrieved from ``vdms.to_pickle()``. If provided, data will be retrieved from the local pickle file instead of the NHC server.</span>
<span class="sd">    update : bool</span>
<span class="sd">        True = search for new data, following existing data in the dropsonde object, and concatenate.</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    Dataset</span>
<span class="sd">        An instance of VDMs.</span>

<span class="sd">    Notes</span>
<span class="sd">    -----</span>
<span class="sd">    .. warning::</span>

<span class="sd">        Recon data is currently only available from 1989 onwards.</span>

<span class="sd">    VDM data is currently retrieved from the National Hurricane Center from 2006 onwards, and UCAR from 1989 through 2005.</span>

<span class="sd">    There are two recommended ways of retrieving a vdms object. Since the ``ReconDataset``, ``hdobs``, ``dropsondes`` and ``vdms`` classes are **storm-centric**, a Storm object is required for both methods.</span>

<span class="sd">    .. code-block:: python</span>

<span class="sd">        #Retrieve Hurricane Michael (2018) from TrackDataset</span>
<span class="sd">        basin = tracks.TrackDataset()</span>
<span class="sd">        storm = basin.get_storm((&#39;michael&#39;,2018))</span>

<span class="sd">    The first method is to use the empty instance of ReconDataset already initialized in the Storm object, which has a ``get_vdms()`` method thus allowing all of the vdms attributes and methods to be accessed from the Storm object. As a result, a Storm object does not need to be provided as an argument.</span>

<span class="sd">    .. code-block:: python</span>

<span class="sd">        #Retrieve all VDMs for this storm</span>
<span class="sd">        storm.recon.get_vdms()</span>

<span class="sd">        #Retrieve the raw VDM data</span>
<span class="sd">        storm.recon.vdms.data</span>

<span class="sd">        #Use the plot_points() method of hdobs</span>
<span class="sd">        storm.recon.vdms.plot_points()</span>

<span class="sd">    The second method is to use the vdms class independently of the other recon classes:</span>

<span class="sd">    .. code-block:: python</span>

<span class="sd">        from tropycal.recon import vdms</span>

<span class="sd">        #Retrieve all VDMs for this storm, passing the Storm object as an argument</span>
<span class="sd">        vdms_obj = vdms(storm)</span>

<span class="sd">        #Retrieve the raw VDM data</span>
<span class="sd">        vdms_obj.data</span>

<span class="sd">        #Use the plot_points() method of vdms</span>
<span class="sd">        vdms_obj.plot_points()</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="fm">__repr__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">summary</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;&lt;tropycal.recon.vdms&gt;&quot;</span><span class="p">]</span>

        <span class="c1"># Find maximum wind and minimum pressure</span>
        <span class="n">time_range</span> <span class="o">=</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">nanmin</span><span class="p">([</span><span class="n">i</span><span class="p">[</span><span class="s1">&#39;time&#39;</span><span class="p">]</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">]),</span> <span class="n">np</span><span class="o">.</span><span class="n">nanmax</span><span class="p">(</span>
            <span class="p">[</span><span class="n">i</span><span class="p">[</span><span class="s1">&#39;time&#39;</span><span class="p">]</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">]))</span>
        <span class="n">time_range</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="n">time_range</span><span class="p">))</span>
        <span class="n">min_slp</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nanmin</span><span class="p">([</span><span class="n">i</span><span class="p">[</span><span class="s1">&#39;Minimum Sea Level Pressure (hPa)&#39;</span><span class="p">]</span>
                            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">])</span>
        <span class="n">min_slp</span> <span class="o">=</span> <span class="s1">&#39;N/A&#39;</span> <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">isnan</span><span class="p">(</span><span class="n">min_slp</span><span class="p">)</span> <span class="k">else</span> <span class="n">min_slp</span>
        <span class="n">missions</span> <span class="o">=</span> <span class="nb">set</span><span class="p">([</span><span class="n">i</span><span class="p">[</span><span class="s1">&#39;mission&#39;</span><span class="p">]</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">])</span>

        <span class="c1"># Add general summary</span>
        <span class="n">emdash</span> <span class="o">=</span> <span class="s1">&#39;</span><span class="se">\u2014</span><span class="s1">&#39;</span>
        <span class="n">summary_keys</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s1">&#39;Storm&#39;</span><span class="p">:</span> <span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">storm</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s1"> </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">storm</span><span class="o">.</span><span class="n">year</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">,</span>
            <span class="s1">&#39;Missions&#39;</span><span class="p">:</span> <span class="nb">len</span><span class="p">(</span><span class="n">missions</span><span class="p">),</span>
            <span class="s1">&#39;VDMs&#39;</span><span class="p">:</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">),</span>
            <span class="s1">&#39;Min sea level pressure&#39;</span><span class="p">:</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">min_slp</span><span class="si">}</span><span class="s2"> hPa&quot;</span><span class="p">,</span>
            <span class="s1">&#39;Source&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">source</span>
        <span class="p">}</span>

        <span class="c1"># Add dataset summary</span>
        <span class="n">summary</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;Dataset Summary:&quot;</span><span class="p">)</span>
        <span class="n">add_space</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">([</span><span class="nb">len</span><span class="p">(</span><span class="n">key</span><span class="p">)</span> <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="n">summary_keys</span><span class="o">.</span><span class="n">keys</span><span class="p">()])</span> <span class="o">+</span> <span class="mi">3</span>
        <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="n">summary_keys</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
            <span class="n">key_name</span> <span class="o">=</span> <span class="n">key</span> <span class="o">+</span> <span class="s2">&quot;:&quot;</span>
            <span class="n">summary</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
                <span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="s2">&quot; &quot;</span><span class="o">*</span><span class="mi">4</span><span class="si">}{</span><span class="n">key_name</span><span class="si">:</span><span class="s1">&lt;</span><span class="si">{</span><span class="n">add_space</span><span class="si">}}{</span><span class="n">summary_keys</span><span class="p">[</span><span class="n">key</span><span class="p">]</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>

        <span class="k">return</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">summary</span><span class="p">)</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">storm</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">update</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">storm</span> <span class="o">=</span> <span class="n">storm</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">source</span> <span class="o">=</span> <span class="s1">&#39;National Hurricane Center (NHC)&#39;</span>
        <span class="k">if</span> <span class="n">storm</span><span class="o">.</span><span class="n">year</span> <span class="o">&gt;=</span> <span class="mi">2006</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">format</span> <span class="o">=</span> <span class="mi">1</span>
            <span class="k">if</span> <span class="n">storm</span><span class="o">.</span><span class="n">basin</span> <span class="o">==</span> <span class="s1">&#39;north_atlantic&#39;</span><span class="p">:</span>
                <span class="n">archive_url</span> <span class="o">=</span> <span class="sa">f</span><span class="s1">&#39;https://www.nhc.noaa.gov/archive/recon/</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">storm</span><span class="o">.</span><span class="n">year</span><span class="si">}</span><span class="s1">/REPNT2/&#39;</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">archive_url</span> <span class="o">=</span> <span class="sa">f</span><span class="s1">&#39;https://www.nhc.noaa.gov/archive/recon/</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">storm</span><span class="o">.</span><span class="n">year</span><span class="si">}</span><span class="s1">/REPPN2/&#39;</span>
        <span class="k">elif</span> <span class="n">storm</span><span class="o">.</span><span class="n">year</span> <span class="o">&gt;=</span> <span class="mi">1989</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">format</span> <span class="o">=</span> <span class="mi">2</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">source</span> <span class="o">=</span> <span class="s2">&quot;UCAR&#39;s Tropical Cyclone Guidance Project (TCGP)&quot;</span>
            <span class="n">archive_url</span> <span class="o">=</span> <span class="sa">f</span><span class="s1">&#39;http://hurricanes.ral.ucar.edu/structure/vortex/vdm_data/</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">storm</span><span class="o">.</span><span class="n">year</span><span class="si">}</span><span class="s1">/&#39;</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span><span class="s2">&quot;Recon data is not available prior to 1989.&quot;</span><span class="p">)</span>

        <span class="n">timestr</span> <span class="o">=</span> <span class="p">[</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">t</span><span class="si">:</span><span class="s1">%Y%m%d</span><span class="si">}</span><span class="s1">&#39;</span> <span class="k">for</span> <span class="n">t</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">storm</span><span class="o">.</span><span class="n">dict</span><span class="p">[</span><span class="s1">&#39;time&#39;</span><span class="p">]]</span>

        <span class="c1"># Retrieve list of files in URL and filter by storm dates</span>
        <span class="n">page</span> <span class="o">=</span> <span class="n">requests</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">archive_url</span><span class="p">)</span><span class="o">.</span><span class="n">text</span>
        <span class="n">content</span> <span class="o">=</span> <span class="n">page</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="n">files</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="n">content</span><span class="p">:</span>
            <span class="k">if</span> <span class="s2">&quot;.txt&quot;</span> <span class="ow">in</span> <span class="n">line</span><span class="p">:</span>
                <span class="n">files</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
                    <span class="p">((</span><span class="n">line</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;txt&quot;&gt;&#39;</span><span class="p">)[</span><span class="mi">1</span><span class="p">])</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;&lt;/a&gt;&quot;</span><span class="p">)[</span><span class="mi">0</span><span class="p">])</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;.&quot;</span><span class="p">))</span>
        <span class="k">del</span> <span class="n">content</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">format</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
            <span class="n">files</span> <span class="o">=</span> <span class="nb">sorted</span><span class="p">([</span><span class="n">i</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">files</span> <span class="k">if</span> <span class="n">i</span><span class="p">[</span><span class="mi">1</span><span class="p">][:</span><span class="mi">8</span><span class="p">]</span>
                           <span class="ow">in</span> <span class="n">timestr</span><span class="p">],</span> <span class="n">key</span><span class="o">=</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
            <span class="n">linksub</span> <span class="o">=</span> <span class="p">[</span><span class="n">archive_url</span> <span class="o">+</span> <span class="s1">&#39;.&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">l</span><span class="p">)</span> <span class="k">for</span> <span class="n">l</span> <span class="ow">in</span> <span class="n">files</span><span class="p">]</span>
        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">format</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>
            <span class="n">files</span> <span class="o">=</span> <span class="p">[</span><span class="n">f</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="k">for</span> <span class="n">f</span> <span class="ow">in</span> <span class="n">files</span><span class="p">]</span>
            <span class="n">linksub</span> <span class="o">=</span> <span class="p">[</span><span class="n">archive_url</span> <span class="o">+</span>
                       <span class="n">l</span> <span class="k">for</span> <span class="n">l</span> <span class="ow">in</span> <span class="n">files</span> <span class="k">if</span> <span class="n">storm</span><span class="o">.</span><span class="n">name</span><span class="o">.</span><span class="n">upper</span><span class="p">()</span> <span class="ow">in</span> <span class="n">l</span><span class="p">]</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">data</span> <span class="o">=</span> <span class="p">[]</span>

        <span class="k">if</span> <span class="n">data</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>

            <span class="n">urllib3</span><span class="o">.</span><span class="n">disable_warnings</span><span class="p">()</span>
            <span class="n">http</span> <span class="o">=</span> <span class="n">urllib3</span><span class="o">.</span><span class="n">PoolManager</span><span class="p">()</span>

            <span class="n">filecount</span> <span class="o">=</span> <span class="mi">0</span>
            <span class="n">timer_start</span> <span class="o">=</span> <span class="n">dt</span><span class="o">.</span><span class="n">now</span><span class="p">()</span>
            <span class="nb">print</span><span class="p">(</span>
                <span class="sa">f</span><span class="s1">&#39;Searching through recon VDM files between </span><span class="si">{</span><span class="n">timestr</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="si">}</span><span class="s1"> and </span><span class="si">{</span><span class="n">timestr</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="si">}</span><span class="s1"> ...&#39;</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">link</span> <span class="ow">in</span> <span class="n">linksub</span><span class="p">:</span>
                <span class="n">response</span> <span class="o">=</span> <span class="n">http</span><span class="o">.</span><span class="n">request</span><span class="p">(</span><span class="s1">&#39;GET&#39;</span><span class="p">,</span> <span class="n">link</span><span class="p">)</span>
                <span class="n">content</span> <span class="o">=</span> <span class="n">response</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">decode</span><span class="p">(</span><span class="s1">&#39;utf-8&#39;</span><span class="p">)</span>

                <span class="c1"># Parse with NHC format</span>
                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">format</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
                    <span class="k">try</span><span class="p">:</span>
                        <span class="n">date</span> <span class="o">=</span> <span class="n">link</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;.&#39;</span><span class="p">)[</span><span class="o">-</span><span class="mi">2</span><span class="p">]</span>
                        <span class="n">date</span> <span class="o">=</span> <span class="n">dt</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">date</span><span class="p">[:</span><span class="mi">4</span><span class="p">]),</span> <span class="nb">int</span><span class="p">(</span>
                            <span class="n">date</span><span class="p">[</span><span class="mi">4</span><span class="p">:</span><span class="mi">6</span><span class="p">]),</span> <span class="nb">int</span><span class="p">(</span><span class="n">date</span><span class="p">[</span><span class="mi">6</span><span class="p">:</span><span class="mi">8</span><span class="p">]))</span>
                        <span class="n">missionname</span><span class="p">,</span> <span class="n">tmp</span> <span class="o">=</span> <span class="n">decode_vdm</span><span class="p">(</span><span class="n">content</span><span class="p">,</span> <span class="n">date</span><span class="p">)</span>
                    <span class="k">except</span><span class="p">:</span>
                        <span class="k">continue</span>

                    <span class="n">testkeys</span> <span class="o">=</span> <span class="p">(</span><span class="s1">&#39;time&#39;</span><span class="p">,</span> <span class="s1">&#39;lat&#39;</span><span class="p">,</span> <span class="s1">&#39;lon&#39;</span><span class="p">)</span>
                    <span class="k">if</span> <span class="n">missionname</span><span class="p">[</span><span class="mi">2</span><span class="p">:</span><span class="mi">5</span><span class="p">]</span> <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">storm</span><span class="o">.</span><span class="n">operational_id</span><span class="p">[</span><span class="mi">2</span><span class="p">:</span><span class="mi">4</span><span class="p">]</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">storm</span><span class="o">.</span><span class="n">operational_id</span><span class="p">[</span><span class="mi">0</span><span class="p">]:</span>
                        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                            <span class="bp">self</span><span class="o">.</span><span class="n">data</span> <span class="o">=</span> <span class="p">[</span><span class="n">copy</span><span class="o">.</span><span class="n">copy</span><span class="p">(</span><span class="n">tmp</span><span class="p">)]</span>
                            <span class="n">filecount</span> <span class="o">+=</span> <span class="mi">1</span>
                        <span class="k">elif</span> <span class="p">[</span><span class="n">tmp</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="n">testkeys</span><span class="p">]</span> <span class="ow">not</span> <span class="ow">in</span> <span class="p">[[</span><span class="n">d</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="n">testkeys</span><span class="p">]</span> <span class="k">for</span> <span class="n">d</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">]:</span>
                            <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">tmp</span><span class="p">)</span>
                            <span class="n">filecount</span> <span class="o">+=</span> <span class="mi">1</span>
                        <span class="k">else</span><span class="p">:</span>
                            <span class="k">pass</span>

                <span class="c1"># Parse with UCAR format</span>
                <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">format</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>
                    <span class="n">content_split</span> <span class="o">=</span> <span class="n">content</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;URNT12&quot;</span><span class="p">)</span>
                    <span class="n">content_split</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;URNT12&#39;</span> <span class="o">+</span> <span class="n">i</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">content_split</span><span class="p">]</span>
                    <span class="k">for</span> <span class="n">iter_content</span> <span class="ow">in</span> <span class="n">content_split</span><span class="p">:</span>

                        <span class="k">try</span><span class="p">:</span>
                            <span class="c1"># Check for line length</span>
                            <span class="n">iter_split</span> <span class="o">=</span> <span class="n">iter_content</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
                            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">iter_split</span><span class="p">)</span> <span class="o">&lt;</span> <span class="mi">10</span><span class="p">:</span>
                                <span class="k">continue</span>

                            <span class="c1"># Check for date</span>
                            <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="n">iter_split</span><span class="p">:</span>
                                <span class="k">if</span> <span class="n">line</span><span class="p">[:</span><span class="mi">2</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;A.&#39;</span><span class="p">:</span>
                                    <span class="n">day</span> <span class="o">=</span> <span class="nb">int</span><span class="p">((</span><span class="n">line</span><span class="p">[</span><span class="mi">3</span><span class="p">:]</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;/&#39;</span><span class="p">))[</span><span class="mi">0</span><span class="p">])</span>
                            <span class="k">for</span> <span class="n">iter_date</span> <span class="ow">in</span> <span class="n">storm</span><span class="o">.</span><span class="n">dict</span><span class="p">[</span><span class="s1">&#39;time&#39;</span><span class="p">]:</span>
                                <span class="n">found_date</span> <span class="o">=</span> <span class="kc">False</span>
                                <span class="k">if</span> <span class="n">iter_date</span><span class="o">.</span><span class="n">day</span> <span class="o">==</span> <span class="n">day</span><span class="p">:</span>
                                    <span class="n">date</span> <span class="o">=</span> <span class="n">dt</span><span class="p">(</span><span class="n">iter_date</span><span class="o">.</span><span class="n">year</span><span class="p">,</span>
                                              <span class="n">iter_date</span><span class="o">.</span><span class="n">month</span><span class="p">,</span> <span class="n">iter_date</span><span class="o">.</span><span class="n">day</span><span class="p">)</span>
                                    <span class="n">found_date</span> <span class="o">=</span> <span class="kc">True</span>
                                    <span class="k">break</span>
                            <span class="k">if</span> <span class="ow">not</span> <span class="n">found_date</span><span class="p">:</span>
                                <span class="k">continue</span>

                            <span class="c1"># Decode VDMs</span>
                            <span class="n">missionname</span><span class="p">,</span> <span class="n">tmp</span> <span class="o">=</span> <span class="n">decode_vdm</span><span class="p">(</span><span class="n">iter_content</span><span class="p">,</span> <span class="n">date</span><span class="p">)</span>

                            <span class="n">testkeys</span> <span class="o">=</span> <span class="p">(</span><span class="s1">&#39;time&#39;</span><span class="p">,</span> <span class="s1">&#39;lat&#39;</span><span class="p">,</span> <span class="s1">&#39;lon&#39;</span><span class="p">)</span>
                            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                                <span class="bp">self</span><span class="o">.</span><span class="n">data</span> <span class="o">=</span> <span class="p">[</span><span class="n">copy</span><span class="o">.</span><span class="n">copy</span><span class="p">(</span><span class="n">tmp</span><span class="p">)]</span>
                                <span class="n">filecount</span> <span class="o">+=</span> <span class="mi">1</span>
                            <span class="k">elif</span> <span class="p">[</span><span class="n">tmp</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="n">testkeys</span><span class="p">]</span> <span class="ow">not</span> <span class="ow">in</span> <span class="p">[[</span><span class="n">d</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="n">testkeys</span><span class="p">]</span> <span class="k">for</span> <span class="n">d</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">]:</span>
                                <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">tmp</span><span class="p">)</span>
                                <span class="n">filecount</span> <span class="o">+=</span> <span class="mi">1</span>
                            <span class="k">else</span><span class="p">:</span>
                                <span class="k">pass</span>

                        <span class="k">except</span><span class="p">:</span>
                            <span class="k">continue</span>

            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;--&gt; Completed reading in recon VDM files (</span><span class="si">{</span><span class="p">(</span><span class="n">dt</span><span class="o">.</span><span class="n">now</span><span class="p">()</span><span class="o">-</span><span class="n">timer_start</span><span class="p">)</span><span class="o">.</span><span class="n">total_seconds</span><span class="p">()</span><span class="si">:</span><span class="s1">.1f</span><span class="si">}</span><span class="s1"> seconds)&#39;</span> <span class="o">+</span>
                  <span class="sa">f</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">Read </span><span class="si">{</span><span class="n">filecount</span><span class="si">}</span><span class="s1"> files&#39;</span><span class="p">)</span>

        <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
            <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="s1">&#39;rb&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">data</span> <span class="o">=</span> <span class="n">pickle</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">f</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">data</span> <span class="o">=</span> <span class="n">data</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">keys</span> <span class="o">=</span> <span class="nb">sorted</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="nb">set</span><span class="p">([</span><span class="n">k</span> <span class="k">for</span> <span class="n">d</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span> <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="n">d</span><span class="o">.</span><span class="n">keys</span><span class="p">()])))</span>

<div class="viewcode-block" id="vdms.update"><a class="viewcode-back" href="../../../api/generated/tropycal.recon.vdms.update.html#tropycal.recon.vdms.update">[docs]</a>    <span class="k">def</span> <span class="nf">update</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sa">r</span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Update with the latest data for an ongoing storm.</span>

<span class="sd">        Notes</span>
<span class="sd">        -----</span>
<span class="sd">        This function has no return value, but simply updates the internal VDM data with new observations since the object was created.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">newobj</span> <span class="o">=</span> <span class="n">vdms</span><span class="p">(</span><span class="n">storm</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">storm</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">,</span> <span class="n">update</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">newobj</span></div>

<div class="viewcode-block" id="vdms.isel"><a class="viewcode-back" href="../../../api/generated/tropycal.recon.vdms.isel.html#tropycal.recon.vdms.isel">[docs]</a>    <span class="k">def</span> <span class="nf">isel</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">index</span><span class="p">):</span>
<span class="w">        </span><span class="sa">r</span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Select a single VDM by index of the list.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        index : int</span>
<span class="sd">            Integer containing the index of the dropsonde.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        vdms</span>
<span class="sd">            Instance of VDMs for the single requested VDM.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">NEW_DATA</span> <span class="o">=</span> <span class="n">copy</span><span class="o">.</span><span class="n">copy</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">)</span>
        <span class="n">NEW_DATA</span> <span class="o">=</span> <span class="p">[</span><span class="n">NEW_DATA</span><span class="p">[</span><span class="n">index</span><span class="p">]]</span>
        <span class="n">NEW_OBJ</span> <span class="o">=</span> <span class="n">vdms</span><span class="p">(</span><span class="n">storm</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">storm</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="n">NEW_DATA</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">NEW_OBJ</span></div>

<div class="viewcode-block" id="vdms.sel"><a class="viewcode-back" href="../../../api/generated/tropycal.recon.vdms.sel.html#tropycal.recon.vdms.sel">[docs]</a>    <span class="k">def</span> <span class="nf">sel</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">mission</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">time</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">domain</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
<span class="w">        </span><span class="sa">r</span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Select a subset of VDMs by any of its parameters and return a new vdms object.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        mission : str</span>
<span class="sd">            Mission name (number + storm id), e.g. mission 7 for AL05 is &#39;0705L&#39;</span>
<span class="sd">        time : list/tuple of datetimes</span>
<span class="sd">            list/tuple of start time and end time datetime objects.</span>
<span class="sd">            Default is None, which returns all points</span>
<span class="sd">        domain : dict</span>
<span class="sd">            dictionary with keys &#39;n&#39;, &#39;s&#39;, &#39;e&#39;, &#39;w&#39; corresponding to boundaries of domain</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        vdms object</span>
<span class="sd">            A new vdms object that satisfies the intersection of all subsetting.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">NEW_DATA</span> <span class="o">=</span> <span class="n">copy</span><span class="o">.</span><span class="n">copy</span><span class="p">(</span><span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">))</span>

        <span class="c1"># Apply mission filter</span>
        <span class="k">if</span> <span class="n">mission</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">mission</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">mission</span><span class="p">)</span>
            <span class="n">NEW_DATA</span> <span class="o">=</span> <span class="n">NEW_DATA</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">NEW_DATA</span><span class="p">[</span><span class="s1">&#39;mission&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="n">mission</span><span class="p">]</span>

        <span class="c1"># Apply time filter</span>
        <span class="k">if</span> <span class="n">time</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">bounds</span> <span class="o">=</span> <span class="n">get_bounds</span><span class="p">(</span><span class="n">NEW_DATA</span><span class="p">[</span><span class="s1">&#39;time&#39;</span><span class="p">],</span> <span class="n">time</span><span class="p">)</span>
            <span class="n">NEW_DATA</span> <span class="o">=</span> <span class="n">NEW_DATA</span><span class="o">.</span><span class="n">loc</span><span class="p">[(</span><span class="n">NEW_DATA</span><span class="p">[</span><span class="s1">&#39;time&#39;</span><span class="p">]</span> <span class="o">&gt;=</span> <span class="n">bounds</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span> <span class="o">&amp;</span> <span class="p">(</span>
                <span class="n">NEW_DATA</span><span class="p">[</span><span class="s1">&#39;time&#39;</span><span class="p">]</span> <span class="o">&lt;=</span> <span class="n">bounds</span><span class="p">[</span><span class="mi">1</span><span class="p">])]</span>

        <span class="c1"># Apply domain filter</span>
        <span class="k">if</span> <span class="n">domain</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">tmp</span> <span class="o">=</span> <span class="p">{</span><span class="n">k</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">lower</span><span class="p">():</span> <span class="n">v</span> <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">domain</span><span class="o">.</span><span class="n">items</span><span class="p">()}</span>
            <span class="n">domain</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;n&#39;</span><span class="p">:</span> <span class="mi">90</span><span class="p">,</span> <span class="s1">&#39;s&#39;</span><span class="p">:</span> <span class="o">-</span><span class="mi">90</span><span class="p">,</span> <span class="s1">&#39;e&#39;</span><span class="p">:</span> <span class="mf">359.99</span><span class="p">,</span> <span class="s1">&#39;w&#39;</span><span class="p">:</span> <span class="mi">0</span><span class="p">}</span>
            <span class="n">domain</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">tmp</span><span class="p">)</span>
            <span class="n">bounds</span> <span class="o">=</span> <span class="n">get_bounds</span><span class="p">(</span>
                <span class="n">NEW_DATA</span><span class="p">[</span><span class="s1">&#39;lon&#39;</span><span class="p">]</span> <span class="o">%</span> <span class="mi">360</span><span class="p">,</span> <span class="p">(</span><span class="n">domain</span><span class="p">[</span><span class="s1">&#39;w&#39;</span><span class="p">]</span> <span class="o">%</span> <span class="mi">360</span><span class="p">,</span> <span class="n">domain</span><span class="p">[</span><span class="s1">&#39;e&#39;</span><span class="p">]</span> <span class="o">%</span> <span class="mi">360</span><span class="p">))</span>
            <span class="n">NEW_DATA</span> <span class="o">=</span> <span class="n">NEW_DATA</span><span class="o">.</span><span class="n">loc</span><span class="p">[(</span><span class="n">NEW_DATA</span><span class="p">[</span><span class="s1">&#39;lon&#39;</span><span class="p">]</span> <span class="o">%</span> <span class="mi">360</span> <span class="o">&gt;=</span> <span class="n">bounds</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span> <span class="o">&amp;</span> <span class="p">(</span>
                <span class="n">NEW_DATA</span><span class="p">[</span><span class="s1">&#39;lon&#39;</span><span class="p">]</span> <span class="o">%</span> <span class="mi">360</span> <span class="o">&lt;=</span> <span class="n">bounds</span><span class="p">[</span><span class="mi">1</span><span class="p">])]</span>
            <span class="n">bounds</span> <span class="o">=</span> <span class="n">get_bounds</span><span class="p">(</span><span class="n">NEW_DATA</span><span class="p">[</span><span class="s1">&#39;lat&#39;</span><span class="p">],</span> <span class="p">(</span><span class="n">domain</span><span class="p">[</span><span class="s1">&#39;s&#39;</span><span class="p">],</span> <span class="n">domain</span><span class="p">[</span><span class="s1">&#39;n&#39;</span><span class="p">]))</span>
            <span class="n">NEW_DATA</span> <span class="o">=</span> <span class="n">NEW_DATA</span><span class="o">.</span><span class="n">loc</span><span class="p">[(</span><span class="n">NEW_DATA</span><span class="p">[</span><span class="s1">&#39;lat&#39;</span><span class="p">]</span> <span class="o">&gt;=</span> <span class="n">bounds</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span> <span class="o">&amp;</span> <span class="p">(</span>
                <span class="n">NEW_DATA</span><span class="p">[</span><span class="s1">&#39;lat&#39;</span><span class="p">]</span> <span class="o">&lt;=</span> <span class="n">bounds</span><span class="p">[</span><span class="mi">1</span><span class="p">])]</span>

        <span class="n">NEW_OBJ</span> <span class="o">=</span> <span class="n">vdms</span><span class="p">(</span><span class="n">storm</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">storm</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="nb">list</span><span class="p">(</span>
            <span class="n">NEW_DATA</span><span class="o">.</span><span class="n">T</span><span class="o">.</span><span class="n">to_dict</span><span class="p">()</span><span class="o">.</span><span class="n">values</span><span class="p">()))</span>

        <span class="k">return</span> <span class="n">NEW_OBJ</span></div>

<div class="viewcode-block" id="vdms.to_pickle"><a class="viewcode-back" href="../../../api/generated/tropycal.recon.vdms.to_pickle.html#tropycal.recon.vdms.to_pickle">[docs]</a>    <span class="k">def</span> <span class="nf">to_pickle</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">filename</span><span class="p">):</span>
<span class="w">        </span><span class="sa">r</span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Save VDM data (list of dictionaries) to a pickle file</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        filename : str</span>
<span class="sd">            name of file to save pickle file to.</span>

<span class="sd">        Notes</span>
<span class="sd">        -----</span>
<span class="sd">        This method saves the VDMs data as a pickle within the current working directory, given a filename as an argument.</span>

<span class="sd">        For example, assume ``vdms`` was retrieved from a Storm object (using the first method described in the ``vdms`` class documentation). The VDMs data would be saved to a pickle file as follows:</span>

<span class="sd">        &gt;&gt;&gt; storm.recon.vdms.to_pickle(data=&quot;mystorm_vdms.pickle&quot;)</span>

<span class="sd">        Now the VDMs data is saved locally, and next time recon data for this storm needs to be analyzed, this allows to bypass re-reading the VDMs data from the NHC server by providing the pickle file as an argument:</span>

<span class="sd">        &gt;&gt;&gt; storm.recon.get_vdms(&quot;mystorm_vdms.pickle&quot;)</span>

<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">filename</span><span class="p">,</span> <span class="s1">&#39;wb&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
            <span class="n">pickle</span><span class="o">.</span><span class="n">dump</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">,</span> <span class="n">f</span><span class="p">)</span></div>

<div class="viewcode-block" id="vdms.plot_time_series"><a class="viewcode-back" href="../../../api/generated/tropycal.recon.vdms.plot_time_series.html#tropycal.recon.vdms.plot_time_series">[docs]</a>    <span class="k">def</span> <span class="nf">plot_time_series</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">time</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">best_track</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">dots</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
<span class="w">        </span><span class="sa">r</span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Creates a time series of MSLP VDM data.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        time : tuple, optional</span>
<span class="sd">            Tuple of start and end datetime.datetime objects for plot. If None, all times will be plotted.</span>
<span class="sd">        best_track : bool, optional</span>
<span class="sd">            If True, Best Track MSLP will be plotted alongside VDM MSLP. Default is False.</span>
<span class="sd">        dots : bool, optional</span>
<span class="sd">            If True, dots will be plotted for each VDM point. Default is True.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        ax</span>
<span class="sd">            Instance of axes containing the plot is returned.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="c1"># Retrieve data</span>
        <span class="n">storm_data</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">storm</span><span class="o">.</span><span class="n">dict</span>
        <span class="n">data</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span>

        <span class="c1"># Retrive data and subset by time</span>
        <span class="k">if</span> <span class="n">time</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">times</span> <span class="o">=</span> <span class="p">[</span><span class="n">i</span><span class="p">[</span><span class="s1">&#39;time&#39;</span><span class="p">]</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">data</span> <span class="k">if</span> <span class="n">i</span><span class="p">[</span><span class="s1">&#39;time&#39;</span><span class="p">]</span>
                     <span class="o">&gt;=</span> <span class="n">time</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="ow">and</span> <span class="n">i</span><span class="p">[</span><span class="s1">&#39;time&#39;</span><span class="p">]</span> <span class="o">&lt;=</span> <span class="n">time</span><span class="p">[</span><span class="mi">1</span><span class="p">]]</span>
            <span class="n">mslp</span> <span class="o">=</span> <span class="p">[</span><span class="n">i</span><span class="p">[</span><span class="s1">&#39;Minimum Sea Level Pressure (hPa)&#39;</span><span class="p">]</span>
                    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">data</span> <span class="k">if</span> <span class="n">i</span><span class="p">[</span><span class="s1">&#39;time&#39;</span><span class="p">]</span> <span class="o">&gt;=</span> <span class="n">time</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="ow">and</span> <span class="n">i</span><span class="p">[</span><span class="s1">&#39;time&#39;</span><span class="p">]</span> <span class="o">&lt;=</span> <span class="n">time</span><span class="p">[</span><span class="mi">1</span><span class="p">]]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">times</span> <span class="o">=</span> <span class="p">[</span><span class="n">i</span><span class="p">[</span><span class="s1">&#39;time&#39;</span><span class="p">]</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">data</span><span class="p">]</span>
            <span class="n">mslp</span> <span class="o">=</span> <span class="p">[</span><span class="n">i</span><span class="p">[</span><span class="s1">&#39;Minimum Sea Level Pressure (hPa)&#39;</span><span class="p">]</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">data</span><span class="p">]</span>

        <span class="c1"># Create figure</span>
        <span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">9</span><span class="p">,</span> <span class="mi">6</span><span class="p">),</span> <span class="n">dpi</span><span class="o">=</span><span class="mi">200</span><span class="p">)</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">grid</span><span class="p">()</span>

        <span class="c1"># Plot VDM MSLP</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">times</span><span class="p">,</span> <span class="n">mslp</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;b&#39;</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.5</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;VDM MSLP (hPa)&#39;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">dots</span><span class="p">:</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">times</span><span class="p">,</span> <span class="n">mslp</span><span class="p">,</span> <span class="s1">&#39;o&#39;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;b&#39;</span><span class="p">)</span>

        <span class="c1"># Retrieve &amp; plot Best Track data</span>
        <span class="k">if</span> <span class="n">best_track</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">time</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">times_btk</span> <span class="o">=</span> <span class="p">[</span><span class="n">i</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">storm_data</span><span class="p">[</span><span class="s1">&#39;time&#39;</span><span class="p">]</span>
                             <span class="k">if</span> <span class="n">i</span> <span class="o">&gt;=</span> <span class="n">time</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="ow">and</span> <span class="n">i</span> <span class="o">&lt;=</span> <span class="n">time</span><span class="p">[</span><span class="mi">1</span><span class="p">]]</span>
                <span class="n">mslp_btk</span> <span class="o">=</span> <span class="p">[</span><span class="n">storm_data</span><span class="p">[</span><span class="s1">&#39;mslp&#39;</span><span class="p">][</span><span class="n">i</span><span class="p">]</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span>
                    <span class="n">storm_data</span><span class="p">[</span><span class="s1">&#39;mslp&#39;</span><span class="p">]))</span> <span class="k">if</span> <span class="n">storm_data</span><span class="p">[</span><span class="s1">&#39;time&#39;</span><span class="p">][</span><span class="n">i</span><span class="p">]</span> <span class="o">&gt;=</span> <span class="n">time</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="ow">and</span> <span class="n">storm_data</span><span class="p">[</span><span class="s1">&#39;time&#39;</span><span class="p">][</span><span class="n">i</span><span class="p">]</span> <span class="o">&lt;=</span> <span class="n">time</span><span class="p">[</span><span class="mi">1</span><span class="p">]]</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">times_btk</span> <span class="o">=</span> <span class="p">[</span><span class="n">i</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">storm_data</span><span class="p">[</span><span class="s1">&#39;time&#39;</span><span class="p">]]</span>
                <span class="n">mslp_btk</span> <span class="o">=</span> <span class="p">[</span><span class="n">i</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">storm_data</span><span class="p">[</span><span class="s1">&#39;mslp&#39;</span><span class="p">]]</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">times_btk</span><span class="p">,</span> <span class="n">mslp_btk</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;r&#39;</span><span class="p">,</span>
                    <span class="n">alpha</span><span class="o">=</span><span class="mf">0.25</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;Best Track MSLP (hPa)&#39;</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">dots</span><span class="p">:</span>
                <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">times_btk</span><span class="p">,</span> <span class="n">mslp_btk</span><span class="p">,</span> <span class="s1">&#39;o&#39;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;r&#39;</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.5</span><span class="p">)</span>

        <span class="c1"># Add labels</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s2">&quot;MSLP (hPa)&quot;</span><span class="p">)</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s2">&quot;Vortex Data Message time (UTC)&quot;</span><span class="p">)</span>

        <span class="c1"># Add time labels</span>
        <span class="n">times_use</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">start_time</span> <span class="o">=</span> <span class="n">times</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="n">hour</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
        <span class="n">total_days</span> <span class="o">=</span> <span class="p">(</span><span class="n">times</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="n">start_time</span><span class="p">)</span><span class="o">.</span><span class="n">total_seconds</span><span class="p">()</span> <span class="o">/</span> <span class="mi">86400</span>
        <span class="n">increment_hour</span> <span class="o">=</span> <span class="mi">6</span>
        <span class="k">if</span> <span class="n">total_days</span> <span class="o">&gt;</span> <span class="mi">3</span><span class="p">:</span>
            <span class="n">increment_hour</span> <span class="o">=</span> <span class="mi">12</span>
        <span class="k">if</span> <span class="n">total_days</span> <span class="o">&gt;</span> <span class="mi">6</span><span class="p">:</span>
            <span class="n">increment_hour</span> <span class="o">=</span> <span class="mi">24</span>
        <span class="k">while</span> <span class="n">start_time</span> <span class="o">&lt;=</span> <span class="p">(</span><span class="n">times</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="n">timedelta</span><span class="p">(</span><span class="n">hours</span><span class="o">=</span><span class="n">increment_hour</span><span class="p">)):</span>
            <span class="n">times_use</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">start_time</span><span class="p">)</span>
            <span class="n">start_time</span> <span class="o">+=</span> <span class="n">timedelta</span><span class="p">(</span><span class="n">hours</span><span class="o">=</span><span class="n">increment_hour</span><span class="p">)</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">set_xticks</span><span class="p">(</span><span class="n">times_use</span><span class="p">)</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">set_xlim</span><span class="p">(</span><span class="n">times</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">-</span> <span class="n">timedelta</span><span class="p">(</span><span class="n">hours</span><span class="o">=</span><span class="mi">6</span><span class="p">),</span>
                    <span class="n">times</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="n">timedelta</span><span class="p">(</span><span class="n">hours</span><span class="o">=</span><span class="mi">6</span><span class="p">))</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">xaxis</span><span class="o">.</span><span class="n">set_major_formatter</span><span class="p">(</span><span class="n">mdates</span><span class="o">.</span><span class="n">DateFormatter</span><span class="p">(</span><span class="s1">&#39;%H UTC</span><span class="se">\n</span><span class="s1">%b </span><span class="si">%d</span><span class="s1">&#39;</span><span class="p">))</span>

        <span class="c1"># Add titles</span>
        <span class="n">type_array</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">storm_data</span><span class="p">[</span><span class="s1">&#39;type&#39;</span><span class="p">])</span>
        <span class="n">idx</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">((</span><span class="n">type_array</span> <span class="o">==</span> <span class="s1">&#39;SD&#39;</span><span class="p">)</span> <span class="o">|</span> <span class="p">(</span><span class="n">type_array</span> <span class="o">==</span> <span class="s1">&#39;SS&#39;</span><span class="p">)</span> <span class="o">|</span> <span class="p">(</span><span class="n">type_array</span> <span class="o">==</span> <span class="s1">&#39;TD&#39;</span><span class="p">)</span> <span class="o">|</span> <span class="p">(</span>
            <span class="n">type_array</span> <span class="o">==</span> <span class="s1">&#39;TS&#39;</span><span class="p">)</span> <span class="o">|</span> <span class="p">(</span><span class="n">type_array</span> <span class="o">==</span> <span class="s1">&#39;HU&#39;</span><span class="p">)</span> <span class="o">|</span> <span class="p">(</span><span class="n">type_array</span> <span class="o">==</span> <span class="s1">&#39;TY&#39;</span><span class="p">)</span> <span class="o">|</span> <span class="p">(</span><span class="n">type_array</span> <span class="o">==</span> <span class="s1">&#39;ST&#39;</span><span class="p">))</span>
        <span class="k">if</span> <span class="p">(</span><span class="s1">&#39;invest&#39;</span> <span class="ow">in</span> <span class="n">storm_data</span><span class="o">.</span><span class="n">keys</span><span class="p">()</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">storm_data</span><span class="p">[</span><span class="s1">&#39;invest&#39;</span><span class="p">])</span> <span class="ow">or</span> <span class="nb">len</span><span class="p">(</span><span class="n">idx</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">tropical_vmax</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">storm_data</span><span class="p">[</span><span class="s1">&#39;vmax&#39;</span><span class="p">])[</span><span class="n">idx</span><span class="p">]</span>

            <span class="n">add_ptc_flag</span> <span class="o">=</span> <span class="kc">False</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">tropical_vmax</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                <span class="n">add_ptc_flag</span> <span class="o">=</span> <span class="kc">True</span>
                <span class="n">idx</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">((</span><span class="n">type_array</span> <span class="o">==</span> <span class="s1">&#39;LO&#39;</span><span class="p">)</span> <span class="o">|</span> <span class="p">(</span><span class="n">type_array</span> <span class="o">==</span> <span class="s1">&#39;DB&#39;</span><span class="p">))</span>
            <span class="n">tropical_vmax</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">storm_data</span><span class="p">[</span><span class="s1">&#39;vmax&#39;</span><span class="p">])[</span><span class="n">idx</span><span class="p">]</span>

            <span class="n">subtrop</span> <span class="o">=</span> <span class="n">classify_subtropical</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">storm_data</span><span class="p">[</span><span class="s1">&#39;type&#39;</span><span class="p">]))</span>
            <span class="n">peak_idx</span> <span class="o">=</span> <span class="n">storm_data</span><span class="p">[</span><span class="s1">&#39;vmax&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">nanmax</span><span class="p">(</span><span class="n">tropical_vmax</span><span class="p">))</span>
            <span class="n">peak_basin</span> <span class="o">=</span> <span class="n">storm_data</span><span class="p">[</span><span class="s1">&#39;wmo_basin&#39;</span><span class="p">][</span><span class="n">peak_idx</span><span class="p">]</span>
            <span class="n">storm_type</span> <span class="o">=</span> <span class="n">get_storm_classification</span><span class="p">(</span>
                <span class="n">np</span><span class="o">.</span><span class="n">nanmax</span><span class="p">(</span><span class="n">tropical_vmax</span><span class="p">),</span> <span class="n">subtrop</span><span class="p">,</span> <span class="n">peak_basin</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">add_ptc_flag</span><span class="p">:</span>
                <span class="n">storm_type</span> <span class="o">=</span> <span class="s2">&quot;Potential Tropical Cyclone&quot;</span>

        <span class="k">if</span> <span class="n">best_track</span><span class="p">:</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span>
            <span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">storm_type</span><span class="si">}</span><span class="s1"> </span><span class="si">{</span><span class="n">storm_data</span><span class="p">[</span><span class="s2">&quot;name&quot;</span><span class="p">]</span><span class="si">}</span><span class="se">\n</span><span class="s1">VDM Minimum Sea Level Pressure (hPa)&#39;</span><span class="p">,</span> <span class="n">loc</span><span class="o">=</span><span class="s1">&#39;left&#39;</span><span class="p">,</span> <span class="n">fontweight</span><span class="o">=</span><span class="s1">&#39;bold&#39;</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">ax</span></div>

<div class="viewcode-block" id="vdms.plot_points"><a class="viewcode-back" href="../../../api/generated/tropycal.recon.vdms.plot_points.html#tropycal.recon.vdms.plot_points">[docs]</a>    <span class="k">def</span> <span class="nf">plot_points</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">varname</span><span class="o">=</span><span class="s1">&#39;Minimum Sea Level Pressure (hPa)&#39;</span><span class="p">,</span> <span class="n">domain</span><span class="o">=</span><span class="s2">&quot;dynamic&quot;</span><span class="p">,</span> <span class="n">ax</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">cartopy_proj</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
<span class="w">        </span><span class="sa">r</span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Creates a plot of recon data points.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        varname : str</span>
<span class="sd">            Variable to plot. Currently the best option is &quot;Minimum Sea Level Pressure (hPa)&quot;.</span>
<span class="sd">        domain : str</span>
<span class="sd">            Domain for the plot. Default is &quot;dynamic&quot;. Please refer to :ref:`options-domain` for available domain options.</span>
<span class="sd">        ax : axes</span>
<span class="sd">            Instance of axes to plot on. If none, one will be generated. Default is none.</span>
<span class="sd">        cartopy_proj : ccrs</span>
<span class="sd">            Instance of a cartopy projection to use. If none, one will be generated. Default is none.</span>

<span class="sd">        Other Parameters</span>
<span class="sd">        ----------------</span>
<span class="sd">        prop : dict</span>
<span class="sd">            Customization properties of recon plot. Please refer to :ref:`options-prop-recon-plot` for available options.</span>
<span class="sd">        map_prop : dict</span>
<span class="sd">            Customization properties of Cartopy map. Please refer to :ref:`options-map-prop` for available options.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        ax</span>
<span class="sd">            Instance of axes containing the plot is returned.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="c1"># Pop kwargs</span>
        <span class="n">prop</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;prop&#39;</span><span class="p">,</span> <span class="p">{})</span>
        <span class="n">map_prop</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;map_prop&#39;</span><span class="p">,</span> <span class="p">{})</span>

        <span class="c1"># Get plot data</span>
        <span class="n">plotdata</span> <span class="o">=</span> <span class="p">[</span><span class="n">m</span><span class="p">[</span><span class="n">varname</span><span class="p">]</span> <span class="k">if</span> <span class="n">varname</span> <span class="ow">in</span> <span class="n">m</span><span class="o">.</span><span class="n">keys</span><span class="p">()</span>
                    <span class="k">else</span> <span class="n">np</span><span class="o">.</span><span class="n">nan</span> <span class="k">for</span> <span class="n">m</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">]</span>

        <span class="n">dfRecon</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="o">.</span><span class="n">from_dict</span><span class="p">({</span><span class="s1">&#39;time&#39;</span><span class="p">:</span> <span class="p">[</span><span class="n">m</span><span class="p">[</span><span class="s1">&#39;time&#39;</span><span class="p">]</span> <span class="k">for</span> <span class="n">m</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">],</span>
                                          <span class="s1">&#39;lat&#39;</span><span class="p">:</span> <span class="p">[</span><span class="n">m</span><span class="p">[</span><span class="s1">&#39;lat&#39;</span><span class="p">]</span> <span class="k">for</span> <span class="n">m</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">],</span>
                                          <span class="s1">&#39;lon&#39;</span><span class="p">:</span> <span class="p">[</span><span class="n">m</span><span class="p">[</span><span class="s1">&#39;lon&#39;</span><span class="p">]</span> <span class="k">for</span> <span class="n">m</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">],</span>
                                          <span class="n">varname</span><span class="p">:</span> <span class="n">plotdata</span><span class="p">})</span>

        <span class="c1"># Create instance of plot object</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">plot_obj</span> <span class="o">=</span> <span class="n">ReconPlot</span><span class="p">()</span>

        <span class="c1"># Create cartopy projection</span>
        <span class="k">if</span> <span class="n">cartopy_proj</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">plot_obj</span><span class="o">.</span><span class="n">create_cartopy</span><span class="p">(</span>
                <span class="n">proj</span><span class="o">=</span><span class="s1">&#39;PlateCarree&#39;</span><span class="p">,</span> <span class="n">central_longitude</span><span class="o">=</span><span class="mf">0.0</span><span class="p">)</span>
            <span class="n">cartopy_proj</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">plot_obj</span><span class="o">.</span><span class="n">proj</span>

        <span class="c1"># Plot recon</span>
        <span class="n">plot_ax</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">plot_obj</span><span class="o">.</span><span class="n">plot_points</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">storm</span><span class="p">,</span> <span class="n">dfRecon</span><span class="p">,</span> <span class="n">domain</span><span class="p">,</span> <span class="n">varname</span><span class="o">=</span><span class="n">varname</span><span class="p">,</span> <span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">,</span> <span class="n">prop</span><span class="o">=</span><span class="n">prop</span><span class="p">,</span> <span class="n">map_prop</span><span class="o">=</span><span class="n">map_prop</span><span class="p">)</span>

        <span class="c1"># Return axis</span>
        <span class="k">return</span> <span class="n">plot_ax</span></div></div>
</pre></div>

           </div>
          </div>
          <footer>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2023, Tropycal Developers.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>