<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>tropycal.realtime.storm &mdash; tropycal </title>
      <link rel="stylesheet" href="../../../_static/pygments.css" type="text/css" />
      <link rel="stylesheet" href="../../../_static/css/theme.css" type="text/css" />
      <link rel="stylesheet" href="../../../_static/plot_directive.css" type="text/css" />
      <link rel="stylesheet" href="../../../_static/sg_gallery.css" type="text/css" />
      <link rel="stylesheet" href="../../../_static/sg_gallery-binder.css" type="text/css" />
      <link rel="stylesheet" href="../../../_static/sg_gallery-dataframe.css" type="text/css" />
      <link rel="stylesheet" href="../../../_static/sg_gallery-rendered-html.css" type="text/css" />
      <link rel="stylesheet" href="../../../_static/css/theme.css" type="text/css" />
    <link rel="shortcut icon" href="../../../_static/logo_32.ico"/>
  <!--[if lt IE 9]>
    <script src="../../../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
        <script data-url_root="../../../" id="documentation_options" src="../../../_static/documentation_options.js"></script>
        <script src="../../../_static/jquery.js"></script>
        <script src="../../../_static/underscore.js"></script>
        <script src="../../../_static/_sphinx_javascript_frameworks_compat.js"></script>
        <script src="../../../_static/doctools.js"></script>
        <script src="../../../_static/sphinx_highlight.js"></script>
    <script src="../../../_static/js/theme.js"></script>
    <link rel="index" title="Index" href="../../../genindex.html" />
    <link rel="search" title="Search" href="../../../search.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >

          
          
          <a href="../../../index.html" class="icon icon-home">
            tropycal
              <img src="../../../_static/logo.png" class="logo" alt="Logo"/>
          </a>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <ul>
<li class="toctree-l1"><a class="reference internal" href="../../../install.html">Installation Guide</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../support.html">Support</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../examples/index.html">Example Scripts</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../api/index.html">API Reference</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../sample_usage.html">Example Gallery</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../data.html">Data Sources</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../../index.html">tropycal</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../../../index.html" class="icon icon-home" aria-label="Home"></a></li>
          <li class="breadcrumb-item"><a href="../../index.html">Module code</a></li>
      <li class="breadcrumb-item active">tropycal.realtime.storm</li>
      <li class="wy-breadcrumbs-aside">
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <h1>Source code for tropycal.realtime.storm</h1><div class="highlight"><pre>
<span></span><span class="sa">r</span><span class="sd">&quot;&quot;&quot;Functionality for storing and analyzing an individual realtime storm.&quot;&quot;&quot;</span>

<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">scipy.interpolate</span> <span class="k">as</span> <span class="nn">interp</span>
<span class="kn">import</span> <span class="nn">urllib</span>
<span class="kn">import</span> <span class="nn">warnings</span>
<span class="kn">from</span> <span class="nn">datetime</span> <span class="kn">import</span> <span class="n">datetime</span> <span class="k">as</span> <span class="n">dt</span><span class="p">,</span> <span class="n">timedelta</span>
<span class="kn">import</span> <span class="nn">requests</span>
<span class="kn">from</span> <span class="nn">ftplib</span> <span class="kn">import</span> <span class="n">FTP</span>

<span class="kn">from</span> <span class="nn">..tracks</span> <span class="kn">import</span> <span class="o">*</span>
<span class="kn">from</span> <span class="nn">..tracks.tools</span> <span class="kn">import</span> <span class="o">*</span>
<span class="kn">from</span> <span class="nn">..tracks.plot</span> <span class="kn">import</span> <span class="n">TrackPlot</span>
<span class="kn">from</span> <span class="nn">..utils</span> <span class="kn">import</span> <span class="o">*</span>
<span class="kn">from</span> <span class="nn">..</span> <span class="kn">import</span> <span class="n">constants</span>
<span class="kn">from</span> <span class="nn">..recon</span> <span class="kn">import</span> <span class="n">ReconDataset</span>


<div class="viewcode-block" id="RealtimeStorm"><a class="viewcode-back" href="../../../api/generated/tropycal.realtime.RealtimeStorm.html#tropycal.realtime.RealtimeStorm">[docs]</a><span class="k">class</span> <span class="nc">RealtimeStorm</span><span class="p">(</span><span class="n">Storm</span><span class="p">):</span>

<span class="w">    </span><span class="sa">r</span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Initializes an instance of RealtimeStorm. This object inherits all the methods and functionality of ``tropycal.tracks.Storm``, but with additional methods unique to this object, all containing the word &quot;realtime&quot; as part of the function name.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    storm : dict</span>
<span class="sd">        Dict entry of the requested storm.</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    RealtimeStorm</span>
<span class="sd">        Instance of a RealtimeStorm object.</span>

<span class="sd">    Notes</span>
<span class="sd">    -----</span>
<span class="sd">    A RealtimeStorm object is retrieved from a Realtime object&#39;s ``get_storm()`` method, or directly as an attribute of the Realtime object. For example, if an active storm has an ID of &#39;EP012022&#39;, it can be retrieved as such:</span>

<span class="sd">    .. code-block:: python</span>

<span class="sd">        from tropycal import realtime</span>
<span class="sd">        realtime_obj = realtime.Realtime()</span>
<span class="sd">        storm = realtime_obj.get_storm(&#39;EP012022&#39;)</span>

<span class="sd">    Now this storm&#39;s data is stored in the variable ``storm``, which is an instance of RealtimeStorm and can access all of the methods and attributes of a RealtimeStorm object.</span>

<span class="sd">    All the variables associated with a RealtimeStorm object (e.g., lat, lon, time, vmax) can be accessed in two ways. The first is directly from the RealtimeStorm object:</span>

<span class="sd">    &gt;&gt;&gt; storm.lat</span>
<span class="sd">    array([ 9.8, 10.3, 10.8, 11.4, 11.9, 12.1, 12.2, 12.4, 12.6, 12.8, 13. ,</span>
<span class="sd">           12.9, 12.8, 12.9, 13.2, 13.6, 13.8, 13.9, 14. , 14. , 14.3, 14.6,</span>
<span class="sd">           15.1, 15.4])</span>

<span class="sd">    The second is via ``storm.vars``, which returns a dictionary of the variables associated with the RealtimeStorm object. This is also a quick way to access all of the variables associated with a RealtimeStorm object:</span>

<span class="sd">    &gt;&gt;&gt; variable_dict = storm.vars</span>
<span class="sd">    &gt;&gt;&gt; lat = variable_dict[&#39;lat&#39;]</span>
<span class="sd">    &gt;&gt;&gt; lon = variable_dict[&#39;lon&#39;]</span>
<span class="sd">    &gt;&gt;&gt; print(variable_dict.keys())</span>
<span class="sd">    dict_keys([&#39;time&#39;, &#39;extra_obs&#39;, &#39;special&#39;, &#39;type&#39;, &#39;lat&#39;, &#39;lon&#39;, &#39;vmax&#39;, &#39;mslp&#39;, &#39;wmo_basin&#39;])</span>

<span class="sd">    RealtimeStorm objects also have numerous attributes with information about the storm. ``storm.attrs`` returns a dictionary of the attributes for this RealtimeStorm object.</span>

<span class="sd">    It should be noted that RealtimeStorm objects have additional attributes that Storm objects do not, specifically for 2 and 5 day NHC formation probability. These only display values for invests within NHC&#39;s area of responsibility; tropical cyclones or invests in JTWC&#39;s area of responsibility display &quot;N/A&quot;.</span>

<span class="sd">    &gt;&gt;&gt; print(storm.attrs)</span>
<span class="sd">    {&#39;id&#39;: &#39;EP012022&#39;,</span>
<span class="sd">     &#39;operational_id&#39;: &#39;EP012022&#39;,</span>
<span class="sd">     &#39;name&#39;: &#39;AGATHA&#39;,</span>
<span class="sd">     &#39;year&#39;: 2022,</span>
<span class="sd">     &#39;season&#39;: 2022,</span>
<span class="sd">     &#39;basin&#39;: &#39;east_pacific&#39;,</span>
<span class="sd">     &#39;source_info&#39;: &#39;NHC Hurricane Database&#39;,</span>
<span class="sd">     &#39;invest&#39;: False,</span>
<span class="sd">     &#39;source_method&#39;: &quot;NHC&#39;s Automated Tropical Cyclone Forecasting System (ATCF)&quot;,</span>
<span class="sd">     &#39;source_url&#39;: &#39;https://ftp.nhc.noaa.gov/atcf/btk/&#39;,</span>
<span class="sd">     &#39;source&#39;: &#39;hurdat&#39;,</span>
<span class="sd">     &#39;ace&#39;: 6.055,</span>
<span class="sd">     &#39;prob_2day&#39;: &#39;N/A&#39;,</span>
<span class="sd">     &#39;prob_5day&#39;: &#39;N/A&#39;,</span>
<span class="sd">     &#39;risk_2day&#39;: &#39;N/A&#39;,</span>
<span class="sd">     &#39;risk_5day&#39;: &#39;N/A&#39;,</span>
<span class="sd">     &#39;realtime&#39;: True}</span>

<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="fm">__setitem__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">key</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="vm">__dict__</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="n">value</span>

    <span class="k">def</span> <span class="fm">__getitem__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">key</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="vm">__dict__</span><span class="p">[</span><span class="n">key</span><span class="p">]</span>

    <span class="k">def</span> <span class="fm">__repr__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>

        <span class="c1"># Label object</span>
        <span class="n">summary</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;&lt;tropycal.realtime.RealtimeStorm&gt;&quot;</span><span class="p">]</span>

        <span class="c1"># Format keys for summary</span>
        <span class="n">type_array</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">dict</span><span class="p">[</span><span class="s1">&#39;type&#39;</span><span class="p">])</span>
        <span class="n">idx</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">((</span><span class="n">type_array</span> <span class="o">==</span> <span class="s1">&#39;SD&#39;</span><span class="p">)</span> <span class="o">|</span> <span class="p">(</span><span class="n">type_array</span> <span class="o">==</span> <span class="s1">&#39;SS&#39;</span><span class="p">)</span> <span class="o">|</span> <span class="p">(</span><span class="n">type_array</span> <span class="o">==</span> <span class="s1">&#39;TD&#39;</span><span class="p">)</span> <span class="o">|</span> <span class="p">(</span>
            <span class="n">type_array</span> <span class="o">==</span> <span class="s1">&#39;TS&#39;</span><span class="p">)</span> <span class="o">|</span> <span class="p">(</span><span class="n">type_array</span> <span class="o">==</span> <span class="s1">&#39;HU&#39;</span><span class="p">)</span> <span class="o">|</span> <span class="p">(</span><span class="n">type_array</span> <span class="o">==</span> <span class="s1">&#39;TY&#39;</span><span class="p">)</span> <span class="o">|</span> <span class="p">(</span><span class="n">type_array</span> <span class="o">==</span> <span class="s1">&#39;ST&#39;</span><span class="p">))[</span><span class="mi">0</span><span class="p">]</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">invest</span> <span class="ow">and</span> <span class="nb">len</span><span class="p">(</span><span class="n">idx</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">idx</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="kc">True</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">type_array</span><span class="p">])</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">idx</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">start_time</span> <span class="o">=</span> <span class="s1">&#39;N/A&#39;</span>
            <span class="n">end_time</span> <span class="o">=</span> <span class="s1">&#39;N/A&#39;</span>
            <span class="n">max_wind</span> <span class="o">=</span> <span class="s1">&#39;N/A&#39;</span>
            <span class="n">min_mslp</span> <span class="o">=</span> <span class="s1">&#39;N/A&#39;</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">time_tropical</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">dict</span><span class="p">[</span><span class="s1">&#39;time&#39;</span><span class="p">])[</span><span class="n">idx</span><span class="p">]</span>
            <span class="n">start_time</span> <span class="o">=</span> <span class="n">time_tropical</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">strftime</span><span class="p">(</span><span class="s2">&quot;%H00 UTC </span><span class="si">%d</span><span class="s2"> %B %Y&quot;</span><span class="p">)</span>
            <span class="n">end_time</span> <span class="o">=</span> <span class="n">time_tropical</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">strftime</span><span class="p">(</span><span class="s2">&quot;%H00 UTC </span><span class="si">%d</span><span class="s2"> %B %Y&quot;</span><span class="p">)</span>
            <span class="n">max_wind</span> <span class="o">=</span> <span class="s1">&#39;N/A&#39;</span> <span class="k">if</span> <span class="n">all_nan</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">dict</span><span class="p">[</span><span class="s1">&#39;vmax&#39;</span><span class="p">])[</span><span class="n">idx</span><span class="p">])</span> <span class="k">else</span> <span class="n">np</span><span class="o">.</span><span class="n">nanmax</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">dict</span><span class="p">[</span><span class="s1">&#39;vmax&#39;</span><span class="p">])[</span><span class="n">idx</span><span class="p">])</span>
            <span class="n">min_mslp</span> <span class="o">=</span> <span class="s1">&#39;N/A&#39;</span> <span class="k">if</span> <span class="n">all_nan</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">dict</span><span class="p">[</span><span class="s1">&#39;mslp&#39;</span><span class="p">])[</span><span class="n">idx</span><span class="p">])</span> <span class="k">else</span> <span class="n">np</span><span class="o">.</span><span class="n">nanmin</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">dict</span><span class="p">[</span><span class="s1">&#39;mslp&#39;</span><span class="p">])[</span><span class="n">idx</span><span class="p">])</span>
        <span class="n">summary_keys</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s1">&#39;Maximum Wind&#39;</span><span class="p">:</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">max_wind</span><span class="si">}</span><span class="s2"> knots&quot;</span><span class="p">,</span>
            <span class="s1">&#39;Minimum Pressure&#39;</span><span class="p">:</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">min_mslp</span><span class="si">}</span><span class="s2"> hPa&quot;</span><span class="p">,</span>
            <span class="s1">&#39;Start Time&#39;</span><span class="p">:</span> <span class="n">start_time</span><span class="p">,</span>
            <span class="s1">&#39;End Time&#39;</span><span class="p">:</span> <span class="n">end_time</span><span class="p">,</span>
        <span class="p">}</span>

        <span class="c1"># Format keys for coordinates</span>
        <span class="n">variable_keys</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">vars</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
            <span class="n">dtype</span> <span class="o">=</span> <span class="nb">type</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">vars</span><span class="p">[</span><span class="n">key</span><span class="p">][</span><span class="mi">0</span><span class="p">])</span><span class="o">.</span><span class="vm">__name__</span>
            <span class="n">dtype</span> <span class="o">=</span> <span class="n">dtype</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;_&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">)</span>
            <span class="n">variable_keys</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;(</span><span class="si">{</span><span class="n">dtype</span><span class="si">}</span><span class="s2">) [</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">vars</span><span class="p">[</span><span class="n">key</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span><span class="si">}</span><span class="s2"> .... </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">vars</span><span class="p">[</span><span class="n">key</span><span class="p">][</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="si">}</span><span class="s2">]&quot;</span>

        <span class="c1"># Add storm summary</span>
        <span class="n">summary</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;Storm Summary:&quot;</span><span class="p">)</span>
        <span class="n">add_space</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">([</span><span class="nb">len</span><span class="p">(</span><span class="n">key</span><span class="p">)</span> <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="n">summary_keys</span><span class="o">.</span><span class="n">keys</span><span class="p">()])</span><span class="o">+</span><span class="mi">3</span>
        <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="n">summary_keys</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
            <span class="n">key_name</span> <span class="o">=</span> <span class="n">key</span><span class="o">+</span><span class="s2">&quot;:&quot;</span>
            <span class="n">summary</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
                <span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="s2">&quot; &quot;</span><span class="o">*</span><span class="mi">4</span><span class="si">}{</span><span class="n">key_name</span><span class="si">:</span><span class="s1">&lt;</span><span class="si">{</span><span class="n">add_space</span><span class="si">}}{</span><span class="n">summary_keys</span><span class="p">[</span><span class="n">key</span><span class="p">]</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>

        <span class="c1"># Add coordinates</span>
        <span class="n">summary</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">Variables:&quot;</span><span class="p">)</span>
        <span class="n">add_space</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">([</span><span class="nb">len</span><span class="p">(</span><span class="n">key</span><span class="p">)</span> <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="n">variable_keys</span><span class="o">.</span><span class="n">keys</span><span class="p">()])</span><span class="o">+</span><span class="mi">3</span>
        <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="n">variable_keys</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
            <span class="n">key_name</span> <span class="o">=</span> <span class="n">key</span>
            <span class="n">summary</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
                <span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="s2">&quot; &quot;</span><span class="o">*</span><span class="mi">4</span><span class="si">}{</span><span class="n">key_name</span><span class="si">:</span><span class="s1">&lt;</span><span class="si">{</span><span class="n">add_space</span><span class="si">}}{</span><span class="n">variable_keys</span><span class="p">[</span><span class="n">key</span><span class="p">]</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>

        <span class="c1"># Add additional information</span>
        <span class="n">summary</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">More Information:&quot;</span><span class="p">)</span>
        <span class="n">add_space</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">([</span><span class="nb">len</span><span class="p">(</span><span class="n">key</span><span class="p">)</span> <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">attrs</span><span class="o">.</span><span class="n">keys</span><span class="p">()])</span><span class="o">+</span><span class="mi">3</span>
        <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">attrs</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
            <span class="n">key_name</span> <span class="o">=</span> <span class="n">key</span><span class="o">+</span><span class="s2">&quot;:&quot;</span>
            <span class="n">val</span> <span class="o">=</span> <span class="s1">&#39;</span><span class="si">%0.1f</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">attrs</span><span class="p">[</span><span class="n">key</span><span class="p">])</span> <span class="k">if</span> <span class="n">key</span> <span class="o">==</span> <span class="s1">&#39;ace&#39;</span> <span class="k">else</span> <span class="bp">self</span><span class="o">.</span><span class="n">attrs</span><span class="p">[</span><span class="n">key</span><span class="p">]</span>
            <span class="n">summary</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="s2">&quot; &quot;</span><span class="o">*</span><span class="mi">4</span><span class="si">}{</span><span class="n">key_name</span><span class="si">:</span><span class="s1">&lt;</span><span class="si">{</span><span class="n">add_space</span><span class="si">}}{</span><span class="n">val</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>

        <span class="k">return</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">summary</span><span class="p">)</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">storm</span><span class="p">,</span> <span class="n">stormTors</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>

        <span class="c1"># Save the dict entry of the storm</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">dict</span> <span class="o">=</span> <span class="n">storm</span>

        <span class="c1"># Add other attributes about the storm</span>
        <span class="n">keys</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">dict</span><span class="o">.</span><span class="n">keys</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">attrs</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">vars</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="n">keys</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">key</span> <span class="o">==</span> <span class="s1">&#39;realtime&#39;</span><span class="p">:</span>
                <span class="k">continue</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">dict</span><span class="p">[</span><span class="n">key</span><span class="p">],</span> <span class="nb">list</span><span class="p">)</span> <span class="ow">and</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">dict</span><span class="p">[</span><span class="n">key</span><span class="p">],</span> <span class="nb">dict</span><span class="p">):</span>
                <span class="bp">self</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">dict</span><span class="p">[</span><span class="n">key</span><span class="p">]</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">attrs</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">dict</span><span class="p">[</span><span class="n">key</span><span class="p">]</span>
            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">dict</span><span class="p">[</span><span class="n">key</span><span class="p">],</span> <span class="nb">list</span><span class="p">)</span> <span class="ow">and</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">dict</span><span class="p">[</span><span class="n">key</span><span class="p">],</span> <span class="nb">dict</span><span class="p">):</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">vars</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">dict</span><span class="p">[</span><span class="n">key</span><span class="p">])</span>
                <span class="bp">self</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">dict</span><span class="p">[</span><span class="n">key</span><span class="p">])</span>

        <span class="c1"># Assign tornado data</span>
        <span class="k">if</span> <span class="n">stormTors</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">stormTors</span><span class="p">,</span> <span class="nb">dict</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">stormTors</span> <span class="o">=</span> <span class="n">stormTors</span><span class="p">[</span><span class="s1">&#39;data&#39;</span><span class="p">]</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">tornado_dist_thresh</span> <span class="o">=</span> <span class="n">stormTors</span><span class="p">[</span><span class="s1">&#39;dist_thresh&#39;</span><span class="p">]</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">attrs</span><span class="p">[</span><span class="s1">&#39;Tornado Count&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">stormTors</span><span class="p">[</span><span class="s1">&#39;data&#39;</span><span class="p">])</span>

        <span class="c1"># Get Archer track data for this storm, if it exists</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">get_archer</span><span class="p">()</span>
        <span class="k">except</span><span class="p">:</span>
            <span class="k">pass</span>

        <span class="c1"># Initialize recon dataset instance</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">recon</span> <span class="o">=</span> <span class="n">ReconDataset</span><span class="p">(</span><span class="n">storm</span><span class="o">=</span><span class="bp">self</span><span class="p">)</span>

        <span class="c1"># Determine if storm object was retrieved via realtime object</span>
        <span class="k">if</span> <span class="s1">&#39;realtime&#39;</span> <span class="ow">in</span> <span class="n">keys</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">dict</span><span class="p">[</span><span class="s1">&#39;realtime&#39;</span><span class="p">]:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">realtime</span> <span class="o">=</span> <span class="kc">True</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">attrs</span><span class="p">[</span><span class="s1">&#39;realtime&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">realtime</span> <span class="o">=</span> <span class="kc">False</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">attrs</span><span class="p">[</span><span class="s1">&#39;realtime&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">False</span>

<div class="viewcode-block" id="RealtimeStorm.get_realtime_formation_prob"><a class="viewcode-back" href="../../../api/generated/tropycal.realtime.RealtimeStorm.get_realtime_formation_prob.html#tropycal.realtime.RealtimeStorm.get_realtime_formation_prob">[docs]</a>    <span class="k">def</span> <span class="nf">get_realtime_formation_prob</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sa">r</span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Retrieve the latest NHC formation probability. Only valid for invests within NHC&#39;s area of responsibility.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        dict</span>
<span class="sd">            Dictionary containing latest NHC forecast formation probability, if available. If none, defaults to zero or N/A.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">return</span> <span class="p">{</span>
            <span class="s1">&#39;prob_2day&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">dict</span><span class="p">[</span><span class="s1">&#39;prob_2day&#39;</span><span class="p">],</span>
            <span class="s1">&#39;risk_2day&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">dict</span><span class="p">[</span><span class="s1">&#39;risk_2day&#39;</span><span class="p">],</span>
            <span class="s1">&#39;prob_7day&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">dict</span><span class="p">[</span><span class="s1">&#39;prob_7day&#39;</span><span class="p">],</span>
            <span class="s1">&#39;risk_7day&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">dict</span><span class="p">[</span><span class="s1">&#39;risk_7day&#39;</span><span class="p">]</span>
        <span class="p">}</span></div>

<div class="viewcode-block" id="RealtimeStorm.download_graphic_realtime"><a class="viewcode-back" href="../../../api/generated/tropycal.realtime.RealtimeStorm.download_graphic_realtime.html#tropycal.realtime.RealtimeStorm.download_graphic_realtime">[docs]</a>    <span class="k">def</span> <span class="nf">download_graphic_realtime</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">save_path</span><span class="o">=</span><span class="s2">&quot;&quot;</span><span class="p">):</span>
<span class="w">        </span><span class="sa">r</span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Download the latest official forecast track graphic. Available for both NHC and JTWC sources.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        save_path : str</span>
<span class="sd">            Filepath to save the image in. If blank, default is current working directory.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="c1"># Check to ensure storm is not an invest</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">invest</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span>
                <span class="s2">&quot;Error: NHC does not issue advisories for invests that have not been designated as Potential Tropical Cyclones.&quot;</span><span class="p">)</span>

        <span class="c1"># Determine data source</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">source</span> <span class="o">==</span> <span class="s1">&#39;hurdat&#39;</span><span class="p">:</span>
            <span class="n">part1</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;AT</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">id</span><span class="p">[</span><span class="mi">2</span><span class="p">:</span><span class="mi">4</span><span class="p">]</span><span class="si">}</span><span class="s2">&quot;</span> <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">id</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="mi">2</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;AL&quot;</span> <span class="k">else</span> <span class="bp">self</span><span class="o">.</span><span class="n">id</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="mi">4</span><span class="p">]</span>
            <span class="n">url</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;https://www.nhc.noaa.gov/storm_graphics/</span><span class="si">{</span><span class="n">part1</span><span class="si">}</span><span class="s2">/</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">id</span><span class="si">}</span><span class="s2">_5day_cone_with_line_and_wind.png&quot;</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">url</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;https://www.nrlmry.navy.mil/atcf_web/docs/current_storms/</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">id</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span><span class="si">}</span><span class="s2">.gif&quot;</span>
        <span class="n">url_ext</span> <span class="o">=</span> <span class="n">url</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;.&quot;</span><span class="p">)[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>

        <span class="c1"># Try to download file</span>
        <span class="k">if</span> <span class="n">requests</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">url</span><span class="p">)</span><span class="o">.</span><span class="n">status_code</span> <span class="o">!=</span> <span class="mi">200</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span>
                <span class="s2">&quot;Official forecast graphic is unavailable for this storm.&quot;</span><span class="p">)</span>

        <span class="c1"># Download file</span>
        <span class="n">response</span> <span class="o">=</span> <span class="n">requests</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">url</span><span class="p">)</span>
        <span class="n">full_path</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">save_path</span><span class="p">,</span> <span class="sa">f</span><span class="s2">&quot;Forecast_</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">id</span><span class="si">}</span><span class="s2">.</span><span class="si">{</span><span class="n">url_ext</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">full_path</span><span class="p">,</span> <span class="s1">&#39;wb&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
            <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">response</span><span class="o">.</span><span class="n">content</span><span class="p">)</span></div>

<div class="viewcode-block" id="RealtimeStorm.get_discussion_realtime"><a class="viewcode-back" href="../../../api/generated/tropycal.realtime.RealtimeStorm.get_discussion_realtime.html#tropycal.realtime.RealtimeStorm.get_discussion_realtime">[docs]</a>    <span class="k">def</span> <span class="nf">get_discussion_realtime</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sa">r</span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Retrieve the latest available forecast discussion. For JTWC storms, the Prognostic Reasoning product is retrieved.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        dict</span>
<span class="sd">            Dict entry containing the latest official forecast discussion.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="c1"># Check to ensure storm is not an invest</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">invest</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span>
                <span class="s2">&quot;Error: NHC does not issue advisories for invests that have not been designated as Potential Tropical Cyclones.&quot;</span><span class="p">)</span>

        <span class="c1"># Get latest forecast discussion for HURDAT source storm objects</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">source</span> <span class="o">==</span> <span class="s2">&quot;hurdat&quot;</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_nhc_discussion</span><span class="p">(</span><span class="n">forecast</span><span class="o">=-</span><span class="mi">1</span><span class="p">)</span>

        <span class="c1"># Get latest forecast discussion for JTWC source storm objects</span>
        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">source</span> <span class="o">==</span> <span class="s1">&#39;jtwc&#39;</span><span class="p">:</span>

            <span class="c1"># Read in discussion file</span>
            <span class="n">url</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;https://www.metoc.navy.mil/jtwc/products/</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">id</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="mi">2</span><span class="p">]</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span><span class="si">}{</span><span class="bp">self</span><span class="o">.</span><span class="n">id</span><span class="p">[</span><span class="mi">2</span><span class="p">:</span><span class="mi">4</span><span class="p">]</span><span class="si">}{</span><span class="bp">self</span><span class="o">.</span><span class="n">id</span><span class="p">[</span><span class="mi">6</span><span class="p">:</span><span class="mi">8</span><span class="p">]</span><span class="si">}</span><span class="s2">prog.txt&quot;</span>
            <span class="n">f</span> <span class="o">=</span> <span class="n">urllib</span><span class="o">.</span><span class="n">request</span><span class="o">.</span><span class="n">urlopen</span><span class="p">(</span><span class="n">url</span><span class="p">)</span>
            <span class="n">content</span> <span class="o">=</span> <span class="n">f</span><span class="o">.</span><span class="n">read</span><span class="p">()</span>
            <span class="n">content</span> <span class="o">=</span> <span class="n">content</span><span class="o">.</span><span class="n">decode</span><span class="p">(</span><span class="s2">&quot;utf-8&quot;</span><span class="p">)</span>
            <span class="n">f</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
            <span class="k">return</span> <span class="n">content</span>

        <span class="c1"># Otherwise, return error message</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">msg</span> <span class="o">=</span> <span class="s2">&quot;No realtime forecast discussion is available for this storm.&quot;</span>
            <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span></div>

<div class="viewcode-block" id="RealtimeStorm.get_forecast_realtime"><a class="viewcode-back" href="../../../api/generated/tropycal.realtime.RealtimeStorm.get_forecast_realtime.html#tropycal.realtime.RealtimeStorm.get_forecast_realtime">[docs]</a>    <span class="k">def</span> <span class="nf">get_forecast_realtime</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">ssl_certificate</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
<span class="w">        </span><span class="sa">r</span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Retrieve a dictionary containing the latest official forecast. Available for both NHC and JTWC sources.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        ssl_certificate : boolean, optional</span>
<span class="sd">            If a JTWC forecast, this determines whether to disable SSL certificate when retrieving data from JTWC. Default is True. Use False *ONLY* if True causes an SSL certification error.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        dict</span>
<span class="sd">            Dictionary containing the latest official forecast.</span>

<span class="sd">        Notes</span>
<span class="sd">        -----</span>
<span class="sd">        This dictionary includes a calculation for accumulated cyclone energy (ACE), cumulatively for the storm&#39;s lifespan through each forecast hour. This is done by linearly interpolating the forecast to 6-hour intervals and calculating 6-hourly ACE at each interval. For storms where forecast tropical cyclone type is available, ACE is not calculated for forecast periods that are neither tropical nor subtropical.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="c1"># Check to ensure storm is not an invest</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">invest</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span>
                <span class="s2">&quot;Error: NHC does not issue advisories for invests that have not been designated as Potential Tropical Cyclones.&quot;</span><span class="p">)</span>

        <span class="c1"># NHC forecast data</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">source</span> <span class="o">==</span> <span class="s1">&#39;hurdat&#39;</span><span class="p">:</span>

            <span class="c1"># Get forecast for this storm</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">content</span> <span class="o">=</span> <span class="n">read_url</span><span class="p">(</span>
                    <span class="sa">f</span><span class="s2">&quot;https://ftp.nhc.noaa.gov/atcf/fst/</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">id</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span><span class="si">}</span><span class="s2">.fst&quot;</span><span class="p">)</span>
            <span class="k">except</span><span class="p">:</span>
                <span class="k">try</span><span class="p">:</span>
                    <span class="n">content</span> <span class="o">=</span> <span class="n">read_url</span><span class="p">(</span>
                        <span class="sa">f</span><span class="s2">&quot;ftp://ftp.nhc.noaa.gov/atcf/fst/</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">id</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span><span class="si">}</span><span class="s2">.fst&quot;</span><span class="p">)</span>
                <span class="k">except</span><span class="p">:</span>
                    <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span>
                        <span class="s2">&quot;NHC forecast data is unavailable for this storm.&quot;</span><span class="p">)</span>

            <span class="c1"># Iterate through every line in content:</span>
            <span class="n">forecasts</span> <span class="o">=</span> <span class="p">{}</span>

            <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="n">content</span><span class="p">:</span>

                <span class="c1"># Get basic components</span>
                <span class="n">lineArray</span> <span class="o">=</span> <span class="p">[</span><span class="n">i</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot; &quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">)</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">line</span><span class="p">]</span>
                <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">lineArray</span><span class="p">)</span> <span class="o">&lt;</span> <span class="mi">11</span><span class="p">:</span>
                    <span class="k">continue</span>
                <span class="k">try</span><span class="p">:</span>
                    <span class="n">basin</span><span class="p">,</span> <span class="n">number</span><span class="p">,</span> <span class="n">run_init</span><span class="p">,</span> <span class="n">n_a</span><span class="p">,</span> <span class="n">model</span><span class="p">,</span> <span class="n">fhr</span><span class="p">,</span> <span class="n">lat</span><span class="p">,</span> <span class="n">lon</span><span class="p">,</span> <span class="n">vmax</span><span class="p">,</span> <span class="n">mslp</span><span class="p">,</span> <span class="n">stype</span><span class="p">,</span> <span class="n">rad</span><span class="p">,</span> <span class="n">windcode</span><span class="p">,</span> <span class="n">neq</span><span class="p">,</span> <span class="n">seq</span><span class="p">,</span> <span class="n">swq</span><span class="p">,</span> <span class="n">nwq</span> <span class="o">=</span> <span class="n">lineArray</span><span class="p">[:</span><span class="mi">17</span><span class="p">]</span>
                    <span class="n">use_wind</span> <span class="o">=</span> <span class="kc">True</span>
                <span class="k">except</span><span class="p">:</span>
                    <span class="n">basin</span><span class="p">,</span> <span class="n">number</span><span class="p">,</span> <span class="n">run_init</span><span class="p">,</span> <span class="n">n_a</span><span class="p">,</span> <span class="n">model</span><span class="p">,</span> <span class="n">fhr</span><span class="p">,</span> <span class="n">lat</span><span class="p">,</span> <span class="n">lon</span><span class="p">,</span> <span class="n">vmax</span><span class="p">,</span> <span class="n">mslp</span><span class="p">,</span> <span class="n">stype</span> <span class="o">=</span> <span class="n">lineArray</span><span class="p">[:</span><span class="mi">11</span><span class="p">]</span>
                    <span class="n">use_wind</span> <span class="o">=</span> <span class="kc">False</span>
                <span class="k">if</span> <span class="n">model</span> <span class="ow">not</span> <span class="ow">in</span> <span class="p">[</span><span class="s2">&quot;OFCL&quot;</span><span class="p">,</span> <span class="s2">&quot;OFCI&quot;</span><span class="p">]:</span>
                    <span class="k">continue</span>

                <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">forecasts</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                    <span class="n">forecasts</span> <span class="o">=</span> <span class="p">{</span>
                        <span class="s1">&#39;init&#39;</span><span class="p">:</span> <span class="n">dt</span><span class="o">.</span><span class="n">strptime</span><span class="p">(</span><span class="n">run_init</span><span class="p">,</span> <span class="s1">&#39;%Y%m</span><span class="si">%d</span><span class="s1">%H&#39;</span><span class="p">),</span>
                        <span class="s1">&#39;fhr&#39;</span><span class="p">:</span> <span class="p">[],</span>
                        <span class="s1">&#39;lat&#39;</span><span class="p">:</span> <span class="p">[],</span>
                        <span class="s1">&#39;lon&#39;</span><span class="p">:</span> <span class="p">[],</span>
                        <span class="s1">&#39;vmax&#39;</span><span class="p">:</span> <span class="p">[],</span>
                        <span class="s1">&#39;mslp&#39;</span><span class="p">:</span> <span class="p">[],</span>
                        <span class="s1">&#39;type&#39;</span><span class="p">:</span> <span class="p">[],</span>
                        <span class="s1">&#39;windrad&#39;</span><span class="p">:</span> <span class="p">[],</span>
                        <span class="s1">&#39;cumulative_ace&#39;</span><span class="p">:</span> <span class="p">[],</span>
                        <span class="s1">&#39;cumulative_ace_fhr&#39;</span><span class="p">:</span> <span class="p">[],</span>
                    <span class="p">}</span>

                <span class="c1"># Format lat &amp; lon</span>
                <span class="n">fhr</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">fhr</span><span class="p">)</span>
                <span class="k">if</span> <span class="s2">&quot;N&quot;</span> <span class="ow">in</span> <span class="n">lat</span><span class="p">:</span>
                    <span class="n">lat_temp</span> <span class="o">=</span> <span class="n">lat</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;N&quot;</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
                    <span class="n">lat</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">round</span><span class="p">(</span><span class="nb">float</span><span class="p">(</span><span class="n">lat_temp</span><span class="p">)</span> <span class="o">*</span> <span class="mf">0.1</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
                <span class="k">elif</span> <span class="s2">&quot;S&quot;</span> <span class="ow">in</span> <span class="n">lat</span><span class="p">:</span>
                    <span class="n">lat_temp</span> <span class="o">=</span> <span class="n">lat</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;S&quot;</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
                    <span class="n">lat</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">round</span><span class="p">(</span><span class="nb">float</span><span class="p">(</span><span class="n">lat_temp</span><span class="p">)</span> <span class="o">*</span> <span class="o">-</span><span class="mf">0.1</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
                <span class="k">if</span> <span class="s2">&quot;W&quot;</span> <span class="ow">in</span> <span class="n">lon</span><span class="p">:</span>
                    <span class="n">lon_temp</span> <span class="o">=</span> <span class="n">lon</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;W&quot;</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
                    <span class="n">lon</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">round</span><span class="p">(</span><span class="nb">float</span><span class="p">(</span><span class="n">lon_temp</span><span class="p">)</span> <span class="o">*</span> <span class="o">-</span><span class="mf">0.1</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
                <span class="k">elif</span> <span class="s2">&quot;E&quot;</span> <span class="ow">in</span> <span class="n">lon</span><span class="p">:</span>
                    <span class="n">lon_temp</span> <span class="o">=</span> <span class="n">lon</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;E&quot;</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
                    <span class="n">lon</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">round</span><span class="p">(</span><span class="nb">float</span><span class="p">(</span><span class="n">lon_temp</span><span class="p">)</span> <span class="o">*</span> <span class="mf">0.1</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>

                <span class="c1"># Format vmax &amp; MSLP</span>
                <span class="k">if</span> <span class="n">vmax</span> <span class="o">==</span> <span class="s1">&#39;&#39;</span><span class="p">:</span>
                    <span class="n">vmax</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nan</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">vmax</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">vmax</span><span class="p">)</span>
                    <span class="k">if</span> <span class="n">vmax</span> <span class="o">&lt;</span> <span class="mi">10</span> <span class="ow">or</span> <span class="n">vmax</span> <span class="o">&gt;</span> <span class="mi">300</span><span class="p">:</span>
                        <span class="n">vmax</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nan</span>
                <span class="k">if</span> <span class="n">mslp</span> <span class="o">==</span> <span class="s1">&#39;&#39;</span><span class="p">:</span>
                    <span class="n">mslp</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nan</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">mslp</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">mslp</span><span class="p">)</span>
                    <span class="k">if</span> <span class="n">mslp</span> <span class="o">&lt;</span> <span class="mi">1</span><span class="p">:</span>
                        <span class="n">mslp</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nan</span>

                <span class="c1"># Format wind radii</span>
                <span class="k">if</span> <span class="n">use_wind</span><span class="p">:</span>
                    <span class="k">try</span><span class="p">:</span>
                        <span class="n">rad</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">rad</span><span class="p">)</span>
                        <span class="k">if</span> <span class="n">rad</span> <span class="ow">in</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">35</span><span class="p">]:</span>
                            <span class="n">rad</span> <span class="o">=</span> <span class="mi">34</span>
                        <span class="n">neq</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nan</span> <span class="k">if</span> <span class="n">windcode</span> <span class="o">==</span> <span class="s1">&#39;&#39;</span> <span class="k">else</span> <span class="nb">int</span><span class="p">(</span><span class="n">neq</span><span class="p">)</span>
                        <span class="n">seq</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nan</span> <span class="k">if</span> <span class="n">windcode</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="s1">&#39;AAA&#39;</span><span class="p">]</span> <span class="k">else</span> <span class="nb">int</span><span class="p">(</span><span class="n">seq</span><span class="p">)</span>
                        <span class="n">swq</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nan</span> <span class="k">if</span> <span class="n">windcode</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="s1">&#39;AAA&#39;</span><span class="p">]</span> <span class="k">else</span> <span class="nb">int</span><span class="p">(</span><span class="n">swq</span><span class="p">)</span>
                        <span class="n">nwq</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nan</span> <span class="k">if</span> <span class="n">windcode</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="s1">&#39;AAA&#39;</span><span class="p">]</span> <span class="k">else</span> <span class="nb">int</span><span class="p">(</span><span class="n">nwq</span><span class="p">)</span>
                    <span class="k">except</span><span class="p">:</span>
                        <span class="n">rad</span> <span class="o">=</span> <span class="mi">34</span>
                        <span class="n">neq</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nan</span>
                        <span class="n">seq</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nan</span>
                        <span class="n">swq</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nan</span>
                        <span class="n">nwq</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nan</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">rad</span> <span class="o">=</span> <span class="mi">34</span>
                    <span class="n">neq</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nan</span>
                    <span class="n">seq</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nan</span>
                    <span class="n">swq</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nan</span>
                    <span class="n">nwq</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nan</span>

                <span class="c1"># Add forecast data to dict if forecast hour isn&#39;t already there</span>
                <span class="k">if</span> <span class="n">fhr</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">forecasts</span><span class="p">[</span><span class="s1">&#39;fhr&#39;</span><span class="p">]:</span>
                    <span class="k">if</span> <span class="n">model</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;OFCL&#39;</span><span class="p">,</span> <span class="s1">&#39;OFCI&#39;</span><span class="p">]</span> <span class="ow">and</span> <span class="n">fhr</span> <span class="o">&gt;</span> <span class="mi">120</span><span class="p">:</span>
                        <span class="k">pass</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="k">if</span> <span class="n">lat</span> <span class="o">==</span> <span class="mf">0.0</span> <span class="ow">and</span> <span class="n">lon</span> <span class="o">==</span> <span class="mf">0.0</span><span class="p">:</span>
                            <span class="k">continue</span>
                        <span class="n">forecasts</span><span class="p">[</span><span class="s1">&#39;fhr&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">fhr</span><span class="p">)</span>
                        <span class="n">forecasts</span><span class="p">[</span><span class="s1">&#39;lat&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">lat</span><span class="p">)</span>
                        <span class="n">forecasts</span><span class="p">[</span><span class="s1">&#39;lon&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">lon</span><span class="p">)</span>
                        <span class="n">forecasts</span><span class="p">[</span><span class="s1">&#39;vmax&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">vmax</span><span class="p">)</span>
                        <span class="n">forecasts</span><span class="p">[</span><span class="s1">&#39;mslp&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">mslp</span><span class="p">)</span>
                        <span class="n">forecasts</span><span class="p">[</span><span class="s1">&#39;windrad&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
                            <span class="p">{</span><span class="n">rad</span><span class="p">:</span> <span class="p">[</span><span class="n">neq</span><span class="p">,</span> <span class="n">seq</span><span class="p">,</span> <span class="n">swq</span><span class="p">,</span> <span class="n">nwq</span><span class="p">]})</span>

                        <span class="c1"># Get storm type, if it can be determined</span>
                        <span class="k">if</span> <span class="n">stype</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="s1">&#39;DB&#39;</span><span class="p">]</span> <span class="ow">and</span> <span class="n">vmax</span> <span class="o">!=</span> <span class="mi">0</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">np</span><span class="o">.</span><span class="n">isnan</span><span class="p">(</span><span class="n">vmax</span><span class="p">):</span>
                            <span class="n">stype</span> <span class="o">=</span> <span class="n">get_storm_type</span><span class="p">(</span><span class="n">vmax</span><span class="p">,</span> <span class="kc">False</span><span class="p">)</span>
                        <span class="n">forecasts</span><span class="p">[</span><span class="s1">&#39;type&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">stype</span><span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">ifhr</span> <span class="o">=</span> <span class="n">forecasts</span><span class="p">[</span><span class="s1">&#39;fhr&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="n">fhr</span><span class="p">)</span>
                    <span class="n">forecasts</span><span class="p">[</span><span class="s1">&#39;windrad&#39;</span><span class="p">][</span><span class="n">ifhr</span><span class="p">][</span><span class="n">rad</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="n">neq</span><span class="p">,</span> <span class="n">seq</span><span class="p">,</span> <span class="n">swq</span><span class="p">,</span> <span class="n">nwq</span><span class="p">]</span>

        <span class="c1"># Retrieve JTWC forecast otherwise</span>
        <span class="k">else</span><span class="p">:</span>

            <span class="c1"># Get forecast for this storm</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">jtwc_source</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;jtwc&#39;</span><span class="p">,</span> <span class="s1">&#39;ucar&#39;</span><span class="p">]:</span>
                <span class="n">url</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;https://www.nrlmry.navy.mil/atcf_web/docs/current_storms/</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">id</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span><span class="si">}</span><span class="s2">.sum&quot;</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">url</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;https://www.ssd.noaa.gov/PS/TROP/DATA/ATCF/JTWC/</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">id</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span><span class="si">}</span><span class="s2">.fst&quot;</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">ssl_certificate</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">jtwc_source</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;jtwc&#39;</span><span class="p">,</span> <span class="s1">&#39;ucar&#39;</span><span class="p">]:</span>
                <span class="kn">import</span> <span class="nn">ssl</span>
                <span class="k">if</span> <span class="n">requests</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">url</span><span class="p">,</span> <span class="n">verify</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span><span class="o">.</span><span class="n">status_code</span> <span class="o">!=</span> <span class="mi">200</span><span class="p">:</span>
                    <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span>
                        <span class="s2">&quot;JTWC forecast data is unavailable for this storm.&quot;</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">requests</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">url</span><span class="p">)</span><span class="o">.</span><span class="n">status_code</span> <span class="o">!=</span> <span class="mi">200</span><span class="p">:</span>
                    <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span>
                        <span class="s2">&quot;JTWC forecast data is unavailable for this storm.&quot;</span><span class="p">)</span>

            <span class="c1"># Read file content</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">ssl_certificate</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">jtwc_source</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;jtwc&#39;</span><span class="p">,</span> <span class="s1">&#39;ucar&#39;</span><span class="p">]:</span>
                <span class="kn">import</span> <span class="nn">ssl</span>
                <span class="n">f</span> <span class="o">=</span> <span class="n">urllib</span><span class="o">.</span><span class="n">request</span><span class="o">.</span><span class="n">urlopen</span><span class="p">(</span>
                    <span class="n">url</span><span class="p">,</span> <span class="n">context</span><span class="o">=</span><span class="n">ssl</span><span class="o">.</span><span class="n">_create_unverified_context</span><span class="p">())</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">f</span> <span class="o">=</span> <span class="n">urllib</span><span class="o">.</span><span class="n">request</span><span class="o">.</span><span class="n">urlopen</span><span class="p">(</span><span class="n">url</span><span class="p">)</span>
            <span class="n">content</span> <span class="o">=</span> <span class="n">f</span><span class="o">.</span><span class="n">read</span><span class="p">()</span>
            <span class="n">content</span> <span class="o">=</span> <span class="n">content</span><span class="o">.</span><span class="n">decode</span><span class="p">(</span><span class="s2">&quot;utf-8&quot;</span><span class="p">)</span>
            <span class="n">content</span> <span class="o">=</span> <span class="n">content</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
            <span class="n">f</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>

            <span class="c1"># Find starting index</span>
            <span class="n">start_idx</span> <span class="o">=</span> <span class="mi">0</span>
            <span class="k">for</span> <span class="n">idx</span><span class="p">,</span> <span class="n">line</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">content</span><span class="p">):</span>
                <span class="n">lineArray</span> <span class="o">=</span> <span class="n">line</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot; &quot;</span><span class="p">)</span>
                <span class="k">if</span> <span class="s1">&#39;WARNING&#39;</span> <span class="ow">in</span> <span class="n">lineArray</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="ow">and</span> <span class="nb">len</span><span class="p">(</span><span class="n">lineArray</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">2</span><span class="p">:</span>
                    <span class="n">start_idx</span> <span class="o">=</span> <span class="n">idx</span>
                    <span class="k">break</span>

            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">jtwc_source</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;jtwc&#39;</span><span class="p">,</span> <span class="s1">&#39;ucar&#39;</span><span class="p">]:</span>
                <span class="c1"># Iterate through every line in content:</span>
                <span class="n">run_init</span> <span class="o">=</span> <span class="n">content</span><span class="p">[</span><span class="n">start_idx</span><span class="o">+</span><span class="mi">2</span><span class="p">]</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot; &quot;</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
                <span class="n">forecasts</span> <span class="o">=</span> <span class="p">{}</span>

                <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="n">content</span><span class="p">[</span><span class="n">start_idx</span><span class="o">+</span><span class="mi">3</span><span class="p">:]:</span>

                    <span class="c1"># Exit once done retrieving forecast</span>
                    <span class="k">if</span> <span class="n">line</span> <span class="o">==</span> <span class="s2">&quot;AMP&quot;</span><span class="p">:</span>
                        <span class="k">break</span>

                    <span class="c1"># Get basic components</span>
                    <span class="n">lineArray</span> <span class="o">=</span> <span class="n">line</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot; &quot;</span><span class="p">)</span>
                    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">lineArray</span><span class="p">)</span> <span class="o">&lt;</span> <span class="mi">4</span><span class="p">:</span>
                        <span class="k">continue</span>

                    <span class="c1"># Exit once done retrieving forecast</span>
                    <span class="k">if</span> <span class="n">lineArray</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;AMP&quot;</span><span class="p">:</span>
                        <span class="k">break</span>

                    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">forecasts</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                        <span class="n">forecasts</span> <span class="o">=</span> <span class="p">{</span>
                            <span class="s1">&#39;init&#39;</span><span class="p">:</span> <span class="n">dt</span><span class="o">.</span><span class="n">strptime</span><span class="p">(</span><span class="n">run_init</span><span class="p">,</span> <span class="s1">&#39;%Y%m</span><span class="si">%d</span><span class="s1">%H&#39;</span><span class="p">),</span>
                            <span class="s1">&#39;fhr&#39;</span><span class="p">:</span> <span class="p">[],</span>
                            <span class="s1">&#39;lat&#39;</span><span class="p">:</span> <span class="p">[],</span>
                            <span class="s1">&#39;lon&#39;</span><span class="p">:</span> <span class="p">[],</span>
                            <span class="s1">&#39;vmax&#39;</span><span class="p">:</span> <span class="p">[],</span>
                            <span class="s1">&#39;mslp&#39;</span><span class="p">:</span> <span class="p">[],</span>
                            <span class="s1">&#39;windrad&#39;</span><span class="p">:</span> <span class="p">[],</span>
                            <span class="s1">&#39;cumulative_ace&#39;</span><span class="p">:</span> <span class="p">[],</span>
                            <span class="s1">&#39;cumulative_ace_fhr&#39;</span><span class="p">:</span> <span class="p">[],</span>
                            <span class="s1">&#39;type&#39;</span><span class="p">:</span> <span class="p">[]</span>
                        <span class="p">}</span>

                    <span class="c1"># Forecast hour</span>
                    <span class="n">fhr</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">lineArray</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;T&quot;</span><span class="p">)[</span><span class="mi">1</span><span class="p">])</span>

                    <span class="c1"># Format lat &amp; lon</span>
                    <span class="n">lat</span> <span class="o">=</span> <span class="n">lineArray</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
                    <span class="n">lon</span> <span class="o">=</span> <span class="n">lineArray</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span>
                    <span class="k">if</span> <span class="s2">&quot;N&quot;</span> <span class="ow">in</span> <span class="n">lat</span><span class="p">:</span>
                        <span class="n">lat_temp</span> <span class="o">=</span> <span class="n">lat</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;N&quot;</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
                        <span class="n">lat</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">round</span><span class="p">(</span><span class="nb">float</span><span class="p">(</span><span class="n">lat_temp</span><span class="p">)</span> <span class="o">*</span> <span class="mf">0.1</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
                    <span class="k">elif</span> <span class="s2">&quot;S&quot;</span> <span class="ow">in</span> <span class="n">lat</span><span class="p">:</span>
                        <span class="n">lat_temp</span> <span class="o">=</span> <span class="n">lat</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;S&quot;</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
                        <span class="n">lat</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">round</span><span class="p">(</span><span class="nb">float</span><span class="p">(</span><span class="n">lat_temp</span><span class="p">)</span> <span class="o">*</span> <span class="o">-</span><span class="mf">0.1</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
                    <span class="k">if</span> <span class="s2">&quot;W&quot;</span> <span class="ow">in</span> <span class="n">lon</span><span class="p">:</span>
                        <span class="n">lon_temp</span> <span class="o">=</span> <span class="n">lon</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;W&quot;</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
                        <span class="n">lon</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">round</span><span class="p">(</span><span class="nb">float</span><span class="p">(</span><span class="n">lon_temp</span><span class="p">)</span> <span class="o">*</span> <span class="o">-</span><span class="mf">0.1</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
                    <span class="k">elif</span> <span class="s2">&quot;E&quot;</span> <span class="ow">in</span> <span class="n">lon</span><span class="p">:</span>
                        <span class="n">lon_temp</span> <span class="o">=</span> <span class="n">lon</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;E&quot;</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
                        <span class="n">lon</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">round</span><span class="p">(</span><span class="nb">float</span><span class="p">(</span><span class="n">lon_temp</span><span class="p">)</span> <span class="o">*</span> <span class="mf">0.1</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>

                    <span class="c1"># Format vmax &amp; MSLP</span>
                    <span class="n">vmax</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">lineArray</span><span class="p">[</span><span class="mi">3</span><span class="p">])</span>
                    <span class="k">if</span> <span class="n">vmax</span> <span class="o">&lt;</span> <span class="mi">10</span> <span class="ow">or</span> <span class="n">vmax</span> <span class="o">&gt;</span> <span class="mi">300</span><span class="p">:</span>
                        <span class="n">vmax</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nan</span>
                    <span class="n">mslp</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nan</span>

                    <span class="c1"># Format wind radii</span>
                    <span class="n">windrad</span> <span class="o">=</span> <span class="p">{}</span>
                    <span class="k">for</span> <span class="n">rad</span> <span class="ow">in</span> <span class="p">(</span><span class="mi">34</span><span class="p">,</span> <span class="mi">50</span><span class="p">,</span> <span class="mi">64</span><span class="p">):</span>
                        <span class="k">try</span><span class="p">:</span>
                            <span class="n">irad</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">lineArray</span><span class="p">)</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;R</span><span class="si">{</span><span class="n">rad</span><span class="si">:</span><span class="s1">03</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
                            <span class="n">windrad</span><span class="p">[</span><span class="n">rad</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="nb">int</span><span class="p">(</span><span class="n">lineArray</span><span class="p">[</span><span class="n">irad</span><span class="o">+</span><span class="n">j</span><span class="p">])</span>
                                            <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">7</span><span class="p">,</span> <span class="mi">10</span><span class="p">)]</span>
                        <span class="k">except</span><span class="p">:</span>
                            <span class="k">continue</span>

                    <span class="c1"># Add forecast data to dict if forecast hour isn&#39;t already there</span>
                    <span class="k">if</span> <span class="n">fhr</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">forecasts</span><span class="p">[</span><span class="s1">&#39;fhr&#39;</span><span class="p">]:</span>
                        <span class="k">if</span> <span class="n">lat</span> <span class="o">==</span> <span class="mf">0.0</span> <span class="ow">and</span> <span class="n">lon</span> <span class="o">==</span> <span class="mf">0.0</span><span class="p">:</span>
                            <span class="k">continue</span>
                        <span class="n">forecasts</span><span class="p">[</span><span class="s1">&#39;fhr&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">fhr</span><span class="p">)</span>
                        <span class="n">forecasts</span><span class="p">[</span><span class="s1">&#39;lat&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">lat</span><span class="p">)</span>
                        <span class="n">forecasts</span><span class="p">[</span><span class="s1">&#39;lon&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">lon</span><span class="p">)</span>
                        <span class="n">forecasts</span><span class="p">[</span><span class="s1">&#39;vmax&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">vmax</span><span class="p">)</span>
                        <span class="n">forecasts</span><span class="p">[</span><span class="s1">&#39;mslp&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">mslp</span><span class="p">)</span>
                        <span class="n">forecasts</span><span class="p">[</span><span class="s1">&#39;windrad&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">windrad</span><span class="p">)</span>

                        <span class="c1"># Get storm type, if it can be determined</span>
                        <span class="n">stype</span> <span class="o">=</span> <span class="n">get_storm_type</span><span class="p">(</span><span class="n">vmax</span><span class="p">,</span> <span class="kc">False</span><span class="p">)</span>
                        <span class="n">forecasts</span><span class="p">[</span><span class="s1">&#39;type&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">stype</span><span class="p">)</span>

            <span class="k">else</span><span class="p">:</span>

                <span class="n">content</span> <span class="o">=</span> <span class="p">[(</span><span class="n">i</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot; &quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">))</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;,&quot;</span><span class="p">)</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">content</span><span class="p">]</span>

                <span class="c1"># Iterate through every line in content:</span>
                <span class="n">forecasts</span> <span class="o">=</span> <span class="p">{}</span>

                <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="n">content</span><span class="p">:</span>

                    <span class="c1"># Get basic components</span>
                    <span class="n">lineArray</span> <span class="o">=</span> <span class="p">[</span><span class="n">i</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot; &quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">)</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">line</span><span class="p">]</span>
                    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">lineArray</span><span class="p">)</span> <span class="o">&lt;</span> <span class="mi">11</span><span class="p">:</span>
                        <span class="k">continue</span>
                    <span class="k">try</span><span class="p">:</span>
                        <span class="n">basin</span><span class="p">,</span> <span class="n">number</span><span class="p">,</span> <span class="n">run_init</span><span class="p">,</span> <span class="n">n_a</span><span class="p">,</span> <span class="n">model</span><span class="p">,</span> <span class="n">fhr</span><span class="p">,</span> <span class="n">lat</span><span class="p">,</span> <span class="n">lon</span><span class="p">,</span> <span class="n">vmax</span><span class="p">,</span> <span class="n">mslp</span><span class="p">,</span> <span class="n">stype</span><span class="p">,</span> <span class="n">rad</span><span class="p">,</span> <span class="n">windcode</span><span class="p">,</span> <span class="n">neq</span><span class="p">,</span> <span class="n">seq</span><span class="p">,</span> <span class="n">swq</span><span class="p">,</span> <span class="n">nwq</span> <span class="o">=</span> <span class="n">lineArray</span><span class="p">[</span> <span class="p">:</span><span class="mi">17</span><span class="p">]</span>
                        <span class="n">use_wind</span> <span class="o">=</span> <span class="kc">True</span>
                    <span class="k">except</span><span class="p">:</span>
                        <span class="n">basin</span><span class="p">,</span> <span class="n">number</span><span class="p">,</span> <span class="n">run_init</span><span class="p">,</span> <span class="n">n_a</span><span class="p">,</span> <span class="n">model</span><span class="p">,</span> <span class="n">fhr</span><span class="p">,</span> <span class="n">lat</span><span class="p">,</span> <span class="n">lon</span><span class="p">,</span> <span class="n">vmax</span><span class="p">,</span> <span class="n">mslp</span><span class="p">,</span> <span class="n">stype</span> <span class="o">=</span> <span class="n">lineArray</span><span class="p">[:</span><span class="mi">11</span><span class="p">]</span>
                        <span class="n">use_wind</span> <span class="o">=</span> <span class="kc">False</span>
                    <span class="k">if</span> <span class="n">model</span> <span class="ow">not</span> <span class="ow">in</span> <span class="p">[</span><span class="s2">&quot;JTWC&quot;</span><span class="p">]:</span>
                        <span class="k">continue</span>

                    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">forecasts</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                        <span class="n">forecasts</span> <span class="o">=</span> <span class="p">{</span>
                            <span class="s1">&#39;init&#39;</span><span class="p">:</span> <span class="n">dt</span><span class="o">.</span><span class="n">strptime</span><span class="p">(</span><span class="n">run_init</span><span class="p">,</span> <span class="s1">&#39;%Y%m</span><span class="si">%d</span><span class="s1">%H&#39;</span><span class="p">),</span>
                            <span class="s1">&#39;fhr&#39;</span><span class="p">:</span> <span class="p">[],</span>
                            <span class="s1">&#39;lat&#39;</span><span class="p">:</span> <span class="p">[],</span>
                            <span class="s1">&#39;lon&#39;</span><span class="p">:</span> <span class="p">[],</span>
                            <span class="s1">&#39;vmax&#39;</span><span class="p">:</span> <span class="p">[],</span>
                            <span class="s1">&#39;mslp&#39;</span><span class="p">:</span> <span class="p">[],</span>
                            <span class="s1">&#39;type&#39;</span><span class="p">:</span> <span class="p">[],</span>
                            <span class="s1">&#39;windrad&#39;</span><span class="p">:</span> <span class="p">[],</span>
                            <span class="s1">&#39;cumulative_ace&#39;</span><span class="p">:</span> <span class="p">[],</span>
                            <span class="s1">&#39;cumulative_ace_fhr&#39;</span><span class="p">:</span> <span class="p">[]</span>
                        <span class="p">}</span>

                    <span class="c1"># Format lat &amp; lon</span>
                    <span class="n">fhr</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">fhr</span><span class="p">)</span>
                    <span class="k">if</span> <span class="s2">&quot;N&quot;</span> <span class="ow">in</span> <span class="n">lat</span><span class="p">:</span>
                        <span class="n">lat_temp</span> <span class="o">=</span> <span class="n">lat</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;N&quot;</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
                        <span class="n">lat</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">round</span><span class="p">(</span><span class="nb">float</span><span class="p">(</span><span class="n">lat_temp</span><span class="p">)</span> <span class="o">*</span> <span class="mf">0.1</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
                    <span class="k">elif</span> <span class="s2">&quot;S&quot;</span> <span class="ow">in</span> <span class="n">lat</span><span class="p">:</span>
                        <span class="n">lat_temp</span> <span class="o">=</span> <span class="n">lat</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;S&quot;</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
                        <span class="n">lat</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">round</span><span class="p">(</span><span class="nb">float</span><span class="p">(</span><span class="n">lat_temp</span><span class="p">)</span> <span class="o">*</span> <span class="o">-</span><span class="mf">0.1</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
                    <span class="k">if</span> <span class="s2">&quot;W&quot;</span> <span class="ow">in</span> <span class="n">lon</span><span class="p">:</span>
                        <span class="n">lon_temp</span> <span class="o">=</span> <span class="n">lon</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;W&quot;</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
                        <span class="n">lon</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">round</span><span class="p">(</span><span class="nb">float</span><span class="p">(</span><span class="n">lon_temp</span><span class="p">)</span> <span class="o">*</span> <span class="o">-</span><span class="mf">0.1</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
                    <span class="k">elif</span> <span class="s2">&quot;E&quot;</span> <span class="ow">in</span> <span class="n">lon</span><span class="p">:</span>
                        <span class="n">lon_temp</span> <span class="o">=</span> <span class="n">lon</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;E&quot;</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
                        <span class="n">lon</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">round</span><span class="p">(</span><span class="nb">float</span><span class="p">(</span><span class="n">lon_temp</span><span class="p">)</span> <span class="o">*</span> <span class="mf">0.1</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>

                    <span class="c1"># Format vmax &amp; MSLP</span>
                    <span class="k">if</span> <span class="n">vmax</span> <span class="o">==</span> <span class="s1">&#39;&#39;</span><span class="p">:</span>
                        <span class="n">vmax</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nan</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="n">vmax</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">vmax</span><span class="p">)</span>
                        <span class="k">if</span> <span class="n">vmax</span> <span class="o">&lt;</span> <span class="mi">10</span> <span class="ow">or</span> <span class="n">vmax</span> <span class="o">&gt;</span> <span class="mi">300</span><span class="p">:</span>
                            <span class="n">vmax</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nan</span>
                    <span class="k">if</span> <span class="n">mslp</span> <span class="o">==</span> <span class="s1">&#39;&#39;</span><span class="p">:</span>
                        <span class="n">mslp</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nan</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="n">mslp</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">mslp</span><span class="p">)</span>
                        <span class="k">if</span> <span class="n">mslp</span> <span class="o">&lt;</span> <span class="mi">1</span><span class="p">:</span>
                            <span class="n">mslp</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nan</span>

                    <span class="c1"># Format wind radii</span>
                    <span class="k">if</span> <span class="n">use_wind</span><span class="p">:</span>
                        <span class="k">try</span><span class="p">:</span>
                            <span class="n">rad</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">rad</span><span class="p">)</span>
                            <span class="k">if</span> <span class="n">rad</span> <span class="ow">in</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">35</span><span class="p">]:</span>
                                <span class="n">rad</span> <span class="o">=</span> <span class="mi">34</span>
                            <span class="n">neq</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nan</span> <span class="k">if</span> <span class="n">windcode</span> <span class="o">==</span> <span class="s1">&#39;&#39;</span> <span class="k">else</span> <span class="nb">int</span><span class="p">(</span><span class="n">neq</span><span class="p">)</span>
                            <span class="n">seq</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nan</span> <span class="k">if</span> <span class="n">windcode</span> <span class="ow">in</span> <span class="p">[</span>
                                <span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="s1">&#39;AAA&#39;</span><span class="p">]</span> <span class="k">else</span> <span class="nb">int</span><span class="p">(</span><span class="n">seq</span><span class="p">)</span>
                            <span class="n">swq</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nan</span> <span class="k">if</span> <span class="n">windcode</span> <span class="ow">in</span> <span class="p">[</span>
                                <span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="s1">&#39;AAA&#39;</span><span class="p">]</span> <span class="k">else</span> <span class="nb">int</span><span class="p">(</span><span class="n">swq</span><span class="p">)</span>
                            <span class="n">nwq</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nan</span> <span class="k">if</span> <span class="n">windcode</span> <span class="ow">in</span> <span class="p">[</span>
                                <span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="s1">&#39;AAA&#39;</span><span class="p">]</span> <span class="k">else</span> <span class="nb">int</span><span class="p">(</span><span class="n">nwq</span><span class="p">)</span>
                        <span class="k">except</span><span class="p">:</span>
                            <span class="n">rad</span> <span class="o">=</span> <span class="mi">34</span>
                            <span class="n">neq</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nan</span>
                            <span class="n">seq</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nan</span>
                            <span class="n">swq</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nan</span>
                            <span class="n">nwq</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nan</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="n">rad</span> <span class="o">=</span> <span class="mi">34</span>
                        <span class="n">neq</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nan</span>
                        <span class="n">seq</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nan</span>
                        <span class="n">swq</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nan</span>
                        <span class="n">nwq</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nan</span>

                    <span class="c1"># Add forecast data to dict if forecast hour isn&#39;t already there</span>
                    <span class="k">if</span> <span class="n">fhr</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">forecasts</span><span class="p">[</span><span class="s1">&#39;fhr&#39;</span><span class="p">]:</span>
                        <span class="k">if</span> <span class="n">model</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;OFCL&#39;</span><span class="p">,</span> <span class="s1">&#39;OFCI&#39;</span><span class="p">]</span> <span class="ow">and</span> <span class="n">fhr</span> <span class="o">&gt;</span> <span class="mi">120</span><span class="p">:</span>
                            <span class="k">pass</span>
                        <span class="k">else</span><span class="p">:</span>
                            <span class="k">if</span> <span class="n">lat</span> <span class="o">==</span> <span class="mf">0.0</span> <span class="ow">and</span> <span class="n">lon</span> <span class="o">==</span> <span class="mf">0.0</span><span class="p">:</span>
                                <span class="k">continue</span>
                            <span class="n">forecasts</span><span class="p">[</span><span class="s1">&#39;fhr&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">fhr</span><span class="p">)</span>
                            <span class="n">forecasts</span><span class="p">[</span><span class="s1">&#39;lat&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">lat</span><span class="p">)</span>
                            <span class="n">forecasts</span><span class="p">[</span><span class="s1">&#39;lon&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">lon</span><span class="p">)</span>
                            <span class="n">forecasts</span><span class="p">[</span><span class="s1">&#39;vmax&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">vmax</span><span class="p">)</span>
                            <span class="n">forecasts</span><span class="p">[</span><span class="s1">&#39;mslp&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">mslp</span><span class="p">)</span>
                            <span class="n">forecasts</span><span class="p">[</span><span class="s1">&#39;windrad&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
                                <span class="p">{</span><span class="n">rad</span><span class="p">:</span> <span class="p">[</span><span class="n">neq</span><span class="p">,</span> <span class="n">seq</span><span class="p">,</span> <span class="n">swq</span><span class="p">,</span> <span class="n">nwq</span><span class="p">]})</span>

                            <span class="c1"># Get storm type, if it can be determined</span>
                            <span class="k">if</span> <span class="n">stype</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="s1">&#39;DB&#39;</span><span class="p">]</span> <span class="ow">and</span> <span class="n">vmax</span> <span class="o">!=</span> <span class="mi">0</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">np</span><span class="o">.</span><span class="n">isnan</span><span class="p">(</span><span class="n">vmax</span><span class="p">):</span>
                                <span class="n">stype</span> <span class="o">=</span> <span class="n">get_storm_type</span><span class="p">(</span><span class="n">vmax</span><span class="p">,</span> <span class="kc">False</span><span class="p">)</span>
                            <span class="n">forecasts</span><span class="p">[</span><span class="s1">&#39;type&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">stype</span><span class="p">)</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="n">ifhr</span> <span class="o">=</span> <span class="n">forecasts</span><span class="p">[</span><span class="s1">&#39;fhr&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="n">fhr</span><span class="p">)</span>
                        <span class="n">forecasts</span><span class="p">[</span><span class="s1">&#39;windrad&#39;</span><span class="p">][</span><span class="n">ifhr</span><span class="p">][</span><span class="n">rad</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="n">neq</span><span class="p">,</span> <span class="n">seq</span><span class="p">,</span> <span class="n">swq</span><span class="p">,</span> <span class="n">nwq</span><span class="p">]</span>

        <span class="c1"># Determine ACE thus far (prior to initial forecast hour)</span>
        <span class="n">ace</span> <span class="o">=</span> <span class="mf">0.0</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">time</span><span class="p">)):</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">time</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">&gt;=</span> <span class="n">forecasts</span><span class="p">[</span><span class="s1">&#39;init&#39;</span><span class="p">]:</span>
                <span class="k">continue</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">type</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">constants</span><span class="o">.</span><span class="n">NAMED_TROPICAL_STORM_TYPES</span><span class="p">:</span>
                <span class="k">continue</span>
            <span class="n">ace</span> <span class="o">+=</span> <span class="n">accumulated_cyclone_energy</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">vmax</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">hours</span><span class="o">=</span><span class="mi">6</span><span class="p">)</span>

        <span class="c1"># Add initial forecast hour ACE</span>
        <span class="n">ace</span> <span class="o">+=</span> <span class="n">accumulated_cyclone_energy</span><span class="p">(</span><span class="n">forecasts</span><span class="p">[</span><span class="s1">&#39;vmax&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">],</span> <span class="n">hours</span><span class="o">=</span><span class="mi">6</span><span class="p">)</span>
        <span class="n">forecasts</span><span class="p">[</span><span class="s1">&#39;cumulative_ace_fhr&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
        <span class="n">forecasts</span><span class="p">[</span><span class="s1">&#39;cumulative_ace&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">round</span><span class="p">(</span><span class="n">ace</span><span class="p">,</span> <span class="mi">1</span><span class="p">))</span>

        <span class="c1"># Interpolate forecast to 6-hour increments</span>
        <span class="k">def</span> <span class="nf">temporal_interpolation</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="n">orig_times</span><span class="p">,</span> <span class="n">target_times</span><span class="p">,</span> <span class="n">kind</span><span class="o">=</span><span class="s1">&#39;linear&#39;</span><span class="p">):</span>
            <span class="n">f</span> <span class="o">=</span> <span class="n">interp</span><span class="o">.</span><span class="n">interp1d</span><span class="p">(</span><span class="n">orig_times</span><span class="p">,</span> <span class="n">value</span><span class="p">,</span> <span class="n">kind</span><span class="o">=</span><span class="n">kind</span><span class="p">,</span>
                                <span class="n">fill_value</span><span class="o">=</span><span class="s1">&#39;extrapolate&#39;</span><span class="p">)</span>
            <span class="n">ynew</span> <span class="o">=</span> <span class="n">f</span><span class="p">(</span><span class="n">target_times</span><span class="p">)</span>
            <span class="k">return</span> <span class="n">ynew</span>
        <span class="c1"># Construct a 6-hour time range</span>
        <span class="n">interp_fhr</span> <span class="o">=</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">forecasts</span><span class="p">[</span><span class="s1">&#39;fhr&#39;</span><span class="p">][</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span> <span class="mi">6</span><span class="p">)</span>
        <span class="n">interp_vmax</span> <span class="o">=</span> <span class="n">temporal_interpolation</span><span class="p">(</span>
            <span class="n">forecasts</span><span class="p">[</span><span class="s1">&#39;vmax&#39;</span><span class="p">],</span> <span class="n">forecasts</span><span class="p">[</span><span class="s1">&#39;fhr&#39;</span><span class="p">],</span> <span class="n">interp_fhr</span><span class="p">)</span>

        <span class="c1"># Interpolate storm type</span>
        <span class="n">interp_type</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">dummy_i</span><span class="p">,</span> <span class="p">(</span><span class="n">i_hour</span><span class="p">,</span> <span class="n">i_vmax</span><span class="p">)</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="nb">zip</span><span class="p">(</span><span class="n">interp_fhr</span><span class="p">,</span> <span class="n">interp_vmax</span><span class="p">)):</span>
            <span class="n">use_i</span> <span class="o">=</span> <span class="mi">0</span>
            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">forecasts</span><span class="p">[</span><span class="s1">&#39;fhr&#39;</span><span class="p">])):</span>
                <span class="k">if</span> <span class="n">forecasts</span><span class="p">[</span><span class="s1">&#39;fhr&#39;</span><span class="p">][</span><span class="n">i</span><span class="p">]</span> <span class="o">&gt;</span> <span class="n">i_hour</span><span class="p">:</span>
                    <span class="k">break</span>
                <span class="n">use_i</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">i</span> <span class="o">+</span> <span class="mf">0.0</span><span class="p">)</span>
            <span class="n">i_type</span> <span class="o">=</span> <span class="n">forecasts</span><span class="p">[</span><span class="s1">&#39;type&#39;</span><span class="p">][</span><span class="n">use_i</span><span class="p">]</span>
            <span class="k">if</span> <span class="n">i_type</span> <span class="ow">in</span> <span class="n">constants</span><span class="o">.</span><span class="n">TROPICAL_STORM_TYPES</span><span class="p">:</span>
                <span class="n">i_type</span> <span class="o">=</span> <span class="n">get_storm_type</span><span class="p">(</span><span class="n">i_vmax</span><span class="p">,</span> <span class="kc">False</span><span class="p">)</span>
            <span class="n">interp_type</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">i_type</span><span class="p">)</span>

        <span class="c1"># Add forecast ACE</span>
        <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="p">(</span><span class="n">i_fhr</span><span class="p">,</span> <span class="n">i_vmax</span><span class="p">,</span> <span class="n">i_type</span><span class="p">)</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="nb">zip</span><span class="p">(</span><span class="n">interp_fhr</span><span class="p">[</span><span class="mi">1</span><span class="p">:],</span> <span class="n">interp_vmax</span><span class="p">[</span><span class="mi">1</span><span class="p">:],</span> <span class="n">interp_type</span><span class="p">[</span><span class="mi">1</span><span class="p">:])):</span>

            <span class="c1"># Add ACE if storm is a TC</span>
            <span class="k">if</span> <span class="n">i_type</span> <span class="ow">in</span> <span class="n">constants</span><span class="o">.</span><span class="n">NAMED_TROPICAL_STORM_TYPES</span><span class="p">:</span>
                <span class="n">ace</span> <span class="o">+=</span> <span class="n">accumulated_cyclone_energy</span><span class="p">(</span><span class="n">i_vmax</span><span class="p">,</span> <span class="n">hours</span><span class="o">=</span><span class="mi">6</span><span class="p">)</span>

            <span class="c1"># Add ACE to array</span>
            <span class="k">if</span> <span class="n">i_fhr</span> <span class="ow">in</span> <span class="n">forecasts</span><span class="p">[</span><span class="s1">&#39;fhr&#39;</span><span class="p">]:</span>
                <span class="n">forecasts</span><span class="p">[</span><span class="s1">&#39;cumulative_ace&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">round</span><span class="p">(</span><span class="n">ace</span><span class="p">,</span> <span class="mi">1</span><span class="p">))</span>
                <span class="n">forecasts</span><span class="p">[</span><span class="s1">&#39;cumulative_ace_fhr&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">i_fhr</span><span class="p">)</span>

        <span class="c1"># Save forecast as attribute</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">latest_forecast</span> <span class="o">=</span> <span class="n">forecasts</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">latest_forecast</span></div>

<div class="viewcode-block" id="RealtimeStorm.plot_forecast_realtime"><a class="viewcode-back" href="../../../api/generated/tropycal.realtime.RealtimeStorm.plot_forecast_realtime.html#tropycal.realtime.RealtimeStorm.plot_forecast_realtime">[docs]</a>    <span class="k">def</span> <span class="nf">plot_forecast_realtime</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">track_labels</span><span class="o">=</span><span class="s1">&#39;fhr&#39;</span><span class="p">,</span> <span class="n">cone_days</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span> <span class="n">domain</span><span class="o">=</span><span class="s2">&quot;dynamic_forecast&quot;</span><span class="p">,</span>
                               <span class="n">ax</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">cartopy_proj</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">save_path</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">ssl_certificate</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
<span class="w">        </span><span class="sa">r</span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Plots the latest available official forecast. Available for both NHC and JTWC sources.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        track_labels : str</span>
<span class="sd">            Label forecast hours with the following methods:</span>

<span class="sd">            * **&quot;&quot;** = no label</span>
<span class="sd">            * **&quot;fhr&quot;** = forecast hour (default)</span>
<span class="sd">            * **&quot;valid_utc&quot;** = UTC valid time</span>
<span class="sd">            * **&quot;valid_edt&quot;** = EDT valid time</span>
<span class="sd">        cone_days : int</span>
<span class="sd">            Number of days to plot the forecast cone. Default is 5 days. Can select 2, 3, 4 or 5 days.</span>
<span class="sd">        domain : str</span>
<span class="sd">            Domain for the plot. Default is &quot;dynamic_forecast&quot;. Please refer to :ref:`options-domain` for available domain options.</span>
<span class="sd">        ax : axes</span>
<span class="sd">            Instance of axes to plot on. If none, one will be generated. Default is none.</span>
<span class="sd">        cartopy_proj : ccrs</span>
<span class="sd">            Instance of a cartopy projection to use. If none, one will be generated. Default is none.</span>
<span class="sd">        save_path : str</span>
<span class="sd">            Relative or full path of directory to save the image in. If none, image will not be saved.</span>

<span class="sd">        Other Parameters</span>
<span class="sd">        ----------------</span>
<span class="sd">        ssl_certificate : boolean, optional</span>
<span class="sd">            If a JTWC forecast, this determines whether to disable SSL certificate when retrieving data from JTWC. Default is True. Use False *ONLY* if True causes an SSL certification error.</span>
<span class="sd">        prop : dict</span>
<span class="sd">            Property of storm track lines.</span>
<span class="sd">        map_prop : dict</span>
<span class="sd">            Property of cartopy map.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        ax</span>
<span class="sd">            Instance of axes containing the plot is returned.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="c1"># Retrieve kwargs</span>
        <span class="n">prop</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;prop&#39;</span><span class="p">,</span> <span class="p">{})</span>
        <span class="n">map_prop</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;map_prop&#39;</span><span class="p">,</span> <span class="p">{})</span>

        <span class="c1"># Check to ensure storm is not an invest</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">invest</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span>
                <span class="s2">&quot;Error: NHC does not issue advisories for invests that have not been designated as Potential Tropical Cyclones.&quot;</span><span class="p">)</span>

        <span class="c1"># Create instance of plot object</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">plot_obj</span>
        <span class="k">except</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">plot_obj</span> <span class="o">=</span> <span class="n">TrackPlot</span><span class="p">()</span>

        <span class="c1"># Create cartopy projection</span>
        <span class="k">if</span> <span class="n">cartopy_proj</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">if</span> <span class="nb">max</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">dict</span><span class="p">[</span><span class="s1">&#39;lon&#39;</span><span class="p">])</span> <span class="o">&gt;</span> <span class="mi">140</span> <span class="ow">or</span> <span class="nb">min</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">dict</span><span class="p">[</span><span class="s1">&#39;lon&#39;</span><span class="p">])</span> <span class="o">&lt;</span> <span class="o">-</span><span class="mi">140</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">plot_obj</span><span class="o">.</span><span class="n">create_cartopy</span><span class="p">(</span>
                    <span class="n">proj</span><span class="o">=</span><span class="s1">&#39;PlateCarree&#39;</span><span class="p">,</span> <span class="n">central_longitude</span><span class="o">=</span><span class="mf">180.0</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">plot_obj</span><span class="o">.</span><span class="n">create_cartopy</span><span class="p">(</span>
                    <span class="n">proj</span><span class="o">=</span><span class="s1">&#39;PlateCarree&#39;</span><span class="p">,</span> <span class="n">central_longitude</span><span class="o">=</span><span class="mf">0.0</span><span class="p">)</span>

        <span class="c1"># Get forecast for this storm</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">nhc_forecasts</span> <span class="o">=</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">latest_forecast</span><span class="p">)</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
        <span class="k">except</span><span class="p">:</span>
            <span class="n">nhc_forecasts</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_forecast_realtime</span><span class="p">(</span>
                <span class="n">ssl_certificate</span><span class="o">=</span><span class="n">ssl_certificate</span><span class="p">)</span>

        <span class="c1"># Add other info to forecast dict</span>
        <span class="n">nhc_forecasts</span><span class="p">[</span><span class="s1">&#39;advisory_num&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span>
        <span class="n">nhc_forecasts</span><span class="p">[</span><span class="s1">&#39;basin&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">basin</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">source</span> <span class="o">!=</span> <span class="s2">&quot;hurdat&quot;</span><span class="p">:</span>
            <span class="n">nhc_forecasts</span><span class="p">[</span><span class="s1">&#39;cone&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">False</span>

        <span class="c1"># Plot storm</span>
        <span class="n">plot_ax</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">plot_obj</span><span class="o">.</span><span class="n">plot_storm_nhc</span><span class="p">(</span>
            <span class="n">nhc_forecasts</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">dict</span><span class="p">,</span> <span class="n">track_labels</span><span class="p">,</span> <span class="n">cone_days</span><span class="p">,</span> <span class="n">domain</span><span class="p">,</span> <span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">,</span> <span class="n">save_path</span><span class="o">=</span><span class="n">save_path</span><span class="p">,</span> <span class="n">prop</span><span class="o">=</span><span class="n">prop</span><span class="p">,</span> <span class="n">map_prop</span><span class="o">=</span><span class="n">map_prop</span><span class="p">)</span>

        <span class="c1"># Return axis</span>
        <span class="k">return</span> <span class="n">plot_ax</span></div>

<div class="viewcode-block" id="RealtimeStorm.get_realtime_info"><a class="viewcode-back" href="../../../api/generated/tropycal.realtime.RealtimeStorm.get_realtime_info.html#tropycal.realtime.RealtimeStorm.get_realtime_info">[docs]</a>    <span class="k">def</span> <span class="nf">get_realtime_info</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">source</span><span class="o">=</span><span class="s1">&#39;all&#39;</span><span class="p">):</span>
<span class="w">        </span><span class="sa">r</span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Returns a dict containing the latest available information about the storm. This function uses NHC Public Advisories, so it will differ from available Best Track data.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        source : str</span>
<span class="sd">            Data source to use. Default is &quot;all&quot;. Available options are:</span>

<span class="sd">            * **&quot;all&quot;** = Latest from either public advisory or best track. Both NHC &amp; JTWC.</span>
<span class="sd">            * **&quot;public_advisory&quot;** = Latest public advisory. NHC only.</span>
<span class="sd">            * **&quot;best_track&quot;** = Latest Best Track file data. Both NHC &amp; JTWC.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        dict</span>
<span class="sd">            Dictionary containing current storm information.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="c1"># Error check</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">source</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
            <span class="n">msg</span> <span class="o">=</span> <span class="s2">&quot;</span><span class="se">\&quot;</span><span class="s2">source</span><span class="se">\&quot;</span><span class="s2"> must be of type str.&quot;</span>
            <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">source</span> <span class="ow">not</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;all&#39;</span><span class="p">,</span> <span class="s1">&#39;public_advisory&#39;</span><span class="p">,</span> <span class="s1">&#39;best_track&#39;</span><span class="p">]:</span>
            <span class="n">msg</span> <span class="o">=</span> <span class="s2">&quot;</span><span class="se">\&quot;</span><span class="s2">source</span><span class="se">\&quot;</span><span class="s2"> must be &#39;all&#39;, &#39;public_advisory&#39;, or &#39;best_track&#39;.&quot;</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">source</span> <span class="o">==</span> <span class="s1">&#39;public_advisory&#39;</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">source</span> <span class="o">!=</span> <span class="s1">&#39;hurdat&#39;</span><span class="p">:</span>
            <span class="n">msg</span> <span class="o">=</span> <span class="s2">&quot;A source of &#39;public_advisory&#39; can only be used for storms in NHC&#39;s area of responsibility.&quot;</span>
            <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>

        <span class="c1"># Check to ensure storm is not an invest</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">invest</span><span class="p">:</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">source</span> <span class="o">==</span> <span class="s1">&#39;hurdat&#39;</span><span class="p">:</span>
                <span class="n">msg</span> <span class="o">=</span> <span class="s2">&quot;NHC does not issue public advisories on invests. Defaulting to best track method.&quot;</span>
                <span class="n">warnings</span><span class="o">.</span><span class="n">warn</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>
            <span class="n">source</span> <span class="o">=</span> <span class="s1">&#39;best_track&#39;</span>

        <span class="c1"># Declare empty dict</span>
        <span class="n">current_advisory</span> <span class="o">=</span> <span class="p">{}</span>

        <span class="c1"># If source is all, determine which method to use</span>
        <span class="k">if</span> <span class="n">source</span> <span class="o">==</span> <span class="s1">&#39;all&#39;</span><span class="p">:</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">source</span> <span class="o">==</span> <span class="s1">&#39;hurdat&#39;</span><span class="p">:</span>
                <span class="c1"># Check to see which is the latest advisory</span>
                <span class="n">latest_btk</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">time</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>

                <span class="c1"># Get latest available public advisory</span>
                <span class="k">try</span><span class="p">:</span>
                    <span class="n">content</span> <span class="o">=</span> <span class="n">read_url</span><span class="p">(</span>
                        <span class="sa">f</span><span class="s2">&quot;https://ftp.nhc.noaa.gov/atcf/adv/</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">id</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span><span class="si">}</span><span class="s2">_info.xml&quot;</span><span class="p">,</span> <span class="n">subsplit</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
                <span class="k">except</span><span class="p">:</span>
                    <span class="n">content</span> <span class="o">=</span> <span class="n">read_url</span><span class="p">(</span>
                        <span class="sa">f</span><span class="s2">&quot;ftp://ftp.nhc.noaa.gov/atcf/adv/</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">id</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span><span class="si">}</span><span class="s2">_info.xml&quot;</span><span class="p">,</span> <span class="n">subsplit</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>

                <span class="c1"># Get UTC time of advisory</span>
                <span class="n">results</span> <span class="o">=</span> <span class="p">[</span><span class="n">i</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">content</span> <span class="k">if</span> <span class="s1">&#39;messageDateTimeUTC&#39;</span> <span class="ow">in</span> <span class="n">i</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>
                <span class="n">result</span> <span class="o">=</span> <span class="p">(</span><span class="n">results</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;&gt;&quot;</span><span class="p">)[</span><span class="mi">1</span><span class="p">])</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;&lt;&quot;</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
                <span class="n">latest_advisory</span> <span class="o">=</span> <span class="n">dt</span><span class="o">.</span><span class="n">strptime</span><span class="p">(</span><span class="n">result</span><span class="p">,</span> <span class="s1">&#39;%Y%m</span><span class="si">%d</span><span class="s1"> %I:%M:%S %p UTC&#39;</span><span class="p">)</span>

                <span class="c1"># Check which one to use</span>
                <span class="k">if</span> <span class="n">latest_btk</span> <span class="o">&gt;</span> <span class="n">latest_advisory</span><span class="p">:</span>
                    <span class="n">source</span> <span class="o">=</span> <span class="s1">&#39;best_track&#39;</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">source</span> <span class="o">=</span> <span class="s1">&#39;public_advisory&#39;</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">source</span> <span class="o">=</span> <span class="s1">&#39;best_track&#39;</span>

        <span class="c1"># If public advisory, retrieve this data</span>
        <span class="k">if</span> <span class="n">source</span> <span class="o">==</span> <span class="s1">&#39;public_advisory&#39;</span><span class="p">:</span>

            <span class="c1"># Add source</span>
            <span class="n">current_advisory</span><span class="p">[</span><span class="s1">&#39;source&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;NHC Public Advisory&#39;</span>

            <span class="c1"># Get latest available public advisory</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">content</span> <span class="o">=</span> <span class="n">read_url</span><span class="p">(</span>
                    <span class="sa">f</span><span class="s2">&quot;https://ftp.nhc.noaa.gov/atcf/adv/</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">id</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span><span class="si">}</span><span class="s2">_info.xml&quot;</span><span class="p">,</span> <span class="n">subsplit</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
            <span class="k">except</span><span class="p">:</span>
                <span class="n">content</span> <span class="o">=</span> <span class="n">read_url</span><span class="p">(</span>
                    <span class="sa">f</span><span class="s2">&quot;ftp://ftp.nhc.noaa.gov/atcf/adv/</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">id</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span><span class="si">}</span><span class="s2">_info.xml&quot;</span><span class="p">,</span> <span class="n">subsplit</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>

            <span class="c1"># Get public advisory number</span>
            <span class="n">results</span> <span class="o">=</span> <span class="p">[</span><span class="n">i</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">content</span> <span class="k">if</span> <span class="s1">&#39;advisoryNumber&#39;</span> <span class="ow">in</span> <span class="n">i</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>
            <span class="n">result</span> <span class="o">=</span> <span class="p">(</span><span class="n">results</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;&gt;&quot;</span><span class="p">)[</span><span class="mi">1</span><span class="p">])</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;&lt;&quot;</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
            <span class="n">current_advisory</span><span class="p">[</span><span class="s1">&#39;advisory_number&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">result</span>

            <span class="c1"># Get UTC time of advisory</span>
            <span class="n">results</span> <span class="o">=</span> <span class="p">[</span><span class="n">i</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">content</span> <span class="k">if</span> <span class="s1">&#39;messageDateTimeUTC&#39;</span> <span class="ow">in</span> <span class="n">i</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>
            <span class="n">result</span> <span class="o">=</span> <span class="p">(</span><span class="n">results</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;&gt;&quot;</span><span class="p">)[</span><span class="mi">1</span><span class="p">])</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;&lt;&quot;</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
            <span class="n">result</span> <span class="o">=</span> <span class="n">dt</span><span class="o">.</span><span class="n">strptime</span><span class="p">(</span><span class="n">result</span><span class="p">,</span> <span class="s1">&#39;%Y%m</span><span class="si">%d</span><span class="s1"> %I:%M:%S %p UTC&#39;</span><span class="p">)</span>
            <span class="n">current_advisory</span><span class="p">[</span><span class="s1">&#39;time_utc&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">result</span>

            <span class="c1"># Get storm type</span>
            <span class="n">results</span> <span class="o">=</span> <span class="p">[</span><span class="n">i</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">content</span> <span class="k">if</span> <span class="s1">&#39;systemType&#39;</span> <span class="ow">in</span> <span class="n">i</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>
            <span class="n">result</span> <span class="o">=</span> <span class="p">(</span><span class="n">results</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;&gt;&quot;</span><span class="p">)[</span><span class="mi">1</span><span class="p">])</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;&lt;&quot;</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
            <span class="n">current_advisory</span><span class="p">[</span><span class="s1">&#39;type&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">result</span><span class="o">.</span><span class="n">title</span><span class="p">()</span>

            <span class="c1"># Get storm name</span>
            <span class="n">results</span> <span class="o">=</span> <span class="p">[</span><span class="n">i</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">content</span> <span class="k">if</span> <span class="s1">&#39;systemName&#39;</span> <span class="ow">in</span> <span class="n">i</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>
            <span class="n">result</span> <span class="o">=</span> <span class="p">(</span><span class="n">results</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;&gt;&quot;</span><span class="p">)[</span><span class="mi">1</span><span class="p">])</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;&lt;&quot;</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
            <span class="n">current_advisory</span><span class="p">[</span><span class="s1">&#39;name&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">result</span><span class="o">.</span><span class="n">title</span><span class="p">()</span>

            <span class="c1"># Get coordinates</span>
            <span class="n">results</span> <span class="o">=</span> <span class="p">[</span><span class="n">i</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">content</span> <span class="k">if</span> <span class="s1">&#39;centerLocLatitude&#39;</span> <span class="ow">in</span> <span class="n">i</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>
            <span class="n">result</span> <span class="o">=</span> <span class="p">(</span><span class="n">results</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;&gt;&quot;</span><span class="p">)[</span><span class="mi">1</span><span class="p">])</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;&lt;&quot;</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
            <span class="n">current_advisory</span><span class="p">[</span><span class="s1">&#39;lat&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">result</span><span class="p">)</span>
            <span class="n">results</span> <span class="o">=</span> <span class="p">[</span><span class="n">i</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">content</span> <span class="k">if</span> <span class="s1">&#39;centerLocLongitude&#39;</span> <span class="ow">in</span> <span class="n">i</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>
            <span class="n">result</span> <span class="o">=</span> <span class="p">(</span><span class="n">results</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;&gt;&quot;</span><span class="p">)[</span><span class="mi">1</span><span class="p">])</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;&lt;&quot;</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
            <span class="n">current_advisory</span><span class="p">[</span><span class="s1">&#39;lon&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">result</span><span class="p">)</span>

            <span class="c1"># Get sustained wind speed</span>
            <span class="n">results</span> <span class="o">=</span> <span class="p">[</span><span class="n">i</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">content</span> <span class="k">if</span> <span class="s1">&#39;systemIntensityMph&#39;</span> <span class="ow">in</span> <span class="n">i</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>
            <span class="n">result</span> <span class="o">=</span> <span class="p">(</span><span class="n">results</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;&gt;&quot;</span><span class="p">)[</span><span class="mi">1</span><span class="p">])</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;&lt;&quot;</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
            <span class="n">current_advisory</span><span class="p">[</span><span class="s1">&#39;wind_mph&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">result</span><span class="p">)</span>
            <span class="n">results</span> <span class="o">=</span> <span class="p">[</span><span class="n">i</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">content</span> <span class="k">if</span> <span class="s1">&#39;systemIntensityKph&#39;</span> <span class="ow">in</span> <span class="n">i</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>
            <span class="n">result</span> <span class="o">=</span> <span class="p">(</span><span class="n">results</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;&gt;&quot;</span><span class="p">)[</span><span class="mi">1</span><span class="p">])</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;&lt;&quot;</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
            <span class="n">current_advisory</span><span class="p">[</span><span class="s1">&#39;wind_kph&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">result</span><span class="p">)</span>
            <span class="n">results</span> <span class="o">=</span> <span class="p">[</span><span class="n">i</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">content</span> <span class="k">if</span> <span class="s1">&#39;systemIntensityKts&#39;</span> <span class="ow">in</span> <span class="n">i</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>
            <span class="n">result</span> <span class="o">=</span> <span class="p">(</span><span class="n">results</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;&gt;&quot;</span><span class="p">)[</span><span class="mi">1</span><span class="p">])</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;&lt;&quot;</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
            <span class="n">current_advisory</span><span class="p">[</span><span class="s1">&#39;wind_kt&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">result</span><span class="p">)</span>

            <span class="c1"># Get MSLP</span>
            <span class="n">results</span> <span class="o">=</span> <span class="p">[</span><span class="n">i</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">content</span> <span class="k">if</span> <span class="s1">&#39;systemMslpMb&#39;</span> <span class="ow">in</span> <span class="n">i</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>
            <span class="n">result</span> <span class="o">=</span> <span class="p">(</span><span class="n">results</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;&gt;&quot;</span><span class="p">)[</span><span class="mi">1</span><span class="p">])</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;&lt;&quot;</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
            <span class="n">current_advisory</span><span class="p">[</span><span class="s1">&#39;mslp&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">result</span><span class="p">)</span>

            <span class="c1"># Get storm category</span>
            <span class="n">current_advisory</span><span class="p">[</span><span class="s1">&#39;category&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">wind_to_category</span><span class="p">(</span>
                <span class="n">current_advisory</span><span class="p">[</span><span class="s1">&#39;wind_kt&#39;</span><span class="p">])</span>

            <span class="c1"># Get storm direction</span>
            <span class="n">results</span> <span class="o">=</span> <span class="p">[</span><span class="n">i</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">content</span> <span class="k">if</span> <span class="s1">&#39;systemDirectionOfMotion&#39;</span> <span class="ow">in</span> <span class="n">i</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>
            <span class="n">result</span> <span class="o">=</span> <span class="p">(</span><span class="n">results</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;&gt;&quot;</span><span class="p">)[</span><span class="mi">1</span><span class="p">])</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;&lt;&quot;</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
            <span class="n">current_advisory</span><span class="p">[</span><span class="s1">&#39;motion_direction&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">result</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot; OR &quot;</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
            <span class="n">results</span> <span class="o">=</span> <span class="p">[</span><span class="n">i</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">content</span> <span class="k">if</span> <span class="s1">&#39;systemDirectionOfMotion&#39;</span> <span class="ow">in</span> <span class="n">i</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>
            <span class="n">result</span> <span class="o">=</span> <span class="p">(</span><span class="n">results</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;&gt;&quot;</span><span class="p">)[</span><span class="mi">1</span><span class="p">])</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;&lt;&quot;</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">current_advisory</span><span class="p">[</span><span class="s1">&#39;motion_direction_degrees&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span>
                    <span class="p">(</span><span class="n">result</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot; OR &quot;</span><span class="p">)[</span><span class="mi">1</span><span class="p">])</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot; DEGREES&quot;</span><span class="p">)[</span><span class="mi">0</span><span class="p">])</span>
            <span class="k">except</span><span class="p">:</span>
                <span class="n">current_advisory</span><span class="p">[</span><span class="s1">&#39;motion_direction_degrees&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span>

            <span class="c1"># Get storm speed</span>
            <span class="n">results</span> <span class="o">=</span> <span class="p">[</span><span class="n">i</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">content</span> <span class="k">if</span> <span class="s1">&#39;systemSpeedMph&#39;</span> <span class="ow">in</span> <span class="n">i</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>
            <span class="n">result</span> <span class="o">=</span> <span class="p">(</span><span class="n">results</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;&gt;&quot;</span><span class="p">)[</span><span class="mi">1</span><span class="p">])</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;&lt;&quot;</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
            <span class="n">current_advisory</span><span class="p">[</span><span class="s1">&#39;motion_mph&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">result</span><span class="p">)</span>
            <span class="n">results</span> <span class="o">=</span> <span class="p">[</span><span class="n">i</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">content</span> <span class="k">if</span> <span class="s1">&#39;systemSpeedKph&#39;</span> <span class="ow">in</span> <span class="n">i</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>
            <span class="n">result</span> <span class="o">=</span> <span class="p">(</span><span class="n">results</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;&gt;&quot;</span><span class="p">)[</span><span class="mi">1</span><span class="p">])</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;&lt;&quot;</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
            <span class="n">current_advisory</span><span class="p">[</span><span class="s1">&#39;motion_kph&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">result</span><span class="p">)</span>
            <span class="n">results</span> <span class="o">=</span> <span class="p">[</span><span class="n">i</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">content</span> <span class="k">if</span> <span class="s1">&#39;systemSpeedKts&#39;</span> <span class="ow">in</span> <span class="n">i</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>
            <span class="n">result</span> <span class="o">=</span> <span class="p">(</span><span class="n">results</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;&gt;&quot;</span><span class="p">)[</span><span class="mi">1</span><span class="p">])</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;&lt;&quot;</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
            <span class="n">current_advisory</span><span class="p">[</span><span class="s1">&#39;motion_kt&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">result</span><span class="p">)</span>

        <span class="c1"># Best track data</span>
        <span class="k">else</span><span class="p">:</span>

            <span class="c1"># Add source</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">source</span> <span class="o">==</span> <span class="s1">&#39;hurdat&#39;</span><span class="p">:</span>
                <span class="n">current_advisory</span><span class="p">[</span><span class="s1">&#39;source&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;NHC Best Track&#39;</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">current_advisory</span><span class="p">[</span><span class="s1">&#39;source&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;JTWC Best Track&#39;</span>

            <span class="c1"># Get public advisory number</span>
            <span class="n">current_advisory</span><span class="p">[</span><span class="s1">&#39;advisory_number&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;n/a&#39;</span>

            <span class="c1"># Get UTC time of advisory</span>
            <span class="n">current_advisory</span><span class="p">[</span><span class="s1">&#39;time_utc&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">time</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>

            <span class="c1"># Get storm type</span>
            <span class="n">subtrop_flag</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">type</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="ow">in</span> <span class="n">constants</span><span class="o">.</span><span class="n">SUBTROPICAL_ONLY_STORM_TYPES</span>
            <span class="n">current_advisory</span><span class="p">[</span><span class="s1">&#39;type&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">get_storm_classification</span><span class="p">(</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">vmax</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span> <span class="n">subtrop_flag</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">wmo_basin</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span>

            <span class="c1"># Check for non-tropical storm types</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">type</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">constants</span><span class="o">.</span><span class="n">TROPICAL_STORM_TYPES</span><span class="p">:</span>
                <span class="k">if</span> <span class="nb">all</span><span class="p">(</span><span class="nb">type</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">type</span> <span class="k">for</span> <span class="nb">type</span> <span class="ow">in</span> <span class="n">constants</span><span class="o">.</span><span class="n">TROPICAL_STORM_TYPES</span><span class="p">):</span>
                    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">invest</span><span class="p">:</span>
                        <span class="n">current_advisory</span><span class="p">[</span><span class="s1">&#39;type&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;Invest&#39;</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="n">current_advisory</span><span class="p">[</span><span class="s1">&#39;type&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;Potential Tropical Cyclone&#39;</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">current_advisory</span><span class="p">[</span><span class="s1">&#39;type&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;Post-Tropical Cyclone&#39;</span>
            <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">source</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;jtwc&#39;</span><span class="p">,</span> <span class="s1">&#39;ucar&#39;</span><span class="p">]:</span>
                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">invest</span><span class="p">:</span>
                    <span class="n">current_advisory</span><span class="p">[</span><span class="s1">&#39;type&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;Invest&#39;</span>

            <span class="c1"># Get storm name</span>
            <span class="n">current_advisory</span><span class="p">[</span><span class="s1">&#39;name&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="o">.</span><span class="n">title</span><span class="p">()</span>

            <span class="c1"># Get coordinates</span>
            <span class="n">current_advisory</span><span class="p">[</span><span class="s1">&#39;lat&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">lat</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
            <span class="n">current_advisory</span><span class="p">[</span><span class="s1">&#39;lon&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">lon</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>

            <span class="c1"># Get sustained wind speed</span>
            <span class="n">current_advisory</span><span class="p">[</span><span class="s1">&#39;wind_mph&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">knots_to_mph</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">vmax</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span>
            <span class="n">current_advisory</span><span class="p">[</span><span class="s1">&#39;wind_kph&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">vmax</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">*</span> <span class="mf">1.852</span><span class="p">)</span>
            <span class="n">current_advisory</span><span class="p">[</span><span class="s1">&#39;wind_kt&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">vmax</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>

            <span class="c1"># Get MSLP</span>
            <span class="n">current_advisory</span><span class="p">[</span><span class="s1">&#39;mslp&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">mslp</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span>

            <span class="c1"># Get storm category</span>
            <span class="n">current_advisory</span><span class="p">[</span><span class="s1">&#39;category&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">wind_to_category</span><span class="p">(</span>
                <span class="n">current_advisory</span><span class="p">[</span><span class="s1">&#39;wind_kt&#39;</span><span class="p">])</span>

            <span class="c1"># Determine motion direction and degrees</span>
            <span class="k">try</span><span class="p">:</span>

                <span class="c1"># Cannot calculate motion if there&#39;s only one data point</span>
                <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">lon</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>

                    <span class="c1"># Get storm direction</span>
                    <span class="n">current_advisory</span><span class="p">[</span><span class="s1">&#39;motion_direction&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;n/a&#39;</span>
                    <span class="n">current_advisory</span><span class="p">[</span><span class="s1">&#39;motion_direction_degrees&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;n/a&#39;</span>

                    <span class="c1"># Get storm speed</span>
                    <span class="n">current_advisory</span><span class="p">[</span><span class="s1">&#39;motion_mph&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;n/a&#39;</span>
                    <span class="n">current_advisory</span><span class="p">[</span><span class="s1">&#39;motion_kph&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;n/a&#39;</span>
                    <span class="n">current_advisory</span><span class="p">[</span><span class="s1">&#39;motion_kt&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;n/a&#39;</span>

                <span class="c1"># Otherwise, use great_circle to calculate</span>
                <span class="k">else</span><span class="p">:</span>

                    <span class="c1"># Get points</span>
                    <span class="n">start_point</span> <span class="o">=</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">lat</span><span class="p">[</span><span class="o">-</span><span class="mi">2</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">lon</span><span class="p">[</span><span class="o">-</span><span class="mi">2</span><span class="p">])</span>
                    <span class="n">end_point</span> <span class="o">=</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">lat</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">lon</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span>

                    <span class="c1"># Get time since last update</span>
                    <span class="n">hour_diff</span> <span class="o">=</span> <span class="p">(</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">time</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">time</span><span class="p">[</span><span class="o">-</span><span class="mi">2</span><span class="p">])</span><span class="o">.</span><span class="n">total_seconds</span><span class="p">()</span> <span class="o">/</span> <span class="mf">3600.0</span>

                    <span class="c1"># Calculate zonal and meridional position change in km</span>
                    <span class="n">x</span> <span class="o">=</span> <span class="n">great_circle</span><span class="p">(</span>
                        <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">lat</span><span class="p">[</span><span class="o">-</span><span class="mi">2</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">lon</span><span class="p">[</span><span class="o">-</span><span class="mi">2</span><span class="p">]),</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">lat</span><span class="p">[</span><span class="o">-</span><span class="mi">2</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">lon</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]))</span><span class="o">.</span><span class="n">kilometers</span>
                    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">lon</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">&lt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">lon</span><span class="p">[</span><span class="o">-</span><span class="mi">2</span><span class="p">]:</span>
                        <span class="n">x</span> <span class="o">=</span> <span class="n">x</span> <span class="o">*</span> <span class="o">-</span><span class="mi">1</span>

                    <span class="n">y</span> <span class="o">=</span> <span class="n">great_circle</span><span class="p">(</span>
                        <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">lat</span><span class="p">[</span><span class="o">-</span><span class="mi">2</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">lon</span><span class="p">[</span><span class="o">-</span><span class="mi">2</span><span class="p">]),</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">lat</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">lon</span><span class="p">[</span><span class="o">-</span><span class="mi">2</span><span class="p">]))</span><span class="o">.</span><span class="n">kilometers</span>
                    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">lat</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">&lt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">lat</span><span class="p">[</span><span class="o">-</span><span class="mi">2</span><span class="p">]:</span>
                        <span class="n">y</span> <span class="o">=</span> <span class="n">y</span> <span class="o">*</span> <span class="o">-</span><span class="mi">1</span>

                    <span class="c1"># Calculate motion direction vector</span>
                    <span class="n">idir</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">degrees</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">arctan2</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">))</span>
                    <span class="k">if</span> <span class="n">idir</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">:</span>
                        <span class="n">idir</span> <span class="o">+=</span> <span class="mf">360.0</span>

                    <span class="c1"># Calculate motion direction string</span>
                    <span class="k">def</span> <span class="nf">deg_str</span><span class="p">(</span><span class="n">d</span><span class="p">):</span>
                        <span class="n">dirs</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;N&quot;</span><span class="p">,</span> <span class="s2">&quot;NNE&quot;</span><span class="p">,</span> <span class="s2">&quot;NE&quot;</span><span class="p">,</span> <span class="s2">&quot;ENE&quot;</span><span class="p">,</span> <span class="s2">&quot;E&quot;</span><span class="p">,</span> <span class="s2">&quot;ESE&quot;</span><span class="p">,</span> <span class="s2">&quot;SE&quot;</span><span class="p">,</span> <span class="s2">&quot;SSE&quot;</span><span class="p">,</span>
                                <span class="s2">&quot;S&quot;</span><span class="p">,</span> <span class="s2">&quot;SSW&quot;</span><span class="p">,</span> <span class="s2">&quot;SW&quot;</span><span class="p">,</span> <span class="s2">&quot;WSW&quot;</span><span class="p">,</span> <span class="s2">&quot;W&quot;</span><span class="p">,</span> <span class="s2">&quot;WNW&quot;</span><span class="p">,</span> <span class="s2">&quot;NW&quot;</span><span class="p">,</span> <span class="s2">&quot;NNW&quot;</span><span class="p">]</span>
                        <span class="n">ix</span> <span class="o">=</span> <span class="nb">int</span><span class="p">((</span><span class="n">d</span> <span class="o">+</span> <span class="mf">11.25</span><span class="p">)</span><span class="o">/</span><span class="mf">22.5</span><span class="p">)</span>
                        <span class="k">return</span> <span class="n">dirs</span><span class="p">[</span><span class="n">ix</span> <span class="o">%</span> <span class="mi">16</span><span class="p">]</span>
                    <span class="n">dirs</span> <span class="o">=</span> <span class="n">deg_str</span><span class="p">(</span><span class="n">idir</span><span class="p">)</span>

                    <span class="c1"># Update storm direction</span>
                    <span class="n">current_advisory</span><span class="p">[</span><span class="s1">&#39;motion_direction&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">dirs</span>
                    <span class="n">current_advisory</span><span class="p">[</span><span class="s1">&#39;motion_direction_degrees&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span>
                        <span class="n">np</span><span class="o">.</span><span class="n">round</span><span class="p">(</span><span class="n">idir</span><span class="p">,</span> <span class="mi">0</span><span class="p">))</span>

                    <span class="c1"># Get storm speed</span>
                    <span class="n">current_advisory</span><span class="p">[</span><span class="s1">&#39;motion_mph&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span>
                        <span class="n">np</span><span class="o">.</span><span class="n">round</span><span class="p">(</span><span class="n">great_circle</span><span class="p">(</span><span class="n">start_point</span><span class="p">,</span> <span class="n">end_point</span><span class="p">)</span><span class="o">.</span><span class="n">miles</span> <span class="o">/</span> <span class="nb">float</span><span class="p">(</span><span class="n">hour_diff</span><span class="p">),</span> <span class="mi">0</span><span class="p">))</span>
                    <span class="n">current_advisory</span><span class="p">[</span><span class="s1">&#39;motion_kph&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">round</span><span class="p">(</span><span class="n">great_circle</span><span class="p">(</span>
                        <span class="n">start_point</span><span class="p">,</span> <span class="n">end_point</span><span class="p">)</span><span class="o">.</span><span class="n">kilometers</span> <span class="o">/</span> <span class="nb">float</span><span class="p">(</span><span class="n">hour_diff</span><span class="p">),</span> <span class="mi">0</span><span class="p">))</span>
                    <span class="n">current_advisory</span><span class="p">[</span><span class="s1">&#39;motion_kt&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span>
                        <span class="n">np</span><span class="o">.</span><span class="n">round</span><span class="p">(</span><span class="n">current_advisory</span><span class="p">[</span><span class="s1">&#39;motion_mph&#39;</span><span class="p">]</span> <span class="o">*</span> <span class="mf">0.868976</span><span class="p">,</span> <span class="mi">0</span><span class="p">))</span>

            <span class="c1"># Otherwise, can&#39;t calculate motion</span>
            <span class="k">except</span><span class="p">:</span>

                <span class="c1"># Get storm direction</span>
                <span class="n">current_advisory</span><span class="p">[</span><span class="s1">&#39;motion_direction&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;n/a&#39;</span>
                <span class="n">current_advisory</span><span class="p">[</span><span class="s1">&#39;motion_direction_degrees&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;n/a&#39;</span>

                <span class="c1"># Get storm speed</span>
                <span class="n">current_advisory</span><span class="p">[</span><span class="s1">&#39;motion_mph&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;n/a&#39;</span>
                <span class="n">current_advisory</span><span class="p">[</span><span class="s1">&#39;motion_kph&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;n/a&#39;</span>
                <span class="n">current_advisory</span><span class="p">[</span><span class="s1">&#39;motion_kt&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;n/a&#39;</span>

        <span class="c1"># Return dict</span>
        <span class="k">return</span> <span class="n">current_advisory</span></div>

    <span class="k">def</span> <span class="nf">__get_public_advisory</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>

        <span class="c1"># Get list of all public advisories for this storm</span>
        <span class="n">url_disco</span> <span class="o">=</span> <span class="s1">&#39;https://ftp.nhc.noaa.gov/atcf/pub/&#39;</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">page</span> <span class="o">=</span> <span class="n">requests</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">url_disco</span><span class="p">)</span><span class="o">.</span><span class="n">text</span>
            <span class="n">content</span> <span class="o">=</span> <span class="n">page</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
            <span class="n">files</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="n">content</span><span class="p">:</span>
                <span class="k">if</span> <span class="s2">&quot;.public&quot;</span> <span class="ow">in</span> <span class="n">line</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">id</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="ow">in</span> <span class="n">line</span><span class="p">:</span>
                    <span class="n">filename</span> <span class="o">=</span> <span class="n">line</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;&quot;&gt;&#39;</span><span class="p">)[</span><span class="mi">1</span><span class="p">]</span>
                    <span class="n">filename</span> <span class="o">=</span> <span class="n">filename</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;&lt;/a&gt;&quot;</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
                    <span class="n">files</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">filename</span><span class="p">)</span>
            <span class="k">del</span> <span class="n">content</span>
        <span class="k">except</span><span class="p">:</span>
            <span class="n">ftp</span> <span class="o">=</span> <span class="n">FTP</span><span class="p">(</span><span class="s1">&#39;ftp.nhc.noaa.gov&#39;</span><span class="p">)</span>
            <span class="n">ftp</span><span class="o">.</span><span class="n">login</span><span class="p">()</span>
            <span class="n">ftp</span><span class="o">.</span><span class="n">cwd</span><span class="p">(</span><span class="s1">&#39;atcf/pub&#39;</span><span class="p">)</span>
            <span class="n">files</span> <span class="o">=</span> <span class="n">ftp</span><span class="o">.</span><span class="n">nlst</span><span class="p">()</span>
            <span class="n">out</span> <span class="o">=</span> <span class="n">ftp</span><span class="o">.</span><span class="n">quit</span><span class="p">()</span>

        <span class="c1"># Keep only largest number</span>
        <span class="n">numbers</span> <span class="o">=</span> <span class="p">[</span><span class="nb">int</span><span class="p">(</span><span class="n">i</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;.&quot;</span><span class="p">)[</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">files</span><span class="p">]</span>
        <span class="n">max_number</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nanmax</span><span class="p">(</span><span class="n">numbers</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">max_number</span> <span class="o">&gt;=</span> <span class="mi">100</span><span class="p">:</span>
            <span class="n">max_number</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">max_number</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">max_number</span> <span class="o">&gt;=</span> <span class="mi">10</span><span class="p">:</span>
            <span class="n">max_number</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;0</span><span class="si">{</span><span class="n">max_number</span><span class="si">}</span><span class="s2">&quot;</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">max_number</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;00</span><span class="si">{</span><span class="n">max_number</span><span class="si">}</span><span class="s2">&quot;</span>
        <span class="n">files</span> <span class="o">=</span> <span class="p">[</span><span class="n">i</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">files</span> <span class="k">if</span> <span class="sa">f</span><span class="s2">&quot;.</span><span class="si">{</span><span class="n">max_number</span><span class="si">}</span><span class="s2">&quot;</span> <span class="ow">in</span> <span class="n">i</span><span class="p">]</span>

        <span class="c1"># Determine if there&#39;s an intermediate advisory available</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">files</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
            <span class="n">advisory_letter</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="k">for</span> <span class="n">file</span> <span class="ow">in</span> <span class="n">files</span><span class="p">:</span>
                <span class="k">if</span> <span class="s1">&#39;public_&#39;</span> <span class="ow">in</span> <span class="n">file</span><span class="p">:</span>
                    <span class="n">letter</span> <span class="o">=</span> <span class="p">(</span><span class="n">file</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;public_&quot;</span><span class="p">)[</span><span class="mi">1</span><span class="p">])</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;.&quot;</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
                    <span class="n">advisory_letter</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">letter</span><span class="p">)</span>
            <span class="n">max_letter</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="n">advisory_letter</span><span class="p">)</span>
            <span class="n">files</span> <span class="o">=</span> <span class="p">[</span><span class="n">i</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">files</span> <span class="k">if</span> <span class="sa">f</span><span class="s2">&quot;.public_</span><span class="si">{</span><span class="n">max_letter</span><span class="si">}</span><span class="s2">&quot;</span> <span class="ow">in</span> <span class="n">i</span><span class="p">]</span>

        <span class="c1"># Read file containing advisory</span>
        <span class="n">content</span> <span class="o">=</span> <span class="n">read_url</span><span class="p">(</span><span class="n">url_disco</span> <span class="o">+</span> <span class="n">files</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">subsplit</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>

        <span class="c1"># Figure out time issued</span>
        <span class="n">hr</span> <span class="o">=</span> <span class="n">content</span><span class="p">[</span><span class="mi">6</span><span class="p">]</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot; &quot;</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">zone</span> <span class="o">=</span> <span class="n">content</span><span class="p">[</span><span class="mi">6</span><span class="p">]</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot; &quot;</span><span class="p">)[</span><span class="mi">2</span><span class="p">]</span>
        <span class="n">disco_time</span> <span class="o">=</span> <span class="n">num_to_str2</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">hr</span><span class="p">))</span> <span class="o">+</span> <span class="s1">&#39; &#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">content</span><span class="p">[</span><span class="mi">6</span><span class="p">]</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot; &quot;</span><span class="p">)[</span><span class="mi">1</span><span class="p">:])</span>

        <span class="n">format_time</span> <span class="o">=</span> <span class="n">content</span><span class="p">[</span><span class="mi">6</span><span class="p">]</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot; &quot;</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">format_time</span><span class="p">)</span> <span class="o">==</span> <span class="mi">3</span><span class="p">:</span>
            <span class="n">format_time</span> <span class="o">=</span> <span class="s2">&quot;0&quot;</span> <span class="o">+</span> <span class="n">format_time</span>
        <span class="n">format_time</span> <span class="o">=</span> <span class="n">format_time</span> <span class="o">+</span> <span class="s2">&quot; &quot;</span> <span class="o">+</span> <span class="s1">&#39; &#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">content</span><span class="p">[</span><span class="mi">6</span><span class="p">]</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot; &quot;</span><span class="p">)[</span><span class="mi">1</span><span class="p">:])</span>
        <span class="n">disco_time</span> <span class="o">=</span> <span class="n">dt</span><span class="o">.</span><span class="n">strptime</span><span class="p">(</span><span class="n">format_time</span><span class="p">,</span> <span class="sa">f</span><span class="s1">&#39;%I00 %p </span><span class="si">{</span><span class="n">zone</span><span class="si">}</span><span class="s1"> %a %b %d %Y&#39;</span><span class="p">)</span>

        <span class="n">time_zones</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s1">&#39;ADT&#39;</span><span class="p">:</span> <span class="o">-</span><span class="mi">3</span><span class="p">,</span>
            <span class="s1">&#39;AST&#39;</span><span class="p">:</span> <span class="o">-</span><span class="mi">4</span><span class="p">,</span>
            <span class="s1">&#39;EDT&#39;</span><span class="p">:</span> <span class="o">-</span><span class="mi">4</span><span class="p">,</span>
            <span class="s1">&#39;EST&#39;</span><span class="p">:</span> <span class="o">-</span><span class="mi">5</span><span class="p">,</span>
            <span class="s1">&#39;CDT&#39;</span><span class="p">:</span> <span class="o">-</span><span class="mi">5</span><span class="p">,</span>
            <span class="s1">&#39;CST&#39;</span><span class="p">:</span> <span class="o">-</span><span class="mi">6</span><span class="p">,</span>
            <span class="s1">&#39;MDT&#39;</span><span class="p">:</span> <span class="o">-</span><span class="mi">6</span><span class="p">,</span>
            <span class="s1">&#39;MST&#39;</span><span class="p">:</span> <span class="o">-</span><span class="mi">7</span><span class="p">,</span>
            <span class="s1">&#39;PDT&#39;</span><span class="p">:</span> <span class="o">-</span><span class="mi">7</span><span class="p">,</span>
            <span class="s1">&#39;PST&#39;</span><span class="p">:</span> <span class="o">-</span><span class="mi">8</span><span class="p">,</span>
            <span class="s1">&#39;HDT&#39;</span><span class="p">:</span> <span class="o">-</span><span class="mi">9</span><span class="p">,</span>
            <span class="s1">&#39;HST&#39;</span><span class="p">:</span> <span class="o">-</span><span class="mi">10</span>
        <span class="p">}</span>
        <span class="n">offset</span> <span class="o">=</span> <span class="n">time_zones</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">zone</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
        <span class="n">disco_time</span> <span class="o">=</span> <span class="n">disco_time</span> <span class="o">+</span> <span class="n">timedelta</span><span class="p">(</span><span class="n">hours</span><span class="o">=</span><span class="n">offset</span><span class="o">*-</span><span class="mi">1</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">__get_ensembles_eps</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="c1"># This function is currently not functioning. The path to retrieve EPS ensemble data is:</span>
        <span class="c1"># ftp://wmo:essential@dissemination.ecmwf.int/20200518120000/</span>
        <span class="c1"># A_JSXX01ECEP181200_C_ECMP_20200518120000_tropical_cyclone_track_AMPHAN_86p3degE_14degN_bufr4.bin</span>
        <span class="k">return</span></div>
</pre></div>

           </div>
          </div>
          <footer>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2023, Tropycal Developers.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>