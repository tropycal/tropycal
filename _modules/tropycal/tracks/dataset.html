<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>tropycal.tracks.dataset &mdash; tropycal </title>
      <link rel="stylesheet" href="../../../_static/pygments.css" type="text/css" />
      <link rel="stylesheet" href="../../../_static/css/theme.css" type="text/css" />
      <link rel="stylesheet" href="../../../_static/plot_directive.css" type="text/css" />
      <link rel="stylesheet" href="../../../_static/sg_gallery.css" type="text/css" />
      <link rel="stylesheet" href="../../../_static/sg_gallery-binder.css" type="text/css" />
      <link rel="stylesheet" href="../../../_static/sg_gallery-dataframe.css" type="text/css" />
      <link rel="stylesheet" href="../../../_static/sg_gallery-rendered-html.css" type="text/css" />
      <link rel="stylesheet" href="../../../_static/css/theme.css" type="text/css" />
    <link rel="shortcut icon" href="../../../_static/logo_32.ico"/>
  <!--[if lt IE 9]>
    <script src="../../../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
        <script data-url_root="../../../" id="documentation_options" src="../../../_static/documentation_options.js"></script>
        <script src="../../../_static/jquery.js"></script>
        <script src="../../../_static/underscore.js"></script>
        <script src="../../../_static/doctools.js"></script>
    <script src="../../../_static/js/theme.js"></script>
    <link rel="index" title="Index" href="../../../genindex.html" />
    <link rel="search" title="Search" href="../../../search.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
            <a href="../../../index.html" class="icon icon-home"> tropycal
            <img src="../../../_static/logo.png" class="logo" alt="Logo"/>
          </a>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <ul>
<li class="toctree-l1"><a class="reference internal" href="../../../install.html">Installation Guide</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../support.html">Support</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../examples/index.html">Example Scripts</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../api/index.html">API Reference</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../sample_usage.html">Example Gallery</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../data.html">Data Sources</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../../index.html">tropycal</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../../../index.html" class="icon icon-home"></a> &raquo;</li>
          <li><a href="../../index.html">Module code</a> &raquo;</li>
      <li>tropycal.tracks.dataset</li>
      <li class="wy-breadcrumbs-aside">
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <h1>Source code for tropycal.tracks.dataset</h1><div class="highlight"><pre>
<span></span><span class="sa">r</span><span class="sd">&quot;&quot;&quot;Functionality for storing and analyzing an entire cyclone dataset.&quot;&quot;&quot;</span>

<span class="kn">import</span> <span class="nn">calendar</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>
<span class="kn">import</span> <span class="nn">re</span>
<span class="kn">import</span> <span class="nn">scipy.interpolate</span> <span class="k">as</span> <span class="nn">interp</span>
<span class="kn">import</span> <span class="nn">scipy.stats</span> <span class="k">as</span> <span class="nn">stats</span>
<span class="kn">import</span> <span class="nn">urllib</span>
<span class="kn">import</span> <span class="nn">warnings</span>
<span class="kn">from</span> <span class="nn">datetime</span> <span class="kn">import</span> <span class="n">datetime</span> <span class="k">as</span> <span class="n">dt</span><span class="p">,</span><span class="n">timedelta</span>
<span class="kn">from</span> <span class="nn">scipy.ndimage</span> <span class="kn">import</span> <span class="n">gaussian_filter</span> <span class="k">as</span> <span class="n">gfilt</span>
<span class="kn">from</span> <span class="nn">matplotlib</span> <span class="kn">import</span> <span class="n">path</span>

<span class="c1">#Import internal scripts</span>
<span class="kn">from</span> <span class="nn">..plot</span> <span class="kn">import</span> <span class="n">Plot</span>
<span class="kn">from</span> <span class="nn">.plot</span> <span class="kn">import</span> <span class="n">TrackPlot</span>
<span class="kn">from</span> <span class="nn">.storm</span> <span class="kn">import</span> <span class="n">Storm</span>
<span class="kn">from</span> <span class="nn">.season</span> <span class="kn">import</span> <span class="n">Season</span>
<span class="kn">from</span> <span class="nn">..tornado</span> <span class="kn">import</span> <span class="o">*</span>

<span class="c1">#Import tools</span>
<span class="kn">from</span> <span class="nn">.tools</span> <span class="kn">import</span> <span class="o">*</span>
<span class="kn">from</span> <span class="nn">..utils</span> <span class="kn">import</span> <span class="o">*</span>
<span class="kn">from</span> <span class="nn">..</span> <span class="kn">import</span> <span class="n">constants</span>

<span class="c1">#Import matplotlib</span>
<span class="k">try</span><span class="p">:</span>
    <span class="kn">import</span> <span class="nn">matplotlib.lines</span> <span class="k">as</span> <span class="nn">mlines</span>
    <span class="kn">import</span> <span class="nn">matplotlib.patheffects</span> <span class="k">as</span> <span class="nn">path_effects</span>
    <span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>
    <span class="kn">import</span> <span class="nn">matplotlib.ticker</span> <span class="k">as</span> <span class="nn">mticker</span>
    <span class="kn">import</span> <span class="nn">matplotlib.dates</span> <span class="k">as</span> <span class="nn">mdates</span>
<span class="k">except</span><span class="p">:</span>
    <span class="n">warnings</span><span class="o">.</span><span class="n">warn</span><span class="p">(</span><span class="s2">&quot;Warning: Matplotlib is not installed in your python environment. Plotting functions will not work.&quot;</span><span class="p">)</span>

<div class="viewcode-block" id="TrackDataset"><a class="viewcode-back" href="../../../api/generated/tropycal.tracks.TrackDataset.html#tropycal.tracks.TrackDataset">[docs]</a><span class="k">class</span> <span class="nc">TrackDataset</span><span class="p">:</span>
    
    <span class="sa">r</span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Creates an instance of a TrackDataset object containing various cyclone data.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    basin : str</span>
<span class="sd">        Ocean basin(s) to load data for. Can be any of the following:</span>
<span class="sd">        </span>
<span class="sd">        .. list-table:: </span>
<span class="sd">           :widths: 25 75</span>
<span class="sd">           :header-rows: 1</span>

<span class="sd">           * - Name</span>
<span class="sd">             - Source(s)</span>
<span class="sd">           * - &quot;north_atlantic&quot;</span>
<span class="sd">             - HURDAT2, IBTrACS</span>
<span class="sd">           * - &quot;east_pacific&quot;</span>
<span class="sd">             - HURDAT2, IBTrACS</span>
<span class="sd">           * - &quot;both&quot;</span>
<span class="sd">             - HURDAT2 (&quot;north_atlantic&quot; &amp; &quot;east_pacific&quot; combined)</span>
<span class="sd">           * - &quot;west_pacific&quot;</span>
<span class="sd">             - IBTrACS</span>
<span class="sd">           * - &quot;north_indian&quot;</span>
<span class="sd">             - IBTrACS</span>
<span class="sd">           * - &quot;south_indian&quot;</span>
<span class="sd">             - IBTrACS</span>
<span class="sd">           * - &quot;australia&quot;</span>
<span class="sd">             - IBTrACS* (special case)</span>
<span class="sd">           * - &quot;south_atlantic&quot;</span>
<span class="sd">             - IBTrACS</span>
<span class="sd">           * - &quot;all&quot;</span>
<span class="sd">             - IBTrACS</span>

<span class="sd">    source : str</span>
<span class="sd">        Data source to read in. Default is HURDAT2.</span>
<span class="sd">        </span>
<span class="sd">        * **hurdat** - HURDAT2 data source for the North Atlantic and East/Central Pacific basins</span>
<span class="sd">        * **ibtracs** - ibtracs data source for regional or global data</span>
<span class="sd">    include_btk : bool, optional</span>
<span class="sd">        If True, the best track data from NHC for the most recent years where it doesn&#39;t exist in HURDAT2 will be added into the dataset. Valid for &quot;north_atlantic&quot; and &quot;east_pacific&quot; basins. Default is False.</span>
<span class="sd">    interpolate_data : bool, optional</span>
<span class="sd">        If True, interpolates all storm data to hourly. Default is False.</span>
<span class="sd">    </span>
<span class="sd">    Other Parameters</span>
<span class="sd">    ----------------</span>
<span class="sd">    atlantic_url : str, optional</span>
<span class="sd">        URL containing the Atlantic HURDAT2 dataset. Can be changed to a local txt reference file. Default is retrieval from online URL.</span>
<span class="sd">    pacific_url : str, optional</span>
<span class="sd">        URL containing the Pacific HURDAT2 dataset. Can be changed to a local txt reference file. Default is retrieval from online URL.</span>
<span class="sd">    ibtracs_url : str, optional</span>
<span class="sd">        URL containing the ibtracs dataset. Can be changed to a local txt reference file. Can be a regional or all ibtracs file. If regional, the basin should match the argument basin provided earlier. Default is retrieval from online URL.</span>
<span class="sd">    catarina : bool, optional</span>
<span class="sd">        Modify the dataset to include cyclone track data for Cyclone Catarina (2004) from McTaggart-Cowan et al. (2006). Default is False.</span>
<span class="sd">    ibtracs_hurdat : bool, optional</span>
<span class="sd">        Replace ibtracs data for the North Atlantic and East/Central Pacific basins with HURDAT data. Default is False.</span>
<span class="sd">    ibtracs_mode : str, optional</span>
<span class="sd">        Mode of reading ibtracs in. Default is &quot;jtwc&quot;.</span>
<span class="sd">        </span>
<span class="sd">        * **wmo** = official World Meteorological Organization data. Caveat is sustained wind methodology is inconsistent between basins.</span>
<span class="sd">        * **jtwc** = default. Unofficial data from the Joint Typhoon Warning Center. Caveat is some storms are missing and some storm data is inaccurate.</span>
<span class="sd">        * **jtwc_neumann** = JTWC data modified with the Neumann reanalysis for the Southern Hemisphere. Improves upon some storms (e.g., Cyclone Tracy 1974) while degrading others.</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    Dataset</span>
<span class="sd">        An instance of Dataset.</span>
<span class="sd">    </span>
<span class="sd">    Notes</span>
<span class="sd">    -----</span>
<span class="sd">    This object contains information about all storms in a basin, as well as methods to analyze the dataset and to retrieve individual storms from the dataset.</span>
<span class="sd">    </span>
<span class="sd">    The following block of code creates an instance of a TrackDataset() object and stores it in a variable called &quot;basin&quot;:</span>
<span class="sd">    </span>
<span class="sd">    .. code-block:: python</span>
<span class="sd">    </span>
<span class="sd">        from tropycal import tracks</span>
<span class="sd">        basin = tracks.TrackDataset()</span>
<span class="sd">        </span>
<span class="sd">    With an instance of TrackDataset created, any of the methods listed below can be accessed via the &quot;basin&quot; variable:</span>
<span class="sd">    </span>
<span class="sd">    .. code-block:: python</span>
<span class="sd">    </span>
<span class="sd">        storm = basin.get_storm((&quot;katrina&quot;,2005))</span>
<span class="sd">    </span>
<span class="sd">    For IBTrACS datasets, please refer to :ref:`ibtracs-caveats` for pros and cons of each mode of IBTrACS data available.</span>
<span class="sd">    </span>
<span class="sd">    .. note::</span>
<span class="sd">    </span>
<span class="sd">        1. If using ``basin=&quot;both&quot;``, this combines the North Atlantic and East/Central Pacific HURDATv2 data into a single TrackDataset object. As of Tropycal v0.5, this now merges cross-basin storms (i.e., North Atlantic to East Pacific) which were reclassified with a new East Pacific ID into single Storm objects.</span>
<span class="sd">        </span>
<span class="sd">        2. If using ``basin=&quot;australia&quot;, source=&quot;ibtracs&quot;``, since IBTrACS doesn&#39;t provide an Australia-only basin file by default, this will fetch the full global IBTrACS data and filter storms to only those that existed in the Australia basin.</span>
<span class="sd">    &quot;&quot;&quot;</span>
 
    <span class="k">def</span> <span class="fm">__repr__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
         
        <span class="n">summary</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;&lt;tropycal.tracks.Dataset&gt;&quot;</span><span class="p">]</span>
        
        <span class="c1">#Find maximum wind and minimum pressure</span>
        <span class="n">max_wind</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">nanmax</span><span class="p">([</span><span class="n">x</span> <span class="k">for</span> <span class="n">stormid</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">keys</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="n">stormid</span><span class="p">][</span><span class="s1">&#39;vmax&#39;</span><span class="p">]]))</span>
        <span class="n">max_wind_name</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
        <span class="n">min_mslp</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">nanmin</span><span class="p">([</span><span class="n">x</span> <span class="k">for</span> <span class="n">stormid</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">keys</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="n">stormid</span><span class="p">][</span><span class="s1">&#39;mslp&#39;</span><span class="p">]]))</span>
        <span class="n">min_mslp_name</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
        
        <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">keys</span><span class="p">[::</span><span class="o">-</span><span class="mi">1</span><span class="p">]:</span>
            <span class="n">array_vmax</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="n">key</span><span class="p">][</span><span class="s1">&#39;vmax&#39;</span><span class="p">])</span>
            <span class="n">array_mslp</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="n">key</span><span class="p">][</span><span class="s1">&#39;mslp&#39;</span><span class="p">])</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">array_vmax</span><span class="p">[</span><span class="o">~</span><span class="n">np</span><span class="o">.</span><span class="n">isnan</span><span class="p">(</span><span class="n">array_vmax</span><span class="p">)])</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="ow">and</span> <span class="n">np</span><span class="o">.</span><span class="n">nanmax</span><span class="p">(</span><span class="n">array_vmax</span><span class="p">)</span> <span class="o">==</span> <span class="n">max_wind</span><span class="p">:</span>
                <span class="n">max_wind_name</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="n">key</span><span class="p">][</span><span class="s1">&#39;name&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">title</span><span class="p">()</span><span class="si">}</span><span class="s2"> </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="n">key</span><span class="p">][</span><span class="s1">&#39;year&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2">&quot;</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">array_mslp</span><span class="p">[</span><span class="o">~</span><span class="n">np</span><span class="o">.</span><span class="n">isnan</span><span class="p">(</span><span class="n">array_mslp</span><span class="p">)])</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="ow">and</span> <span class="n">np</span><span class="o">.</span><span class="n">nanmin</span><span class="p">(</span><span class="n">array_mslp</span><span class="p">)</span> <span class="o">==</span> <span class="n">min_mslp</span><span class="p">:</span>
                <span class="n">min_mslp_name</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="n">key</span><span class="p">][</span><span class="s1">&#39;name&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">title</span><span class="p">()</span><span class="si">}</span><span class="s2"> </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="n">key</span><span class="p">][</span><span class="s1">&#39;year&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2">&quot;</span>

        <span class="c1">#Add general summary</span>
        <span class="n">emdash</span> <span class="o">=</span> <span class="s1">&#39;</span><span class="se">\u2014</span><span class="s1">&#39;</span>
        <span class="n">summary_keys</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;Basin&#39;</span><span class="p">:</span><span class="bp">self</span><span class="o">.</span><span class="n">basin</span><span class="p">,</span>\
                        <span class="s1">&#39;Source&#39;</span><span class="p">:</span><span class="bp">self</span><span class="o">.</span><span class="n">source</span><span class="o">+</span><span class="p">[</span><span class="s1">&#39;, &#39;</span><span class="o">+</span><span class="bp">self</span><span class="o">.</span><span class="n">ibtracs_mode</span><span class="p">,</span><span class="s1">&#39;&#39;</span><span class="p">][</span><span class="bp">self</span><span class="o">.</span><span class="n">source</span><span class="o">==</span><span class="s1">&#39;hurdat&#39;</span><span class="p">],</span>\
                        <span class="s1">&#39;Number of storms&#39;</span><span class="p">:</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">keys</span><span class="p">),</span>\
                        <span class="s1">&#39;Maximum wind&#39;</span><span class="p">:</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">max_wind</span><span class="si">}</span><span class="s2"> knots (</span><span class="si">{</span><span class="n">max_wind_name</span><span class="si">}</span><span class="s2">)&quot;</span><span class="p">,</span>
                        <span class="s1">&#39;Minimum pressure&#39;</span><span class="p">:</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">min_mslp</span><span class="si">}</span><span class="s2"> hPa (</span><span class="si">{</span><span class="n">min_mslp_name</span><span class="si">}</span><span class="s2">)&quot;</span><span class="p">,</span>
                        <span class="s1">&#39;Year range&#39;</span><span class="p">:</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">keys</span><span class="p">[</span><span class="mi">0</span><span class="p">]][</span><span class="s1">&#39;year&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2"> </span><span class="si">{</span><span class="n">emdash</span><span class="si">}</span><span class="s2"> </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">keys</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]][</span><span class="s1">&#39;year&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">}</span>
        
        <span class="c1">#Add dataset summary</span>
        <span class="n">summary</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;Dataset Summary:&quot;</span><span class="p">)</span>
        <span class="n">add_space</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">([</span><span class="nb">len</span><span class="p">(</span><span class="n">key</span><span class="p">)</span> <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="n">summary_keys</span><span class="o">.</span><span class="n">keys</span><span class="p">()])</span><span class="o">+</span><span class="mi">3</span>
        <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="n">summary_keys</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
            <span class="n">key_name</span> <span class="o">=</span> <span class="n">key</span><span class="o">+</span><span class="s2">&quot;:&quot;</span>
            <span class="n">summary</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="s2">&quot; &quot;</span><span class="o">*</span><span class="mi">4</span><span class="si">}{</span><span class="n">key_name</span><span class="si">:</span><span class="s1">&lt;</span><span class="si">{</span><span class="n">add_space</span><span class="si">}}{</span><span class="n">summary_keys</span><span class="p">[</span><span class="n">key</span><span class="p">]</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>

        <span class="k">return</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">summary</span><span class="p">)</span>
    
    
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">basin</span><span class="o">=</span><span class="s1">&#39;north_atlantic&#39;</span><span class="p">,</span><span class="n">source</span><span class="o">=</span><span class="s1">&#39;hurdat&#39;</span><span class="p">,</span><span class="n">include_btk</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span><span class="n">interpolate_data</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span><span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        
        <span class="c1">#kwargs</span>
        <span class="n">atlantic_url</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;atlantic_url&#39;</span><span class="p">,</span> <span class="s1">&#39;https://www.aoml.noaa.gov/hrd/hurdat/hurdat2.html&#39;</span><span class="p">)</span>
        <span class="n">pacific_url</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;pacific_url&#39;</span><span class="p">,</span> <span class="s1">&#39;https://www.aoml.noaa.gov/hrd/hurdat/hurdat2-nepac.html&#39;</span><span class="p">)</span>
        <span class="n">ibtracs_url</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;ibtracs_url&#39;</span><span class="p">,</span> <span class="s1">&#39;https://www.ncei.noaa.gov/data/international-best-track-archive-for-climate-stewardship-ibtracs/v04r00/access/csv/ibtracs.(basin).list.v04r00.csv&#39;</span><span class="p">)</span>
        <span class="n">ibtracs_mode</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;ibtracs_mode&#39;</span><span class="p">,</span> <span class="s1">&#39;jtwc&#39;</span><span class="p">)</span>
        <span class="n">catarina</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;catarina&#39;</span><span class="p">,</span> <span class="kc">False</span><span class="p">)</span>
        <span class="n">ibtracs_hurdat</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;ibtracs_hurdat&#39;</span><span class="p">,</span> <span class="kc">False</span><span class="p">)</span>
        
        <span class="c1">#Error check</span>
        <span class="k">if</span> <span class="n">ibtracs_mode</span> <span class="ow">not</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;wmo&#39;</span><span class="p">,</span><span class="s1">&#39;jtwc&#39;</span><span class="p">,</span><span class="s1">&#39;jtwc_neumann&#39;</span><span class="p">]:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;ibtracs_mode must be either &#39;wmo&#39;, &#39;jtwc&#39;, or &#39;jtwc_neumann&#39;&quot;</span><span class="p">)</span>
        
        <span class="c1">#Store input arguments</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">proj</span> <span class="o">=</span> <span class="kc">None</span> <span class="c1">#for plotting</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">basin</span> <span class="o">=</span> <span class="n">basin</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">atlantic_url</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">atlantic_url</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">pacific_url</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">pacific_url</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ibtracs_url</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">ibtracs_url</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">source</span> <span class="o">=</span> <span class="n">source</span>
        
        <span class="c1">#Modification flags</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">catarina</span> <span class="o">=</span> <span class="n">catarina</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ibtracs_mode</span> <span class="o">=</span> <span class="n">ibtracs_mode</span>
        <span class="k">if</span> <span class="n">ibtracs_mode</span> <span class="o">==</span> <span class="s1">&#39;jtwc_neumann&#39;</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">neumann</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">neumann</span> <span class="o">=</span> <span class="kc">False</span>
        
        <span class="c1">#initialize empty dict</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">data</span> <span class="o">=</span> <span class="p">{}</span>
        
        <span class="c1">#Read in from specified data source</span>
        <span class="k">if</span> <span class="n">source</span> <span class="o">==</span> <span class="s1">&#39;hurdat&#39;</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">__read_hurdat</span><span class="p">()</span>
        <span class="k">elif</span> <span class="n">source</span> <span class="o">==</span> <span class="s1">&#39;ibtracs&#39;</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">__read_ibtracs</span><span class="p">()</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span><span class="s2">&quot;Accepted values for &#39;source&#39; are &#39;hurdat&#39; or &#39;ibtracs&#39;&quot;</span><span class="p">)</span>
            
        <span class="c1">#Replace ibtracs with hurdat for atl/pac basins</span>
        <span class="k">if</span> <span class="n">source</span> <span class="o">==</span> <span class="s1">&#39;ibtracs&#39;</span> <span class="ow">and</span> <span class="n">ibtracs_hurdat</span><span class="p">:</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">basin</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;north_atlantic&#39;</span><span class="p">,</span><span class="s1">&#39;east_pacific&#39;</span><span class="p">]:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">__read_hurdat</span><span class="p">()</span>
            <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">basin</span> <span class="o">==</span> <span class="s1">&#39;all&#39;</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">basin</span> <span class="o">=</span> <span class="s1">&#39;both&#39;</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">__read_hurdat</span><span class="p">(</span><span class="n">override_basin</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">basin</span> <span class="o">=</span> <span class="s1">&#39;all&#39;</span>
        
        <span class="c1">#Read in best track data</span>
        <span class="k">if</span> <span class="n">include_btk</span> <span class="o">==</span> <span class="kc">True</span> <span class="ow">and</span> <span class="n">basin</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;north_atlantic&#39;</span><span class="p">,</span><span class="s1">&#39;east_pacific&#39;</span><span class="p">,</span><span class="s1">&#39;both&#39;</span><span class="p">]:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">__read_btk</span><span class="p">()</span>
        
        <span class="c1">#Delete duplicate entries</span>
        <span class="n">check</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">check_ids</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">keys</span> <span class="o">=</span> <span class="p">[</span><span class="n">k</span> <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">keys</span><span class="p">()]</span>
        <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="n">keys</span><span class="p">:</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="n">key</span><span class="p">][</span><span class="s1">&#39;name&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="o">==</span> <span class="s1">&#39;unnamed&#39;</span><span class="p">:</span> <span class="k">continue</span>
            <span class="n">check_id</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="n">key</span><span class="p">][</span><span class="s1">&#39;name&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2">,</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="n">key</span><span class="p">][</span><span class="s1">&#39;year&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2">,</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="n">key</span><span class="p">][</span><span class="s1">&#39;date&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">month</span><span class="si">}</span><span class="s2">&quot;</span>
            <span class="k">if</span> <span class="n">check_id</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">check</span><span class="p">:</span>
                <span class="n">check</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">check_id</span><span class="p">)</span>
                <span class="n">check_ids</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">key</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">existing_id</span> <span class="o">=</span> <span class="n">check_ids</span><span class="p">[</span><span class="n">check</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="n">check_id</span><span class="p">)]</span>
                <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="n">key</span><span class="p">][</span><span class="s1">&#39;vmax&#39;</span><span class="p">])</span> <span class="o">&gt;</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="n">existing_id</span><span class="p">][</span><span class="s1">&#39;vmax&#39;</span><span class="p">]):</span>
                    <span class="k">del</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="n">existing_id</span><span class="p">]</span>
                    <span class="n">check_ids</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="n">check_ids</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="n">existing_id</span><span class="p">))</span>
                    <span class="n">check_ids</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">key</span><span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="k">del</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="n">key</span><span class="p">]</span>
        
        <span class="c1">#Join storms for atlantic-pacific crossovers</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">basin</span> <span class="o">==</span> <span class="s1">&#39;both&#39;</span><span class="p">:</span>
            <span class="n">join_keys</span> <span class="o">=</span> <span class="p">[[</span><span class="s1">&#39;AL081993&#39;</span><span class="p">,</span><span class="s1">&#39;EP141993&#39;</span><span class="p">],[</span><span class="s1">&#39;AL181971&#39;</span><span class="p">,</span><span class="s1">&#39;EP151971&#39;</span><span class="p">],[</span><span class="s1">&#39;AL141974&#39;</span><span class="p">,</span><span class="s1">&#39;EP151974&#39;</span><span class="p">],[</span><span class="s1">&#39;AL161978&#39;</span><span class="p">,</span><span class="s1">&#39;EP151978&#39;</span><span class="p">],[</span><span class="s1">&#39;AL111988&#39;</span><span class="p">,</span><span class="s1">&#39;EP131988&#39;</span><span class="p">],[</span><span class="s1">&#39;AL031996&#39;</span><span class="p">,</span><span class="s1">&#39;EP071996&#39;</span><span class="p">]]</span>
            <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="n">join_keys</span><span class="p">:</span>

                <span class="c1">#Append East Pacific data to Atlantic data</span>
                <span class="k">for</span> <span class="n">idx</span><span class="p">,</span><span class="n">i_time</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="n">key</span><span class="p">[</span><span class="mi">1</span><span class="p">]][</span><span class="s1">&#39;date&#39;</span><span class="p">]):</span>
                    <span class="k">if</span> <span class="n">i_time</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="n">key</span><span class="p">[</span><span class="mi">0</span><span class="p">]][</span><span class="s1">&#39;date&#39;</span><span class="p">]:</span> <span class="k">continue</span>
                    <span class="k">for</span> <span class="n">var</span> <span class="ow">in</span> <span class="p">[</span><span class="n">i</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="n">key</span><span class="p">[</span><span class="mi">1</span><span class="p">]]</span><span class="o">.</span><span class="n">keys</span><span class="p">()</span> <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="n">key</span><span class="p">[</span><span class="mi">1</span><span class="p">]][</span><span class="n">i</span><span class="p">],</span><span class="nb">list</span><span class="p">)]:</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="n">key</span><span class="p">[</span><span class="mi">0</span><span class="p">]][</span><span class="n">var</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="n">key</span><span class="p">[</span><span class="mi">1</span><span class="p">]][</span><span class="n">var</span><span class="p">][</span><span class="n">idx</span><span class="p">])</span>
                    <span class="k">if</span> <span class="n">i_time</span><span class="o">.</span><span class="n">strftime</span><span class="p">(</span><span class="s1">&#39;%H%M&#39;</span><span class="p">)</span> <span class="ow">in</span> <span class="n">constants</span><span class="o">.</span><span class="n">STANDARD_HOURS</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="n">key</span><span class="p">[</span><span class="mi">1</span><span class="p">]][</span><span class="s1">&#39;type&#39;</span><span class="p">][</span><span class="n">idx</span><span class="p">]</span> <span class="ow">in</span> <span class="n">constants</span><span class="o">.</span><span class="n">NAMED_TROPICAL_STORM_TYPES</span><span class="p">:</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="n">key</span><span class="p">[</span><span class="mi">0</span><span class="p">]][</span><span class="s1">&#39;ace&#39;</span><span class="p">]</span> <span class="o">+=</span> <span class="n">accumulated_cyclone_energy</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="n">key</span><span class="p">[</span><span class="mi">1</span><span class="p">]][</span><span class="s1">&#39;vmax&#39;</span><span class="p">][</span><span class="n">idx</span><span class="p">])</span>

                <span class="c1">#Rename storm if needed</span>
                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="n">key</span><span class="p">[</span><span class="mi">1</span><span class="p">]][</span><span class="s1">&#39;name&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="o">==</span> <span class="s1">&#39;unnamed&#39;</span> <span class="ow">or</span> <span class="n">np</span><span class="o">.</span><span class="n">nanmax</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="n">key</span><span class="p">[</span><span class="mi">1</span><span class="p">]][</span><span class="s1">&#39;vmax&#39;</span><span class="p">])</span> <span class="o">&lt;</span> <span class="mi">35</span><span class="p">:</span>
                    <span class="k">pass</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="n">key</span><span class="p">[</span><span class="mi">0</span><span class="p">]][</span><span class="s1">&#39;name&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="n">key</span><span class="p">[</span><span class="mi">0</span><span class="p">]][</span><span class="s1">&#39;name&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2">-</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="n">key</span><span class="p">[</span><span class="mi">1</span><span class="p">]][</span><span class="s1">&#39;name&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2">&quot;</span>

                <span class="c1">#Remove Pacific storm from data</span>
                <span class="k">del</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="n">key</span><span class="p">[</span><span class="mi">1</span><span class="p">]]</span>
        
        <span class="c1">#Add keys of all storms to object</span>
        <span class="n">keys</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">keys</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">keys</span> <span class="o">=</span> <span class="p">[</span><span class="n">k</span> <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="n">keys</span><span class="p">]</span>
        
        <span class="c1">#Create array of zero-ones for existence of tornado data for a given storm</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">keys_tors</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span> <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">keys</span><span class="p">]</span>
        
        <span class="c1">#Add dict to store all storm-specific tornado data in</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">data_tors</span> <span class="o">=</span> <span class="p">{}</span>
        
        <span class="c1"># If interpolate_data, interpolate each storm and save to dictionary.</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">data_interp</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="k">if</span> <span class="n">interpolate_data</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">__interpolate_storms</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">keys</span><span class="p">)</span>
    
    <span class="k">def</span> <span class="nf">__read_hurdat</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">override_basin</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
        
        <span class="sa">r</span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Reads in HURDATv2 data into the Dataset object.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        
        <span class="c1">#Time duration to read in HURDAT</span>
        <span class="n">start_time</span> <span class="o">=</span> <span class="n">dt</span><span class="o">.</span><span class="n">now</span><span class="p">()</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;--&gt; Starting to read in HURDAT2 data&quot;</span><span class="p">)</span>
        
        <span class="c1">#Quick error check</span>
        <span class="n">atl_online</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="n">pac_online</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="n">fcheck</span> <span class="o">=</span> <span class="s2">&quot;https://www.nhc.noaa.gov/data/hurdat/&quot;</span>
        <span class="n">fcheck2</span> <span class="o">=</span> <span class="s2">&quot;https://www.aoml.noaa.gov/hrd/hurdat/&quot;</span>
        <span class="k">if</span> <span class="n">fcheck</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">atlantic_url</span> <span class="ow">and</span> <span class="n">fcheck2</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">atlantic_url</span><span class="p">:</span>
            <span class="k">if</span> <span class="s2">&quot;http&quot;</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">atlantic_url</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span><span class="s2">&quot;URL provided is not via NHC or HRD&quot;</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">atl_online</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="k">if</span> <span class="n">fcheck</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">pacific_url</span> <span class="ow">and</span> <span class="n">fcheck2</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">pacific_url</span><span class="p">:</span>
            <span class="k">if</span> <span class="s2">&quot;http&quot;</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">pacific_url</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span><span class="s2">&quot;URL provided is not via NHC or HRD&quot;</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">pac_online</span> <span class="o">=</span> <span class="kc">False</span>
        
        <span class="c1">#Check if basin is valid</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">basin</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="ow">not</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;north_atlantic&#39;</span><span class="p">,</span><span class="s1">&#39;east_pacific&#39;</span><span class="p">,</span><span class="s1">&#39;both&#39;</span><span class="p">]:</span>
            <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span><span class="s2">&quot;Only valid basins are &#39;north_atlantic&#39;, &#39;east_pacific&#39; or &#39;both&#39;&quot;</span><span class="p">)</span>
        
        <span class="k">def</span> <span class="nf">read_hurdat</span><span class="p">(</span><span class="n">path</span><span class="p">,</span><span class="n">flag</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">flag</span><span class="p">:</span>
                <span class="n">content</span> <span class="o">=</span> <span class="n">read_url</span><span class="p">(</span><span class="n">path</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">f</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span><span class="n">path</span><span class="p">,</span><span class="s2">&quot;r&quot;</span><span class="p">)</span>
                <span class="n">content</span> <span class="o">=</span> <span class="n">f</span><span class="o">.</span><span class="n">readlines</span><span class="p">()</span>
                <span class="n">content</span> <span class="o">=</span> <span class="p">[(</span><span class="n">i</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot; &quot;</span><span class="p">,</span><span class="s2">&quot;&quot;</span><span class="p">))</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;,&quot;</span><span class="p">)</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">content</span><span class="p">]</span>
                <span class="n">f</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
            <span class="k">return</span> <span class="n">content</span>
        
        <span class="c1">#read in HURDAT2 file from URL</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">basin</span> <span class="o">==</span> <span class="s1">&#39;north_atlantic&#39;</span><span class="p">:</span>
            <span class="n">content</span> <span class="o">=</span> <span class="n">read_hurdat</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">atlantic_url</span><span class="p">,</span><span class="n">atl_online</span><span class="p">)</span>
        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">basin</span> <span class="o">==</span> <span class="s1">&#39;east_pacific&#39;</span><span class="p">:</span>
            <span class="n">content</span> <span class="o">=</span> <span class="n">read_hurdat</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">pacific_url</span><span class="p">,</span><span class="n">pac_online</span><span class="p">)</span>
        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">basin</span> <span class="o">==</span> <span class="s1">&#39;both&#39;</span><span class="p">:</span>
            <span class="n">content</span> <span class="o">=</span> <span class="n">read_hurdat</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">atlantic_url</span><span class="p">,</span><span class="n">atl_online</span><span class="p">)</span>
            <span class="n">content</span> <span class="o">+=</span> <span class="n">read_hurdat</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">pacific_url</span><span class="p">,</span><span class="n">pac_online</span><span class="p">)</span>
        
        <span class="c1">#keep current storm ID for iteration</span>
        <span class="n">current_id</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
        
        <span class="c1">#iterate through every line</span>
        <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="n">content</span><span class="p">:</span>
            
            <span class="c1">#Skip if line is empty</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">line</span><span class="p">)</span> <span class="o">&lt;</span> <span class="mi">2</span><span class="p">:</span> <span class="k">continue</span>
            <span class="k">if</span> <span class="n">line</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;&lt;&quot;</span><span class="p">:</span> <span class="k">continue</span>
            
            <span class="c1">#identify if this is a header for a storm or content of storm</span>
            <span class="k">if</span> <span class="n">line</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;A&#39;</span><span class="p">,</span><span class="s1">&#39;C&#39;</span><span class="p">,</span><span class="s1">&#39;E&#39;</span><span class="p">]:</span>
                
                <span class="c1">#Determine basin</span>
                <span class="n">add_basin</span> <span class="o">=</span> <span class="s1">&#39;north_atlantic&#39;</span>
                <span class="k">if</span> <span class="n">line</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;C&#39;</span><span class="p">:</span>
                    <span class="n">add_basin</span> <span class="o">=</span> <span class="s1">&#39;east_pacific&#39;</span>
                <span class="k">elif</span> <span class="n">line</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;E&#39;</span><span class="p">:</span>
                    <span class="n">add_basin</span> <span class="o">=</span> <span class="s1">&#39;east_pacific&#39;</span>
                <span class="k">if</span> <span class="n">override_basin</span><span class="p">:</span>
                    <span class="n">add_basin</span> <span class="o">=</span> <span class="s1">&#39;all&#39;</span>
                
                <span class="c1">#add empty entry into dict</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="n">line</span><span class="p">[</span><span class="mi">0</span><span class="p">]]</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;id&#39;</span><span class="p">:</span><span class="n">line</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span><span class="s1">&#39;operational_id&#39;</span><span class="p">:</span><span class="s1">&#39;&#39;</span><span class="p">,</span><span class="s1">&#39;name&#39;</span><span class="p">:</span><span class="n">line</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span><span class="s1">&#39;year&#39;</span><span class="p">:</span><span class="nb">int</span><span class="p">(</span><span class="n">line</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">4</span><span class="p">:]),</span><span class="s1">&#39;season&#39;</span><span class="p">:</span><span class="nb">int</span><span class="p">(</span><span class="n">line</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">4</span><span class="p">:]),</span><span class="s1">&#39;basin&#39;</span><span class="p">:</span><span class="n">add_basin</span><span class="p">,</span><span class="s1">&#39;source_info&#39;</span><span class="p">:</span><span class="s1">&#39;NHC Hurricane Database&#39;</span><span class="p">}</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="n">line</span><span class="p">[</span><span class="mi">0</span><span class="p">]][</span><span class="s1">&#39;source&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">source</span>
                <span class="n">current_id</span> <span class="o">=</span> <span class="n">line</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
                
                <span class="c1">#add empty lists</span>
                <span class="k">for</span> <span class="n">val</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;date&#39;</span><span class="p">,</span><span class="s1">&#39;extra_obs&#39;</span><span class="p">,</span><span class="s1">&#39;special&#39;</span><span class="p">,</span><span class="s1">&#39;type&#39;</span><span class="p">,</span><span class="s1">&#39;lat&#39;</span><span class="p">,</span><span class="s1">&#39;lon&#39;</span><span class="p">,</span><span class="s1">&#39;vmax&#39;</span><span class="p">,</span><span class="s1">&#39;mslp&#39;</span><span class="p">,</span><span class="s1">&#39;wmo_basin&#39;</span><span class="p">]:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="n">line</span><span class="p">[</span><span class="mi">0</span><span class="p">]][</span><span class="n">val</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="n">line</span><span class="p">[</span><span class="mi">0</span><span class="p">]][</span><span class="s1">&#39;ace&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mf">0.0</span>
                
            <span class="c1">#if not a header, enter storm info into its dict entry</span>
            <span class="k">else</span><span class="p">:</span>
                
                <span class="c1">#Retrieve important info about storm</span>
                <span class="n">yyyymmdd</span><span class="p">,</span><span class="n">hhmm</span><span class="p">,</span><span class="n">special</span><span class="p">,</span><span class="n">storm_type</span><span class="p">,</span><span class="n">lat</span><span class="p">,</span><span class="n">lon</span><span class="p">,</span><span class="n">vmax</span><span class="p">,</span><span class="n">mslp</span> <span class="o">=</span> <span class="n">line</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="mi">8</span><span class="p">]</span>
                
                <span class="c1">#Check date doesn&#39;t already exist in dict</span>
                <span class="n">date</span> <span class="o">=</span> <span class="n">dt</span><span class="o">.</span><span class="n">strptime</span><span class="p">(</span><span class="n">yyyymmdd</span><span class="o">+</span><span class="n">hhmm</span><span class="p">,</span><span class="s1">&#39;%Y%m</span><span class="si">%d</span><span class="s1">%H%M&#39;</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">date</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="n">current_id</span><span class="p">][</span><span class="s1">&#39;date&#39;</span><span class="p">]:</span>
                    <span class="c1">#Hard-code fix</span>
                    <span class="k">if</span> <span class="n">current_id</span> <span class="o">==</span> <span class="s2">&quot;AL151966&quot;</span> <span class="ow">and</span> <span class="n">yyyymmdd</span> <span class="o">==</span> <span class="s2">&quot;19661004&quot;</span><span class="p">:</span>
                        <span class="n">date</span> <span class="o">=</span> <span class="n">dt</span><span class="o">.</span><span class="n">strptime</span><span class="p">(</span><span class="s2">&quot;19661006&quot;</span><span class="o">+</span><span class="n">hhmm</span><span class="p">,</span><span class="s1">&#39;%Y%m</span><span class="si">%d</span><span class="s1">%H%M&#39;</span><span class="p">)</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="k">continue</span>
                
                <span class="c1">#Parse into format to be entered into dict</span>
                <span class="k">if</span> <span class="s2">&quot;N&quot;</span> <span class="ow">in</span> <span class="n">lat</span><span class="p">:</span>
                    <span class="n">lat</span> <span class="o">=</span> <span class="nb">round</span><span class="p">(</span><span class="nb">float</span><span class="p">(</span><span class="n">lat</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;N&quot;</span><span class="p">)[</span><span class="mi">0</span><span class="p">]),</span><span class="mi">1</span><span class="p">)</span>
                <span class="k">elif</span> <span class="s2">&quot;S&quot;</span> <span class="ow">in</span> <span class="n">lat</span><span class="p">:</span>
                    <span class="n">lat</span> <span class="o">=</span> <span class="nb">round</span><span class="p">(</span><span class="nb">float</span><span class="p">(</span><span class="n">lat</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;N&quot;</span><span class="p">)[</span><span class="mi">0</span><span class="p">]),</span><span class="mi">1</span><span class="p">)</span> <span class="o">*</span> <span class="o">-</span><span class="mf">1.0</span>
                <span class="k">if</span> <span class="s2">&quot;W&quot;</span> <span class="ow">in</span> <span class="n">lon</span><span class="p">:</span>
                    <span class="n">lon</span> <span class="o">=</span> <span class="nb">round</span><span class="p">(</span><span class="nb">float</span><span class="p">(</span><span class="n">lon</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;W&quot;</span><span class="p">)[</span><span class="mi">0</span><span class="p">]),</span><span class="mi">1</span><span class="p">)</span> <span class="o">*</span> <span class="o">-</span><span class="mf">1.0</span>
                <span class="k">elif</span> <span class="s2">&quot;E&quot;</span> <span class="ow">in</span> <span class="n">lon</span><span class="p">:</span>
                    <span class="n">lon</span> <span class="o">=</span> <span class="nb">round</span><span class="p">(</span><span class="nb">float</span><span class="p">(</span><span class="n">lon</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;E&quot;</span><span class="p">)[</span><span class="mi">0</span><span class="p">]),</span><span class="mi">1</span><span class="p">)</span>
                <span class="n">vmax</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">vmax</span><span class="p">)</span>
                <span class="n">mslp</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">mslp</span><span class="p">)</span>
                
                <span class="c1">#Fix longitude for Atlantic storms east of the prime meridian</span>
                <span class="k">if</span> <span class="n">add_basin</span> <span class="o">==</span> <span class="s1">&#39;north_atlantic&#39;</span> <span class="ow">and</span> <span class="n">lon</span> <span class="o">&lt;</span> <span class="o">-</span><span class="mi">180</span><span class="p">:</span>
                    <span class="n">lon</span> <span class="o">+=</span> <span class="mf">360.0</span>
                
                <span class="c1">#Handle missing data</span>
                <span class="k">if</span> <span class="n">vmax</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">:</span> <span class="n">vmax</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nan</span>
                <span class="k">if</span> <span class="n">mslp</span> <span class="o">&lt;</span> <span class="mi">800</span><span class="p">:</span> <span class="n">mslp</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nan</span>
                    
                <span class="c1">#Handle off-hour obs</span>
                <span class="k">if</span> <span class="n">hhmm</span> <span class="ow">in</span> <span class="n">constants</span><span class="o">.</span><span class="n">STANDARD_HOURS</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="n">current_id</span><span class="p">][</span><span class="s1">&#39;extra_obs&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="n">current_id</span><span class="p">][</span><span class="s1">&#39;extra_obs&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
                    
                <span class="c1">#Fix storm type for cross-dateline storms</span>
                <span class="n">storm_type</span> <span class="o">=</span> <span class="n">storm_type</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;ST&quot;</span><span class="p">,</span><span class="s2">&quot;HU&quot;</span><span class="p">)</span>
                <span class="n">storm_type</span> <span class="o">=</span> <span class="n">storm_type</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;TY&quot;</span><span class="p">,</span><span class="s2">&quot;HU&quot;</span><span class="p">)</span>
                
                <span class="c1">#Append into dict</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="n">current_id</span><span class="p">][</span><span class="s1">&#39;date&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">date</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="n">current_id</span><span class="p">][</span><span class="s1">&#39;special&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">special</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="n">current_id</span><span class="p">][</span><span class="s1">&#39;type&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">storm_type</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="n">current_id</span><span class="p">][</span><span class="s1">&#39;lat&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">lat</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="n">current_id</span><span class="p">][</span><span class="s1">&#39;lon&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">lon</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="n">current_id</span><span class="p">][</span><span class="s1">&#39;vmax&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">vmax</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="n">current_id</span><span class="p">][</span><span class="s1">&#39;mslp&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">mslp</span><span class="p">)</span>
                
                <span class="c1">#Add basin</span>
                <span class="n">origin_basin</span> <span class="o">=</span> <span class="n">add_basin</span> <span class="o">+</span> <span class="s1">&#39;&#39;</span>
                <span class="k">if</span> <span class="n">add_basin</span> <span class="o">==</span> <span class="s1">&#39;east_pacific&#39;</span><span class="p">:</span>
                    <span class="n">check_basin</span> <span class="o">=</span> <span class="n">get_basin</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="n">current_id</span><span class="p">][</span><span class="s1">&#39;lat&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">],</span><span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="n">current_id</span><span class="p">][</span><span class="s1">&#39;lon&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">],</span><span class="n">add_basin</span><span class="p">)</span>
                    <span class="k">if</span> <span class="n">check_basin</span> <span class="o">!=</span> <span class="n">add_basin</span><span class="p">:</span> <span class="n">origin_basin</span> <span class="o">=</span> <span class="s1">&#39;north_atlantic&#39;</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="n">current_id</span><span class="p">][</span><span class="s1">&#39;wmo_basin&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">get_basin</span><span class="p">(</span><span class="n">lat</span><span class="p">,</span><span class="n">lon</span><span class="p">,</span><span class="n">origin_basin</span><span class="p">))</span>
                
                <span class="c1">#Calculate ACE &amp; append to storm total</span>
                <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">isnan</span><span class="p">(</span><span class="n">vmax</span><span class="p">)</span> <span class="o">==</span> <span class="kc">False</span><span class="p">:</span>
                    <span class="n">ace</span> <span class="o">=</span> <span class="p">(</span><span class="mi">10</span><span class="o">**-</span><span class="mi">4</span><span class="p">)</span> <span class="o">*</span> <span class="p">(</span><span class="n">vmax</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span>
                    <span class="k">if</span> <span class="n">hhmm</span> <span class="ow">in</span> <span class="n">constants</span><span class="o">.</span><span class="n">STANDARD_HOURS</span> <span class="ow">and</span> <span class="n">storm_type</span> <span class="ow">in</span> <span class="n">constants</span><span class="o">.</span><span class="n">NAMED_TROPICAL_STORM_TYPES</span><span class="p">:</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="n">current_id</span><span class="p">][</span><span class="s1">&#39;ace&#39;</span><span class="p">]</span> <span class="o">+=</span> <span class="n">np</span><span class="o">.</span><span class="n">round</span><span class="p">(</span><span class="n">ace</span><span class="p">,</span><span class="mi">4</span><span class="p">)</span>
        
        <span class="c1">#Account for operationally unnamed storms</span>
        <span class="n">current_year</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="n">current_year_id</span> <span class="o">=</span> <span class="mi">1</span>
        <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
            
            <span class="n">storm_data</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="n">key</span><span class="p">]</span>
            <span class="n">storm_name</span> <span class="o">=</span> <span class="n">storm_data</span><span class="p">[</span><span class="s1">&#39;name&#39;</span><span class="p">]</span>
            <span class="n">storm_year</span> <span class="o">=</span> <span class="n">storm_data</span><span class="p">[</span><span class="s1">&#39;year&#39;</span><span class="p">]</span>
            <span class="n">storm_vmax</span> <span class="o">=</span> <span class="n">storm_data</span><span class="p">[</span><span class="s1">&#39;vmax&#39;</span><span class="p">]</span>
            <span class="n">storm_id</span> <span class="o">=</span> <span class="n">storm_data</span><span class="p">[</span><span class="s1">&#39;id&#39;</span><span class="p">]</span>
            
            <span class="c1">#Get max wind for storm</span>
            <span class="n">np_wnd</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">storm_vmax</span><span class="p">)</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">np_wnd</span><span class="p">[</span><span class="o">~</span><span class="n">np</span><span class="o">.</span><span class="n">isnan</span><span class="p">(</span><span class="n">np_wnd</span><span class="p">)])</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                <span class="n">max_wnd</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nan</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">max_wnd</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">nanmax</span><span class="p">(</span><span class="n">storm_vmax</span><span class="p">))</span>
            
            <span class="c1">#Fix current year</span>
            <span class="k">if</span> <span class="n">current_year</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                <span class="n">current_year</span> <span class="o">=</span> <span class="n">storm_year</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">storm_year</span> <span class="o">!=</span> <span class="n">current_year</span><span class="p">:</span>
                    <span class="n">current_year</span> <span class="o">=</span> <span class="n">storm_year</span>
                    <span class="n">current_year_id</span> <span class="o">=</span> <span class="mi">1</span>
                    
                    <span class="c1">#special fix for 1992 in Atlantic</span>
                    <span class="k">if</span> <span class="n">current_year</span> <span class="o">==</span> <span class="mi">1992</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="n">current_id</span><span class="p">][</span><span class="s1">&#39;basin&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;north_atlantic&#39;</span><span class="p">:</span>
                        <span class="n">current_year_id</span> <span class="o">=</span> <span class="mi">2</span>
                
            <span class="c1">#Estimate operational storm ID (which sometimes differs from HURDAT2 ID)</span>
            <span class="n">blocked_list</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="n">potential_tcs</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;AL102017&#39;</span><span class="p">]</span>
            <span class="n">increment_but_pass</span> <span class="o">=</span> <span class="p">[]</span>
            
            <span class="k">if</span> <span class="n">storm_name</span> <span class="o">==</span> <span class="s1">&#39;UNNAMED&#39;</span> <span class="ow">and</span> <span class="n">max_wnd</span> <span class="o">!=</span> <span class="n">np</span><span class="o">.</span><span class="n">nan</span> <span class="ow">and</span> <span class="n">max_wnd</span> <span class="o">&gt;=</span> <span class="mi">34</span> <span class="ow">and</span> <span class="n">storm_id</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">blocked_list</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">storm_id</span> <span class="ow">in</span> <span class="n">increment_but_pass</span><span class="p">:</span> <span class="n">current_year_id</span> <span class="o">+=</span> <span class="mi">1</span>
                <span class="k">pass</span>
            <span class="k">elif</span> <span class="n">storm_id</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="mi">2</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;CP&#39;</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="n">key</span><span class="p">][</span><span class="s1">&#39;operational_id&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">storm_id</span> <span class="o">+</span> <span class="s1">&#39;&#39;</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="c1">#Skip potential TCs</span>
                <span class="k">if</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">storm_id</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="mi">2</span><span class="p">]</span><span class="si">}{</span><span class="n">num_to_str2</span><span class="p">(</span><span class="n">current_year_id</span><span class="p">)</span><span class="si">}{</span><span class="n">storm_year</span><span class="si">}</span><span class="s2">&quot;</span> <span class="ow">in</span> <span class="n">potential_tcs</span><span class="p">:</span>
                    <span class="n">current_year_id</span> <span class="o">+=</span> <span class="mi">1</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="n">key</span><span class="p">][</span><span class="s1">&#39;operational_id&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">storm_id</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="mi">2</span><span class="p">]</span><span class="si">}{</span><span class="n">num_to_str2</span><span class="p">(</span><span class="n">current_year_id</span><span class="p">)</span><span class="si">}{</span><span class="n">storm_year</span><span class="si">}</span><span class="s2">&quot;</span>
                <span class="n">current_year_id</span> <span class="o">+=</span> <span class="mi">1</span>
                
            <span class="c1">#Swap operational storm IDs, if necessary</span>
            <span class="n">swap_list</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;EP101994&#39;</span><span class="p">,</span><span class="s1">&#39;EP111994&#39;</span><span class="p">]</span>
            <span class="n">swap_pair</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;EP111994&#39;</span><span class="p">,</span><span class="s1">&#39;EP101994&#39;</span><span class="p">]</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="n">key</span><span class="p">][</span><span class="s1">&#39;operational_id&#39;</span><span class="p">]</span> <span class="ow">in</span> <span class="n">swap_list</span><span class="p">:</span>
                <span class="n">swap_idx</span> <span class="o">=</span> <span class="n">swap_list</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="n">key</span><span class="p">][</span><span class="s1">&#39;operational_id&#39;</span><span class="p">])</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="n">key</span><span class="p">][</span><span class="s1">&#39;operational_id&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">swap_pair</span><span class="p">[</span><span class="n">swap_idx</span><span class="p">]</span>

        <span class="c1">#Determine time elapsed</span>
        <span class="n">time_elapsed</span> <span class="o">=</span> <span class="n">dt</span><span class="o">.</span><span class="n">now</span><span class="p">()</span> <span class="o">-</span> <span class="n">start_time</span>
        <span class="n">tsec</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="nb">round</span><span class="p">(</span><span class="n">time_elapsed</span><span class="o">.</span><span class="n">total_seconds</span><span class="p">(),</span><span class="mi">2</span><span class="p">))</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;--&gt; Completed reading in HURDAT2 data (</span><span class="si">{</span><span class="n">tsec</span><span class="si">}</span><span class="s2"> seconds)&quot;</span><span class="p">)</span>
    
    
    <span class="k">def</span> <span class="nf">__read_btk</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        
        <span class="sa">r</span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Reads in best track data into the Dataset object.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="c1">#Time duration to read in best track</span>
        <span class="n">start_time</span> <span class="o">=</span> <span class="n">dt</span><span class="o">.</span><span class="n">now</span><span class="p">()</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;--&gt; Starting to read in best track data&quot;</span><span class="p">)</span>

        <span class="c1">#Get range of years missing</span>
        <span class="n">start_year</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[([</span><span class="n">k</span> <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">keys</span><span class="p">()])[</span><span class="o">-</span><span class="mi">1</span><span class="p">]][</span><span class="s1">&#39;year&#39;</span><span class="p">]</span> <span class="o">+</span> <span class="mi">1</span>
        <span class="n">end_year</span> <span class="o">=</span> <span class="p">(</span><span class="n">dt</span><span class="o">.</span><span class="n">now</span><span class="p">())</span><span class="o">.</span><span class="n">year</span>

        <span class="c1">#Get list of files in online directory</span>
        <span class="n">use_ftp</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">urlpath</span> <span class="o">=</span> <span class="n">urllib</span><span class="o">.</span><span class="n">request</span><span class="o">.</span><span class="n">urlopen</span><span class="p">(</span><span class="s1">&#39;https://ftp.nhc.noaa.gov/atcf/btk/&#39;</span><span class="p">)</span>
            <span class="n">string</span> <span class="o">=</span> <span class="n">urlpath</span><span class="o">.</span><span class="n">read</span><span class="p">()</span><span class="o">.</span><span class="n">decode</span><span class="p">(</span><span class="s1">&#39;utf-8&#39;</span><span class="p">)</span>
        <span class="k">except</span><span class="p">:</span>
            <span class="n">use_ftp</span> <span class="o">=</span> <span class="kc">True</span>
            <span class="n">urlpath</span> <span class="o">=</span> <span class="n">urllib</span><span class="o">.</span><span class="n">request</span><span class="o">.</span><span class="n">urlopen</span><span class="p">(</span><span class="s1">&#39;ftp://ftp.nhc.noaa.gov/atcf/btk/&#39;</span><span class="p">)</span>
            <span class="n">string</span> <span class="o">=</span> <span class="n">urlpath</span><span class="o">.</span><span class="n">read</span><span class="p">()</span><span class="o">.</span><span class="n">decode</span><span class="p">(</span><span class="s1">&#39;utf-8&#39;</span><span class="p">)</span>

        <span class="c1">#Get relevant filenames from directory</span>
        <span class="n">files</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">files_years</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">iyear</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">start_year</span><span class="p">,</span><span class="n">end_year</span><span class="o">+</span><span class="mi">1</span><span class="p">):</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">basin</span> <span class="o">==</span> <span class="s1">&#39;north_atlantic&#39;</span><span class="p">:</span>
                <span class="n">search_pattern</span> <span class="o">=</span> <span class="sa">f</span><span class="s1">&#39;bal[01234][0123456789]</span><span class="si">{</span><span class="n">iyear</span><span class="si">}</span><span class="s1">.dat&#39;</span>
            <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">basin</span> <span class="o">==</span> <span class="s1">&#39;east_pacific&#39;</span><span class="p">:</span>
                <span class="n">search_pattern</span> <span class="o">=</span> <span class="sa">f</span><span class="s1">&#39;b[ec]p[01234][0123456789]</span><span class="si">{</span><span class="n">iyear</span><span class="si">}</span><span class="s1">.dat&#39;</span>
            <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">basin</span> <span class="o">==</span> <span class="s1">&#39;both&#39;</span><span class="p">:</span>
                <span class="n">search_pattern</span> <span class="o">=</span> <span class="sa">f</span><span class="s1">&#39;b[aec][lp][01234][0123456789]</span><span class="si">{</span><span class="n">iyear</span><span class="si">}</span><span class="s1">.dat&#39;</span>

            <span class="n">pattern</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">compile</span><span class="p">(</span><span class="n">search_pattern</span><span class="p">)</span>
            <span class="n">filelist</span> <span class="o">=</span> <span class="n">pattern</span><span class="o">.</span><span class="n">findall</span><span class="p">(</span><span class="n">string</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">filename</span> <span class="ow">in</span> <span class="n">filelist</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">filename</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">files</span><span class="p">:</span> <span class="n">files</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">filename</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">iyear</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">files_years</span><span class="p">:</span> <span class="n">files_years</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">iyear</span><span class="p">)</span>

        <span class="c1">#If no files are available, go into archive directory</span>
        <span class="n">archive_years</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">iyear</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">start_year</span><span class="p">,</span><span class="n">end_year</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">iyear</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">files_years</span><span class="p">:</span>
                <span class="n">archive_years</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">iyear</span><span class="p">)</span>
            
            <span class="c1">#retrieve list of storms for that year from the archive</span>
            <span class="n">path_season</span> <span class="o">=</span> <span class="n">urllib</span><span class="o">.</span><span class="n">request</span><span class="o">.</span><span class="n">urlopen</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;http://hurricanes.ral.ucar.edu/repository/data/bdecks_open/</span><span class="si">{</span><span class="n">iyear</span><span class="si">}</span><span class="s1">/&#39;</span><span class="p">)</span>
            <span class="n">string</span> <span class="o">=</span> <span class="n">path_season</span><span class="o">.</span><span class="n">read</span><span class="p">()</span><span class="o">.</span><span class="n">decode</span><span class="p">(</span><span class="s1">&#39;utf-8&#39;</span><span class="p">)</span>
            <span class="n">nums</span> <span class="o">=</span> <span class="s2">&quot;[0123456789]&quot;</span>
            <span class="n">search_pattern</span> <span class="o">=</span> <span class="sa">f</span><span class="s1">&#39;bal[0123]</span><span class="si">{</span><span class="n">nums</span><span class="si">}{</span><span class="n">iyear</span><span class="si">}</span><span class="s1">.dat&#39;</span>
            <span class="n">pattern</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">compile</span><span class="p">(</span><span class="n">search_pattern</span><span class="p">)</span>
            <span class="n">filelist</span> <span class="o">=</span> <span class="n">pattern</span><span class="o">.</span><span class="n">findall</span><span class="p">(</span><span class="n">string</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">file</span> <span class="ow">in</span> <span class="n">filelist</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">file</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">files</span><span class="p">:</span> <span class="n">files</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">file</span><span class="p">)</span>
        
        <span class="c1">#For each file, read in file content and add to hurdat dict</span>
        <span class="k">for</span> <span class="n">file</span> <span class="ow">in</span> <span class="n">files</span><span class="p">:</span>

            <span class="c1">#Get file ID</span>
            <span class="n">stormid</span> <span class="o">=</span> <span class="p">((</span><span class="n">file</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;.dat&quot;</span><span class="p">)[</span><span class="mi">0</span><span class="p">])[</span><span class="mi">1</span><span class="p">:])</span><span class="o">.</span><span class="n">upper</span><span class="p">()</span>

            <span class="c1">#Determine basin</span>
            <span class="n">add_basin</span> <span class="o">=</span> <span class="s1">&#39;north_atlantic&#39;</span>
            <span class="k">if</span> <span class="n">stormid</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;C&#39;</span><span class="p">:</span>
                <span class="n">add_basin</span> <span class="o">=</span> <span class="s1">&#39;east_pacific&#39;</span>
            <span class="k">elif</span> <span class="n">stormid</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;E&#39;</span><span class="p">:</span>
                <span class="n">add_basin</span> <span class="o">=</span> <span class="s1">&#39;east_pacific&#39;</span>

            <span class="c1">#add empty entry into dict</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="n">stormid</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;id&#39;</span><span class="p">:</span><span class="n">stormid</span><span class="p">,</span><span class="s1">&#39;operational_id&#39;</span><span class="p">:</span><span class="n">stormid</span><span class="p">,</span><span class="s1">&#39;name&#39;</span><span class="p">:</span><span class="s1">&#39;&#39;</span><span class="p">,</span><span class="s1">&#39;year&#39;</span><span class="p">:</span><span class="nb">int</span><span class="p">(</span><span class="n">stormid</span><span class="p">[</span><span class="mi">4</span><span class="p">:</span><span class="mi">8</span><span class="p">]),</span><span class="s1">&#39;season&#39;</span><span class="p">:</span><span class="nb">int</span><span class="p">(</span><span class="n">stormid</span><span class="p">[</span><span class="mi">4</span><span class="p">:</span><span class="mi">8</span><span class="p">]),</span><span class="s1">&#39;basin&#39;</span><span class="p">:</span><span class="n">add_basin</span><span class="p">,</span><span class="s1">&#39;source_info&#39;</span><span class="p">:</span><span class="s1">&#39;NHC Hurricane Database&#39;</span><span class="p">,</span><span class="s1">&#39;source_method&#39;</span><span class="p">:</span><span class="s2">&quot;NHC&#39;s Automated Tropical Cyclone Forecasting System (ATCF)&quot;</span><span class="p">,</span><span class="s1">&#39;source_url&#39;</span><span class="p">:</span><span class="s2">&quot;https://ftp.nhc.noaa.gov/atcf/btk/&quot;</span><span class="p">}</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="n">stormid</span><span class="p">][</span><span class="s1">&#39;source&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">source</span>

            <span class="c1">#add empty lists</span>
            <span class="k">for</span> <span class="n">val</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;date&#39;</span><span class="p">,</span><span class="s1">&#39;extra_obs&#39;</span><span class="p">,</span><span class="s1">&#39;special&#39;</span><span class="p">,</span><span class="s1">&#39;type&#39;</span><span class="p">,</span><span class="s1">&#39;lat&#39;</span><span class="p">,</span><span class="s1">&#39;lon&#39;</span><span class="p">,</span><span class="s1">&#39;vmax&#39;</span><span class="p">,</span><span class="s1">&#39;mslp&#39;</span><span class="p">,</span><span class="s1">&#39;wmo_basin&#39;</span><span class="p">]:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="n">stormid</span><span class="p">][</span><span class="n">val</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="n">stormid</span><span class="p">][</span><span class="s1">&#39;ace&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mf">0.0</span>

            <span class="c1">#Read in file</span>
            <span class="k">if</span> <span class="n">use_ftp</span><span class="p">:</span>
                <span class="n">url</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;ftp://ftp.nhc.noaa.gov/atcf/btk/</span><span class="si">{</span><span class="n">file</span><span class="si">}</span><span class="s2">&quot;</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">url</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;https://ftp.nhc.noaa.gov/atcf/btk/</span><span class="si">{</span><span class="n">file</span><span class="si">}</span><span class="s2">&quot;</span>
            <span class="k">if</span> <span class="nb">int</span><span class="p">(</span><span class="n">stormid</span><span class="p">[</span><span class="mi">4</span><span class="p">:</span><span class="mi">8</span><span class="p">])</span> <span class="ow">in</span> <span class="n">archive_years</span><span class="p">:</span>
                <span class="n">url</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;http://hurricanes.ral.ucar.edu/repository/data/bdecks_open/</span><span class="si">{</span><span class="nb">int</span><span class="p">(</span><span class="n">stormid</span><span class="p">[</span><span class="mi">4</span><span class="p">:</span><span class="mi">8</span><span class="p">])</span><span class="si">}</span><span class="s2">/b</span><span class="si">{</span><span class="n">stormid</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span><span class="si">}</span><span class="s2">.dat&quot;</span>
            <span class="n">content</span> <span class="o">=</span> <span class="n">read_url</span><span class="p">(</span><span class="n">url</span><span class="p">)</span>

            <span class="c1">#iterate through file lines</span>
            <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="n">content</span><span class="p">:</span>

                <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">line</span><span class="p">)</span> <span class="o">&lt;</span> <span class="mi">28</span><span class="p">:</span> <span class="k">continue</span>

                <span class="c1">#Get date of obs</span>
                <span class="n">date</span> <span class="o">=</span> <span class="n">dt</span><span class="o">.</span><span class="n">strptime</span><span class="p">(</span><span class="n">line</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span><span class="s1">&#39;%Y%m</span><span class="si">%d</span><span class="s1">%H&#39;</span><span class="p">)</span>
                <span class="n">date_hhmm</span> <span class="o">=</span> <span class="n">date</span><span class="o">.</span><span class="n">strftime</span><span class="p">(</span><span class="s1">&#39;%H%M&#39;</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">date_hhmm</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">constants</span><span class="o">.</span><span class="n">STANDARD_HOURS</span><span class="p">:</span> <span class="k">continue</span>

                <span class="c1">#Ensure obs aren&#39;t being repeated</span>
                <span class="k">if</span> <span class="n">date</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="n">stormid</span><span class="p">][</span><span class="s1">&#39;date&#39;</span><span class="p">]:</span> <span class="k">continue</span>

                <span class="c1">#Get latitude into number</span>
                <span class="n">btk_lat_temp</span> <span class="o">=</span> <span class="n">line</span><span class="p">[</span><span class="mi">6</span><span class="p">]</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;N&quot;</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
                <span class="n">btk_lat</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">btk_lat_temp</span><span class="p">)</span> <span class="o">*</span> <span class="mf">0.1</span>

                <span class="c1">#Get longitude into number</span>
                <span class="k">if</span> <span class="s2">&quot;W&quot;</span> <span class="ow">in</span> <span class="n">line</span><span class="p">[</span><span class="mi">7</span><span class="p">]:</span>
                    <span class="n">btk_lon_temp</span> <span class="o">=</span> <span class="n">line</span><span class="p">[</span><span class="mi">7</span><span class="p">]</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;W&quot;</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
                    <span class="n">btk_lon</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">btk_lon_temp</span><span class="p">)</span> <span class="o">*</span> <span class="o">-</span><span class="mf">0.1</span>
                <span class="k">elif</span> <span class="s2">&quot;E&quot;</span> <span class="ow">in</span> <span class="n">line</span><span class="p">[</span><span class="mi">7</span><span class="p">]:</span>
                    <span class="n">btk_lon_temp</span> <span class="o">=</span> <span class="n">line</span><span class="p">[</span><span class="mi">7</span><span class="p">]</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;E&quot;</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
                    <span class="n">btk_lon</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">btk_lon_temp</span><span class="p">)</span> <span class="o">*</span> <span class="mf">0.1</span>

                <span class="c1">#Get other relevant variables</span>
                <span class="n">btk_wind</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">line</span><span class="p">[</span><span class="mi">8</span><span class="p">])</span>
                <span class="n">btk_mslp</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">line</span><span class="p">[</span><span class="mi">9</span><span class="p">])</span>
                <span class="n">btk_type</span> <span class="o">=</span> <span class="n">line</span><span class="p">[</span><span class="mi">10</span><span class="p">]</span>
                <span class="n">name</span> <span class="o">=</span> <span class="n">line</span><span class="p">[</span><span class="mi">27</span><span class="p">]</span>

                <span class="c1">#Replace with NaNs</span>
                <span class="k">if</span> <span class="n">btk_wind</span> <span class="o">&gt;</span> <span class="mi">250</span> <span class="ow">or</span> <span class="n">btk_wind</span> <span class="o">&lt;</span> <span class="mi">10</span><span class="p">:</span> <span class="n">btk_wind</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nan</span>
                <span class="k">if</span> <span class="n">btk_mslp</span> <span class="o">&gt;</span> <span class="mi">1040</span> <span class="ow">or</span> <span class="n">btk_mslp</span> <span class="o">&lt;</span> <span class="mi">800</span><span class="p">:</span> <span class="n">btk_mslp</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nan</span>

                <span class="c1">#Add extra obs</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="n">stormid</span><span class="p">][</span><span class="s1">&#39;extra_obs&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>

                <span class="c1">#Append into dict</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="n">stormid</span><span class="p">][</span><span class="s1">&#39;date&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">date</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="n">stormid</span><span class="p">][</span><span class="s1">&#39;special&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">&#39;&#39;</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="n">stormid</span><span class="p">][</span><span class="s1">&#39;type&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">btk_type</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="n">stormid</span><span class="p">][</span><span class="s1">&#39;lat&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">round</span><span class="p">(</span><span class="n">btk_lat</span><span class="p">,</span><span class="mi">1</span><span class="p">))</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="n">stormid</span><span class="p">][</span><span class="s1">&#39;lon&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">round</span><span class="p">(</span><span class="n">btk_lon</span><span class="p">,</span><span class="mi">1</span><span class="p">))</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="n">stormid</span><span class="p">][</span><span class="s1">&#39;vmax&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">btk_wind</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="n">stormid</span><span class="p">][</span><span class="s1">&#39;mslp&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">btk_mslp</span><span class="p">)</span>
                
                <span class="c1">#Add basin</span>
                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">basin</span> <span class="o">==</span> <span class="s1">&#39;both&#39;</span><span class="p">:</span>
                    <span class="n">origin_basin</span> <span class="o">=</span> <span class="s1">&#39;north_atlantic&#39;</span> <span class="k">if</span> <span class="n">stormid</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="mi">2</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;AL&#39;</span> <span class="k">else</span> <span class="s1">&#39;east_pacific&#39;</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">origin_basin</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">basin</span> <span class="o">+</span> <span class="s1">&#39;&#39;</span>
                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">basin</span> <span class="o">==</span> <span class="s1">&#39;east_pacific&#39;</span><span class="p">:</span>
                    <span class="n">check_basin</span> <span class="o">=</span> <span class="n">get_basin</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="n">stormid</span><span class="p">][</span><span class="s1">&#39;lat&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">],</span><span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="n">stormid</span><span class="p">][</span><span class="s1">&#39;lon&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">],</span><span class="bp">self</span><span class="o">.</span><span class="n">basin</span><span class="p">)</span>
                    <span class="k">if</span> <span class="n">check_basin</span> <span class="o">!=</span> <span class="bp">self</span><span class="o">.</span><span class="n">basin</span><span class="p">:</span> <span class="n">origin_basin</span> <span class="o">=</span> <span class="s1">&#39;north_atlantic&#39;</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="n">stormid</span><span class="p">][</span><span class="s1">&#39;wmo_basin&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">get_basin</span><span class="p">(</span><span class="n">btk_lat</span><span class="p">,</span><span class="n">btk_lon</span><span class="p">,</span><span class="n">origin_basin</span><span class="p">))</span>

                <span class="c1">#Calculate ACE &amp; append to storm total</span>
                <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">isnan</span><span class="p">(</span><span class="n">btk_wind</span><span class="p">)</span> <span class="o">==</span> <span class="kc">False</span><span class="p">:</span>
                    <span class="n">ace</span> <span class="o">=</span> <span class="p">(</span><span class="mi">10</span><span class="o">**-</span><span class="mi">4</span><span class="p">)</span> <span class="o">*</span> <span class="p">(</span><span class="n">btk_wind</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span>
                    <span class="k">if</span> <span class="n">btk_type</span> <span class="ow">in</span> <span class="n">constants</span><span class="o">.</span><span class="n">NAMED_TROPICAL_STORM_TYPES</span><span class="p">:</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="n">stormid</span><span class="p">][</span><span class="s1">&#39;ace&#39;</span><span class="p">]</span> <span class="o">+=</span> <span class="n">np</span><span class="o">.</span><span class="n">round</span><span class="p">(</span><span class="n">ace</span><span class="p">,</span><span class="mi">4</span><span class="p">)</span>

            <span class="c1">#Add storm name</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="n">stormid</span><span class="p">][</span><span class="s1">&#39;name&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">name</span>

        <span class="c1">#Determine time elapsed</span>
        <span class="n">time_elapsed</span> <span class="o">=</span> <span class="n">dt</span><span class="o">.</span><span class="n">now</span><span class="p">()</span> <span class="o">-</span> <span class="n">start_time</span>
        <span class="n">tsec</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="nb">round</span><span class="p">(</span><span class="n">time_elapsed</span><span class="o">.</span><span class="n">total_seconds</span><span class="p">(),</span><span class="mi">2</span><span class="p">))</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;--&gt; Completed reading in best track data (</span><span class="si">{</span><span class="n">tsec</span><span class="si">}</span><span class="s2"> seconds)&quot;</span><span class="p">)</span>

        
    <span class="k">def</span> <span class="nf">__read_ibtracs</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        
        <span class="sa">r</span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Reads in ibtracs data into the Dataset object.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="c1">#Time duration to read in ibtracs</span>
        <span class="n">start_time</span> <span class="o">=</span> <span class="n">dt</span><span class="o">.</span><span class="n">now</span><span class="p">()</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;--&gt; Starting to read in ibtracs data&quot;</span><span class="p">)</span>
        
        <span class="c1">#Quick error check</span>
        <span class="n">ibtracs_online</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="n">fcheck</span> <span class="o">=</span> <span class="s2">&quot;https://www.ncei.noaa.gov/data/international-best-track-archive-for-climate-stewardship-ibtracs/&quot;</span>
        <span class="k">if</span> <span class="n">fcheck</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">ibtracs_url</span><span class="p">:</span>
            <span class="k">if</span> <span class="s2">&quot;http&quot;</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">ibtracs_url</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span><span class="s2">&quot;URL provided is not via NCEI&quot;</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">ibtracs_online</span> <span class="o">=</span> <span class="kc">False</span>

        <span class="c1">#convert to ibtracs basin</span>
        <span class="n">basin_convert</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;all&#39;</span><span class="p">:</span><span class="s1">&#39;ALL&#39;</span><span class="p">,</span>
                         <span class="s1">&#39;east_pacific&#39;</span><span class="p">:</span><span class="s1">&#39;EP&#39;</span><span class="p">,</span>
                         <span class="s1">&#39;north_atlantic&#39;</span><span class="p">:</span><span class="s1">&#39;NA&#39;</span><span class="p">,</span>
                         <span class="s1">&#39;north_indian&#39;</span><span class="p">:</span><span class="s1">&#39;NI&#39;</span><span class="p">,</span>
                         <span class="s1">&#39;south_atlantic&#39;</span><span class="p">:</span><span class="s1">&#39;SA&#39;</span><span class="p">,</span>
                         <span class="s1">&#39;south_indian&#39;</span><span class="p">:</span><span class="s1">&#39;SI&#39;</span><span class="p">,</span>
                         <span class="s1">&#39;south_pacific&#39;</span><span class="p">:</span><span class="s1">&#39;SP&#39;</span><span class="p">,</span>
                         <span class="s1">&#39;west_pacific&#39;</span><span class="p">:</span><span class="s1">&#39;WP&#39;</span><span class="p">}</span>
        <span class="n">ibtracs_basin</span> <span class="o">=</span> <span class="n">basin_convert</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">basin</span><span class="p">,</span><span class="s1">&#39;&#39;</span><span class="p">)</span>
        
        <span class="c1">#read in ibtracs file</span>
        <span class="k">if</span> <span class="n">ibtracs_online</span><span class="p">:</span>
            <span class="n">enter_basin</span> <span class="o">=</span> <span class="s1">&#39;ALL&#39;</span> <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">basin</span> <span class="o">==</span> <span class="s1">&#39;australia&#39;</span> <span class="k">else</span> <span class="n">ibtracs_basin</span><span class="o">+</span><span class="s1">&#39;&#39;</span>
            <span class="n">path</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ibtracs_url</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;(basin)&quot;</span><span class="p">,</span><span class="n">enter_basin</span><span class="p">)</span>
            <span class="n">content</span> <span class="o">=</span> <span class="n">read_url</span><span class="p">(</span><span class="n">path</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">f</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ibtracs_url</span><span class="p">,</span><span class="s2">&quot;r&quot;</span><span class="p">)</span>
            <span class="n">content</span> <span class="o">=</span> <span class="n">f</span><span class="o">.</span><span class="n">readlines</span><span class="p">()</span>
            <span class="n">content</span> <span class="o">=</span> <span class="p">[(</span><span class="n">i</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot; &quot;</span><span class="p">,</span><span class="s2">&quot;&quot;</span><span class="p">))</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;,&quot;</span><span class="p">)</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">content</span><span class="p">]</span>
            <span class="n">f</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>

        <span class="c1">#Initialize empty dict for neumann data</span>
        <span class="n">neumann</span> <span class="o">=</span> <span class="p">{}</span>
        
        <span class="c1">#ibtracs ID to jtwc ID mapping</span>
        <span class="n">map_all_id</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="n">map_id</span> <span class="o">=</span> <span class="p">{}</span>
        
        <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="n">content</span><span class="p">[</span><span class="mi">2</span><span class="p">:]:</span>
            
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">line</span><span class="p">)</span> <span class="o">&lt;</span> <span class="mi">150</span><span class="p">:</span> <span class="k">continue</span>
            
            <span class="n">ibtracs_id</span><span class="p">,</span> <span class="n">year</span><span class="p">,</span> <span class="n">adv_number</span><span class="p">,</span> <span class="n">basin</span><span class="p">,</span> <span class="n">subbasin</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">time</span><span class="p">,</span> <span class="n">wmo_type</span><span class="p">,</span> <span class="n">wmo_lat</span><span class="p">,</span> <span class="n">wmo_lon</span><span class="p">,</span> <span class="n">wmo_vmax</span><span class="p">,</span> <span class="n">wmo_mslp</span><span class="p">,</span> <span class="n">agency</span><span class="p">,</span> <span class="n">track_type</span><span class="p">,</span> <span class="n">dist_land</span><span class="p">,</span> <span class="n">dist_landfall</span><span class="p">,</span> <span class="n">iflag</span><span class="p">,</span> <span class="n">usa_agency</span><span class="p">,</span> <span class="n">sid</span><span class="p">,</span> <span class="n">lat</span><span class="p">,</span> <span class="n">lon</span><span class="p">,</span> <span class="n">special</span><span class="p">,</span> <span class="n">stype</span><span class="p">,</span> <span class="n">vmax</span><span class="p">,</span> <span class="n">mslp</span> <span class="o">=</span> <span class="n">line</span><span class="p">[:</span><span class="mi">25</span><span class="p">]</span>
            
            <span class="n">date</span> <span class="o">=</span> <span class="n">dt</span><span class="o">.</span><span class="n">strptime</span><span class="p">(</span><span class="n">time</span><span class="p">,</span><span class="s1">&#39;%Y-%m-</span><span class="si">%d</span><span class="s1">%H:%M:00&#39;</span><span class="p">)</span>
            
            <span class="c1">#Fix name to be consistent with HURDAT</span>
            <span class="k">if</span> <span class="n">name</span> <span class="o">==</span> <span class="s1">&#39;NOT_NAMED&#39;</span><span class="p">:</span> <span class="n">name</span> <span class="o">=</span> <span class="s1">&#39;UNNAMED&#39;</span>
            <span class="k">if</span> <span class="n">name</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;-&#39;</span><span class="p">:</span> <span class="n">name</span> <span class="o">=</span> <span class="n">name</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>

            <span class="c1">#Add storm to list of keys</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">ibtracs_mode</span> <span class="o">==</span> <span class="s1">&#39;wmo&#39;</span> <span class="ow">and</span> <span class="n">ibtracs_id</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>

                <span class="c1">#add empty entry into dict</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="n">ibtracs_id</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;id&#39;</span><span class="p">:</span><span class="n">sid</span><span class="p">,</span><span class="s1">&#39;operational_id&#39;</span><span class="p">:</span><span class="s1">&#39;&#39;</span><span class="p">,</span><span class="s1">&#39;name&#39;</span><span class="p">:</span><span class="n">name</span><span class="p">,</span><span class="s1">&#39;year&#39;</span><span class="p">:</span><span class="n">date</span><span class="o">.</span><span class="n">year</span><span class="p">,</span><span class="s1">&#39;season&#39;</span><span class="p">:</span><span class="nb">int</span><span class="p">(</span><span class="n">year</span><span class="p">),</span><span class="s1">&#39;basin&#39;</span><span class="p">:</span><span class="bp">self</span><span class="o">.</span><span class="n">basin</span><span class="p">}</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="n">ibtracs_id</span><span class="p">][</span><span class="s1">&#39;source&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">source</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="n">ibtracs_id</span><span class="p">][</span><span class="s1">&#39;source_info&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;World Meteorological Organization (official)&#39;</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="n">ibtracs_id</span><span class="p">][</span><span class="s1">&#39;notes&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;&#39;vmax&#39; = wind converted to 1-minute using the 0.88 conversion factor. &#39;vmax_orig&#39; = original vmax as assessed by its respective WMO agency.&quot;</span>

                <span class="c1">#add empty lists</span>
                <span class="k">for</span> <span class="n">val</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;date&#39;</span><span class="p">,</span><span class="s1">&#39;extra_obs&#39;</span><span class="p">,</span><span class="s1">&#39;special&#39;</span><span class="p">,</span><span class="s1">&#39;type&#39;</span><span class="p">,</span><span class="s1">&#39;lat&#39;</span><span class="p">,</span><span class="s1">&#39;lon&#39;</span><span class="p">,</span><span class="s1">&#39;vmax&#39;</span><span class="p">,</span><span class="s1">&#39;vmax_orig&#39;</span><span class="p">,</span><span class="s1">&#39;mslp&#39;</span><span class="p">,</span><span class="s1">&#39;wmo_basin&#39;</span><span class="p">]:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="n">ibtracs_id</span><span class="p">][</span><span class="n">val</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="n">ibtracs_id</span><span class="p">][</span><span class="s1">&#39;ace&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mf">0.0</span>
                
            <span class="k">elif</span> <span class="n">sid</span> <span class="o">!=</span> <span class="s1">&#39;&#39;</span> <span class="ow">and</span> <span class="n">ibtracs_id</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">map_all_id</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
                
                <span class="c1">#ID entry method to use</span>
                <span class="n">use_id</span> <span class="o">=</span> <span class="n">sid</span>
                
                <span class="c1">#Add id to list</span>
                <span class="n">map_all_id</span><span class="p">[</span><span class="n">ibtracs_id</span><span class="p">]</span> <span class="o">=</span> <span class="n">sid</span>

                <span class="c1">#add empty entry into dict</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="n">use_id</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;id&#39;</span><span class="p">:</span><span class="n">sid</span><span class="p">,</span><span class="s1">&#39;operational_id&#39;</span><span class="p">:</span><span class="s1">&#39;&#39;</span><span class="p">,</span><span class="s1">&#39;name&#39;</span><span class="p">:</span><span class="n">name</span><span class="p">,</span><span class="s1">&#39;year&#39;</span><span class="p">:</span><span class="n">date</span><span class="o">.</span><span class="n">year</span><span class="p">,</span><span class="s1">&#39;season&#39;</span><span class="p">:</span><span class="nb">int</span><span class="p">(</span><span class="n">year</span><span class="p">),</span><span class="s1">&#39;basin&#39;</span><span class="p">:</span><span class="bp">self</span><span class="o">.</span><span class="n">basin</span><span class="p">}</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="n">use_id</span><span class="p">][</span><span class="s1">&#39;source&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">source</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="n">use_id</span><span class="p">][</span><span class="s1">&#39;source_info&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;Joint Typhoon Warning Center (unofficial)&#39;</span>
                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">neumann</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="n">use_id</span><span class="p">][</span><span class="s1">&#39;source_info&#39;</span><span class="p">]</span> <span class="o">+=</span> <span class="s1">&#39;&amp; Charles Neumann reanalysis for South Hemisphere storms&#39;</span>
                <span class="n">current_id</span> <span class="o">=</span> <span class="n">use_id</span>

                <span class="c1">#add empty lists</span>
                <span class="k">for</span> <span class="n">val</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;date&#39;</span><span class="p">,</span><span class="s1">&#39;extra_obs&#39;</span><span class="p">,</span><span class="s1">&#39;special&#39;</span><span class="p">,</span><span class="s1">&#39;type&#39;</span><span class="p">,</span><span class="s1">&#39;lat&#39;</span><span class="p">,</span><span class="s1">&#39;lon&#39;</span><span class="p">,</span><span class="s1">&#39;vmax&#39;</span><span class="p">,</span><span class="s1">&#39;mslp&#39;</span><span class="p">,</span>
                            <span class="s1">&#39;wmo_type&#39;</span><span class="p">,</span><span class="s1">&#39;wmo_lat&#39;</span><span class="p">,</span><span class="s1">&#39;wmo_lon&#39;</span><span class="p">,</span><span class="s1">&#39;wmo_vmax&#39;</span><span class="p">,</span><span class="s1">&#39;wmo_mslp&#39;</span><span class="p">,</span><span class="s1">&#39;wmo_basin&#39;</span><span class="p">]:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="n">use_id</span><span class="p">][</span><span class="n">val</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="n">use_id</span><span class="p">][</span><span class="s1">&#39;ace&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mf">0.0</span>

            <span class="c1">#Get neumann data for storms containing it</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">neumann</span><span class="p">:</span>
                <span class="n">neumann_lat</span><span class="p">,</span> <span class="n">neumann_lon</span><span class="p">,</span> <span class="n">neumann_type</span><span class="p">,</span> <span class="n">neumann_vmax</span><span class="p">,</span> <span class="n">neumann_mslp</span> <span class="o">=</span> <span class="n">line</span><span class="p">[</span><span class="mi">141</span><span class="p">:</span><span class="mi">146</span><span class="p">]</span>
                <span class="k">if</span> <span class="n">neumann_lat</span> <span class="o">!=</span> <span class="s2">&quot;&quot;</span> <span class="ow">and</span> <span class="n">neumann_lon</span> <span class="o">!=</span> <span class="s2">&quot;&quot;</span><span class="p">:</span>
                    
                    <span class="c1">#Add storm to list of keys</span>
                    <span class="k">if</span> <span class="n">ibtracs_id</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">neumann</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
                        <span class="n">neumann</span><span class="p">[</span><span class="n">ibtracs_id</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;id&#39;</span><span class="p">:</span><span class="n">sid</span><span class="p">,</span><span class="s1">&#39;operational_id&#39;</span><span class="p">:</span><span class="s1">&#39;&#39;</span><span class="p">,</span><span class="s1">&#39;name&#39;</span><span class="p">:</span><span class="n">name</span><span class="p">,</span><span class="s1">&#39;year&#39;</span><span class="p">:</span><span class="n">date</span><span class="o">.</span><span class="n">year</span><span class="p">,</span><span class="s1">&#39;season&#39;</span><span class="p">:</span><span class="nb">int</span><span class="p">(</span><span class="n">year</span><span class="p">),</span><span class="s1">&#39;basin&#39;</span><span class="p">:</span><span class="bp">self</span><span class="o">.</span><span class="n">basin</span><span class="p">}</span>
                        <span class="n">neumann</span><span class="p">[</span><span class="n">ibtracs_id</span><span class="p">][</span><span class="s1">&#39;source&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">source</span>
                        <span class="n">neumann</span><span class="p">[</span><span class="n">ibtracs_id</span><span class="p">][</span><span class="s1">&#39;source_info&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;Joint Typhoon Warning Center (unofficial) &amp; Charles Neumann reanalysis for South Hemisphere storms&#39;</span>
                        <span class="k">for</span> <span class="n">val</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;date&#39;</span><span class="p">,</span><span class="s1">&#39;extra_obs&#39;</span><span class="p">,</span><span class="s1">&#39;special&#39;</span><span class="p">,</span><span class="s1">&#39;type&#39;</span><span class="p">,</span><span class="s1">&#39;lat&#39;</span><span class="p">,</span><span class="s1">&#39;lon&#39;</span><span class="p">,</span><span class="s1">&#39;vmax&#39;</span><span class="p">,</span><span class="s1">&#39;mslp&#39;</span><span class="p">,</span><span class="s1">&#39;wmo_basin&#39;</span><span class="p">]:</span>
                            <span class="n">neumann</span><span class="p">[</span><span class="n">ibtracs_id</span><span class="p">][</span><span class="n">val</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span>
                        <span class="n">neumann</span><span class="p">[</span><span class="n">ibtracs_id</span><span class="p">][</span><span class="s1">&#39;ace&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mf">0.0</span>
                    
                    <span class="c1">#Retrieve data</span>
                    <span class="n">neumann_date</span> <span class="o">=</span> <span class="n">dt</span><span class="o">.</span><span class="n">strptime</span><span class="p">(</span><span class="n">time</span><span class="p">,</span><span class="s1">&#39;%Y-%m-</span><span class="si">%d</span><span class="s1">%H:%M:00&#39;</span><span class="p">)</span>
                    <span class="n">neumann_lat</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">wmo_lat</span><span class="p">)</span>
                    <span class="n">neumann_lon</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">wmo_lon</span><span class="p">)</span>
                    <span class="n">neumann_vmax</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nan</span> <span class="k">if</span> <span class="n">neumann_vmax</span> <span class="o">==</span> <span class="s2">&quot;&quot;</span> <span class="k">else</span> <span class="nb">int</span><span class="p">(</span><span class="n">neumann_vmax</span><span class="p">)</span>
                    <span class="n">neumann_mslp</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nan</span> <span class="k">if</span> <span class="n">neumann_mslp</span> <span class="o">==</span> <span class="s2">&quot;&quot;</span> <span class="k">else</span> <span class="nb">int</span><span class="p">(</span><span class="n">neumann_mslp</span><span class="p">)</span>
                    <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">isnan</span><span class="p">(</span><span class="n">neumann_vmax</span><span class="p">)</span> <span class="o">==</span> <span class="kc">False</span><span class="p">:</span>
                        <span class="k">if</span> <span class="nb">str</span><span class="p">(</span><span class="n">neumann_vmax</span><span class="p">)[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;4&#39;</span><span class="p">,</span><span class="s1">&#39;9&#39;</span><span class="p">]:</span> <span class="n">neumann_vmax</span> <span class="o">+=</span> <span class="mi">1</span>
                        <span class="k">if</span> <span class="nb">str</span><span class="p">(</span><span class="n">neumann_vmax</span><span class="p">)[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;1&#39;</span><span class="p">,</span><span class="s1">&#39;6&#39;</span><span class="p">]:</span> <span class="n">neumann_vmax</span> <span class="o">=</span> <span class="n">neumann_vmax</span> <span class="o">-</span> <span class="mi">1</span>
                    <span class="k">if</span> <span class="n">neumann_type</span> <span class="o">==</span> <span class="s1">&#39;TC&#39;</span><span class="p">:</span>
                        <span class="k">if</span> <span class="n">neumann_vmax</span> <span class="o">&lt;</span> <span class="mi">34</span><span class="p">:</span>
                            <span class="n">neumann_type</span> <span class="o">=</span> <span class="s1">&#39;TD&#39;</span>
                        <span class="k">elif</span> <span class="n">neumann_vmax</span> <span class="o">&lt;</span> <span class="mi">64</span><span class="p">:</span>
                            <span class="n">neumann_type</span> <span class="o">=</span> <span class="s1">&#39;TS&#39;</span>
                        <span class="k">else</span><span class="p">:</span>
                            <span class="n">neumann_type</span> <span class="o">=</span> <span class="s1">&#39;HU&#39;</span>
                    <span class="k">elif</span> <span class="n">neumann_type</span> <span class="o">==</span> <span class="s1">&#39;MM&#39;</span> <span class="ow">or</span> <span class="n">neumann_type</span> <span class="o">==</span> <span class="s1">&#39;&#39;</span><span class="p">:</span>
                        <span class="n">neumann_type</span> <span class="o">=</span> <span class="s1">&#39;LO&#39;</span>
                    
                    <span class="n">neumann</span><span class="p">[</span><span class="n">ibtracs_id</span><span class="p">][</span><span class="s1">&#39;date&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">neumann_date</span><span class="p">)</span>
                    <span class="n">neumann</span><span class="p">[</span><span class="n">ibtracs_id</span><span class="p">][</span><span class="s1">&#39;special&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">special</span><span class="p">)</span>

                    <span class="n">neumann</span><span class="p">[</span><span class="n">ibtracs_id</span><span class="p">][</span><span class="s1">&#39;type&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">neumann_type</span><span class="p">)</span>
                    <span class="n">neumann</span><span class="p">[</span><span class="n">ibtracs_id</span><span class="p">][</span><span class="s1">&#39;lat&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">neumann_lat</span><span class="p">)</span>
                    <span class="n">neumann</span><span class="p">[</span><span class="n">ibtracs_id</span><span class="p">][</span><span class="s1">&#39;lon&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">neumann_lon</span><span class="p">)</span>
                    <span class="n">neumann</span><span class="p">[</span><span class="n">ibtracs_id</span><span class="p">][</span><span class="s1">&#39;vmax&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">neumann_vmax</span><span class="p">)</span>
                    <span class="n">neumann</span><span class="p">[</span><span class="n">ibtracs_id</span><span class="p">][</span><span class="s1">&#39;mslp&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">neumann_mslp</span><span class="p">)</span>
                    
                    <span class="n">hhmm</span> <span class="o">=</span> <span class="n">neumann_date</span><span class="o">.</span><span class="n">strftime</span><span class="p">(</span><span class="s1">&#39;%H%M&#39;</span><span class="p">)</span>
                    <span class="k">if</span> <span class="n">hhmm</span> <span class="ow">in</span> <span class="n">constants</span><span class="o">.</span><span class="n">STANDARD_HOURS</span><span class="p">:</span>
                        <span class="n">neumann</span><span class="p">[</span><span class="n">ibtracs_id</span><span class="p">][</span><span class="s1">&#39;extra_obs&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="n">neumann</span><span class="p">[</span><span class="n">ibtracs_id</span><span class="p">][</span><span class="s1">&#39;extra_obs&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
                    
                    <span class="c1">#Edit basin</span>
                    <span class="n">basin_reverse</span> <span class="o">=</span> <span class="p">{</span><span class="n">v</span><span class="p">:</span> <span class="n">k</span> <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">basin_convert</span><span class="o">.</span><span class="n">items</span><span class="p">()}</span>
                    <span class="n">wmo_basin</span> <span class="o">=</span> <span class="n">basin_reverse</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">basin</span><span class="p">,</span><span class="s1">&#39;&#39;</span><span class="p">)</span>
                    <span class="k">if</span> <span class="n">subbasin</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;WA&#39;</span><span class="p">,</span><span class="s1">&#39;EA&#39;</span><span class="p">]:</span>
                        <span class="n">wmo_basin</span> <span class="o">=</span> <span class="s1">&#39;australia&#39;</span>
                    <span class="n">neumann</span><span class="p">[</span><span class="n">ibtracs_id</span><span class="p">][</span><span class="s1">&#39;wmo_basin&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">wmo_basin</span><span class="p">)</span>
                    
                    <span class="c1">#Calculate ACE &amp; append to storm total</span>
                    <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">isnan</span><span class="p">(</span><span class="n">neumann_vmax</span><span class="p">)</span> <span class="o">==</span> <span class="kc">False</span><span class="p">:</span>
                        <span class="n">ace</span> <span class="o">=</span> <span class="p">(</span><span class="mi">10</span><span class="o">**-</span><span class="mi">4</span><span class="p">)</span> <span class="o">*</span> <span class="p">(</span><span class="n">neumann_vmax</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span>
                        <span class="k">if</span> <span class="n">hhmm</span> <span class="ow">in</span> <span class="n">constants</span><span class="o">.</span><span class="n">STANDARD_HOURS</span> <span class="ow">and</span> <span class="n">neumann_type</span> <span class="ow">in</span> <span class="n">constants</span><span class="o">.</span><span class="n">NAMED_TROPICAL_STORM_TYPES</span> <span class="ow">and</span> <span class="n">np</span><span class="o">.</span><span class="n">isnan</span><span class="p">(</span><span class="n">ace</span><span class="p">)</span> <span class="o">==</span> <span class="kc">False</span><span class="p">:</span>
                            <span class="n">neumann</span><span class="p">[</span><span class="n">ibtracs_id</span><span class="p">][</span><span class="s1">&#39;ace&#39;</span><span class="p">]</span> <span class="o">+=</span> <span class="n">np</span><span class="o">.</span><span class="n">round</span><span class="p">(</span><span class="n">ace</span><span class="p">,</span><span class="mi">4</span><span class="p">)</span>
                        
            <span class="c1">#Skip missing entries</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">ibtracs_mode</span> <span class="o">==</span> <span class="s1">&#39;wmo&#39;</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">wmo_lat</span> <span class="o">==</span> <span class="s2">&quot;&quot;</span> <span class="ow">or</span> <span class="n">wmo_lon</span> <span class="o">==</span> <span class="s2">&quot;&quot;</span><span class="p">:</span>
                    <span class="k">continue</span>
                <span class="k">if</span> <span class="n">agency</span> <span class="o">==</span> <span class="s2">&quot;&quot;</span><span class="p">:</span> <span class="k">continue</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">lat</span> <span class="o">==</span> <span class="s2">&quot;&quot;</span> <span class="ow">or</span> <span class="n">lon</span> <span class="o">==</span> <span class="s2">&quot;&quot;</span><span class="p">:</span>
                    <span class="k">continue</span>
                <span class="k">if</span> <span class="n">usa_agency</span> <span class="o">==</span> <span class="s2">&quot;&quot;</span> <span class="ow">and</span> <span class="n">track_type</span> <span class="o">!=</span> <span class="s2">&quot;PROVISIONAL&quot;</span><span class="p">:</span> <span class="k">continue</span>
            
            
            <span class="c1">#map JTWC to ibtracs ID (for neumann replacement)</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">neumann</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">ibtracs_id</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">map_id</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
                    <span class="n">map_id</span><span class="p">[</span><span class="n">ibtracs_id</span><span class="p">]</span> <span class="o">=</span> <span class="n">sid</span>
            
            <span class="c1">#Handle WMO mode</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">ibtracs_mode</span> <span class="o">==</span> <span class="s1">&#39;wmo&#39;</span><span class="p">:</span>
                
                <span class="c1">#Retrieve data</span>
                <span class="n">date</span> <span class="o">=</span> <span class="n">dt</span><span class="o">.</span><span class="n">strptime</span><span class="p">(</span><span class="n">time</span><span class="p">,</span><span class="s1">&#39;%Y-%m-</span><span class="si">%d</span><span class="s1">%H:%M:00&#39;</span><span class="p">)</span>
                <span class="n">dist_land</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">dist_land</span><span class="p">)</span>

                <span class="c1">#Properly format WMO variables</span>
                <span class="n">wmo_lat</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">wmo_lat</span><span class="p">)</span>
                <span class="n">wmo_lon</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">wmo_lon</span><span class="p">)</span>
                <span class="n">wmo_vmax</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nan</span> <span class="k">if</span> <span class="n">wmo_vmax</span> <span class="o">==</span> <span class="s2">&quot;&quot;</span> <span class="k">else</span> <span class="nb">int</span><span class="p">(</span><span class="n">wmo_vmax</span><span class="p">)</span>
                <span class="n">wmo_mslp</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nan</span> <span class="k">if</span> <span class="n">wmo_mslp</span> <span class="o">==</span> <span class="s2">&quot;&quot;</span> <span class="k">else</span> <span class="nb">int</span><span class="p">(</span><span class="n">wmo_mslp</span><span class="p">)</span>
                
                <span class="c1">#Edit basin</span>
                <span class="n">basin_reverse</span> <span class="o">=</span> <span class="p">{</span><span class="n">v</span><span class="p">:</span> <span class="n">k</span> <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">basin_convert</span><span class="o">.</span><span class="n">items</span><span class="p">()}</span>
                <span class="n">wmo_basin</span> <span class="o">=</span> <span class="n">basin_reverse</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">basin</span><span class="p">,</span><span class="s1">&#39;&#39;</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">subbasin</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;WA&#39;</span><span class="p">,</span><span class="s1">&#39;EA&#39;</span><span class="p">]:</span>
                    <span class="n">wmo_basin</span> <span class="o">=</span> <span class="s1">&#39;australia&#39;</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="n">ibtracs_id</span><span class="p">][</span><span class="s1">&#39;wmo_basin&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">wmo_basin</span><span class="p">)</span>
                
                <span class="c1">#Account for wind discrepancy</span>
                <span class="k">if</span> <span class="n">wmo_basin</span> <span class="ow">not</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;north_atlantic&#39;</span><span class="p">,</span><span class="s1">&#39;east_pacific&#39;</span><span class="p">]</span> <span class="ow">and</span> <span class="n">np</span><span class="o">.</span><span class="n">isnan</span><span class="p">(</span><span class="n">wmo_vmax</span><span class="p">)</span> <span class="o">==</span> <span class="kc">False</span><span class="p">:</span>
                    <span class="n">jtwc_vmax</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">wmo_vmax</span> <span class="o">/</span> <span class="mf">0.88</span><span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">isnan</span><span class="p">(</span><span class="n">wmo_vmax</span><span class="p">)</span> <span class="o">==</span> <span class="kc">False</span><span class="p">:</span>
                        <span class="n">jtwc_vmax</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">wmo_vmax</span> <span class="o">+</span> <span class="mf">0.0</span><span class="p">)</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="n">jtwc_vmax</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nan</span>
                <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">isnan</span><span class="p">(</span><span class="n">jtwc_vmax</span><span class="p">)</span> <span class="o">==</span> <span class="kc">False</span><span class="p">:</span>
                    <span class="k">if</span> <span class="nb">str</span><span class="p">(</span><span class="n">jtwc_vmax</span><span class="p">)[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;4&#39;</span><span class="p">,</span><span class="s1">&#39;9&#39;</span><span class="p">]:</span> <span class="n">jtwc_vmax</span> <span class="o">+=</span> <span class="mi">1</span>
                    <span class="k">if</span> <span class="nb">str</span><span class="p">(</span><span class="n">jtwc_vmax</span><span class="p">)[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;1&#39;</span><span class="p">,</span><span class="s1">&#39;6&#39;</span><span class="p">]:</span> <span class="n">jtwc_vmax</span> <span class="o">=</span> <span class="n">jtwc_vmax</span> <span class="o">-</span> <span class="mi">1</span>
                
                <span class="c1">#Convert storm type from ibtracs to hurdat style</span>
                <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">                DS - Disturbance</span>
<span class="sd">                TS - Tropical</span>
<span class="sd">                ET - Extratropical</span>
<span class="sd">                SS - Subtropical</span>
<span class="sd">                NR - Not reported</span>
<span class="sd">                MX - Mixture (contradicting nature reports from different agencies)</span>
<span class="sd">                &quot;&quot;&quot;</span>
                <span class="k">if</span> <span class="n">wmo_type</span> <span class="o">==</span> <span class="s2">&quot;DS&quot;</span><span class="p">:</span>
                    <span class="n">stype</span> <span class="o">=</span> <span class="s2">&quot;LO&quot;</span>
                <span class="k">elif</span> <span class="n">wmo_type</span> <span class="o">==</span> <span class="s2">&quot;TS&quot;</span><span class="p">:</span>
                    <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">isnan</span><span class="p">(</span><span class="n">jtwc_vmax</span><span class="p">):</span>
                        <span class="n">stype</span> <span class="o">=</span> <span class="s1">&#39;LO&#39;</span>
                    <span class="k">elif</span> <span class="n">jtwc_vmax</span> <span class="o">&lt;</span> <span class="mi">34</span><span class="p">:</span>
                        <span class="n">stype</span> <span class="o">=</span> <span class="s1">&#39;TD&#39;</span>
                    <span class="k">elif</span> <span class="n">jtwc_vmax</span> <span class="o">&lt;</span> <span class="mi">64</span><span class="p">:</span>
                        <span class="n">stype</span> <span class="o">=</span> <span class="s1">&#39;TS&#39;</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="n">stype</span> <span class="o">=</span> <span class="s1">&#39;HU&#39;</span>
                <span class="k">elif</span> <span class="n">wmo_type</span> <span class="o">==</span> <span class="s1">&#39;SS&#39;</span><span class="p">:</span>
                    <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">isnan</span><span class="p">(</span><span class="n">jtwc_vmax</span><span class="p">):</span>
                        <span class="n">stype</span> <span class="o">=</span> <span class="s1">&#39;LO&#39;</span>
                    <span class="k">elif</span> <span class="n">jtwc_vmax</span> <span class="o">&lt;</span> <span class="mi">34</span><span class="p">:</span>
                        <span class="n">stype</span> <span class="o">=</span> <span class="s1">&#39;SD&#39;</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="n">stype</span> <span class="o">=</span> <span class="s1">&#39;SS&#39;</span>
                <span class="k">elif</span> <span class="n">wmo_type</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;ET&#39;</span><span class="p">,</span><span class="s1">&#39;MX&#39;</span><span class="p">]:</span>
                    <span class="n">wmo_type</span> <span class="o">=</span> <span class="s1">&#39;EX&#39;</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">stype</span> <span class="o">=</span> <span class="s1">&#39;LO&#39;</span>

                <span class="c1">#Handle missing data</span>
                <span class="k">if</span> <span class="n">wmo_vmax</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">:</span> <span class="n">wmo_vmax</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nan</span>
                <span class="k">if</span> <span class="n">wmo_mslp</span> <span class="o">&lt;</span> <span class="mi">800</span><span class="p">:</span> <span class="n">wmo_mslp</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nan</span>

                <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="n">ibtracs_id</span><span class="p">][</span><span class="s1">&#39;date&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">date</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="n">ibtracs_id</span><span class="p">][</span><span class="s1">&#39;special&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">special</span><span class="p">)</span>

                <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="n">ibtracs_id</span><span class="p">][</span><span class="s1">&#39;type&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">stype</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="n">ibtracs_id</span><span class="p">][</span><span class="s1">&#39;lat&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">wmo_lat</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="n">ibtracs_id</span><span class="p">][</span><span class="s1">&#39;lon&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">wmo_lon</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="n">ibtracs_id</span><span class="p">][</span><span class="s1">&#39;vmax&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">jtwc_vmax</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="n">ibtracs_id</span><span class="p">][</span><span class="s1">&#39;vmax_orig&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">wmo_vmax</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="n">ibtracs_id</span><span class="p">][</span><span class="s1">&#39;mslp&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">wmo_mslp</span><span class="p">)</span>

                <span class="n">hhmm</span> <span class="o">=</span> <span class="n">date</span><span class="o">.</span><span class="n">strftime</span><span class="p">(</span><span class="s1">&#39;%H%M&#39;</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">hhmm</span> <span class="ow">in</span> <span class="n">constants</span><span class="o">.</span><span class="n">STANDARD_HOURS</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="n">ibtracs_id</span><span class="p">][</span><span class="s1">&#39;extra_obs&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="n">ibtracs_id</span><span class="p">][</span><span class="s1">&#39;extra_obs&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>

                <span class="c1">#Calculate ACE &amp; append to storm total</span>
                <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">isnan</span><span class="p">(</span><span class="n">jtwc_vmax</span><span class="p">)</span> <span class="o">==</span> <span class="kc">False</span><span class="p">:</span>
                    <span class="n">ace</span> <span class="o">=</span> <span class="p">(</span><span class="mi">10</span><span class="o">**-</span><span class="mi">4</span><span class="p">)</span> <span class="o">*</span> <span class="p">(</span><span class="n">jtwc_vmax</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span>
                    <span class="k">if</span> <span class="n">hhmm</span> <span class="ow">in</span> <span class="n">constants</span><span class="o">.</span><span class="n">STANDARD_HOURS</span> <span class="ow">and</span> <span class="n">stype</span> <span class="ow">in</span> <span class="n">constants</span><span class="o">.</span><span class="n">NAMED_TROPICAL_STORM_TYPES</span> <span class="ow">and</span> <span class="n">np</span><span class="o">.</span><span class="n">isnan</span><span class="p">(</span><span class="n">ace</span><span class="p">)</span> <span class="o">==</span> <span class="kc">False</span><span class="p">:</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="n">ibtracs_id</span><span class="p">][</span><span class="s1">&#39;ace&#39;</span><span class="p">]</span> <span class="o">+=</span> <span class="n">np</span><span class="o">.</span><span class="n">round</span><span class="p">(</span><span class="n">ace</span><span class="p">,</span><span class="mi">4</span><span class="p">)</span>
                
            <span class="c1">#Handle non-WMO mode</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">sid</span> <span class="o">==</span> <span class="s1">&#39;&#39;</span><span class="p">:</span> <span class="k">continue</span>
                <span class="n">sid</span> <span class="o">=</span> <span class="n">map_all_id</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">ibtracs_id</span><span class="p">)</span>

                <span class="c1">#Retrieve data</span>
                <span class="n">date</span> <span class="o">=</span> <span class="n">dt</span><span class="o">.</span><span class="n">strptime</span><span class="p">(</span><span class="n">time</span><span class="p">,</span><span class="s1">&#39;%Y-%m-</span><span class="si">%d</span><span class="s1">%H:%M:00&#39;</span><span class="p">)</span>
                <span class="n">dist_land</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">dist_land</span><span class="p">)</span>

                <span class="c1">#Properly format WMO variables</span>
                <span class="n">wmo_lat</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">wmo_lat</span><span class="p">)</span>
                <span class="n">wmo_lon</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">wmo_lon</span><span class="p">)</span>
                <span class="n">wmo_vmax</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nan</span> <span class="k">if</span> <span class="n">wmo_vmax</span> <span class="o">==</span> <span class="s2">&quot;&quot;</span> <span class="k">else</span> <span class="nb">int</span><span class="p">(</span><span class="n">wmo_vmax</span><span class="p">)</span>
                <span class="n">wmo_mslp</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nan</span> <span class="k">if</span> <span class="n">wmo_mslp</span> <span class="o">==</span> <span class="s2">&quot;&quot;</span> <span class="k">else</span> <span class="nb">int</span><span class="p">(</span><span class="n">wmo_mslp</span><span class="p">)</span>

                <span class="c1">#Properly format hurdat-style variables</span>
                <span class="n">lat</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">lat</span><span class="p">)</span>
                <span class="n">lon</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">lon</span><span class="p">)</span>
                <span class="n">vmax</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nan</span> <span class="k">if</span> <span class="n">vmax</span> <span class="o">==</span> <span class="s2">&quot;&quot;</span> <span class="k">else</span> <span class="nb">int</span><span class="p">(</span><span class="n">vmax</span><span class="p">)</span>
                <span class="n">mslp</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nan</span> <span class="k">if</span> <span class="n">mslp</span> <span class="o">==</span> <span class="s2">&quot;&quot;</span> <span class="k">else</span> <span class="nb">int</span><span class="p">(</span><span class="n">mslp</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">isnan</span><span class="p">(</span><span class="n">vmax</span><span class="p">)</span> <span class="o">==</span> <span class="kc">False</span><span class="p">:</span>
                    <span class="k">if</span> <span class="nb">str</span><span class="p">(</span><span class="n">vmax</span><span class="p">)[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;4&#39;</span><span class="p">,</span><span class="s1">&#39;9&#39;</span><span class="p">]:</span> <span class="n">vmax</span> <span class="o">+=</span> <span class="mi">1</span>
                    <span class="k">if</span> <span class="nb">str</span><span class="p">(</span><span class="n">vmax</span><span class="p">)[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;1&#39;</span><span class="p">,</span><span class="s1">&#39;6&#39;</span><span class="p">]:</span> <span class="n">vmax</span> <span class="o">=</span> <span class="n">vmax</span> <span class="o">-</span> <span class="mi">1</span>

                <span class="c1">#Convert storm type from ibtracs to hurdat style</span>
                <span class="k">if</span> <span class="n">stype</span> <span class="o">==</span> <span class="s2">&quot;ST&quot;</span> <span class="ow">or</span> <span class="n">stype</span> <span class="o">==</span> <span class="s2">&quot;TY&quot;</span><span class="p">:</span>
                    <span class="n">stype</span> <span class="o">=</span> <span class="s2">&quot;HU&quot;</span>
                <span class="k">elif</span> <span class="n">stype</span> <span class="o">==</span> <span class="s2">&quot;&quot;</span><span class="p">:</span>
                    <span class="k">if</span> <span class="n">wmo_type</span> <span class="o">==</span> <span class="s1">&#39;TS&#39;</span><span class="p">:</span>
                        <span class="k">if</span> <span class="n">vmax</span> <span class="o">&lt;</span> <span class="mi">34</span><span class="p">:</span>
                            <span class="n">stype</span> <span class="o">=</span> <span class="s1">&#39;TD&#39;</span>
                        <span class="k">elif</span> <span class="n">vmax</span> <span class="o">&lt;</span> <span class="mi">64</span><span class="p">:</span>
                            <span class="n">stype</span> <span class="o">=</span> <span class="s1">&#39;TS&#39;</span>
                        <span class="k">else</span><span class="p">:</span>
                            <span class="n">stype</span> <span class="o">=</span> <span class="s1">&#39;HU&#39;</span>
                    <span class="k">elif</span> <span class="n">wmo_type</span> <span class="o">==</span> <span class="s1">&#39;SS&#39;</span><span class="p">:</span>
                        <span class="k">if</span> <span class="n">vmax</span> <span class="o">&lt;</span> <span class="mi">34</span><span class="p">:</span>
                            <span class="n">stype</span> <span class="o">=</span> <span class="s1">&#39;SD&#39;</span>
                        <span class="k">else</span><span class="p">:</span>
                            <span class="n">stype</span> <span class="o">=</span> <span class="s1">&#39;SS&#39;</span>
                    <span class="k">elif</span> <span class="n">wmo_type</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;ET&#39;</span><span class="p">,</span><span class="s1">&#39;MX&#39;</span><span class="p">]:</span>
                        <span class="n">wmo_type</span> <span class="o">=</span> <span class="s1">&#39;EX&#39;</span>
                    <span class="k">elif</span> <span class="n">stype</span> <span class="o">==</span> <span class="s1">&#39;DS&#39;</span><span class="p">:</span>
                        <span class="n">stype</span> <span class="o">=</span> <span class="s1">&#39;LO&#39;</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">isnan</span><span class="p">(</span><span class="n">vmax</span><span class="p">):</span>
                            <span class="n">stype</span> <span class="o">=</span> <span class="s1">&#39;LO&#39;</span>
                        <span class="k">elif</span> <span class="n">vmax</span> <span class="o">&lt;</span> <span class="mi">34</span><span class="p">:</span>
                            <span class="n">stype</span> <span class="o">=</span> <span class="s1">&#39;TD&#39;</span>
                        <span class="k">elif</span> <span class="n">vmax</span> <span class="o">&lt;</span> <span class="mi">64</span><span class="p">:</span>
                            <span class="n">stype</span> <span class="o">=</span> <span class="s1">&#39;TS&#39;</span>
                        <span class="k">else</span><span class="p">:</span>
                            <span class="n">stype</span> <span class="o">=</span> <span class="s1">&#39;HU&#39;</span>

                <span class="c1">#Handle missing data</span>
                <span class="k">if</span> <span class="n">vmax</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">:</span> <span class="n">vmax</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nan</span>
                <span class="k">if</span> <span class="n">mslp</span> <span class="o">&lt;</span> <span class="mi">800</span><span class="p">:</span> <span class="n">mslp</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nan</span>

                <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="n">sid</span><span class="p">][</span><span class="s1">&#39;date&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">date</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="n">sid</span><span class="p">][</span><span class="s1">&#39;special&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">special</span><span class="p">)</span>

                <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="n">sid</span><span class="p">][</span><span class="s1">&#39;wmo_type&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">wmo_type</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="n">sid</span><span class="p">][</span><span class="s1">&#39;wmo_lat&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">wmo_lat</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="n">sid</span><span class="p">][</span><span class="s1">&#39;wmo_lon&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">wmo_lon</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="n">sid</span><span class="p">][</span><span class="s1">&#39;wmo_vmax&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">wmo_vmax</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="n">sid</span><span class="p">][</span><span class="s1">&#39;wmo_mslp&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">wmo_mslp</span><span class="p">)</span>

                <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="n">sid</span><span class="p">][</span><span class="s1">&#39;type&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">stype</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="n">sid</span><span class="p">][</span><span class="s1">&#39;lat&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">lat</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="n">sid</span><span class="p">][</span><span class="s1">&#39;lon&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">lon</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="n">sid</span><span class="p">][</span><span class="s1">&#39;vmax&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">vmax</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="n">sid</span><span class="p">][</span><span class="s1">&#39;mslp&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">mslp</span><span class="p">)</span>

                <span class="c1">#Edit basin</span>
                <span class="n">basin_reverse</span> <span class="o">=</span> <span class="p">{</span><span class="n">v</span><span class="p">:</span> <span class="n">k</span> <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">basin_convert</span><span class="o">.</span><span class="n">items</span><span class="p">()}</span>
                <span class="n">wmo_basin</span> <span class="o">=</span> <span class="n">basin_reverse</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">basin</span><span class="p">,</span><span class="s1">&#39;&#39;</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">subbasin</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;WA&#39;</span><span class="p">,</span><span class="s1">&#39;EA&#39;</span><span class="p">]:</span>
                    <span class="n">wmo_basin</span> <span class="o">=</span> <span class="s1">&#39;australia&#39;</span>
                <span class="k">if</span> <span class="n">sid</span> <span class="o">==</span> <span class="s1">&#39;AL041932&#39;</span><span class="p">:</span> <span class="n">wmo_basin</span> <span class="o">=</span> <span class="s1">&#39;north_atlantic&#39;</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="n">sid</span><span class="p">][</span><span class="s1">&#39;wmo_basin&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">wmo_basin</span><span class="p">)</span>

                <span class="n">hhmm</span> <span class="o">=</span> <span class="n">date</span><span class="o">.</span><span class="n">strftime</span><span class="p">(</span><span class="s1">&#39;%H%M&#39;</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">hhmm</span> <span class="ow">in</span> <span class="n">constants</span><span class="o">.</span><span class="n">STANDARD_HOURS</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="n">sid</span><span class="p">][</span><span class="s1">&#39;extra_obs&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="n">sid</span><span class="p">][</span><span class="s1">&#39;extra_obs&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>

                <span class="c1">#Calculate ACE &amp; append to storm total</span>
                <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">isnan</span><span class="p">(</span><span class="n">vmax</span><span class="p">)</span> <span class="o">==</span> <span class="kc">False</span><span class="p">:</span>
                    <span class="n">ace</span> <span class="o">=</span> <span class="p">(</span><span class="mi">10</span><span class="o">**-</span><span class="mi">4</span><span class="p">)</span> <span class="o">*</span> <span class="p">(</span><span class="n">vmax</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span>
                    <span class="k">if</span> <span class="n">hhmm</span> <span class="ow">in</span> <span class="n">constants</span><span class="o">.</span><span class="n">STANDARD_HOURS</span> <span class="ow">and</span> <span class="n">stype</span> <span class="ow">in</span> <span class="n">constants</span><span class="o">.</span><span class="n">NAMED_TROPICAL_STORM_TYPES</span> <span class="ow">and</span> <span class="n">np</span><span class="o">.</span><span class="n">isnan</span><span class="p">(</span><span class="n">ace</span><span class="p">)</span> <span class="o">==</span> <span class="kc">False</span><span class="p">:</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="n">sid</span><span class="p">][</span><span class="s1">&#39;ace&#39;</span><span class="p">]</span> <span class="o">+=</span> <span class="n">np</span><span class="o">.</span><span class="n">round</span><span class="p">(</span><span class="n">ace</span><span class="p">,</span><span class="mi">4</span><span class="p">)</span>
                    
        <span class="c1">#Remove empty entries</span>
        <span class="n">all_keys</span> <span class="o">=</span> <span class="p">[</span><span class="n">k</span> <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">keys</span><span class="p">()]</span>
        <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="n">all_keys</span><span class="p">:</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="n">key</span><span class="p">][</span><span class="s1">&#39;lat&#39;</span><span class="p">])</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                <span class="k">del</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="n">key</span><span class="p">])</span>
        
        <span class="c1">#Remove entries where requested basin doesn&#39;t appear</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">basin</span> <span class="ow">not</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;all&#39;</span><span class="p">,</span><span class="s1">&#39;both&#39;</span><span class="p">]:</span>
            <span class="n">all_keys</span> <span class="o">=</span> <span class="p">[</span><span class="n">k</span> <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">keys</span><span class="p">()]</span>
            <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="n">all_keys</span><span class="p">:</span>
                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">basin</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="n">key</span><span class="p">][</span><span class="s1">&#39;wmo_basin&#39;</span><span class="p">]:</span>
                    <span class="k">del</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="n">key</span><span class="p">])</span>
        
        <span class="c1">#Replace neumann entries</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">neumann</span><span class="p">:</span>
            
            <span class="c1">#iterate through every neumann entry</span>
            <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="n">neumann</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
                
                <span class="c1">#get corresponding JTWC ID</span>
                <span class="n">jtwc_id</span> <span class="o">=</span> <span class="n">map_id</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">key</span><span class="p">,</span><span class="s1">&#39;&#39;</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">jtwc_id</span> <span class="o">==</span> <span class="s1">&#39;&#39;</span><span class="p">:</span> <span class="k">continue</span>
                
                <span class="c1">#plug dict entry</span>
                <span class="n">old_entry</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="n">jtwc_id</span><span class="p">]</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="n">jtwc_id</span><span class="p">]</span> <span class="o">=</span> <span class="n">neumann</span><span class="p">[</span><span class="n">key</span><span class="p">]</span>
                
                <span class="c1">#replace id</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="n">jtwc_id</span><span class="p">][</span><span class="s1">&#39;id&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">jtwc_id</span>
                
        <span class="c1">#Fix cyclone Catarina, if specified &amp; requested</span>
        <span class="n">all_keys</span> <span class="o">=</span> <span class="p">[</span><span class="n">k</span> <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">keys</span><span class="p">()]</span>
        <span class="k">if</span> <span class="s1">&#39;2004086S29318&#39;</span> <span class="ow">in</span> <span class="n">all_keys</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">catarina</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;2004086S29318&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">cyclone_catarina</span><span class="p">()</span>
        <span class="k">elif</span> <span class="s1">&#39;AL502004&#39;</span> <span class="ow">in</span> <span class="n">all_keys</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">catarina</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;AL502004&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">cyclone_catarina</span><span class="p">()</span>
        
        <span class="c1">#Determine time elapsed</span>
        <span class="n">time_elapsed</span> <span class="o">=</span> <span class="n">dt</span><span class="o">.</span><span class="n">now</span><span class="p">()</span> <span class="o">-</span> <span class="n">start_time</span>
        <span class="n">tsec</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="nb">round</span><span class="p">(</span><span class="n">time_elapsed</span><span class="o">.</span><span class="n">total_seconds</span><span class="p">(),</span><span class="mi">2</span><span class="p">))</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;--&gt; Completed reading in ibtracs data (</span><span class="si">{</span><span class="n">tsec</span><span class="si">}</span><span class="s2"> seconds)&quot;</span><span class="p">)</span>
    
    <span class="k">def</span> <span class="nf">__interpolate_storms</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">keys</span><span class="p">):</span>
        
        <span class="sa">r</span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Interpolates storm data temporally to hourly. This is done for every provided key, and is stored in a separate internal dict.</span>
<span class="sd">        </span>
<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        keys : list</span>
<span class="sd">            List of keys to be interpolated to hourly data.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        
        <span class="c1">#Check if operation needs to be performed</span>
        <span class="n">count</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="n">keys</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">key</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">data_interp</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span> <span class="n">count</span> <span class="o">+=</span> <span class="mi">1</span>
        <span class="k">if</span> <span class="n">count</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span> <span class="k">return</span>
        
        <span class="n">start_time</span> <span class="o">=</span> <span class="n">dt</span><span class="o">.</span><span class="n">now</span><span class="p">()</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;--&gt; Starting to interpolate storms&quot;</span><span class="p">)</span>
        
        <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="n">keys</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">key</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">data_interp</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">data_interp</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="n">interp_storm</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="n">key</span><span class="p">]</span><span class="o">.</span><span class="n">copy</span><span class="p">(),</span><span class="n">hours</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span><span class="n">dt_window</span><span class="o">=</span><span class="mi">24</span><span class="p">,</span><span class="n">dt_align</span><span class="o">=</span><span class="s1">&#39;middle&#39;</span><span class="p">)</span>
        
        <span class="c1">#Determine time elapsed</span>
        <span class="n">time_elapsed</span> <span class="o">=</span> <span class="n">dt</span><span class="o">.</span><span class="n">now</span><span class="p">()</span> <span class="o">-</span> <span class="n">start_time</span>
        <span class="n">tsec</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="nb">round</span><span class="p">(</span><span class="n">time_elapsed</span><span class="o">.</span><span class="n">total_seconds</span><span class="p">(),</span><span class="mi">2</span><span class="p">))</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;--&gt; Completed interpolating storms (</span><span class="si">{</span><span class="n">tsec</span><span class="si">}</span><span class="s2"> seconds)&quot;</span><span class="p">)</span>

<div class="viewcode-block" id="TrackDataset.get_storm_id"><a class="viewcode-back" href="../../../api/generated/tropycal.tracks.TrackDataset.get_storm_id.html#tropycal.tracks.TrackDataset.get_storm_id">[docs]</a>    <span class="k">def</span> <span class="nf">get_storm_id</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">storm</span><span class="p">):</span>
        
        <span class="sa">r</span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Returns the storm ID (e.g., &quot;AL012019&quot;) given the storm name and year.</span>
<span class="sd">        </span>
<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        storm : tuple</span>
<span class="sd">            Tuple containing the storm name and year (e.g., (&quot;Matthew&quot;,2016)).</span>
<span class="sd">            </span>
<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        str or list</span>
<span class="sd">            If a single storm was found, returns a string containing its ID. Otherwise returns a list of matching IDs.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        
        <span class="c1">#Error check</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">storm</span><span class="p">,</span><span class="nb">tuple</span><span class="p">)</span> <span class="o">==</span> <span class="kc">False</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s2">&quot;storm must be of type tuple.&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">storm</span><span class="p">)</span> <span class="o">!=</span> <span class="mi">2</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;storm must contain 2 elements, name (str) and year (int)&quot;</span><span class="p">)</span>
        <span class="n">name</span><span class="p">,</span><span class="n">year</span> <span class="o">=</span> <span class="n">storm</span>
        
        <span class="c1">#Search for corresponding entry in keys</span>
        <span class="n">keys_use</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">keys</span><span class="p">:</span>
            <span class="n">temp_year</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="n">key</span><span class="p">][</span><span class="s1">&#39;year&#39;</span><span class="p">]</span>
            <span class="k">if</span> <span class="n">temp_year</span> <span class="o">==</span> <span class="n">year</span><span class="p">:</span>
                <span class="n">temp_name</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="n">key</span><span class="p">][</span><span class="s1">&#39;name&#39;</span><span class="p">]</span>
                <span class="k">if</span> <span class="n">temp_name</span> <span class="o">==</span> <span class="n">name</span><span class="o">.</span><span class="n">upper</span><span class="p">():</span>
                    <span class="n">keys_use</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">key</span><span class="p">)</span>
                
        <span class="c1">#return key, or list of keys</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">keys_use</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span> <span class="n">keys_use</span> <span class="o">=</span> <span class="n">keys_use</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">keys_use</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span> <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span><span class="s2">&quot;Storm not found&quot;</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">keys_use</span></div>
    
<div class="viewcode-block" id="TrackDataset.get_storm_tuple"><a class="viewcode-back" href="../../../api/generated/tropycal.tracks.TrackDataset.get_storm_tuple.html#tropycal.tracks.TrackDataset.get_storm_tuple">[docs]</a>    <span class="k">def</span> <span class="nf">get_storm_tuple</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">storm</span><span class="p">):</span>

        <span class="sa">r</span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Returns the storm tuple (e.g., (&quot;Dorian&quot;,2019)) given the storm id.</span>
<span class="sd">        </span>
<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        storm : string</span>
<span class="sd">            String containing the storm ID (e.g., &quot;AL052019&quot;).</span>
<span class="sd">            </span>
<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        tuple</span>
<span class="sd">            Returns a list of matching IDs.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="c1">#Error check</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">storm</span><span class="p">,</span><span class="nb">str</span><span class="p">)</span> <span class="o">==</span> <span class="kc">False</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s2">&quot;storm must be of type string.&quot;</span><span class="p">)</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">name</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="n">storm</span><span class="p">][</span><span class="s1">&#39;name&#39;</span><span class="p">]</span>
            <span class="n">year</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="n">storm</span><span class="p">][</span><span class="s1">&#39;year&#39;</span><span class="p">]</span>
        <span class="k">except</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span><span class="s2">&quot;Storm not found&quot;</span><span class="p">)</span>
        <span class="k">return</span> <span class="p">(</span><span class="n">name</span><span class="p">,</span><span class="n">year</span><span class="p">)</span></div>
    
<div class="viewcode-block" id="TrackDataset.get_storm"><a class="viewcode-back" href="../../../api/generated/tropycal.tracks.TrackDataset.get_storm.html#tropycal.tracks.TrackDataset.get_storm">[docs]</a>    <span class="k">def</span> <span class="nf">get_storm</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">storm</span><span class="p">):</span>
        
        <span class="sa">r</span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Retrieves a Storm object for the requested storm.</span>
<span class="sd">        </span>
<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        storm : str or tuple</span>
<span class="sd">            Requested storm. Can be either string of storm ID (e.g., &quot;AL052019&quot;), or tuple with storm name and year (e.g., (&quot;Matthew&quot;,2016)).</span>
<span class="sd">        </span>
<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        tropycal.tracks.Storm</span>
<span class="sd">            Object containing information about the requested storm, and methods for analyzing and plotting the storm.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        
        <span class="c1">#Check if storm is str or tuple</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">storm</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
            <span class="n">key</span> <span class="o">=</span> <span class="n">storm</span>
        <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">storm</span><span class="p">,</span> <span class="nb">tuple</span><span class="p">):</span>
            <span class="n">key</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_storm_id</span><span class="p">((</span><span class="n">storm</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span><span class="n">storm</span><span class="p">[</span><span class="mi">1</span><span class="p">]))</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span><span class="s2">&quot;Storm must be a string (e.g., &#39;AL052019&#39;) or tuple (e.g., (&#39;Matthew&#39;,2016)).&quot;</span><span class="p">)</span>
        
        <span class="c1">#Retrieve key of given storm</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">key</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
            
            <span class="c1">#Check to see if tornado data exists for this storm</span>
            <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">keys_tors</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">key</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">data_tors</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
                    <span class="k">return</span> <span class="n">Storm</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="n">key</span><span class="p">],{</span><span class="s1">&#39;data&#39;</span><span class="p">:</span><span class="bp">self</span><span class="o">.</span><span class="n">data_tors</span><span class="p">[</span><span class="n">key</span><span class="p">],</span><span class="s1">&#39;dist_thresh&#39;</span><span class="p">:</span><span class="bp">self</span><span class="o">.</span><span class="n">tornado_dist_thresh</span><span class="p">})</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="k">return</span> <span class="n">Storm</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="n">key</span><span class="p">])</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">return</span> <span class="n">Storm</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="n">key</span><span class="p">])</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">error_message</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="sa">f</span><span class="s2">&quot;</span><span class="se">\n</span><span class="si">{</span><span class="n">i</span><span class="si">}</span><span class="s2">&quot;</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">key</span><span class="p">])</span>
            <span class="n">error_message</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;Multiple IDs were identified for the requested storm. Choose one of the following storm IDs and provide it as the &#39;storm&#39; argument instead of a tuple:</span><span class="si">{</span><span class="n">error_message</span><span class="si">}</span><span class="s2">&quot;</span>
            <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span><span class="n">error_message</span><span class="p">)</span></div>
    
    
<div class="viewcode-block" id="TrackDataset.plot_storm"><a class="viewcode-back" href="../../../api/generated/tropycal.tracks.TrackDataset.plot_storm.html#tropycal.tracks.TrackDataset.plot_storm">[docs]</a>    <span class="k">def</span> <span class="nf">plot_storm</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">storm</span><span class="p">,</span><span class="n">domain</span><span class="o">=</span><span class="s2">&quot;dynamic&quot;</span><span class="p">,</span><span class="n">plot_all_dots</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span><span class="n">ax</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span><span class="n">cartopy_proj</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span><span class="n">save_path</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span><span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        
        <span class="sa">r</span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Creates a plot of a single storm.</span>
<span class="sd">        </span>
<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        storm : str, tuple or dict</span>
<span class="sd">            Requested storm. Can be either string of storm ID (e.g., &quot;AL052019&quot;), tuple with storm name and year (e.g., (&quot;Matthew&quot;,2016)), or a dict entry.</span>
<span class="sd">        domain : str</span>
<span class="sd">            Domain for the plot. Default is &quot;dynamic&quot;. &quot;dynamic_tropical&quot; is also available. Please refer to :ref:`options-domain` for available domain options.</span>
<span class="sd">        plot_all_dots : bool</span>
<span class="sd">            Whether to plot dots for all observations along the track. If false, dots will be plotted every 6 hours. Default is false.</span>
<span class="sd">        ax : axes</span>
<span class="sd">            Instance of axes to plot on. If none, one will be generated. Default is none.</span>
<span class="sd">        cartopy_proj : ccrs</span>
<span class="sd">            Instance of a cartopy projection to use. If none, one will be generated. Default is none.</span>
<span class="sd">        save_path : str</span>
<span class="sd">            Relative or full path of directory to save the image in. If none, image will not be saved.</span>
<span class="sd">        </span>
<span class="sd">        Other Parameters</span>
<span class="sd">        ----------------</span>
<span class="sd">        prop : dict</span>
<span class="sd">            Customization properties of storm track lines. Please refer to :ref:`options-prop` for available options.</span>
<span class="sd">        map_prop : dict</span>
<span class="sd">            Customization properties of Cartopy map. Please refer to :ref:`options-map-prop` for available options.</span>
<span class="sd">        </span>
<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        ax</span>
<span class="sd">            Instance of axes containing the plot is returned.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        
        <span class="c1">#Retrieve kwargs</span>
        <span class="n">prop</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;prop&#39;</span><span class="p">,{})</span>
        <span class="n">map_prop</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;map_prop&#39;</span><span class="p">,{})</span>
        
        <span class="c1">#Retrieve requested storm</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">storm</span><span class="p">,</span><span class="nb">dict</span><span class="p">)</span> <span class="o">==</span> <span class="kc">False</span><span class="p">:</span>
            <span class="n">storm_dict</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_storm</span><span class="p">(</span><span class="n">storm</span><span class="p">)</span><span class="o">.</span><span class="n">dict</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">storm_dict</span> <span class="o">=</span> <span class="n">storm</span>
        
        <span class="c1">#Create instance of plot object</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">plot_obj</span>
        <span class="k">except</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">plot_obj</span> <span class="o">=</span> <span class="n">TrackPlot</span><span class="p">()</span>
        
        <span class="c1">#Create cartopy projection</span>
        <span class="k">if</span> <span class="n">cartopy_proj</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">plot_obj</span><span class="o">.</span><span class="n">proj</span> <span class="o">=</span> <span class="n">cartopy_proj</span>
        <span class="k">elif</span> <span class="nb">max</span><span class="p">(</span><span class="n">storm_dict</span><span class="p">[</span><span class="s1">&#39;lon&#39;</span><span class="p">])</span> <span class="o">&gt;</span> <span class="mi">150</span> <span class="ow">or</span> <span class="nb">min</span><span class="p">(</span><span class="n">storm_dict</span><span class="p">[</span><span class="s1">&#39;lon&#39;</span><span class="p">])</span> <span class="o">&lt;</span> <span class="o">-</span><span class="mi">150</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">plot_obj</span><span class="o">.</span><span class="n">create_cartopy</span><span class="p">(</span><span class="n">proj</span><span class="o">=</span><span class="s1">&#39;PlateCarree&#39;</span><span class="p">,</span><span class="n">central_longitude</span><span class="o">=</span><span class="mf">180.0</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">plot_obj</span><span class="o">.</span><span class="n">create_cartopy</span><span class="p">(</span><span class="n">proj</span><span class="o">=</span><span class="s1">&#39;PlateCarree&#39;</span><span class="p">,</span><span class="n">central_longitude</span><span class="o">=</span><span class="mf">0.0</span><span class="p">)</span>
            
        <span class="c1">#Plot storm</span>
        <span class="n">plot_ax</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">plot_obj</span><span class="o">.</span><span class="n">plot_storms</span><span class="p">([</span><span class="n">storm_dict</span><span class="p">],</span><span class="n">domain</span><span class="p">,</span><span class="n">plot_all_dots</span><span class="o">=</span><span class="n">plot_all_dots</span><span class="p">,</span><span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">,</span><span class="n">save_path</span><span class="o">=</span><span class="n">save_path</span><span class="p">,</span><span class="n">prop</span><span class="o">=</span><span class="n">prop</span><span class="p">,</span><span class="n">map_prop</span><span class="o">=</span><span class="n">map_prop</span><span class="p">)</span>
        
        <span class="c1">#Return axis</span>
        <span class="k">return</span> <span class="n">plot_ax</span></div>
    
    
<div class="viewcode-block" id="TrackDataset.plot_storms"><a class="viewcode-back" href="../../../api/generated/tropycal.tracks.TrackDataset.plot_storms.html#tropycal.tracks.TrackDataset.plot_storms">[docs]</a>    <span class="k">def</span> <span class="nf">plot_storms</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">storms</span><span class="p">,</span><span class="n">domain</span><span class="o">=</span><span class="s2">&quot;dynamic&quot;</span><span class="p">,</span><span class="n">title</span><span class="o">=</span><span class="s2">&quot;TC Track Composite&quot;</span><span class="p">,</span><span class="n">plot_all_dots</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span><span class="n">ax</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span><span class="n">cartopy_proj</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span><span class="n">save_path</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span><span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        
        <span class="sa">r</span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Creates a plot of multiple storms.</span>
<span class="sd">        </span>
<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        storms : list</span>
<span class="sd">            List of requested storms. List can contain either strings of storm ID (e.g., &quot;AL052019&quot;), tuples with storm name and year (e.g., (&quot;Matthew&quot;,2016)), or dict entries.</span>
<span class="sd">        domain : str</span>
<span class="sd">            Domain for the plot. Default is &quot;dynamic&quot;. Please refer to :ref:`options-domain` for available domain options.</span>
<span class="sd">        title : str</span>
<span class="sd">            Title string to display on the plot. Default is &quot;TC Track Composite&quot;.</span>
<span class="sd">        plot_all_dots : bool</span>
<span class="sd">            Whether to plot dots for all observations along the track. If false, dots will be plotted every 6 hours. Default is false.</span>
<span class="sd">        ax : axes</span>
<span class="sd">            Instance of axes to plot on. If none, one will be generated. Default is none.</span>
<span class="sd">        cartopy_proj : ccrs</span>
<span class="sd">            Instance of a cartopy projection to use. If none, one will be generated. Default is none.</span>
<span class="sd">        save_path : str</span>
<span class="sd">            Relative or full path of directory to save the image in. If none, image will not be saved.</span>
<span class="sd">        </span>
<span class="sd">        Other Parameters</span>
<span class="sd">        ----------------</span>
<span class="sd">        prop : dict</span>
<span class="sd">            Customization properties of storm track lines. Please refer to :ref:`options-prop` for available options.</span>
<span class="sd">        map_prop : dict</span>
<span class="sd">            Customization properties of Cartopy map. Please refer to :ref:`options-map-prop` for available options.</span>
<span class="sd">        </span>
<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        ax</span>
<span class="sd">            Instance of axes containing the plot is returned.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        
        <span class="c1">#Retrieve kwargs</span>
        <span class="n">prop</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;prop&#39;</span><span class="p">,{})</span>
        <span class="n">map_prop</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;map_prop&#39;</span><span class="p">,{})</span>
        
        <span class="c1">#Create instance of plot object</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">plot_obj</span>
        <span class="k">except</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">plot_obj</span> <span class="o">=</span> <span class="n">TrackPlot</span><span class="p">()</span>
        
        <span class="c1">#Identify plot domain for all requested storms</span>
        <span class="n">max_lon</span> <span class="o">=</span> <span class="o">-</span><span class="mi">9999</span>
        <span class="n">min_lon</span> <span class="o">=</span> <span class="mi">9999</span>
        <span class="n">storm_dicts</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">storm</span> <span class="ow">in</span> <span class="n">storms</span><span class="p">:</span>
            
            <span class="c1">#Retrieve requested storm</span>
            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">storm</span><span class="p">,</span><span class="nb">dict</span><span class="p">)</span> <span class="o">==</span> <span class="kc">False</span><span class="p">:</span>
                <span class="n">storm_dict</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_storm</span><span class="p">(</span><span class="n">storm</span><span class="p">)</span><span class="o">.</span><span class="n">dict</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">storm_dict</span> <span class="o">=</span> <span class="n">storm</span>
            <span class="n">storm_dicts</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">storm_dict</span><span class="p">)</span>
            
            <span class="c1">#Add to array of max/min lat/lons</span>
            <span class="k">if</span> <span class="nb">max</span><span class="p">(</span><span class="n">storm_dict</span><span class="p">[</span><span class="s1">&#39;lon&#39;</span><span class="p">])</span> <span class="o">&gt;</span> <span class="n">max_lon</span><span class="p">:</span> <span class="n">max_lon</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="n">storm_dict</span><span class="p">[</span><span class="s1">&#39;lon&#39;</span><span class="p">])</span>
            <span class="k">if</span> <span class="nb">min</span><span class="p">(</span><span class="n">storm_dict</span><span class="p">[</span><span class="s1">&#39;lon&#39;</span><span class="p">])</span> <span class="o">&lt;</span> <span class="n">min_lon</span><span class="p">:</span> <span class="n">min_lon</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="n">storm_dict</span><span class="p">[</span><span class="s1">&#39;lon&#39;</span><span class="p">])</span>
            
        <span class="c1">#Create cartopy projection</span>
        <span class="k">if</span> <span class="n">cartopy_proj</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">plot_obj</span><span class="o">.</span><span class="n">proj</span> <span class="o">=</span> <span class="n">cartopy_proj</span>
        <span class="k">elif</span> <span class="nb">max</span><span class="p">(</span><span class="n">storm_dict</span><span class="p">[</span><span class="s1">&#39;lon&#39;</span><span class="p">])</span> <span class="o">&gt;</span> <span class="mi">150</span> <span class="ow">or</span> <span class="nb">min</span><span class="p">(</span><span class="n">storm_dict</span><span class="p">[</span><span class="s1">&#39;lon&#39;</span><span class="p">])</span> <span class="o">&lt;</span> <span class="o">-</span><span class="mi">150</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">plot_obj</span><span class="o">.</span><span class="n">create_cartopy</span><span class="p">(</span><span class="n">proj</span><span class="o">=</span><span class="s1">&#39;PlateCarree&#39;</span><span class="p">,</span><span class="n">central_longitude</span><span class="o">=</span><span class="mf">180.0</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">plot_obj</span><span class="o">.</span><span class="n">create_cartopy</span><span class="p">(</span><span class="n">proj</span><span class="o">=</span><span class="s1">&#39;PlateCarree&#39;</span><span class="p">,</span><span class="n">central_longitude</span><span class="o">=</span><span class="mf">0.0</span><span class="p">)</span>
            
        <span class="c1">#Plot storm</span>
        <span class="n">plot_ax</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">plot_obj</span><span class="o">.</span><span class="n">plot_storms</span><span class="p">(</span><span class="n">storm_dicts</span><span class="p">,</span><span class="n">domain</span><span class="p">,</span><span class="n">title</span><span class="p">,</span><span class="n">plot_all_dots</span><span class="p">,</span><span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">,</span><span class="n">save_path</span><span class="o">=</span><span class="n">save_path</span><span class="p">,</span><span class="n">prop</span><span class="o">=</span><span class="n">prop</span><span class="p">,</span><span class="n">map_prop</span><span class="o">=</span><span class="n">map_prop</span><span class="p">)</span>
        
        <span class="c1">#Return axis</span>
        <span class="k">return</span> <span class="n">plot_ax</span></div>
        
        
<div class="viewcode-block" id="TrackDataset.plot_season"><a class="viewcode-back" href="../../../api/generated/tropycal.tracks.TrackDataset.plot_season.html#tropycal.tracks.TrackDataset.plot_season">[docs]</a>    <span class="k">def</span> <span class="nf">plot_season</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">year</span><span class="p">,</span><span class="n">domain</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span><span class="n">ax</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span><span class="n">cartopy_proj</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span><span class="n">save_path</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span><span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        
        <span class="sa">r</span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Creates a plot of a single season.</span>
<span class="sd">        </span>
<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        year : int</span>
<span class="sd">            Year to retrieve season data. If in southern hemisphere, year is the 2nd year of the season (e.g., 1975 for 1974-1975).</span>
<span class="sd">        domain : str</span>
<span class="sd">            Domain for the plot. Default is basin-wide. Please refer to :ref:`options-domain` for available domain options.</span>
<span class="sd">        ax : axes</span>
<span class="sd">            Instance of axes to plot on. If none, one will be generated. Default is none.</span>
<span class="sd">        cartopy_proj : ccrs</span>
<span class="sd">            Instance of a cartopy projection to use. If none, one will be generated. Default is none.</span>
<span class="sd">        save_path : str</span>
<span class="sd">            Relative or full path of directory to save the image in. If none, image will not be saved.</span>
<span class="sd">        </span>
<span class="sd">        Other Parameters</span>
<span class="sd">        ----------------</span>
<span class="sd">        prop : dict</span>
<span class="sd">            Customization properties of storm track lines. Please refer to :ref:`options-prop` for available options.</span>
<span class="sd">        map_prop : dict</span>
<span class="sd">            Customization properties of Cartopy map. Please refer to :ref:`options-map-prop` for available options.</span>
<span class="sd">        </span>
<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        ax</span>
<span class="sd">            Instance of axes containing the plot is returned.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        
        <span class="c1">#Retrieve kwargs</span>
        <span class="n">prop</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;prop&#39;</span><span class="p">,{})</span>
        <span class="n">map_prop</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;map_prop&#39;</span><span class="p">,{})</span>
        
        <span class="c1">#Retrieve season object</span>
        <span class="n">season</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_season</span><span class="p">(</span><span class="n">year</span><span class="p">)</span>
        
        <span class="c1">#Create instance of plot object</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">plot_obj</span>
        <span class="k">except</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">plot_obj</span> <span class="o">=</span> <span class="n">TrackPlot</span><span class="p">()</span>
        
        <span class="c1">#Create cartopy projection</span>
        <span class="k">if</span> <span class="n">cartopy_proj</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">plot_obj</span><span class="o">.</span><span class="n">proj</span> <span class="o">=</span> <span class="n">cartopy_proj</span>
        <span class="k">elif</span> <span class="n">season</span><span class="o">.</span><span class="n">basin</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;east_pacific&#39;</span><span class="p">,</span><span class="s1">&#39;west_pacific&#39;</span><span class="p">,</span><span class="s1">&#39;south_pacific&#39;</span><span class="p">,</span><span class="s1">&#39;australia&#39;</span><span class="p">,</span><span class="s1">&#39;all&#39;</span><span class="p">]:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">plot_obj</span><span class="o">.</span><span class="n">create_cartopy</span><span class="p">(</span><span class="n">proj</span><span class="o">=</span><span class="s1">&#39;PlateCarree&#39;</span><span class="p">,</span><span class="n">central_longitude</span><span class="o">=</span><span class="mf">180.0</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">plot_obj</span><span class="o">.</span><span class="n">create_cartopy</span><span class="p">(</span><span class="n">proj</span><span class="o">=</span><span class="s1">&#39;PlateCarree&#39;</span><span class="p">,</span><span class="n">central_longitude</span><span class="o">=</span><span class="mf">0.0</span><span class="p">)</span>
            
        <span class="c1">#Plot season</span>
        <span class="n">plot_ax</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">plot_obj</span><span class="o">.</span><span class="n">plot_season</span><span class="p">(</span><span class="n">season</span><span class="p">,</span><span class="n">domain</span><span class="p">,</span><span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">,</span><span class="n">save_path</span><span class="o">=</span><span class="n">save_path</span><span class="p">,</span><span class="n">prop</span><span class="o">=</span><span class="n">prop</span><span class="p">,</span><span class="n">map_prop</span><span class="o">=</span><span class="n">map_prop</span><span class="p">)</span>
        
        <span class="c1">#Return axis</span>
        <span class="k">return</span> <span class="n">plot_ax</span></div>
    
    
<div class="viewcode-block" id="TrackDataset.search_name"><a class="viewcode-back" href="../../../api/generated/tropycal.tracks.TrackDataset.search_name.html#tropycal.tracks.TrackDataset.search_name">[docs]</a>    <span class="k">def</span> <span class="nf">search_name</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">name</span><span class="p">):</span>
        
        <span class="sa">r</span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Searches for hurricane seasons containing a storm of the requested name.</span>
<span class="sd">        </span>
<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        name : str</span>
<span class="sd">            Name to search through the dataset for.</span>
<span class="sd">        </span>
<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        list</span>
<span class="sd">            List containing the hurricane seasons where a storm of the requested name was found.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        
        <span class="c1">#get keys for all storms in requested year</span>
        <span class="n">years</span> <span class="o">=</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="n">key</span><span class="p">][</span><span class="s1">&#39;year&#39;</span><span class="p">]</span> <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">keys</span> <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="n">key</span><span class="p">][</span><span class="s1">&#39;name&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="n">name</span><span class="o">.</span><span class="n">upper</span><span class="p">()]</span>
        
        <span class="k">return</span> <span class="n">years</span></div>
    
    
<div class="viewcode-block" id="TrackDataset.download_tcr"><a class="viewcode-back" href="../../../api/generated/tropycal.tracks.TrackDataset.download_tcr.html#tropycal.tracks.TrackDataset.download_tcr">[docs]</a>    <span class="k">def</span> <span class="nf">download_tcr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">storm</span><span class="p">,</span><span class="n">save_path</span><span class="o">=</span><span class="s2">&quot;&quot;</span><span class="p">):</span>
        
        <span class="sa">r</span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Downloads the NHC offical Tropical Cyclone Report (TCR) for the requested storm to the requested directory. Available only for storms with advisories issued by the National Hurricane Center.</span>
<span class="sd">        </span>
<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        storm : str, tuple or dict</span>
<span class="sd">            Requested storm. Can be either string of storm ID (e.g., &quot;AL052019&quot;), tuple with storm name and year (e.g., (&quot;Matthew&quot;,2016)), or a dict entry.</span>
<span class="sd">        save_path : str</span>
<span class="sd">            Path of directory to download the TCR into. Default is current working directory.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        
        <span class="c1">#Retrieve requested storm</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">storm</span><span class="p">,</span><span class="nb">dict</span><span class="p">)</span> <span class="o">==</span> <span class="kc">False</span><span class="p">:</span>
            <span class="n">storm_dict</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_storm</span><span class="p">(</span><span class="n">storm</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">storm_dict</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_storm</span><span class="p">(</span><span class="n">storm</span><span class="o">.</span><span class="n">id</span><span class="p">)</span>
        
        <span class="c1">#Error check</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">source</span> <span class="o">!=</span> <span class="s2">&quot;hurdat&quot;</span><span class="p">:</span>
            <span class="n">msg</span> <span class="o">=</span> <span class="s2">&quot;NHC data can only be accessed when HURDAT is used as the data source.&quot;</span>
            <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">year</span> <span class="o">&lt;</span> <span class="mi">1995</span><span class="p">:</span>
            <span class="n">msg</span> <span class="o">=</span> <span class="s2">&quot;Tropical Cyclone Reports are unavailable prior to 1995.&quot;</span>
            <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">save_path</span><span class="p">,</span><span class="nb">str</span><span class="p">)</span> <span class="o">==</span> <span class="kc">False</span><span class="p">:</span>
            <span class="n">msg</span> <span class="o">=</span> <span class="s2">&quot;&#39;save_path&#39; must be of type str.&quot;</span>
            <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>
        
        <span class="c1">#Format URL</span>
        <span class="n">storm_id</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">dict</span><span class="p">[</span><span class="s1">&#39;id&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">upper</span><span class="p">()</span>
        <span class="n">storm_name</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">dict</span><span class="p">[</span><span class="s1">&#39;name&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">title</span><span class="p">()</span>
        <span class="n">url</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;https://www.nhc.noaa.gov/data/tcr/</span><span class="si">{</span><span class="n">storm_id</span><span class="si">}</span><span class="s2">_</span><span class="si">{</span><span class="n">storm_name</span><span class="si">}</span><span class="s2">.pdf&quot;</span>
        
        <span class="c1">#Check to make sure PDF is available</span>
        <span class="n">request</span> <span class="o">=</span> <span class="n">requests</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">url</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">request</span><span class="o">.</span><span class="n">status_code</span> <span class="o">!=</span> <span class="mi">200</span><span class="p">:</span>
            <span class="n">msg</span> <span class="o">=</span> <span class="s2">&quot;This tropical cyclone does not have a Tropical Cyclone Report (TCR) available.&quot;</span>
            <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>
        
        <span class="c1">#Retrieve PDF</span>
        <span class="n">response</span> <span class="o">=</span> <span class="n">requests</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">url</span><span class="p">)</span>
        <span class="n">full_path</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">save_path</span><span class="p">,</span><span class="sa">f</span><span class="s2">&quot;TCR_</span><span class="si">{</span><span class="n">storm_id</span><span class="si">}</span><span class="s2">_</span><span class="si">{</span><span class="n">storm_name</span><span class="si">}</span><span class="s2">.pdf&quot;</span><span class="p">)</span>
        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">full_path</span><span class="p">,</span> <span class="s1">&#39;wb&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
            <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">response</span><span class="o">.</span><span class="n">content</span><span class="p">)</span></div>
    
    
    <span class="k">def</span> <span class="nf">__retrieve_season</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">year</span><span class="p">,</span><span class="n">basin</span><span class="p">):</span>
        
        <span class="c1">#Initialize dict to be populated</span>
        <span class="n">season_dict</span> <span class="o">=</span> <span class="p">{}</span>
        
        <span class="c1">#Search for corresponding entry in keys</span>
        <span class="n">basin_list</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">keys</span><span class="p">:</span>
            
            <span class="c1">#Get year for &#39;all&#39; (global data), otherwise get season</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">basin</span> <span class="o">==</span> <span class="s1">&#39;all&#39;</span> <span class="ow">and</span> <span class="n">basin</span> <span class="o">==</span> <span class="s1">&#39;all&#39;</span><span class="p">:</span>
                <span class="n">temp_year</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">year</span><span class="p">)</span> <span class="k">if</span> <span class="nb">int</span><span class="p">(</span><span class="n">year</span><span class="p">)</span> <span class="ow">in</span> <span class="p">[</span><span class="n">i</span><span class="o">.</span><span class="n">year</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="n">key</span><span class="p">][</span><span class="s1">&#39;date&#39;</span><span class="p">]]</span> <span class="k">else</span> <span class="mi">0</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">temp_year</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="n">key</span><span class="p">][</span><span class="s1">&#39;season&#39;</span><span class="p">]</span>
            
            <span class="c1">#Proceed if year/season is a match</span>
            <span class="k">if</span> <span class="n">temp_year</span> <span class="o">==</span> <span class="nb">int</span><span class="p">(</span><span class="n">year</span><span class="p">):</span>
                <span class="n">temp_basin</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="n">key</span><span class="p">][</span><span class="s1">&#39;basin&#39;</span><span class="p">]</span>
                <span class="n">temp_wmo_basin</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="n">key</span><span class="p">][</span><span class="s1">&#39;wmo_basin&#39;</span><span class="p">]</span>
                <span class="k">if</span> <span class="n">temp_basin</span> <span class="o">==</span> <span class="s1">&#39;all&#39;</span><span class="p">:</span>
                    <span class="k">if</span> <span class="n">basin</span> <span class="o">==</span> <span class="s1">&#39;all&#39;</span><span class="p">:</span>
                        <span class="n">season_dict</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="n">key</span><span class="p">]</span>
                        <span class="n">basin_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">&#39;all&#39;</span><span class="p">)</span>
                    <span class="k">elif</span> <span class="n">basin</span> <span class="ow">in</span> <span class="n">temp_wmo_basin</span><span class="p">:</span>
                        <span class="n">season_dict</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="n">key</span><span class="p">]</span>
                        <span class="n">basin_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="n">key</span><span class="p">][</span><span class="s1">&#39;wmo_basin&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">])</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">season_dict</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="n">key</span><span class="p">]</span>
                    <span class="n">basin_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="n">key</span><span class="p">][</span><span class="s1">&#39;wmo_basin&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">])</span>
                
        <span class="c1">#Error check</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">season_dict</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span><span class="s2">&quot;No storms were identified for the given year in the given basin.&quot;</span><span class="p">)</span>
        
        <span class="c1">#Add attributes</span>
        <span class="n">first_key</span> <span class="o">=</span> <span class="p">[</span><span class="n">k</span> <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="n">season_dict</span><span class="o">.</span><span class="n">keys</span><span class="p">()][</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">season_info</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="n">season_info</span><span class="p">[</span><span class="s1">&#39;year&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">year</span>
        <span class="n">season_info</span><span class="p">[</span><span class="s1">&#39;basin&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="n">basin_list</span><span class="p">),</span> <span class="n">key</span><span class="o">=</span><span class="n">basin_list</span><span class="o">.</span><span class="n">count</span><span class="p">)</span>
        <span class="n">season_info</span><span class="p">[</span><span class="s1">&#39;source_basin&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">season_dict</span><span class="p">[</span><span class="n">first_key</span><span class="p">][</span><span class="s1">&#39;basin&#39;</span><span class="p">]</span>
        <span class="n">season_info</span><span class="p">[</span><span class="s1">&#39;source&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">season_dict</span><span class="p">[</span><span class="n">first_key</span><span class="p">][</span><span class="s1">&#39;source&#39;</span><span class="p">]</span>
        <span class="n">season_info</span><span class="p">[</span><span class="s1">&#39;source_info&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">season_dict</span><span class="p">[</span><span class="n">first_key</span><span class="p">][</span><span class="s1">&#39;source_info&#39;</span><span class="p">]</span>
        
        <span class="c1">#Fix basin</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">basin</span> <span class="o">==</span> <span class="s1">&#39;all&#39;</span> <span class="ow">and</span> <span class="n">basin</span> <span class="o">==</span> <span class="s1">&#39;all&#39;</span><span class="p">:</span>
            <span class="n">season_info</span><span class="p">[</span><span class="s1">&#39;basin&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;all&#39;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">basin</span> <span class="o">==</span> <span class="s1">&#39;both&#39;</span><span class="p">:</span>
            <span class="n">season_info</span><span class="p">[</span><span class="s1">&#39;basin&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;both&#39;</span>
        
        <span class="c1">#Return object</span>
        <span class="k">return</span> <span class="n">Season</span><span class="p">(</span><span class="n">season_dict</span><span class="p">,</span><span class="n">season_info</span><span class="p">)</span>
                   
<div class="viewcode-block" id="TrackDataset.get_season"><a class="viewcode-back" href="../../../api/generated/tropycal.tracks.TrackDataset.get_season.html#tropycal.tracks.TrackDataset.get_season">[docs]</a>    <span class="k">def</span> <span class="nf">get_season</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">year</span><span class="p">,</span><span class="n">basin</span><span class="o">=</span><span class="s1">&#39;all&#39;</span><span class="p">):</span>
        
        <span class="sa">r</span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Retrieves a Season object for the requested season or seasons.</span>
<span class="sd">        </span>
<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        year : int or list</span>
<span class="sd">            Year(s) to retrieve season data. If in southern hemisphere, year is the 2nd year of the season (e.g., 1975 for 1974-1975). Use of multiple years is only permissible for hurdat sources.</span>
<span class="sd">        basin : str, optional</span>
<span class="sd">            If using a global ibtracs dataset, this specifies which basin to load in. Otherwise this argument is ignored.</span>
<span class="sd">        </span>
<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        tropycal.tracks.Season</span>
<span class="sd">            Object containing every storm entry for the given season, and methods for analyzing and plotting the season.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        
        <span class="c1">#Error checks</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">year</span><span class="p">,(</span><span class="nb">int</span><span class="p">,</span><span class="n">np</span><span class="o">.</span><span class="n">int</span><span class="p">,</span><span class="n">np</span><span class="o">.</span><span class="n">integer</span><span class="p">,</span><span class="nb">float</span><span class="p">,</span><span class="n">np</span><span class="o">.</span><span class="n">floating</span><span class="p">))</span> <span class="o">==</span> <span class="kc">False</span> <span class="ow">and</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">year</span><span class="p">,</span><span class="nb">list</span><span class="p">)</span> <span class="o">==</span> <span class="kc">False</span><span class="p">:</span>
            <span class="n">msg</span> <span class="o">=</span> <span class="s2">&quot;&#39;year&#39; must be of type int or list.&quot;</span>
            <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">year</span><span class="p">,</span><span class="nb">list</span><span class="p">):</span>
            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">year</span><span class="p">:</span>
                <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">i</span><span class="p">,(</span><span class="nb">int</span><span class="p">,</span><span class="n">np</span><span class="o">.</span><span class="n">int</span><span class="p">,</span><span class="n">np</span><span class="o">.</span><span class="n">integer</span><span class="p">,</span><span class="nb">float</span><span class="p">,</span><span class="n">np</span><span class="o">.</span><span class="n">floating</span><span class="p">))</span> <span class="o">==</span> <span class="kc">False</span><span class="p">:</span>
                    <span class="n">msg</span> <span class="o">=</span> <span class="s2">&quot;Elements of list &#39;year&#39; must be of type int.&quot;</span>
                    <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>
        
        <span class="c1">#Retrieve season object(s)</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">year</span><span class="p">,(</span><span class="nb">int</span><span class="p">,</span><span class="n">np</span><span class="o">.</span><span class="n">int</span><span class="p">,</span><span class="n">np</span><span class="o">.</span><span class="n">integer</span><span class="p">,</span><span class="nb">float</span><span class="p">,</span><span class="n">np</span><span class="o">.</span><span class="n">floating</span><span class="p">)):</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">__retrieve_season</span><span class="p">(</span><span class="n">year</span><span class="p">,</span><span class="n">basin</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">return_season</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__retrieve_season</span><span class="p">(</span><span class="n">year</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span><span class="n">basin</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">i_year</span> <span class="ow">in</span> <span class="n">year</span><span class="p">[</span><span class="mi">1</span><span class="p">:]:</span>
                <span class="n">return_season</span> <span class="o">=</span> <span class="n">return_season</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">__retrieve_season</span><span class="p">(</span><span class="n">i_year</span><span class="p">,</span><span class="n">basin</span><span class="p">)</span>
            <span class="k">return</span> <span class="n">return_season</span></div>
    
<div class="viewcode-block" id="TrackDataset.ace_climo"><a class="viewcode-back" href="../../../api/generated/tropycal.tracks.TrackDataset.ace_climo.html#tropycal.tracks.TrackDataset.ace_climo">[docs]</a>    <span class="k">def</span> <span class="nf">ace_climo</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">plot_year</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span><span class="n">compare_years</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span><span class="n">climo_year_range</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span><span class="n">month_range</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span><span class="n">rolling_sum</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span><span class="n">return_dict</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span><span class="n">plot</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span><span class="n">save_path</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        
        <span class="sa">r</span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Creates and plots a climatology of accumulated cyclone energy (ACE).</span>
<span class="sd">        </span>
<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        plot_year : int</span>
<span class="sd">            Year to highlight. If current year, plot will be drawn through today. If none, no year will be highlighted.</span>
<span class="sd">        compare_years : int or list</span>
<span class="sd">            Seasons to compare against. Can be either a single season (int), or a range or list of seasons (list).</span>
<span class="sd">        climo_year_range : tuple</span>
<span class="sd">            Start and end years to compute the climatology over. Default is from 1950 to last year.</span>
<span class="sd">        month_range : tuple</span>
<span class="sd">            Start and end months to plot (e.g., ``(5,10)``). Default is peak hurricane season by basin.</span>
<span class="sd">        rolling_sum : int</span>
<span class="sd">            Days to calculate a rolling sum over. Default is 0 (annual running sum).</span>
<span class="sd">        return_dict : bool</span>
<span class="sd">            Determines whether to return data from this function. Default is False.</span>
<span class="sd">        plot : bool</span>
<span class="sd">            Determines whether to generate a plot or not. If False, function simply returns ace dictionary.</span>
<span class="sd">        save_path : str</span>
<span class="sd">            Determines the file path to save the image to. If blank or none, image will be directly shown.</span>
<span class="sd">        </span>
<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        axes or dict</span>
<span class="sd">            By default, the plot axes is returned. If return_dict is True, a dictionary containing the axes and data about the ACE climatology is returned.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        
        <span class="c1">#Retrieve current year</span>
        <span class="n">cur_year</span> <span class="o">=</span> <span class="n">dt</span><span class="o">.</span><span class="n">now</span><span class="p">()</span><span class="o">.</span><span class="n">year</span>
        
        <span class="k">if</span> <span class="n">climo_year_range</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">climo_year_range</span> <span class="o">=</span> <span class="p">(</span><span class="mi">1950</span><span class="p">,</span><span class="n">dt</span><span class="o">.</span><span class="n">now</span><span class="p">()</span><span class="o">.</span><span class="n">year</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span>
        
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">basin</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;south_indian&#39;</span><span class="p">,</span><span class="s1">&#39;australia&#39;</span><span class="p">,</span><span class="s1">&#39;south_pacific&#39;</span><span class="p">]:</span>
            <span class="n">warnings</span><span class="o">.</span><span class="n">warn</span><span class="p">(</span><span class="s2">&quot;This function is not currently configured to work in the Southern Hemisphere.&quot;</span><span class="p">)</span>
        
        <span class="c1">#Create empty dict</span>
        <span class="n">ace</span> <span class="o">=</span> <span class="p">{}</span>
        
        <span class="c1">#Iterate over every year of HURDAT available</span>
        <span class="n">end_year</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">keys</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]][</span><span class="s1">&#39;year&#39;</span><span class="p">]</span>
        <span class="n">years</span> <span class="o">=</span> <span class="p">[</span><span class="n">yr</span> <span class="k">for</span> <span class="n">yr</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1851</span><span class="p">,</span><span class="n">dt</span><span class="o">.</span><span class="n">now</span><span class="p">()</span><span class="o">.</span><span class="n">year</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span> <span class="k">if</span> <span class="p">(</span><span class="nb">min</span><span class="p">(</span><span class="n">climo_year_range</span><span class="p">)</span><span class="o">&lt;=</span><span class="n">yr</span><span class="o">&lt;=</span><span class="nb">max</span><span class="p">(</span><span class="n">climo_year_range</span><span class="p">))</span> <span class="ow">or</span> <span class="n">yr</span><span class="o">==</span><span class="n">plot_year</span><span class="p">]</span>
        <span class="k">for</span> <span class="n">year</span> <span class="ow">in</span> <span class="n">years</span><span class="p">:</span>
            
            <span class="c1">#Get info for this year</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">season</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_season</span><span class="p">(</span><span class="n">year</span><span class="p">)</span>
                <span class="n">year_info</span> <span class="o">=</span> <span class="n">season</span><span class="o">.</span><span class="n">summary</span><span class="p">()</span>
            <span class="k">except</span><span class="p">:</span>
                <span class="k">continue</span>
            
            <span class="c1">#Generate list of dates for this year</span>
            <span class="n">year_dates</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">dt</span><span class="o">.</span><span class="n">strptime</span><span class="p">(((</span><span class="n">pd</span><span class="o">.</span><span class="n">to_datetime</span><span class="p">(</span><span class="n">i</span><span class="p">))</span><span class="o">.</span><span class="n">strftime</span><span class="p">(</span><span class="s1">&#39;%Y%m</span><span class="si">%d</span><span class="s1">%H&#39;</span><span class="p">)),</span><span class="s1">&#39;%Y%m</span><span class="si">%d</span><span class="s1">%H&#39;</span><span class="p">)</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">dt</span><span class="p">(</span><span class="n">year</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">),</span><span class="n">dt</span><span class="p">(</span><span class="n">year</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">),</span><span class="n">timedelta</span><span class="p">(</span><span class="n">hours</span><span class="o">=</span><span class="mi">6</span><span class="p">))])</span>
            
            <span class="c1">#Remove 2/29 from dates</span>
            <span class="k">if</span> <span class="n">calendar</span><span class="o">.</span><span class="n">isleap</span><span class="p">(</span><span class="n">year</span><span class="p">):</span>
                <span class="n">year_dates</span> <span class="o">=</span> <span class="n">year_dates</span><span class="p">[</span><span class="n">year_dates</span> <span class="o">!=</span> <span class="n">dt</span><span class="p">(</span><span class="n">year</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">29</span><span class="p">,</span><span class="mi">0</span><span class="p">)]</span>
                <span class="n">year_dates</span> <span class="o">=</span> <span class="n">year_dates</span><span class="p">[</span><span class="n">year_dates</span> <span class="o">!=</span> <span class="n">dt</span><span class="p">(</span><span class="n">year</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">29</span><span class="p">,</span><span class="mi">3</span><span class="p">)]</span>
                <span class="n">year_dates</span> <span class="o">=</span> <span class="n">year_dates</span><span class="p">[</span><span class="n">year_dates</span> <span class="o">!=</span> <span class="n">dt</span><span class="p">(</span><span class="n">year</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">29</span><span class="p">,</span><span class="mi">6</span><span class="p">)]</span>
                <span class="n">year_dates</span> <span class="o">=</span> <span class="n">year_dates</span><span class="p">[</span><span class="n">year_dates</span> <span class="o">!=</span> <span class="n">dt</span><span class="p">(</span><span class="n">year</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">29</span><span class="p">,</span><span class="mi">9</span><span class="p">)]</span>
                <span class="n">year_dates</span> <span class="o">=</span> <span class="n">year_dates</span><span class="p">[</span><span class="n">year_dates</span> <span class="o">!=</span> <span class="n">dt</span><span class="p">(</span><span class="n">year</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">29</span><span class="p">,</span><span class="mi">12</span><span class="p">)]</span>
                <span class="n">year_dates</span> <span class="o">=</span> <span class="n">year_dates</span><span class="p">[</span><span class="n">year_dates</span> <span class="o">!=</span> <span class="n">dt</span><span class="p">(</span><span class="n">year</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">29</span><span class="p">,</span><span class="mi">15</span><span class="p">)]</span>
                <span class="n">year_dates</span> <span class="o">=</span> <span class="n">year_dates</span><span class="p">[</span><span class="n">year_dates</span> <span class="o">!=</span> <span class="n">dt</span><span class="p">(</span><span class="n">year</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">29</span><span class="p">,</span><span class="mi">18</span><span class="p">)]</span>
                <span class="n">year_dates</span> <span class="o">=</span> <span class="n">year_dates</span><span class="p">[</span><span class="n">year_dates</span> <span class="o">!=</span> <span class="n">dt</span><span class="p">(</span><span class="n">year</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">29</span><span class="p">,</span><span class="mi">21</span><span class="p">)]</span>
            
            <span class="c1">#Additional empty arrays</span>
            <span class="n">year_cumace</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">year_dates</span><span class="o">.</span><span class="n">shape</span><span class="p">))</span>
            <span class="n">year_genesis</span> <span class="o">=</span> <span class="p">[]</span>
            
            <span class="c1">#Get list of storms for this year</span>
            <span class="n">storm_ids</span> <span class="o">=</span> <span class="n">year_info</span><span class="p">[</span><span class="s1">&#39;id&#39;</span><span class="p">]</span>
            <span class="k">for</span> <span class="n">storm</span> <span class="ow">in</span> <span class="n">storm_ids</span><span class="p">:</span>
                
                <span class="c1">#Get HURDAT data for this storm</span>
                <span class="n">storm_data</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="n">storm</span><span class="p">]</span>
                <span class="n">storm_date_y</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="nb">int</span><span class="p">(</span><span class="n">i</span><span class="o">.</span><span class="n">strftime</span><span class="p">(</span><span class="s1">&#39;%Y&#39;</span><span class="p">))</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">storm_data</span><span class="p">[</span><span class="s1">&#39;date&#39;</span><span class="p">]])</span>
                <span class="n">storm_date_h</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">i</span><span class="o">.</span><span class="n">strftime</span><span class="p">(</span><span class="s1">&#39;%H%M&#39;</span><span class="p">)</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">storm_data</span><span class="p">[</span><span class="s1">&#39;date&#39;</span><span class="p">]])</span>
                <span class="n">storm_date_m</span> <span class="o">=</span> <span class="p">[</span><span class="n">i</span><span class="o">.</span><span class="n">strftime</span><span class="p">(</span><span class="s1">&#39;%m</span><span class="si">%d</span><span class="s1">&#39;</span><span class="p">)</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">storm_data</span><span class="p">[</span><span class="s1">&#39;date&#39;</span><span class="p">]]</span>
                <span class="n">storm_date</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">storm_data</span><span class="p">[</span><span class="s1">&#39;date&#39;</span><span class="p">])</span>
                <span class="n">storm_type</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">storm_data</span><span class="p">[</span><span class="s1">&#39;type&#39;</span><span class="p">])</span>
                <span class="n">storm_vmax</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">storm_data</span><span class="p">[</span><span class="s1">&#39;vmax&#39;</span><span class="p">])</span>
                
                <span class="c1">#Subset to remove obs not useful for ace</span>
                <span class="n">idx1</span> <span class="o">=</span> <span class="p">((</span><span class="n">storm_type</span> <span class="o">==</span> <span class="s1">&#39;SS&#39;</span><span class="p">)</span> <span class="o">|</span> <span class="p">(</span><span class="n">storm_type</span> <span class="o">==</span> <span class="s1">&#39;TS&#39;</span><span class="p">)</span> <span class="o">|</span> <span class="p">(</span><span class="n">storm_type</span> <span class="o">==</span> <span class="s1">&#39;HU&#39;</span><span class="p">))</span>
                <span class="n">idx2</span> <span class="o">=</span> <span class="o">~</span><span class="n">np</span><span class="o">.</span><span class="n">isnan</span><span class="p">(</span><span class="n">storm_vmax</span><span class="p">)</span>
                <span class="n">idx3</span> <span class="o">=</span> <span class="p">((</span><span class="n">storm_date_h</span> <span class="o">==</span> <span class="s1">&#39;0000&#39;</span><span class="p">)</span> <span class="o">|</span> <span class="p">(</span><span class="n">storm_date_h</span> <span class="o">==</span> <span class="s1">&#39;0600&#39;</span><span class="p">)</span> <span class="o">|</span> <span class="p">(</span><span class="n">storm_date_h</span> <span class="o">==</span> <span class="s1">&#39;1200&#39;</span><span class="p">)</span> <span class="o">|</span> <span class="p">(</span><span class="n">storm_date_h</span> <span class="o">==</span> <span class="s1">&#39;1800&#39;</span><span class="p">))</span>
                <span class="n">idx4</span> <span class="o">=</span> <span class="n">storm_date_y</span> <span class="o">==</span> <span class="n">year</span>
                <span class="n">storm_date</span> <span class="o">=</span> <span class="n">storm_date</span><span class="p">[(</span><span class="n">idx1</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">idx2</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">idx3</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">idx4</span><span class="p">)]</span>
                <span class="n">storm_type</span> <span class="o">=</span> <span class="n">storm_type</span><span class="p">[(</span><span class="n">idx1</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">idx2</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">idx3</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">idx4</span><span class="p">)]</span>
                <span class="n">storm_vmax</span> <span class="o">=</span> <span class="n">storm_vmax</span><span class="p">[(</span><span class="n">idx1</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">idx2</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">idx3</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">idx4</span><span class="p">)]</span>
                <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">storm_vmax</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span> <span class="k">continue</span> <span class="c1">#Continue if doesn&#39;t apply to this storm</span>
                <span class="n">storm_ace</span> <span class="o">=</span> <span class="p">(</span><span class="mi">10</span><span class="o">**-</span><span class="mi">4</span><span class="p">)</span> <span class="o">*</span> <span class="p">(</span><span class="n">storm_vmax</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span>
                
                <span class="c1">#Account for storms on february 29th by pushing them forward 1 day</span>
                <span class="k">if</span> <span class="s1">&#39;0229&#39;</span> <span class="ow">in</span> <span class="n">storm_date_m</span><span class="p">:</span>
                    <span class="n">storm_date_temp</span> <span class="o">=</span> <span class="p">[]</span>
                    <span class="k">for</span> <span class="n">idate</span> <span class="ow">in</span> <span class="n">storm_date</span><span class="p">:</span>
                        <span class="n">dt_date</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">to_datetime</span><span class="p">(</span><span class="n">idate</span><span class="p">)</span>
                        <span class="k">if</span> <span class="n">dt_date</span><span class="o">.</span><span class="n">strftime</span><span class="p">(</span><span class="s1">&#39;%m</span><span class="si">%d</span><span class="s1">&#39;</span><span class="p">)</span> <span class="o">==</span> <span class="s1">&#39;0229&#39;</span> <span class="ow">or</span> <span class="n">dt_date</span><span class="o">.</span><span class="n">strftime</span><span class="p">(</span><span class="s1">&#39;%m&#39;</span><span class="p">)</span> <span class="o">==</span> <span class="s1">&#39;03&#39;</span><span class="p">:</span>
                            <span class="n">dt_date</span> <span class="o">+=</span> <span class="n">timedelta</span><span class="p">(</span><span class="n">hours</span><span class="o">=</span><span class="mi">24</span><span class="p">)</span>
                        <span class="n">storm_date_temp</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">dt_date</span><span class="p">)</span>
                    <span class="n">storm_date</span> <span class="o">=</span> <span class="n">storm_date_temp</span>
                
                <span class="c1">#Append ACE to cumulative sum</span>
                <span class="n">idx</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nonzero</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">in1d</span><span class="p">(</span><span class="n">year_dates</span><span class="p">,</span> <span class="n">storm_date</span><span class="p">))</span>
                <span class="n">year_cumace</span><span class="p">[</span><span class="n">idx</span><span class="p">]</span> <span class="o">+=</span> <span class="n">storm_ace</span>
                <span class="n">year_genesis</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">year_dates</span> <span class="o">==</span> <span class="n">storm_date</span><span class="p">[</span><span class="mi">0</span><span class="p">])[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">])</span>
                
            <span class="c1">#Calculate cumulative sum of year</span>
            <span class="k">if</span> <span class="n">rolling_sum</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                <span class="n">year_cum</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">cumsum</span><span class="p">(</span><span class="n">year_cumace</span><span class="p">)</span>
                <span class="n">year_genesis</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">year_genesis</span><span class="p">)</span>
            
                <span class="c1">#Attach to dict</span>
                <span class="n">ace</span><span class="p">[</span><span class="nb">str</span><span class="p">(</span><span class="n">year</span><span class="p">)]</span> <span class="o">=</span> <span class="p">{}</span>
                <span class="n">ace</span><span class="p">[</span><span class="nb">str</span><span class="p">(</span><span class="n">year</span><span class="p">)][</span><span class="s1">&#39;date&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">year_dates</span>
                <span class="n">ace</span><span class="p">[</span><span class="nb">str</span><span class="p">(</span><span class="n">year</span><span class="p">)][</span><span class="s1">&#39;ace&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">year_cum</span>
                <span class="n">ace</span><span class="p">[</span><span class="nb">str</span><span class="p">(</span><span class="n">year</span><span class="p">)][</span><span class="s1">&#39;genesis_index&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">year_genesis</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">year_cum</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">rolling_window</span><span class="p">(</span><span class="n">year_cumace</span><span class="p">,</span><span class="n">rolling_sum</span><span class="o">*</span><span class="mi">4</span><span class="p">),</span><span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
                <span class="n">year_genesis</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">year_genesis</span><span class="p">)</span> <span class="o">-</span> <span class="p">((</span><span class="n">rolling_sum</span><span class="o">*</span><span class="mi">4</span><span class="p">)</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span>
                
                <span class="c1">#Attach to dict</span>
                <span class="n">ace</span><span class="p">[</span><span class="nb">str</span><span class="p">(</span><span class="n">year</span><span class="p">)]</span> <span class="o">=</span> <span class="p">{}</span>
                <span class="n">ace</span><span class="p">[</span><span class="nb">str</span><span class="p">(</span><span class="n">year</span><span class="p">)][</span><span class="s1">&#39;date&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">year_dates</span><span class="p">[((</span><span class="n">rolling_sum</span><span class="o">*</span><span class="mi">4</span><span class="p">)</span><span class="o">-</span><span class="mi">1</span><span class="p">):]</span>
                <span class="n">ace</span><span class="p">[</span><span class="nb">str</span><span class="p">(</span><span class="n">year</span><span class="p">)][</span><span class="s1">&#39;ace&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">year_cum</span>
                <span class="n">ace</span><span class="p">[</span><span class="nb">str</span><span class="p">(</span><span class="n">year</span><span class="p">)][</span><span class="s1">&#39;genesis_index&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">year_genesis</span>
                 
        <span class="c1">#------------------------------------------------------------------------------------------</span>
        
        <span class="c1">#Construct non-leap year julian day array</span>
        <span class="n">julian</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">365</span><span class="o">*</span><span class="mf">4.0</span><span class="p">)</span> <span class="o">/</span> <span class="mf">4.0</span>
        <span class="k">if</span> <span class="n">rolling_sum</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">julian</span> <span class="o">=</span> <span class="n">julian</span><span class="p">[((</span><span class="n">rolling_sum</span><span class="o">*</span><span class="mi">4</span><span class="p">)</span><span class="o">-</span><span class="mi">1</span><span class="p">):]</span>
          
        <span class="c1">#Get julian days for a non-leap year</span>
        <span class="n">months_julian</span> <span class="o">=</span> <span class="n">months_in_julian</span><span class="p">(</span><span class="mi">2019</span><span class="p">)</span>
        <span class="n">julian_start</span> <span class="o">=</span> <span class="n">months_julian</span><span class="p">[</span><span class="s1">&#39;start&#39;</span><span class="p">]</span>
        <span class="n">julian_midpoint</span> <span class="o">=</span> <span class="n">months_julian</span><span class="p">[</span><span class="s1">&#39;midpoint&#39;</span><span class="p">]</span>
        <span class="n">julian_name</span> <span class="o">=</span> <span class="n">months_julian</span><span class="p">[</span><span class="s1">&#39;name&#39;</span><span class="p">]</span>
        
        <span class="c1">#Construct percentile arrays</span>
        <span class="n">all_ace</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">((</span><span class="nb">len</span><span class="p">(</span><span class="n">years</span><span class="p">),</span><span class="nb">len</span><span class="p">(</span><span class="n">julian</span><span class="p">)))</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">nan</span>
        <span class="k">for</span> <span class="n">year</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">min</span><span class="p">(</span><span class="n">climo_year_range</span><span class="p">),</span><span class="nb">max</span><span class="p">(</span><span class="n">climo_year_range</span><span class="p">)</span><span class="o">+</span><span class="mi">1</span><span class="p">):</span>
            <span class="n">all_ace</span><span class="p">[</span><span class="n">years</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="n">year</span><span class="p">)]</span> <span class="o">=</span> <span class="n">ace</span><span class="p">[</span><span class="nb">str</span><span class="p">(</span><span class="n">year</span><span class="p">)][</span><span class="s1">&#39;ace&#39;</span><span class="p">]</span>
        <span class="n">pmin</span><span class="p">,</span><span class="n">p10</span><span class="p">,</span><span class="n">p25</span><span class="p">,</span><span class="n">p40</span><span class="p">,</span><span class="n">p60</span><span class="p">,</span><span class="n">p75</span><span class="p">,</span><span class="n">p90</span><span class="p">,</span><span class="n">pmax</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nanpercentile</span><span class="p">(</span><span class="n">all_ace</span><span class="p">,[</span><span class="mi">0</span><span class="p">,</span><span class="mi">10</span><span class="p">,</span><span class="mi">25</span><span class="p">,</span><span class="mi">40</span><span class="p">,</span><span class="mi">60</span><span class="p">,</span><span class="mi">75</span><span class="p">,</span><span class="mi">90</span><span class="p">,</span><span class="mi">100</span><span class="p">],</span><span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
        
        <span class="c1">#Return if not plotting</span>
        <span class="k">if</span> <span class="n">plot</span> <span class="o">==</span> <span class="kc">False</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">return_dict</span><span class="p">:</span>
                <span class="k">return</span> <span class="n">ace</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">return</span>
        
        <span class="c1">#------------------------------------------------------------------------------------------</span>
        
        <span class="c1">#Create figure</span>
        <span class="n">fig</span><span class="p">,</span><span class="n">ax</span><span class="o">=</span><span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">9</span><span class="p">,</span><span class="mi">7</span><span class="p">),</span><span class="n">dpi</span><span class="o">=</span><span class="mi">200</span><span class="p">)</span>
        
        <span class="c1">#Set up x-axis</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="s1">&#39;y&#39;</span><span class="p">,</span><span class="n">linewidth</span><span class="o">=</span><span class="mf">0.5</span><span class="p">,</span><span class="n">color</span><span class="o">=</span><span class="s1">&#39;k&#39;</span><span class="p">,</span><span class="n">alpha</span><span class="o">=</span><span class="mf">0.2</span><span class="p">,</span><span class="n">zorder</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span><span class="n">linestyle</span><span class="o">=</span><span class="s1">&#39;--&#39;</span><span class="p">)</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">set_xticks</span><span class="p">(</span><span class="n">julian_midpoint</span><span class="p">)</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">set_xticklabels</span><span class="p">(</span><span class="n">julian_name</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">i</span><span class="p">,(</span><span class="n">istart</span><span class="p">,</span><span class="n">iend</span><span class="p">)</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="nb">zip</span><span class="p">(</span><span class="n">julian_start</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">][::</span><span class="mi">2</span><span class="p">],</span><span class="n">julian_start</span><span class="p">[</span><span class="mi">1</span><span class="p">:][::</span><span class="mi">2</span><span class="p">])):</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">axvspan</span><span class="p">(</span><span class="n">istart</span><span class="p">,</span><span class="n">iend</span><span class="p">,</span><span class="n">color</span><span class="o">=</span><span class="s1">&#39;#e4e4e4&#39;</span><span class="p">,</span><span class="n">alpha</span><span class="o">=</span><span class="mf">0.5</span><span class="p">,</span><span class="n">zorder</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
        
        <span class="c1">#Set x-axis bounds</span>
        <span class="k">if</span> <span class="n">month_range</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">set_xlim</span><span class="p">(</span><span class="n">julian_start</span><span class="p">[</span><span class="mi">4</span><span class="p">],</span><span class="n">julian</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">end_month</span> <span class="o">=</span> <span class="n">month_range</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">-</span><span class="mi">1</span>
            <span class="n">end_julian</span> <span class="o">=</span> <span class="n">julian</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="k">if</span> <span class="n">end_month</span> <span class="o">==</span> <span class="mi">11</span> <span class="k">else</span> <span class="n">julian_start</span><span class="p">[</span><span class="n">end_month</span><span class="p">]</span><span class="o">-</span><span class="mi">1</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">set_xlim</span><span class="p">(</span><span class="n">julian_start</span><span class="p">[</span><span class="n">month_range</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span><span class="n">end_julian</span><span class="p">)</span>

        <span class="c1">#Add plot title</span>
        <span class="k">if</span> <span class="n">plot_year</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">title_string</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">basin</span><span class="o">.</span><span class="n">title</span><span class="p">()</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;_&#39;</span><span class="p">,</span><span class="s1">&#39; &#39;</span><span class="p">)</span><span class="si">}</span><span class="s2"> Accumulated Cyclone Energy Climatology&quot;</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">cur_year</span> <span class="o">=</span> <span class="p">(</span><span class="n">dt</span><span class="o">.</span><span class="n">now</span><span class="p">())</span><span class="o">.</span><span class="n">year</span>
            <span class="k">if</span> <span class="n">plot_year</span> <span class="o">==</span> <span class="n">cur_year</span><span class="p">:</span>
                <span class="n">add_current</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;(through </span><span class="si">{</span><span class="n">dt</span><span class="o">.</span><span class="n">now</span><span class="p">()</span><span class="o">.</span><span class="n">strftime</span><span class="p">(</span><span class="s1">&#39;%m/</span><span class="si">%d</span><span class="s1">&#39;</span><span class="p">)</span><span class="si">}</span><span class="s2">)&quot;</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">add_current</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
            <span class="n">title_string</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">plot_year</span><span class="si">}</span><span class="s2"> </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">basin</span><span class="o">.</span><span class="n">title</span><span class="p">()</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;_&#39;</span><span class="p">,</span><span class="s1">&#39; &#39;</span><span class="p">)</span><span class="si">}</span><span class="s2"> Accumulated Cyclone Energy </span><span class="si">{</span><span class="n">add_current</span><span class="si">}</span><span class="s2">&quot;</span>
        <span class="k">if</span> <span class="n">rolling_sum</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">title_add</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="se">\n</span><span class="si">{</span><span class="n">rolling_sum</span><span class="si">}</span><span class="s2">-Day Running Sum&quot;</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">title_add</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">title_string</span><span class="si">}{</span><span class="n">title_add</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span><span class="n">fontsize</span><span class="o">=</span><span class="mi">12</span><span class="p">,</span><span class="n">fontweight</span><span class="o">=</span><span class="s1">&#39;bold&#39;</span><span class="p">,</span><span class="n">loc</span><span class="o">=</span><span class="s1">&#39;left&#39;</span><span class="p">)</span>
        
        <span class="c1">#Plot requested year</span>
        <span class="k">if</span> <span class="n">plot_year</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            
            <span class="n">year_julian</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">copy</span><span class="p">(</span><span class="n">julian</span><span class="p">)</span>
            <span class="n">year_ace</span> <span class="o">=</span> <span class="n">ace</span><span class="p">[</span><span class="nb">str</span><span class="p">(</span><span class="n">plot_year</span><span class="p">)][</span><span class="s1">&#39;ace&#39;</span><span class="p">]</span>
            <span class="n">year_genesis</span> <span class="o">=</span> <span class="n">ace</span><span class="p">[</span><span class="nb">str</span><span class="p">(</span><span class="n">plot_year</span><span class="p">)][</span><span class="s1">&#39;genesis_index&#39;</span><span class="p">]</span>
            
            <span class="c1">#Check to see if this is current year</span>
            <span class="n">cur_year</span> <span class="o">=</span> <span class="p">(</span><span class="n">dt</span><span class="o">.</span><span class="n">now</span><span class="p">())</span><span class="o">.</span><span class="n">year</span>
            <span class="k">if</span> <span class="n">plot_year</span> <span class="o">==</span> <span class="n">cur_year</span><span class="p">:</span>
                <span class="n">cur_julian</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">convert_to_julian</span><span class="p">(</span> <span class="p">(</span><span class="n">dt</span><span class="o">.</span><span class="n">now</span><span class="p">())</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="n">year</span><span class="o">=</span><span class="mi">2019</span><span class="p">,</span><span class="n">minute</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span><span class="n">second</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span> <span class="p">))</span><span class="o">*</span><span class="mi">4</span> <span class="o">-</span> <span class="nb">int</span><span class="p">(</span><span class="n">rolling_sum</span><span class="o">*</span><span class="mi">4</span><span class="p">)</span>
                <span class="n">year_julian</span> <span class="o">=</span> <span class="n">year_julian</span><span class="p">[:</span><span class="n">cur_julian</span><span class="o">+</span><span class="mi">1</span><span class="p">]</span>
                <span class="n">year_ace</span> <span class="o">=</span> <span class="n">year_ace</span><span class="p">[:</span><span class="n">cur_julian</span><span class="o">+</span><span class="mi">1</span><span class="p">]</span>
                <span class="n">year_genesis</span> <span class="o">=</span> <span class="n">year_genesis</span><span class="p">[:</span><span class="n">cur_julian</span><span class="o">+</span><span class="mi">1</span><span class="p">]</span>

            <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">year_julian</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span><span class="n">year_ace</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span><span class="s1">&#39;o&#39;</span><span class="p">,</span><span class="n">color</span><span class="o">=</span><span class="s1">&#39;k&#39;</span><span class="p">,</span><span class="n">ms</span><span class="o">=</span><span class="mi">8</span><span class="p">,</span><span class="n">mec</span><span class="o">=</span><span class="s1">&#39;w&#39;</span><span class="p">,</span><span class="n">mew</span><span class="o">=</span><span class="mf">0.8</span><span class="p">,</span><span class="n">zorder</span><span class="o">=</span><span class="mi">8</span><span class="p">)</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">year_julian</span><span class="p">,</span><span class="n">year_ace</span><span class="p">,</span><span class="s1">&#39;-&#39;</span><span class="p">,</span><span class="n">color</span><span class="o">=</span><span class="s1">&#39;w&#39;</span><span class="p">,</span><span class="n">linewidth</span><span class="o">=</span><span class="mf">2.8</span><span class="p">,</span><span class="n">zorder</span><span class="o">=</span><span class="mi">6</span><span class="p">)</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">year_julian</span><span class="p">,</span><span class="n">year_ace</span><span class="p">,</span><span class="s1">&#39;-&#39;</span><span class="p">,</span><span class="n">color</span><span class="o">=</span><span class="s1">&#39;k&#39;</span><span class="p">,</span><span class="n">linewidth</span><span class="o">=</span><span class="mf">2.0</span><span class="p">,</span><span class="n">zorder</span><span class="o">=</span><span class="mi">6</span><span class="p">,</span><span class="n">label</span><span class="o">=</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">plot_year</span><span class="si">}</span><span class="s1"> ACE (</span><span class="si">{</span><span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">year_ace</span><span class="p">)</span><span class="si">:</span><span class="s1">.1f</span><span class="si">}</span><span class="s1">)&#39;</span><span class="p">)</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">year_julian</span><span class="p">[</span><span class="n">year_genesis</span><span class="p">],</span><span class="n">year_ace</span><span class="p">[</span><span class="n">year_genesis</span><span class="p">],</span><span class="s1">&#39;D&#39;</span><span class="p">,</span><span class="n">color</span><span class="o">=</span><span class="s1">&#39;k&#39;</span><span class="p">,</span><span class="n">ms</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span><span class="n">mec</span><span class="o">=</span><span class="s1">&#39;w&#39;</span><span class="p">,</span><span class="n">mew</span><span class="o">=</span><span class="mf">0.5</span><span class="p">,</span><span class="n">zorder</span><span class="o">=</span><span class="mi">7</span><span class="p">,</span><span class="n">label</span><span class="o">=</span><span class="s1">&#39;TC Genesis&#39;</span><span class="p">)</span>
            
        <span class="c1">#Plot comparison years</span>
        <span class="k">if</span> <span class="n">compare_years</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            
            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">compare_years</span><span class="p">,</span> <span class="nb">int</span><span class="p">):</span> <span class="n">compare_years</span> <span class="o">=</span> <span class="p">[</span><span class="n">compare_years</span><span class="p">]</span>
                
            <span class="k">for</span> <span class="n">year</span> <span class="ow">in</span> <span class="n">compare_years</span><span class="p">:</span>
                
                <span class="n">year_julian</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">copy</span><span class="p">(</span><span class="n">julian</span><span class="p">)</span>
                <span class="n">year_ace</span> <span class="o">=</span> <span class="n">ace</span><span class="p">[</span><span class="nb">str</span><span class="p">(</span><span class="n">year</span><span class="p">)][</span><span class="s1">&#39;ace&#39;</span><span class="p">]</span>
                <span class="n">year_genesis</span> <span class="o">=</span> <span class="n">ace</span><span class="p">[</span><span class="nb">str</span><span class="p">(</span><span class="n">year</span><span class="p">)][</span><span class="s1">&#39;genesis_index&#39;</span><span class="p">]</span>

                <span class="c1">#Check to see if this is current year</span>
                <span class="n">cur_year</span> <span class="o">=</span> <span class="p">(</span><span class="n">dt</span><span class="o">.</span><span class="n">now</span><span class="p">())</span><span class="o">.</span><span class="n">year</span>
                <span class="k">if</span> <span class="n">year</span> <span class="o">==</span> <span class="n">cur_year</span><span class="p">:</span>
                    <span class="n">cur_julian</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">convert_to_julian</span><span class="p">(</span> <span class="p">(</span><span class="n">dt</span><span class="o">.</span><span class="n">now</span><span class="p">())</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="n">year</span><span class="o">=</span><span class="mi">2019</span><span class="p">,</span><span class="n">minute</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span><span class="n">second</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span> <span class="p">))</span><span class="o">*</span><span class="mi">4</span> <span class="o">-</span> <span class="nb">int</span><span class="p">(</span><span class="n">rolling_sum</span><span class="o">*</span><span class="mi">4</span><span class="p">)</span>
                    <span class="n">year_julian</span> <span class="o">=</span> <span class="n">year_julian</span><span class="p">[:</span><span class="n">cur_julian</span><span class="o">+</span><span class="mi">1</span><span class="p">]</span>
                    <span class="n">year_ace</span> <span class="o">=</span> <span class="n">year_ace</span><span class="p">[:</span><span class="n">cur_julian</span><span class="o">+</span><span class="mi">1</span><span class="p">]</span>
                    <span class="n">year_genesis</span> <span class="o">=</span> <span class="n">year_genesis</span><span class="p">[:</span><span class="n">cur_julian</span><span class="o">+</span><span class="mi">1</span><span class="p">]</span>
                    <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">year_julian</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span><span class="n">year_ace</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span><span class="s1">&#39;o&#39;</span><span class="p">,</span><span class="n">color</span><span class="o">=</span><span class="s1">&#39;#333333&#39;</span><span class="p">,</span><span class="n">alpha</span><span class="o">=</span><span class="mf">0.3</span><span class="p">,</span><span class="n">ms</span><span class="o">=</span><span class="mi">6</span><span class="p">,</span><span class="n">zorder</span><span class="o">=</span><span class="mi">5</span><span class="p">)</span>

                <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">compare_years</span><span class="p">)</span> <span class="o">&lt;=</span> <span class="mi">5</span><span class="p">:</span>
                    <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">year_julian</span><span class="p">,</span><span class="n">year_ace</span><span class="p">,</span><span class="s1">&#39;-&#39;</span><span class="p">,</span><span class="n">color</span><span class="o">=</span><span class="s1">&#39;k&#39;</span><span class="p">,</span><span class="n">linewidth</span><span class="o">=</span><span class="mf">1.0</span><span class="p">,</span><span class="n">alpha</span><span class="o">=</span><span class="mf">0.5</span><span class="p">,</span><span class="n">zorder</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span><span class="n">label</span><span class="o">=</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">year</span><span class="si">}</span><span class="s1"> ACE (</span><span class="si">{</span><span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">year_ace</span><span class="p">)</span><span class="si">:</span><span class="s1">.1f</span><span class="si">}</span><span class="s1">)&#39;</span><span class="p">)</span>
                    <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">year_julian</span><span class="p">[</span><span class="n">year_genesis</span><span class="p">],</span><span class="n">year_ace</span><span class="p">[</span><span class="n">year_genesis</span><span class="p">],</span><span class="s1">&#39;D&#39;</span><span class="p">,</span><span class="n">color</span><span class="o">=</span><span class="s1">&#39;#333333&#39;</span><span class="p">,</span><span class="n">ms</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span><span class="n">alpha</span><span class="o">=</span><span class="mf">0.3</span><span class="p">,</span><span class="n">zorder</span><span class="o">=</span><span class="mi">4</span><span class="p">)</span>
                    <span class="n">ax</span><span class="o">.</span><span class="n">text</span><span class="p">(</span><span class="n">year_julian</span><span class="p">[</span><span class="o">-</span><span class="mi">2</span><span class="p">],</span><span class="n">year_ace</span><span class="p">[</span><span class="o">-</span><span class="mi">2</span><span class="p">]</span><span class="o">+</span><span class="mi">2</span><span class="p">,</span><span class="nb">str</span><span class="p">(</span><span class="n">year</span><span class="p">),</span><span class="n">fontsize</span><span class="o">=</span><span class="mi">7</span><span class="p">,</span><span class="n">fontweight</span><span class="o">=</span><span class="s1">&#39;bold&#39;</span><span class="p">,</span><span class="n">alpha</span><span class="o">=</span><span class="mf">0.7</span><span class="p">,</span><span class="n">ha</span><span class="o">=</span><span class="s1">&#39;right&#39;</span><span class="p">,</span><span class="n">va</span><span class="o">=</span><span class="s1">&#39;bottom&#39;</span><span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">year_julian</span><span class="p">,</span><span class="n">year_ace</span><span class="p">,</span><span class="s1">&#39;-&#39;</span><span class="p">,</span><span class="n">color</span><span class="o">=</span><span class="s1">&#39;k&#39;</span><span class="p">,</span><span class="n">linewidth</span><span class="o">=</span><span class="mf">1.0</span><span class="p">,</span><span class="n">alpha</span><span class="o">=</span><span class="mf">0.15</span><span class="p">,</span><span class="n">zorder</span><span class="o">=</span><span class="mi">3</span><span class="p">)</span>
            
        
        <span class="c1">#Plot all climatological values</span>
        <span class="n">pmin_masked</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">pmin</span><span class="p">)</span>
        <span class="n">pmin_masked</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">ma</span><span class="o">.</span><span class="n">masked_where</span><span class="p">(</span><span class="n">pmin_masked</span><span class="o">==</span><span class="mi">0</span><span class="p">,</span><span class="n">pmin_masked</span><span class="p">)</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">julian</span><span class="p">,</span><span class="n">pmax</span><span class="p">,</span><span class="s1">&#39;--&#39;</span><span class="p">,</span><span class="n">color</span><span class="o">=</span><span class="s1">&#39;r&#39;</span><span class="p">,</span><span class="n">zorder</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span><span class="n">label</span><span class="o">=</span><span class="sa">f</span><span class="s1">&#39;Max (</span><span class="si">{</span><span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">pmax</span><span class="p">)</span><span class="si">:</span><span class="s1">.1f</span><span class="si">}</span><span class="s1">)&#39;</span><span class="p">)</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">julian</span><span class="p">,</span><span class="n">pmin_masked</span><span class="p">,</span><span class="s1">&#39;--&#39;</span><span class="p">,</span><span class="n">color</span><span class="o">=</span><span class="s1">&#39;b&#39;</span><span class="p">,</span><span class="n">zorder</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span><span class="n">label</span><span class="o">=</span><span class="sa">f</span><span class="s1">&#39;Min (</span><span class="si">{</span><span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">pmin</span><span class="p">)</span><span class="si">:</span><span class="s1">.1f</span><span class="si">}</span><span class="s1">)&#39;</span><span class="p">)</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">fill_between</span><span class="p">(</span><span class="n">julian</span><span class="p">,</span><span class="n">p10</span><span class="p">,</span><span class="n">p90</span><span class="p">,</span><span class="n">color</span><span class="o">=</span><span class="s1">&#39;#60CE56&#39;</span><span class="p">,</span><span class="n">alpha</span><span class="o">=</span><span class="mf">0.3</span><span class="p">,</span><span class="n">zorder</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span><span class="n">label</span><span class="o">=</span><span class="s1">&#39;Climo 10-90%&#39;</span><span class="p">)</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">fill_between</span><span class="p">(</span><span class="n">julian</span><span class="p">,</span><span class="n">p25</span><span class="p">,</span><span class="n">p75</span><span class="p">,</span><span class="n">color</span><span class="o">=</span><span class="s1">&#39;#16A147&#39;</span><span class="p">,</span><span class="n">alpha</span><span class="o">=</span><span class="mf">0.3</span><span class="p">,</span><span class="n">zorder</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span><span class="n">label</span><span class="o">=</span><span class="s1">&#39;Climo 25-75%&#39;</span><span class="p">)</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">fill_between</span><span class="p">(</span><span class="n">julian</span><span class="p">,</span><span class="n">p40</span><span class="p">,</span><span class="n">p60</span><span class="p">,</span><span class="n">color</span><span class="o">=</span><span class="s1">&#39;#00782A&#39;</span><span class="p">,</span><span class="n">alpha</span><span class="o">=</span><span class="mf">0.3</span><span class="p">,</span><span class="n">zorder</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span><span class="n">label</span><span class="o">=</span><span class="s1">&#39;Climo 40-60%&#39;</span><span class="p">)</span>

        <span class="c1">#Add legend &amp; plot credit</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">loc</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
        <span class="n">endash</span> <span class="o">=</span> <span class="sa">u</span><span class="s2">&quot;</span><span class="se">\u2013</span><span class="s2">&quot;</span>
        
        <span class="n">credit_text</span> <span class="o">=</span> <span class="n">plot_credit</span><span class="p">()</span>
        <span class="n">add_credit</span><span class="p">(</span><span class="n">ax</span><span class="p">,</span><span class="n">credit_text</span><span class="p">)</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">text</span><span class="p">(</span><span class="mf">0.99</span><span class="p">,</span><span class="mf">0.99</span><span class="p">,</span><span class="sa">f</span><span class="s1">&#39;Climatology from </span><span class="si">{</span><span class="n">climo_year_range</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="si">}{</span><span class="n">endash</span><span class="si">}{</span><span class="n">climo_year_range</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">,</span><span class="n">fontsize</span><span class="o">=</span><span class="mi">9</span><span class="p">,</span><span class="n">color</span><span class="o">=</span><span class="s1">&#39;k&#39;</span><span class="p">,</span><span class="n">alpha</span><span class="o">=</span><span class="mf">0.7</span><span class="p">,</span>
                <span class="n">transform</span><span class="o">=</span><span class="n">ax</span><span class="o">.</span><span class="n">transAxes</span><span class="p">,</span><span class="n">ha</span><span class="o">=</span><span class="s1">&#39;right&#39;</span><span class="p">,</span><span class="n">va</span><span class="o">=</span><span class="s1">&#39;top&#39;</span><span class="p">,</span><span class="n">zorder</span><span class="o">=</span><span class="mi">10</span><span class="p">)</span>
        
        <span class="c1">#Show/save plot and close</span>
        <span class="k">if</span> <span class="n">save_path</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">save_path</span><span class="p">,</span><span class="nb">str</span><span class="p">):</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="n">save_path</span><span class="p">,</span><span class="n">bbox_inches</span><span class="o">=</span><span class="s1">&#39;tight&#39;</span><span class="p">,</span><span class="n">facecolor</span><span class="o">=</span><span class="s1">&#39;w&#39;</span><span class="p">)</span>
        
        <span class="k">if</span> <span class="n">return_dict</span><span class="p">:</span>
            <span class="k">return</span> <span class="p">{</span><span class="s1">&#39;ax&#39;</span><span class="p">:</span><span class="n">ax</span><span class="p">,</span><span class="s1">&#39;ace&#39;</span><span class="p">:</span><span class="n">ace</span><span class="p">}</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">ax</span></div>

<div class="viewcode-block" id="TrackDataset.hurricane_days_climo"><a class="viewcode-back" href="../../../api/generated/tropycal.tracks.TrackDataset.hurricane_days_climo.html#tropycal.tracks.TrackDataset.hurricane_days_climo">[docs]</a>    <span class="k">def</span> <span class="nf">hurricane_days_climo</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">plot_year</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span><span class="n">compare_years</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span><span class="n">start_year</span><span class="o">=</span><span class="mi">1950</span><span class="p">,</span><span class="n">rolling_sum</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span><span class="n">category</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span><span class="n">return_dict</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span><span class="n">plot</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span><span class="n">save_path</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        
        <span class="sa">r</span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Creates a climatology of tropical storm/hurricane/major hurricane days.</span>
<span class="sd">        </span>
<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        plot_year : int</span>
<span class="sd">            Year to highlight. If current year, plot will be drawn through today.</span>
<span class="sd">        compare_years : int or list</span>
<span class="sd">            Seasons to compare against. Can be either a single season (int), or a range or list of seasons (list).</span>
<span class="sd">        start_year : int</span>
<span class="sd">            Year to begin calculating the climatology over. Default is 1950.</span>
<span class="sd">        rolling_sum : int</span>
<span class="sd">            Days to calculate a rolling sum over. Default is 0 (annual running sum).</span>
<span class="sd">        category : int</span>
<span class="sd">            SSHWS Category to generate the data and plot for. Use 0 for tropical storm. If none (default), a plot will be generated for all categories.</span>
<span class="sd">        return_dict : bool</span>
<span class="sd">            Determines whether to return data from this function. Default is False.</span>
<span class="sd">        plot : bool</span>
<span class="sd">            Determines whether to generate a plot or not. If False, function simply returns data dictionary.</span>
<span class="sd">        save_path : str</span>
<span class="sd">            Determines the file path to save the image to. If blank or none, image will be directly shown.</span>
<span class="sd">        </span>
<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        axes or dict</span>
<span class="sd">            By default, the axes is returned. If return_dict is True, a dictionary containing the axes and data about the climatology is returned.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        
        <span class="c1">#Create empty dict</span>
        <span class="n">tc_days</span> <span class="o">=</span> <span class="p">{}</span>
        
        <span class="c1">#Function for counting TC days above a wind threshold</span>
        <span class="k">def</span> <span class="nf">duration_thres</span><span class="p">(</span><span class="n">arr</span><span class="p">,</span><span class="n">thres</span><span class="p">):</span>
            <span class="n">arr2</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">arr</span><span class="o">.</span><span class="n">shape</span><span class="p">))</span>
            <span class="n">arr2</span><span class="p">[</span><span class="n">arr</span><span class="o">&gt;=</span><span class="n">thres</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="mf">6.0</span><span class="o">/</span><span class="mf">24.0</span><span class="p">)</span>
            <span class="k">return</span> <span class="n">arr2</span>
        
        <span class="c1">#Iterate over every year of HURDAT available</span>
        <span class="n">end_year</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">keys</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]][</span><span class="s1">&#39;year&#39;</span><span class="p">]</span>
        <span class="n">years</span> <span class="o">=</span> <span class="nb">range</span><span class="p">(</span><span class="n">start_year</span><span class="p">,</span><span class="n">end_year</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">year</span> <span class="ow">in</span> <span class="n">years</span><span class="p">:</span>
            
            <span class="c1">#Get info for this year</span>
            <span class="n">season</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_season</span><span class="p">(</span><span class="n">year</span><span class="p">)</span>
            <span class="n">year_info</span> <span class="o">=</span> <span class="n">season</span><span class="o">.</span><span class="n">summary</span><span class="p">()</span>
            
            <span class="c1">#Generate list of dates for this year</span>
            <span class="n">year_dates</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">dt</span><span class="o">.</span><span class="n">strptime</span><span class="p">(((</span><span class="n">pd</span><span class="o">.</span><span class="n">to_datetime</span><span class="p">(</span><span class="n">i</span><span class="p">))</span><span class="o">.</span><span class="n">strftime</span><span class="p">(</span><span class="s1">&#39;%Y%m</span><span class="si">%d</span><span class="s1">%H&#39;</span><span class="p">)),</span><span class="s1">&#39;%Y%m</span><span class="si">%d</span><span class="s1">%H&#39;</span><span class="p">)</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">dt</span><span class="p">(</span><span class="n">year</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">),</span><span class="n">dt</span><span class="p">(</span><span class="n">year</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">),</span><span class="n">timedelta</span><span class="p">(</span><span class="n">hours</span><span class="o">=</span><span class="mi">6</span><span class="p">))])</span>
            
            <span class="c1">#Remove 2/29 from dates</span>
            <span class="k">if</span> <span class="n">calendar</span><span class="o">.</span><span class="n">isleap</span><span class="p">(</span><span class="n">year</span><span class="p">):</span>
                <span class="n">year_dates</span> <span class="o">=</span> <span class="n">year_dates</span><span class="p">[</span><span class="n">year_dates</span> <span class="o">!=</span> <span class="n">dt</span><span class="p">(</span><span class="n">year</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">29</span><span class="p">,</span><span class="mi">0</span><span class="p">)]</span>
                <span class="n">year_dates</span> <span class="o">=</span> <span class="n">year_dates</span><span class="p">[</span><span class="n">year_dates</span> <span class="o">!=</span> <span class="n">dt</span><span class="p">(</span><span class="n">year</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">29</span><span class="p">,</span><span class="mi">6</span><span class="p">)]</span>
                <span class="n">year_dates</span> <span class="o">=</span> <span class="n">year_dates</span><span class="p">[</span><span class="n">year_dates</span> <span class="o">!=</span> <span class="n">dt</span><span class="p">(</span><span class="n">year</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">29</span><span class="p">,</span><span class="mi">12</span><span class="p">)]</span>
                <span class="n">year_dates</span> <span class="o">=</span> <span class="n">year_dates</span><span class="p">[</span><span class="n">year_dates</span> <span class="o">!=</span> <span class="n">dt</span><span class="p">(</span><span class="n">year</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">29</span><span class="p">,</span><span class="mi">18</span><span class="p">)]</span>
            
            <span class="c1">#Additional empty arrays</span>
            <span class="n">temp_arr</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">year_dates</span><span class="o">.</span><span class="n">shape</span><span class="p">))</span>
            <span class="n">cumulative</span> <span class="o">=</span> <span class="p">{}</span>
            <span class="n">all_thres</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;ts&#39;</span><span class="p">,</span><span class="s1">&#39;c1&#39;</span><span class="p">,</span><span class="s1">&#39;c2&#39;</span><span class="p">,</span><span class="s1">&#39;c3&#39;</span><span class="p">,</span><span class="s1">&#39;c4&#39;</span><span class="p">,</span><span class="s1">&#39;c5&#39;</span><span class="p">]</span>
            <span class="k">for</span> <span class="n">thres</span> <span class="ow">in</span> <span class="n">all_thres</span><span class="p">:</span>
                <span class="n">cumulative</span><span class="p">[</span><span class="n">thres</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">copy</span><span class="p">(</span><span class="n">temp_arr</span><span class="p">)</span>
            <span class="n">year_genesis</span> <span class="o">=</span> <span class="p">[]</span>
            
            <span class="c1">#Get list of storms for this year</span>
            <span class="n">storm_ids</span> <span class="o">=</span> <span class="n">year_info</span><span class="p">[</span><span class="s1">&#39;id&#39;</span><span class="p">]</span>
            <span class="k">for</span> <span class="n">storm</span> <span class="ow">in</span> <span class="n">storm_ids</span><span class="p">:</span>
                
                <span class="c1">#Get HURDAT data for this storm</span>
                <span class="n">storm_data</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="n">storm</span><span class="p">]</span>
                <span class="n">storm_date_y</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="nb">int</span><span class="p">(</span><span class="n">i</span><span class="o">.</span><span class="n">strftime</span><span class="p">(</span><span class="s1">&#39;%Y&#39;</span><span class="p">))</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">storm_data</span><span class="p">[</span><span class="s1">&#39;date&#39;</span><span class="p">]])</span>
                <span class="n">storm_date_h</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">i</span><span class="o">.</span><span class="n">strftime</span><span class="p">(</span><span class="s1">&#39;%H%M&#39;</span><span class="p">)</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">storm_data</span><span class="p">[</span><span class="s1">&#39;date&#39;</span><span class="p">]])</span>
                <span class="n">storm_date</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">storm_data</span><span class="p">[</span><span class="s1">&#39;date&#39;</span><span class="p">])</span>
                <span class="n">storm_type</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">storm_data</span><span class="p">[</span><span class="s1">&#39;type&#39;</span><span class="p">])</span>
                <span class="n">storm_vmax</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">storm_data</span><span class="p">[</span><span class="s1">&#39;vmax&#39;</span><span class="p">])</span>
                
                <span class="c1">#Subset to remove obs not useful for calculation</span>
                <span class="n">idx1</span> <span class="o">=</span> <span class="p">((</span><span class="n">storm_type</span> <span class="o">==</span> <span class="s1">&#39;SS&#39;</span><span class="p">)</span> <span class="o">|</span> <span class="p">(</span><span class="n">storm_type</span> <span class="o">==</span> <span class="s1">&#39;TS&#39;</span><span class="p">)</span> <span class="o">|</span> <span class="p">(</span><span class="n">storm_type</span> <span class="o">==</span> <span class="s1">&#39;HU&#39;</span><span class="p">))</span>
                <span class="n">idx2</span> <span class="o">=</span> <span class="o">~</span><span class="n">np</span><span class="o">.</span><span class="n">isnan</span><span class="p">(</span><span class="n">storm_vmax</span><span class="p">)</span>
                <span class="n">idx3</span> <span class="o">=</span> <span class="p">((</span><span class="n">storm_date_h</span> <span class="o">==</span> <span class="s1">&#39;0000&#39;</span><span class="p">)</span> <span class="o">|</span> <span class="p">(</span><span class="n">storm_date_h</span> <span class="o">==</span> <span class="s1">&#39;0600&#39;</span><span class="p">)</span> <span class="o">|</span> <span class="p">(</span><span class="n">storm_date_h</span> <span class="o">==</span> <span class="s1">&#39;1200&#39;</span><span class="p">)</span> <span class="o">|</span> <span class="p">(</span><span class="n">storm_date_h</span> <span class="o">==</span> <span class="s1">&#39;1800&#39;</span><span class="p">))</span>
                <span class="n">idx4</span> <span class="o">=</span> <span class="n">storm_date_y</span> <span class="o">==</span> <span class="n">year</span>
                <span class="n">storm_date</span> <span class="o">=</span> <span class="n">storm_date</span><span class="p">[(</span><span class="n">idx1</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">idx2</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">idx3</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">idx4</span><span class="p">)]</span>
                <span class="n">storm_type</span> <span class="o">=</span> <span class="n">storm_type</span><span class="p">[(</span><span class="n">idx1</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">idx2</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">idx3</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">idx4</span><span class="p">)]</span>
                <span class="n">storm_vmax</span> <span class="o">=</span> <span class="n">storm_vmax</span><span class="p">[(</span><span class="n">idx1</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">idx2</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">idx3</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">idx4</span><span class="p">)]</span>
                <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">storm_vmax</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span> <span class="k">continue</span> <span class="c1">#Continue if doesn&#39;t apply to this storm</span>
                
                <span class="c1">#Append storm days to cumulative sum</span>
                <span class="n">idx</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nonzero</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">in1d</span><span class="p">(</span><span class="n">year_dates</span><span class="p">,</span> <span class="n">storm_date</span><span class="p">))</span>
                <span class="n">cumulative</span><span class="p">[</span><span class="s1">&#39;ts&#39;</span><span class="p">][</span><span class="n">idx</span><span class="p">]</span> <span class="o">+=</span> <span class="n">duration_thres</span><span class="p">(</span><span class="n">storm_vmax</span><span class="p">,</span><span class="mf">34.0</span><span class="p">)</span>
                <span class="n">cumulative</span><span class="p">[</span><span class="s1">&#39;c1&#39;</span><span class="p">][</span><span class="n">idx</span><span class="p">]</span> <span class="o">+=</span> <span class="n">duration_thres</span><span class="p">(</span><span class="n">storm_vmax</span><span class="p">,</span><span class="mf">64.0</span><span class="p">)</span>
                <span class="n">cumulative</span><span class="p">[</span><span class="s1">&#39;c2&#39;</span><span class="p">][</span><span class="n">idx</span><span class="p">]</span> <span class="o">+=</span> <span class="n">duration_thres</span><span class="p">(</span><span class="n">storm_vmax</span><span class="p">,</span><span class="mf">83.0</span><span class="p">)</span>
                <span class="n">cumulative</span><span class="p">[</span><span class="s1">&#39;c3&#39;</span><span class="p">][</span><span class="n">idx</span><span class="p">]</span> <span class="o">+=</span> <span class="n">duration_thres</span><span class="p">(</span><span class="n">storm_vmax</span><span class="p">,</span><span class="mf">96.0</span><span class="p">)</span>
                <span class="n">cumulative</span><span class="p">[</span><span class="s1">&#39;c4&#39;</span><span class="p">][</span><span class="n">idx</span><span class="p">]</span> <span class="o">+=</span> <span class="n">duration_thres</span><span class="p">(</span><span class="n">storm_vmax</span><span class="p">,</span><span class="mf">113.0</span><span class="p">)</span>
                <span class="n">cumulative</span><span class="p">[</span><span class="s1">&#39;c5&#39;</span><span class="p">][</span><span class="n">idx</span><span class="p">]</span> <span class="o">+=</span> <span class="n">duration_thres</span><span class="p">(</span><span class="n">storm_vmax</span><span class="p">,</span><span class="mf">137.0</span><span class="p">)</span>
                <span class="n">year_genesis</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">year_dates</span> <span class="o">==</span> <span class="n">storm_date</span><span class="p">[</span><span class="mi">0</span><span class="p">])[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">])</span>
                
            <span class="c1">#Calculate cumulative sum of year</span>
            <span class="k">if</span> <span class="n">rolling_sum</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                <span class="n">year_genesis</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">year_genesis</span><span class="p">)</span>
            
                <span class="c1">#Attach to dict</span>
                <span class="n">tc_days</span><span class="p">[</span><span class="nb">str</span><span class="p">(</span><span class="n">year</span><span class="p">)]</span> <span class="o">=</span> <span class="p">{}</span>
                <span class="n">tc_days</span><span class="p">[</span><span class="nb">str</span><span class="p">(</span><span class="n">year</span><span class="p">)][</span><span class="s1">&#39;date&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">year_dates</span>
                <span class="n">tc_days</span><span class="p">[</span><span class="nb">str</span><span class="p">(</span><span class="n">year</span><span class="p">)][</span><span class="s1">&#39;genesis_index&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">year_genesis</span>
                
                <span class="c1">#Loop through all thresholds</span>
                <span class="k">for</span> <span class="n">thres</span> <span class="ow">in</span> <span class="n">all_thres</span><span class="p">:</span>
                    <span class="n">tc_days</span><span class="p">[</span><span class="nb">str</span><span class="p">(</span><span class="n">year</span><span class="p">)][</span><span class="n">thres</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">cumsum</span><span class="p">(</span><span class="n">cumulative</span><span class="p">[</span><span class="n">thres</span><span class="p">])</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">year_genesis</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">year_genesis</span><span class="p">)</span> <span class="o">-</span> <span class="p">((</span><span class="n">rolling_sum</span><span class="o">*</span><span class="mi">4</span><span class="p">)</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span>
                
                <span class="c1">#Attach to dict</span>
                <span class="n">tc_days</span><span class="p">[</span><span class="nb">str</span><span class="p">(</span><span class="n">year</span><span class="p">)]</span> <span class="o">=</span> <span class="p">{}</span>
                <span class="n">tc_days</span><span class="p">[</span><span class="nb">str</span><span class="p">(</span><span class="n">year</span><span class="p">)][</span><span class="s1">&#39;date&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">year_dates</span><span class="p">[((</span><span class="n">rolling_sum</span><span class="o">*</span><span class="mi">4</span><span class="p">)</span><span class="o">-</span><span class="mi">1</span><span class="p">):]</span>
                <span class="n">tc_days</span><span class="p">[</span><span class="nb">str</span><span class="p">(</span><span class="n">year</span><span class="p">)][</span><span class="s1">&#39;genesis_index&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">year_genesis</span>
                
                <span class="c1">#Loop through all thresholds</span>
                <span class="k">for</span> <span class="n">thres</span> <span class="ow">in</span> <span class="n">all_thres</span><span class="p">:</span>
                    <span class="n">tc_days</span><span class="p">[</span><span class="nb">str</span><span class="p">(</span><span class="n">year</span><span class="p">)][</span><span class="n">thres</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">rolling_window</span><span class="p">(</span><span class="n">cumulative</span><span class="p">[</span><span class="n">thres</span><span class="p">],</span><span class="n">rolling_sum</span><span class="o">*</span><span class="mi">4</span><span class="p">),</span><span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
         
        <span class="c1">#------------------------------------------------------------------------------------------</span>
        
        <span class="c1">#Construct non-leap year julian day array</span>
        <span class="n">julian</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">365</span><span class="o">*</span><span class="mf">4.0</span><span class="p">)</span> <span class="o">/</span> <span class="mf">4.0</span>
        <span class="k">if</span> <span class="n">rolling_sum</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">julian</span> <span class="o">=</span> <span class="n">julian</span><span class="p">[((</span><span class="n">rolling_sum</span><span class="o">*</span><span class="mi">4</span><span class="p">)</span><span class="o">-</span><span class="mi">1</span><span class="p">):]</span>
          
        <span class="c1">#Get julian days for a non-leap year</span>
        <span class="n">months_julian</span> <span class="o">=</span> <span class="n">months_in_julian</span><span class="p">(</span><span class="mi">2019</span><span class="p">)</span>
        <span class="n">julian_start</span> <span class="o">=</span> <span class="n">months_julian</span><span class="p">[</span><span class="s1">&#39;start&#39;</span><span class="p">]</span>
        <span class="n">julian_midpoint</span> <span class="o">=</span> <span class="n">months_julian</span><span class="p">[</span><span class="s1">&#39;midpoint&#39;</span><span class="p">]</span>
        <span class="n">julian_name</span> <span class="o">=</span> <span class="n">months_julian</span><span class="p">[</span><span class="s1">&#39;name&#39;</span><span class="p">]</span>
        
        <span class="c1">#Determine type of plot to make</span>
        <span class="n">category_match</span> <span class="o">=</span> <span class="p">{</span><span class="mi">0</span><span class="p">:</span><span class="s1">&#39;ts&#39;</span><span class="p">,</span><span class="mi">1</span><span class="p">:</span><span class="s1">&#39;c1&#39;</span><span class="p">,</span><span class="mi">2</span><span class="p">:</span><span class="s1">&#39;c2&#39;</span><span class="p">,</span><span class="mi">3</span><span class="p">:</span><span class="s1">&#39;c3&#39;</span><span class="p">,</span><span class="mi">4</span><span class="p">:</span><span class="s1">&#39;c4&#39;</span><span class="p">,</span><span class="mi">5</span><span class="p">:</span><span class="s1">&#39;c5&#39;</span><span class="p">}</span>
        <span class="k">if</span> <span class="n">category</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">cat</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">cat</span> <span class="o">=</span> <span class="n">category_match</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">category</span><span class="p">,</span><span class="s1">&#39;c1&#39;</span><span class="p">)</span>
        
        <span class="c1">#Construct percentile arrays</span>
        <span class="k">if</span> <span class="n">cat</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">p50</span> <span class="o">=</span> <span class="p">{}</span>
            <span class="k">for</span> <span class="n">thres</span> <span class="ow">in</span> <span class="n">all_thres</span><span class="p">:</span>
                <span class="n">all_tc_days</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="nb">len</span><span class="p">(</span><span class="n">years</span><span class="p">),</span><span class="nb">len</span><span class="p">(</span><span class="n">julian</span><span class="p">)))</span>
                <span class="k">for</span> <span class="n">year</span> <span class="ow">in</span> <span class="n">years</span><span class="p">:</span>
                    <span class="n">all_tc_days</span><span class="p">[</span><span class="n">years</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="n">year</span><span class="p">)]</span> <span class="o">=</span> <span class="n">tc_days</span><span class="p">[</span><span class="nb">str</span><span class="p">(</span><span class="n">year</span><span class="p">)][</span><span class="n">thres</span><span class="p">]</span>
                <span class="n">p50</span><span class="p">[</span><span class="n">thres</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">percentile</span><span class="p">(</span><span class="n">all_tc_days</span><span class="p">,</span><span class="mi">50</span><span class="p">,</span><span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
                <span class="n">p50</span><span class="p">[</span><span class="n">thres</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">average</span><span class="p">(</span><span class="n">all_tc_days</span><span class="p">,</span><span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">all_tc_days</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="nb">len</span><span class="p">(</span><span class="n">years</span><span class="p">),</span><span class="nb">len</span><span class="p">(</span><span class="n">julian</span><span class="p">)))</span>
            <span class="k">for</span> <span class="n">year</span> <span class="ow">in</span> <span class="n">years</span><span class="p">:</span>
                <span class="n">all_tc_days</span><span class="p">[</span><span class="n">years</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="n">year</span><span class="p">)]</span> <span class="o">=</span> <span class="n">tc_days</span><span class="p">[</span><span class="nb">str</span><span class="p">(</span><span class="n">year</span><span class="p">)][</span><span class="n">cat</span><span class="p">]</span>
            <span class="n">pmin</span><span class="p">,</span><span class="n">p10</span><span class="p">,</span><span class="n">p25</span><span class="p">,</span><span class="n">p40</span><span class="p">,</span><span class="n">p60</span><span class="p">,</span><span class="n">p75</span><span class="p">,</span><span class="n">p90</span><span class="p">,</span><span class="n">pmax</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">percentile</span><span class="p">(</span><span class="n">all_tc_days</span><span class="p">,[</span><span class="mi">0</span><span class="p">,</span><span class="mi">10</span><span class="p">,</span><span class="mi">25</span><span class="p">,</span><span class="mi">40</span><span class="p">,</span><span class="mi">60</span><span class="p">,</span><span class="mi">75</span><span class="p">,</span><span class="mi">90</span><span class="p">,</span><span class="mi">100</span><span class="p">],</span><span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
        
        <span class="c1">#Return if not plotting</span>
        <span class="k">if</span> <span class="n">plot</span> <span class="o">==</span> <span class="kc">False</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">return_dict</span><span class="p">:</span>
                <span class="k">return</span> <span class="n">tc_days</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">return</span>
        
        <span class="c1">#------------------------------------------------------------------------------------------</span>
        
        <span class="c1">#Create figure</span>
        <span class="n">fig</span><span class="p">,</span><span class="n">ax</span><span class="o">=</span><span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">9</span><span class="p">,</span><span class="mi">7</span><span class="p">),</span><span class="n">dpi</span><span class="o">=</span><span class="mi">200</span><span class="p">)</span>
        
        <span class="c1">#Set up x-axis</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="s1">&#39;y&#39;</span><span class="p">,</span><span class="n">linewidth</span><span class="o">=</span><span class="mf">0.5</span><span class="p">,</span><span class="n">color</span><span class="o">=</span><span class="s1">&#39;k&#39;</span><span class="p">,</span><span class="n">alpha</span><span class="o">=</span><span class="mf">0.2</span><span class="p">,</span><span class="n">zorder</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span><span class="n">linestyle</span><span class="o">=</span><span class="s1">&#39;--&#39;</span><span class="p">)</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">set_xticks</span><span class="p">(</span><span class="n">julian_midpoint</span><span class="p">)</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">set_xticklabels</span><span class="p">(</span><span class="n">julian_name</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">i</span><span class="p">,(</span><span class="n">istart</span><span class="p">,</span><span class="n">iend</span><span class="p">)</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="nb">zip</span><span class="p">(</span><span class="n">julian_start</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">][::</span><span class="mi">2</span><span class="p">],</span><span class="n">julian_start</span><span class="p">[</span><span class="mi">1</span><span class="p">:][::</span><span class="mi">2</span><span class="p">])):</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">axvspan</span><span class="p">(</span><span class="n">istart</span><span class="p">,</span><span class="n">iend</span><span class="p">,</span><span class="n">color</span><span class="o">=</span><span class="s1">&#39;#e4e4e4&#39;</span><span class="p">,</span><span class="n">alpha</span><span class="o">=</span><span class="mf">0.5</span><span class="p">,</span><span class="n">zorder</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
        
        <span class="c1">#Limit plot from May onward</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">set_xlim</span><span class="p">(</span><span class="n">julian_start</span><span class="p">[</span><span class="mi">4</span><span class="p">],</span><span class="n">julian</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span>
        
        <span class="c1">#Format plot title by category</span>
        <span class="n">category_names</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;ts&#39;</span><span class="p">:</span><span class="s1">&#39;Tropical Storm&#39;</span><span class="p">,</span><span class="s1">&#39;c1&#39;</span><span class="p">:</span><span class="s1">&#39;Category 1&#39;</span><span class="p">,</span><span class="s1">&#39;c2&#39;</span><span class="p">:</span><span class="s1">&#39;Category 2&#39;</span><span class="p">,</span><span class="s1">&#39;c3&#39;</span><span class="p">:</span><span class="s1">&#39;Category 3&#39;</span><span class="p">,</span><span class="s1">&#39;c4&#39;</span><span class="p">:</span><span class="s1">&#39;Category 4&#39;</span><span class="p">,</span><span class="s1">&#39;c5&#39;</span><span class="p">:</span><span class="s1">&#39;Category 5&#39;</span><span class="p">}</span>
        <span class="k">if</span> <span class="n">cat</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">add_str</span> <span class="o">=</span> <span class="s2">&quot;Tropical Cyclone&quot;</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">add_str</span> <span class="o">=</span> <span class="n">category_names</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">cat</span><span class="p">)</span>
        
        <span class="c1">#Add plot title</span>
        <span class="k">if</span> <span class="n">plot_year</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">title_string</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">basin</span><span class="o">.</span><span class="n">title</span><span class="p">()</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;_&#39;</span><span class="p">,</span><span class="s1">&#39; &#39;</span><span class="p">)</span><span class="si">}</span><span class="s2"> Accumulated </span><span class="si">{</span><span class="n">add_str</span><span class="si">}</span><span class="s2"> Days&quot;</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">cur_year</span> <span class="o">=</span> <span class="p">(</span><span class="n">dt</span><span class="o">.</span><span class="n">now</span><span class="p">())</span><span class="o">.</span><span class="n">year</span>
            <span class="k">if</span> <span class="n">plot_year</span> <span class="o">==</span> <span class="n">cur_year</span><span class="p">:</span>
                <span class="n">add_current</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot; (through </span><span class="si">{</span><span class="p">(</span><span class="n">dt</span><span class="o">.</span><span class="n">now</span><span class="p">())</span><span class="o">.</span><span class="n">strftime</span><span class="p">(</span><span class="s1">&#39;%b </span><span class="si">%d</span><span class="s1">&#39;</span><span class="p">)</span><span class="si">}</span><span class="s2">)&quot;</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">add_current</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
            <span class="n">title_string</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">plot_year</span><span class="si">}</span><span class="s2"> </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">basin</span><span class="o">.</span><span class="n">title</span><span class="p">()</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;_&#39;</span><span class="p">,</span><span class="s1">&#39; &#39;</span><span class="p">)</span><span class="si">}</span><span class="s2"> Accumulated </span><span class="si">{</span><span class="n">add_str</span><span class="si">}</span><span class="s2"> Days</span><span class="si">{</span><span class="n">add_current</span><span class="si">}</span><span class="s2">&quot;</span>
        <span class="k">if</span> <span class="n">rolling_sum</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">title_add</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="se">\n</span><span class="si">{</span><span class="n">rolling_sum</span><span class="si">}</span><span class="s2">-Day Running Sum&quot;</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">title_add</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">title_string</span><span class="si">}{</span><span class="n">title_add</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span><span class="n">fontsize</span><span class="o">=</span><span class="mi">12</span><span class="p">,</span><span class="n">fontweight</span><span class="o">=</span><span class="s1">&#39;bold&#39;</span><span class="p">,</span><span class="n">loc</span><span class="o">=</span><span class="s1">&#39;left&#39;</span><span class="p">)</span>
        
        <span class="c1">#Plot requested year</span>
        <span class="k">if</span> <span class="n">plot_year</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            
            <span class="k">if</span> <span class="n">cat</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                <span class="n">year_labels</span> <span class="o">=</span> <span class="p">[]</span>
                <span class="k">for</span> <span class="n">icat</span> <span class="ow">in</span> <span class="n">all_thres</span><span class="p">[::</span><span class="o">-</span><span class="mi">1</span><span class="p">]:</span>
                    <span class="n">year_julian</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">copy</span><span class="p">(</span><span class="n">julian</span><span class="p">)</span>
                    <span class="n">year_tc_days</span> <span class="o">=</span> <span class="n">tc_days</span><span class="p">[</span><span class="nb">str</span><span class="p">(</span><span class="n">plot_year</span><span class="p">)][</span><span class="n">icat</span><span class="p">]</span>

                    <span class="c1">#Check to see if this is current year</span>
                    <span class="n">cur_year</span> <span class="o">=</span> <span class="p">(</span><span class="n">dt</span><span class="o">.</span><span class="n">now</span><span class="p">())</span><span class="o">.</span><span class="n">year</span>
                    <span class="k">if</span> <span class="n">plot_year</span> <span class="o">==</span> <span class="n">cur_year</span><span class="p">:</span>
                        <span class="n">cur_julian</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">convert_to_julian</span><span class="p">(</span> <span class="p">(</span><span class="n">dt</span><span class="o">.</span><span class="n">now</span><span class="p">())</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="n">year</span><span class="o">=</span><span class="mi">2019</span><span class="p">,</span><span class="n">minute</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span><span class="n">second</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span> <span class="p">))</span><span class="o">*</span><span class="mi">4</span> <span class="o">-</span> <span class="nb">int</span><span class="p">(</span><span class="n">rolling_sum</span><span class="o">*</span><span class="mi">4</span><span class="p">)</span>
                        <span class="n">year_julian</span> <span class="o">=</span> <span class="n">year_julian</span><span class="p">[:</span><span class="n">cur_julian</span><span class="o">+</span><span class="mi">1</span><span class="p">]</span>
                        <span class="n">year_tc_days</span> <span class="o">=</span> <span class="n">year_tc_days</span><span class="p">[:</span><span class="n">cur_julian</span><span class="o">+</span><span class="mi">1</span><span class="p">]</span>
                        <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">year_julian</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span><span class="n">year_tc_days</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span><span class="s1">&#39;o&#39;</span><span class="p">,</span><span class="n">color</span><span class="o">=</span><span class="n">get_colors_sshws</span><span class="p">(</span><span class="n">icat</span><span class="p">),</span><span class="n">ms</span><span class="o">=</span><span class="mi">8</span><span class="p">,</span><span class="n">mec</span><span class="o">=</span><span class="s1">&#39;k&#39;</span><span class="p">,</span><span class="n">mew</span><span class="o">=</span><span class="mf">0.8</span><span class="p">,</span><span class="n">zorder</span><span class="o">=</span><span class="mi">8</span><span class="p">)</span>

                    <span class="n">year_tc_days_masked</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">year_tc_days</span><span class="p">)</span>
                    <span class="n">year_tc_days_masked</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">ma</span><span class="o">.</span><span class="n">masked_where</span><span class="p">(</span><span class="n">year_tc_days_masked</span><span class="o">==</span><span class="mi">0</span><span class="p">,</span><span class="n">year_tc_days_masked</span><span class="p">)</span>
                    <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">year_julian</span><span class="p">,</span><span class="n">year_tc_days_masked</span><span class="p">,</span><span class="s1">&#39;-&#39;</span><span class="p">,</span><span class="n">color</span><span class="o">=</span><span class="s1">&#39;k&#39;</span><span class="p">,</span><span class="n">linewidth</span><span class="o">=</span><span class="mf">2.8</span><span class="p">,</span><span class="n">zorder</span><span class="o">=</span><span class="mi">6</span><span class="p">)</span>
                    <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">year_julian</span><span class="p">,</span><span class="n">year_tc_days_masked</span><span class="p">,</span><span class="s1">&#39;-&#39;</span><span class="p">,</span><span class="n">color</span><span class="o">=</span><span class="n">get_colors_sshws</span><span class="p">(</span><span class="n">icat</span><span class="p">),</span><span class="n">linewidth</span><span class="o">=</span><span class="mf">2.0</span><span class="p">,</span><span class="n">zorder</span><span class="o">=</span><span class="mi">6</span><span class="p">)</span>
                    <span class="n">year_labels</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">year_tc_days</span><span class="p">)</span><span class="si">:</span><span class="s2">.1f</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
                    
            <span class="k">else</span><span class="p">:</span>
                <span class="n">year_julian</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">copy</span><span class="p">(</span><span class="n">julian</span><span class="p">)</span>
                <span class="n">year_tc_days</span> <span class="o">=</span> <span class="n">tc_days</span><span class="p">[</span><span class="nb">str</span><span class="p">(</span><span class="n">plot_year</span><span class="p">)][</span><span class="n">cat</span><span class="p">]</span>
                <span class="n">year_genesis</span> <span class="o">=</span> <span class="n">tc_days</span><span class="p">[</span><span class="nb">str</span><span class="p">(</span><span class="n">plot_year</span><span class="p">)][</span><span class="s1">&#39;genesis_index&#39;</span><span class="p">]</span>

                <span class="c1">#Check to see if this is current year</span>
                <span class="n">cur_year</span> <span class="o">=</span> <span class="p">(</span><span class="n">dt</span><span class="o">.</span><span class="n">now</span><span class="p">())</span><span class="o">.</span><span class="n">year</span>
                <span class="k">if</span> <span class="n">plot_year</span> <span class="o">==</span> <span class="n">cur_year</span><span class="p">:</span>
                    <span class="n">cur_julian</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">convert_to_julian</span><span class="p">(</span> <span class="p">(</span><span class="n">dt</span><span class="o">.</span><span class="n">now</span><span class="p">())</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="n">year</span><span class="o">=</span><span class="mi">2019</span><span class="p">,</span><span class="n">minute</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span><span class="n">second</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span> <span class="p">))</span><span class="o">*</span><span class="mi">4</span> <span class="o">-</span> <span class="nb">int</span><span class="p">(</span><span class="n">rolling_sum</span><span class="o">*</span><span class="mi">4</span><span class="p">)</span>
                    <span class="n">year_julian</span> <span class="o">=</span> <span class="n">year_julian</span><span class="p">[:</span><span class="n">cur_julian</span><span class="o">+</span><span class="mi">1</span><span class="p">]</span>
                    <span class="n">year_tc_days</span> <span class="o">=</span> <span class="n">year_tc_days</span><span class="p">[:</span><span class="n">cur_julian</span><span class="o">+</span><span class="mi">1</span><span class="p">]</span>
                    <span class="n">year_genesis</span> <span class="o">=</span> <span class="n">year_genesis</span><span class="p">[:</span><span class="n">cur_julian</span><span class="o">+</span><span class="mi">1</span><span class="p">]</span>
                    <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">year_julian</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span><span class="n">year_tc_days</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span><span class="s1">&#39;o&#39;</span><span class="p">,</span><span class="n">color</span><span class="o">=</span><span class="s1">&#39;#FF7CFF&#39;</span><span class="p">,</span><span class="n">ms</span><span class="o">=</span><span class="mi">8</span><span class="p">,</span><span class="n">mec</span><span class="o">=</span><span class="s1">&#39;#750775&#39;</span><span class="p">,</span><span class="n">mew</span><span class="o">=</span><span class="mf">0.8</span><span class="p">,</span><span class="n">zorder</span><span class="o">=</span><span class="mi">8</span><span class="p">)</span>

                <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">year_julian</span><span class="p">,</span><span class="n">year_tc_days</span><span class="p">,</span><span class="s1">&#39;-&#39;</span><span class="p">,</span><span class="n">color</span><span class="o">=</span><span class="s1">&#39;#750775&#39;</span><span class="p">,</span><span class="n">linewidth</span><span class="o">=</span><span class="mf">2.8</span><span class="p">,</span><span class="n">zorder</span><span class="o">=</span><span class="mi">6</span><span class="p">)</span>
                <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">year_julian</span><span class="p">,</span><span class="n">year_tc_days</span><span class="p">,</span><span class="s1">&#39;-&#39;</span><span class="p">,</span><span class="n">color</span><span class="o">=</span><span class="s1">&#39;#FF7CFF&#39;</span><span class="p">,</span><span class="n">linewidth</span><span class="o">=</span><span class="mf">2.0</span><span class="p">,</span><span class="n">zorder</span><span class="o">=</span><span class="mi">6</span><span class="p">,</span><span class="n">label</span><span class="o">=</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">plot_year</span><span class="si">}</span><span class="s1"> (</span><span class="si">{</span><span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">year_tc_days</span><span class="p">)</span><span class="si">:</span><span class="s1">.1f</span><span class="si">}</span><span class="s1"> days)&#39;</span><span class="p">)</span>
                <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">year_julian</span><span class="p">[</span><span class="n">year_genesis</span><span class="p">],</span><span class="n">year_tc_days</span><span class="p">[</span><span class="n">year_genesis</span><span class="p">],</span><span class="s1">&#39;D&#39;</span><span class="p">,</span><span class="n">color</span><span class="o">=</span><span class="s1">&#39;#FF7CFF&#39;</span><span class="p">,</span><span class="n">ms</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span><span class="n">mec</span><span class="o">=</span><span class="s1">&#39;#750775&#39;</span><span class="p">,</span><span class="n">mew</span><span class="o">=</span><span class="mf">0.5</span><span class="p">,</span><span class="n">zorder</span><span class="o">=</span><span class="mi">7</span><span class="p">,</span><span class="n">label</span><span class="o">=</span><span class="s1">&#39;TC Genesis&#39;</span><span class="p">)</span>
            
        <span class="c1">#Plot comparison years</span>
        <span class="k">if</span> <span class="n">compare_years</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">cat</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">:</span>
            
            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">compare_years</span><span class="p">,</span> <span class="nb">int</span><span class="p">):</span> <span class="n">compare_years</span> <span class="o">=</span> <span class="p">[</span><span class="n">compare_years</span><span class="p">]</span>
                
            <span class="k">for</span> <span class="n">year</span> <span class="ow">in</span> <span class="n">compare_years</span><span class="p">:</span>
                
                <span class="n">year_julian</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">copy</span><span class="p">(</span><span class="n">julian</span><span class="p">)</span>
                <span class="n">year_tc_days</span> <span class="o">=</span> <span class="n">tc_days</span><span class="p">[</span><span class="nb">str</span><span class="p">(</span><span class="n">year</span><span class="p">)][</span><span class="n">cat</span><span class="p">]</span>
                <span class="n">year_genesis</span> <span class="o">=</span> <span class="n">tc_days</span><span class="p">[</span><span class="nb">str</span><span class="p">(</span><span class="n">year</span><span class="p">)][</span><span class="s1">&#39;genesis_index&#39;</span><span class="p">]</span>

                <span class="c1">#Check to see if this is current year</span>
                <span class="n">cur_year</span> <span class="o">=</span> <span class="p">(</span><span class="n">dt</span><span class="o">.</span><span class="n">now</span><span class="p">())</span><span class="o">.</span><span class="n">year</span>
                <span class="k">if</span> <span class="n">year</span> <span class="o">==</span> <span class="n">cur_year</span><span class="p">:</span>
                    <span class="n">cur_julian</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">convert_to_julian</span><span class="p">(</span> <span class="p">(</span><span class="n">dt</span><span class="o">.</span><span class="n">now</span><span class="p">())</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="n">year</span><span class="o">=</span><span class="mi">2019</span><span class="p">,</span><span class="n">minute</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span><span class="n">second</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span> <span class="p">))</span><span class="o">*</span><span class="mi">4</span> <span class="o">-</span> <span class="nb">int</span><span class="p">(</span><span class="n">rolling_sum</span><span class="o">*</span><span class="mi">4</span><span class="p">)</span>
                    <span class="n">year_julian</span> <span class="o">=</span> <span class="n">year_julian</span><span class="p">[:</span><span class="n">cur_julian</span><span class="o">+</span><span class="mi">1</span><span class="p">]</span>
                    <span class="n">year_tc_days</span> <span class="o">=</span> <span class="n">year_tc_days</span><span class="p">[:</span><span class="n">cur_julian</span><span class="o">+</span><span class="mi">1</span><span class="p">]</span>
                    <span class="n">year_genesis</span> <span class="o">=</span> <span class="n">year_genesis</span><span class="p">[:</span><span class="n">cur_julian</span><span class="o">+</span><span class="mi">1</span><span class="p">]</span>
                    <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">year_julian</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span><span class="n">year_tc_days</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span><span class="s1">&#39;o&#39;</span><span class="p">,</span><span class="n">color</span><span class="o">=</span><span class="s1">&#39;#333333&#39;</span><span class="p">,</span><span class="n">alpha</span><span class="o">=</span><span class="mf">0.3</span><span class="p">,</span><span class="n">ms</span><span class="o">=</span><span class="mi">6</span><span class="p">,</span><span class="n">zorder</span><span class="o">=</span><span class="mi">5</span><span class="p">)</span>

                <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">compare_years</span><span class="p">)</span> <span class="o">&lt;=</span> <span class="mi">5</span><span class="p">:</span>
                    <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">year_julian</span><span class="p">,</span><span class="n">year_tc_days</span><span class="p">,</span><span class="s1">&#39;-&#39;</span><span class="p">,</span><span class="n">color</span><span class="o">=</span><span class="s1">&#39;k&#39;</span><span class="p">,</span><span class="n">linewidth</span><span class="o">=</span><span class="mf">1.0</span><span class="p">,</span><span class="n">alpha</span><span class="o">=</span><span class="mf">0.5</span><span class="p">,</span><span class="n">zorder</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span><span class="n">label</span><span class="o">=</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">year</span><span class="si">}</span><span class="s1"> (</span><span class="si">{</span><span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">year_tc_days</span><span class="p">)</span><span class="si">:</span><span class="s1">.1f</span><span class="si">}</span><span class="s1"> days)&#39;</span><span class="p">)</span>
                    <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">year_julian</span><span class="p">[</span><span class="n">year_genesis</span><span class="p">],</span><span class="n">year_tc_days</span><span class="p">[</span><span class="n">year_genesis</span><span class="p">],</span><span class="s1">&#39;D&#39;</span><span class="p">,</span><span class="n">color</span><span class="o">=</span><span class="s1">&#39;#333333&#39;</span><span class="p">,</span><span class="n">ms</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span><span class="n">alpha</span><span class="o">=</span><span class="mf">0.3</span><span class="p">,</span><span class="n">zorder</span><span class="o">=</span><span class="mi">4</span><span class="p">)</span>
                    <span class="n">ax</span><span class="o">.</span><span class="n">text</span><span class="p">(</span><span class="n">year_julian</span><span class="p">[</span><span class="o">-</span><span class="mi">2</span><span class="p">],</span><span class="n">year_tc_days</span><span class="p">[</span><span class="o">-</span><span class="mi">2</span><span class="p">]</span><span class="o">+</span><span class="mi">2</span><span class="p">,</span><span class="nb">str</span><span class="p">(</span><span class="n">year</span><span class="p">),</span><span class="n">fontsize</span><span class="o">=</span><span class="mi">7</span><span class="p">,</span><span class="n">fontweight</span><span class="o">=</span><span class="s1">&#39;bold&#39;</span><span class="p">,</span><span class="n">alpha</span><span class="o">=</span><span class="mf">0.7</span><span class="p">,</span><span class="n">ha</span><span class="o">=</span><span class="s1">&#39;right&#39;</span><span class="p">,</span><span class="n">va</span><span class="o">=</span><span class="s1">&#39;bottom&#39;</span><span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">year_julian</span><span class="p">,</span><span class="n">year_tc_days</span><span class="p">,</span><span class="s1">&#39;-&#39;</span><span class="p">,</span><span class="n">color</span><span class="o">=</span><span class="s1">&#39;k&#39;</span><span class="p">,</span><span class="n">linewidth</span><span class="o">=</span><span class="mf">1.0</span><span class="p">,</span><span class="n">alpha</span><span class="o">=</span><span class="mf">0.15</span><span class="p">,</span><span class="n">zorder</span><span class="o">=</span><span class="mi">3</span><span class="p">)</span>
            
        
        <span class="c1">#Plot all climatological values</span>
        <span class="k">if</span> <span class="n">cat</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">plot_year</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">add_str</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;&quot;</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">all_thres</span><span class="p">]</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">add_str</span> <span class="o">=</span> <span class="p">[</span><span class="sa">f</span><span class="s2">&quot; | </span><span class="si">{</span><span class="n">plot_year</span><span class="si">}</span><span class="s2">: </span><span class="si">{</span><span class="n">i</span><span class="si">}</span><span class="s2">&quot;</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">year_labels</span><span class="p">[::</span><span class="o">-</span><span class="mi">1</span><span class="p">]]</span>
            <span class="n">xnums</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">p50</span><span class="p">[</span><span class="s1">&#39;ts&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">shape</span><span class="p">))</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">fill_between</span><span class="p">(</span><span class="n">julian</span><span class="p">,</span><span class="n">p50</span><span class="p">[</span><span class="s1">&#39;c1&#39;</span><span class="p">],</span><span class="n">p50</span><span class="p">[</span><span class="s1">&#39;ts&#39;</span><span class="p">],</span><span class="n">color</span><span class="o">=</span><span class="n">get_colors_sshws</span><span class="p">(</span><span class="mi">34</span><span class="p">),</span><span class="n">alpha</span><span class="o">=</span><span class="mf">0.3</span><span class="p">,</span><span class="n">zorder</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span><span class="n">label</span><span class="o">=</span><span class="sa">f</span><span class="s1">&#39;TS (Avg: </span><span class="si">{</span><span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">p50</span><span class="p">[</span><span class="s2">&quot;ts&quot;</span><span class="p">])</span><span class="si">:</span><span class="s1">.1f</span><span class="si">}{</span><span class="n">add_str</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="si">}</span><span class="s1">)&#39;</span><span class="p">)</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">fill_between</span><span class="p">(</span><span class="n">julian</span><span class="p">,</span><span class="n">p50</span><span class="p">[</span><span class="s1">&#39;c2&#39;</span><span class="p">],</span><span class="n">p50</span><span class="p">[</span><span class="s1">&#39;c1&#39;</span><span class="p">],</span><span class="n">color</span><span class="o">=</span><span class="n">get_colors_sshws</span><span class="p">(</span><span class="mi">64</span><span class="p">),</span><span class="n">alpha</span><span class="o">=</span><span class="mf">0.3</span><span class="p">,</span><span class="n">zorder</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span><span class="n">label</span><span class="o">=</span><span class="sa">f</span><span class="s1">&#39;C1 (Avg: </span><span class="si">{</span><span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">p50</span><span class="p">[</span><span class="s2">&quot;c1&quot;</span><span class="p">])</span><span class="si">:</span><span class="s1">.1f</span><span class="si">}{</span><span class="n">add_str</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="si">}</span><span class="s1">)&#39;</span><span class="p">)</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">fill_between</span><span class="p">(</span><span class="n">julian</span><span class="p">,</span><span class="n">p50</span><span class="p">[</span><span class="s1">&#39;c3&#39;</span><span class="p">],</span><span class="n">p50</span><span class="p">[</span><span class="s1">&#39;c2&#39;</span><span class="p">],</span><span class="n">color</span><span class="o">=</span><span class="n">get_colors_sshws</span><span class="p">(</span><span class="mi">83</span><span class="p">),</span><span class="n">alpha</span><span class="o">=</span><span class="mf">0.3</span><span class="p">,</span><span class="n">zorder</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span><span class="n">label</span><span class="o">=</span><span class="sa">f</span><span class="s1">&#39;C2 (Avg: </span><span class="si">{</span><span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">p50</span><span class="p">[</span><span class="s2">&quot;c2&quot;</span><span class="p">])</span><span class="si">:</span><span class="s1">.1f</span><span class="si">}{</span><span class="n">add_str</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="si">}</span><span class="s1">)&#39;</span><span class="p">)</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">fill_between</span><span class="p">(</span><span class="n">julian</span><span class="p">,</span><span class="n">p50</span><span class="p">[</span><span class="s1">&#39;c4&#39;</span><span class="p">],</span><span class="n">p50</span><span class="p">[</span><span class="s1">&#39;c3&#39;</span><span class="p">],</span><span class="n">color</span><span class="o">=</span><span class="n">get_colors_sshws</span><span class="p">(</span><span class="mi">96</span><span class="p">),</span><span class="n">alpha</span><span class="o">=</span><span class="mf">0.3</span><span class="p">,</span><span class="n">zorder</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span><span class="n">label</span><span class="o">=</span><span class="sa">f</span><span class="s1">&#39;C3 (Avg: </span><span class="si">{</span><span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">p50</span><span class="p">[</span><span class="s2">&quot;c3&quot;</span><span class="p">])</span><span class="si">:</span><span class="s1">.1f</span><span class="si">}{</span><span class="n">add_str</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span><span class="si">}</span><span class="s1">)&#39;</span><span class="p">)</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">fill_between</span><span class="p">(</span><span class="n">julian</span><span class="p">,</span><span class="n">p50</span><span class="p">[</span><span class="s1">&#39;c5&#39;</span><span class="p">],</span><span class="n">p50</span><span class="p">[</span><span class="s1">&#39;c4&#39;</span><span class="p">],</span><span class="n">color</span><span class="o">=</span><span class="n">get_colors_sshws</span><span class="p">(</span><span class="mi">113</span><span class="p">),</span><span class="n">alpha</span><span class="o">=</span><span class="mf">0.3</span><span class="p">,</span><span class="n">zorder</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span><span class="n">label</span><span class="o">=</span><span class="sa">f</span><span class="s1">&#39;C4 (Avg: </span><span class="si">{</span><span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">p50</span><span class="p">[</span><span class="s2">&quot;c4&quot;</span><span class="p">])</span><span class="si">:</span><span class="s1">.1f</span><span class="si">}{</span><span class="n">add_str</span><span class="p">[</span><span class="mi">4</span><span class="p">]</span><span class="si">}</span><span class="s1">)&#39;</span><span class="p">)</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">fill_between</span><span class="p">(</span><span class="n">julian</span><span class="p">,</span><span class="n">xnums</span><span class="p">,</span><span class="n">p50</span><span class="p">[</span><span class="s1">&#39;c5&#39;</span><span class="p">],</span><span class="n">color</span><span class="o">=</span><span class="n">get_colors_sshws</span><span class="p">(</span><span class="mi">137</span><span class="p">),</span><span class="n">alpha</span><span class="o">=</span><span class="mf">0.3</span><span class="p">,</span><span class="n">zorder</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span><span class="n">label</span><span class="o">=</span><span class="sa">f</span><span class="s1">&#39;C5 (Avg: </span><span class="si">{</span><span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">p50</span><span class="p">[</span><span class="s2">&quot;c5&quot;</span><span class="p">])</span><span class="si">:</span><span class="s1">.1f</span><span class="si">}{</span><span class="n">add_str</span><span class="p">[</span><span class="mi">5</span><span class="p">]</span><span class="si">}</span><span class="s1">)&#39;</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">pmin_masked</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">pmin</span><span class="p">)</span>
            <span class="n">pmin_masked</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">ma</span><span class="o">.</span><span class="n">masked_where</span><span class="p">(</span><span class="n">pmin_masked</span><span class="o">==</span><span class="mi">0</span><span class="p">,</span><span class="n">pmin_masked</span><span class="p">)</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">julian</span><span class="p">,</span><span class="n">pmax</span><span class="p">,</span><span class="s1">&#39;--&#39;</span><span class="p">,</span><span class="n">color</span><span class="o">=</span><span class="s1">&#39;r&#39;</span><span class="p">,</span><span class="n">zorder</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span><span class="n">label</span><span class="o">=</span><span class="sa">f</span><span class="s1">&#39;Max (</span><span class="si">{</span><span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">pmax</span><span class="p">)</span><span class="si">:</span><span class="s1">.1f</span><span class="si">}</span><span class="s1"> days)&#39;</span><span class="p">)</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">julian</span><span class="p">,</span><span class="n">pmin_masked</span><span class="p">,</span><span class="s1">&#39;--&#39;</span><span class="p">,</span><span class="n">color</span><span class="o">=</span><span class="s1">&#39;b&#39;</span><span class="p">,</span><span class="n">zorder</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span><span class="n">label</span><span class="o">=</span><span class="sa">f</span><span class="s1">&#39;Min (</span><span class="si">{</span><span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">pmin</span><span class="p">)</span><span class="si">:</span><span class="s1">.1f</span><span class="si">}</span><span class="s1"> days)&#39;</span><span class="p">)</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">fill_between</span><span class="p">(</span><span class="n">julian</span><span class="p">,</span><span class="n">p10</span><span class="p">,</span><span class="n">p90</span><span class="p">,</span><span class="n">color</span><span class="o">=</span><span class="s1">&#39;#60CE56&#39;</span><span class="p">,</span><span class="n">alpha</span><span class="o">=</span><span class="mf">0.3</span><span class="p">,</span><span class="n">zorder</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span><span class="n">label</span><span class="o">=</span><span class="s1">&#39;Climo 10-90%&#39;</span><span class="p">)</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">fill_between</span><span class="p">(</span><span class="n">julian</span><span class="p">,</span><span class="n">p25</span><span class="p">,</span><span class="n">p75</span><span class="p">,</span><span class="n">color</span><span class="o">=</span><span class="s1">&#39;#16A147&#39;</span><span class="p">,</span><span class="n">alpha</span><span class="o">=</span><span class="mf">0.3</span><span class="p">,</span><span class="n">zorder</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span><span class="n">label</span><span class="o">=</span><span class="s1">&#39;Climo 25-75%&#39;</span><span class="p">)</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">fill_between</span><span class="p">(</span><span class="n">julian</span><span class="p">,</span><span class="n">p40</span><span class="p">,</span><span class="n">p60</span><span class="p">,</span><span class="n">color</span><span class="o">=</span><span class="s1">&#39;#00782A&#39;</span><span class="p">,</span><span class="n">alpha</span><span class="o">=</span><span class="mf">0.3</span><span class="p">,</span><span class="n">zorder</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span><span class="n">label</span><span class="o">=</span><span class="s1">&#39;Climo 40-60%&#39;</span><span class="p">)</span>

        <span class="c1">#Add legend &amp; plot credit</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">loc</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
        <span class="n">endash</span> <span class="o">=</span> <span class="sa">u</span><span class="s2">&quot;</span><span class="se">\u2013</span><span class="s2">&quot;</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">text</span><span class="p">(</span><span class="mf">0.99</span><span class="p">,</span><span class="mf">0.01</span><span class="p">,</span><span class="n">plot_credit</span><span class="p">(),</span><span class="n">fontsize</span><span class="o">=</span><span class="mi">6</span><span class="p">,</span><span class="n">color</span><span class="o">=</span><span class="s1">&#39;k&#39;</span><span class="p">,</span><span class="n">alpha</span><span class="o">=</span><span class="mf">0.7</span><span class="p">,</span>
                <span class="n">transform</span><span class="o">=</span><span class="n">ax</span><span class="o">.</span><span class="n">transAxes</span><span class="p">,</span><span class="n">ha</span><span class="o">=</span><span class="s1">&#39;right&#39;</span><span class="p">,</span><span class="n">va</span><span class="o">=</span><span class="s1">&#39;bottom&#39;</span><span class="p">,</span><span class="n">zorder</span><span class="o">=</span><span class="mi">10</span><span class="p">)</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">text</span><span class="p">(</span><span class="mf">0.99</span><span class="p">,</span><span class="mf">0.99</span><span class="p">,</span><span class="sa">f</span><span class="s1">&#39;Climatology from </span><span class="si">{</span><span class="n">start_year</span><span class="si">}{</span><span class="n">endash</span><span class="si">}{</span><span class="n">end_year</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">,</span><span class="n">fontsize</span><span class="o">=</span><span class="mi">8</span><span class="p">,</span><span class="n">color</span><span class="o">=</span><span class="s1">&#39;k&#39;</span><span class="p">,</span><span class="n">alpha</span><span class="o">=</span><span class="mf">0.7</span><span class="p">,</span>
                <span class="n">transform</span><span class="o">=</span><span class="n">ax</span><span class="o">.</span><span class="n">transAxes</span><span class="p">,</span><span class="n">ha</span><span class="o">=</span><span class="s1">&#39;right&#39;</span><span class="p">,</span><span class="n">va</span><span class="o">=</span><span class="s1">&#39;top&#39;</span><span class="p">,</span><span class="n">zorder</span><span class="o">=</span><span class="mi">10</span><span class="p">)</span>
        
        <span class="c1">#Show/save plot and close</span>
        <span class="k">if</span> <span class="n">save_path</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">save_path</span><span class="p">,</span><span class="nb">str</span><span class="p">):</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="n">save_path</span><span class="p">,</span><span class="n">bbox_inches</span><span class="o">=</span><span class="s1">&#39;tight&#39;</span><span class="p">)</span>
        
        <span class="k">if</span> <span class="n">return_dict</span><span class="p">:</span>
            <span class="k">return</span> <span class="p">{</span><span class="s1">&#39;ax&#39;</span><span class="p">:</span><span class="n">ax</span><span class="p">,</span><span class="s1">&#39;data&#39;</span><span class="p">:</span><span class="n">tc_days</span><span class="p">}</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">ax</span></div>
    
<div class="viewcode-block" id="TrackDataset.wind_pres_relationship"><a class="viewcode-back" href="../../../api/generated/tropycal.tracks.TrackDataset.wind_pres_relationship.html#tropycal.tracks.TrackDataset.wind_pres_relationship">[docs]</a>    <span class="k">def</span> <span class="nf">wind_pres_relationship</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">storm</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span><span class="n">year_range</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span><span class="n">return_dict</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span><span class="n">plot</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span><span class="n">save_path</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        
        <span class="sa">r</span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Creates a climatology of maximum sustained wind speed vs minimum MSLP relationships.</span>
<span class="sd">        </span>
<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        storm : str or tuple</span>
<span class="sd">            Storm to plot. Can be either string of storm ID (e.g., &quot;AL052019&quot;), or tuple with storm name and year (e.g., (&quot;Matthew&quot;,2016)).</span>
<span class="sd">        year_range : list or tuple</span>
<span class="sd">            List or tuple representing the start and end years (e.g., (1950,2018)). Default is the start and end of dataset.</span>
<span class="sd">        return_dict : bool</span>
<span class="sd">            Determines whether to return data from this function. Default is False.</span>
<span class="sd">        plot : bool</span>
<span class="sd">            Determines whether to generate a plot or not. If False, function simply returns ace dictionary.</span>
<span class="sd">        save_path : str</span>
<span class="sd">            Determines the file path to save the image to. If blank or none, image will be directly shown.</span>
<span class="sd">        </span>
<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        ax or dict</span>
<span class="sd">            By default, the plot axes is returned. If return_dict is True, a dictionary containing data about the wind vs. MSLP relationship climatology is returned.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        
        <span class="c1">#Define empty dictionary</span>
        <span class="n">relationship</span> <span class="o">=</span> <span class="p">{}</span>
        
        <span class="c1">#Determine year range of dataset</span>
        <span class="k">if</span> <span class="n">year_range</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">start_year</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">keys</span><span class="p">[</span><span class="mi">0</span><span class="p">]][</span><span class="s1">&#39;year&#39;</span><span class="p">]</span>
            <span class="n">end_year</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">keys</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]][</span><span class="s1">&#39;year&#39;</span><span class="p">]</span>
        <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">year_range</span><span class="p">,(</span><span class="nb">list</span><span class="p">,</span><span class="nb">tuple</span><span class="p">)):</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">year_range</span><span class="p">)</span> <span class="o">!=</span> <span class="mi">2</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;year_range must be a tuple or list with 2 elements: (start_year, end_year)&quot;</span><span class="p">)</span>
            <span class="n">start_year</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">year_range</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
            <span class="k">if</span> <span class="n">start_year</span> <span class="o">&lt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">keys</span><span class="p">[</span><span class="mi">0</span><span class="p">]][</span><span class="s1">&#39;year&#39;</span><span class="p">]:</span> <span class="n">start_year</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">keys</span><span class="p">[</span><span class="mi">0</span><span class="p">]][</span><span class="s1">&#39;year&#39;</span><span class="p">]</span>
            <span class="n">end_year</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">year_range</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
            <span class="k">if</span> <span class="n">end_year</span> <span class="o">&gt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">keys</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]][</span><span class="s1">&#39;year&#39;</span><span class="p">]:</span> <span class="n">end_year</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">keys</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]][</span><span class="s1">&#39;year&#39;</span><span class="p">]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s2">&quot;year_range must be of type tuple or list&quot;</span><span class="p">)</span>
        
        <span class="c1">#Get velocity &amp; pressure pairs for all storms in dataset</span>
        <span class="n">vp</span> <span class="o">=</span> <span class="n">filter_storms_vp</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">year_min</span><span class="o">=</span><span class="n">start_year</span><span class="p">,</span><span class="n">year_max</span><span class="o">=</span><span class="n">end_year</span><span class="p">)</span>
        <span class="n">relationship</span><span class="p">[</span><span class="s1">&#39;vp&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">vp</span>

        <span class="c1">#Create 2D histogram of v+p relationship</span>
        <span class="n">counts</span><span class="p">,</span><span class="n">yedges</span><span class="p">,</span><span class="n">xedges</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">histogram2d</span><span class="p">(</span><span class="o">*</span><span class="nb">zip</span><span class="p">(</span><span class="o">*</span><span class="n">vp</span><span class="p">),[</span><span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">800</span><span class="p">,</span><span class="mi">1050</span><span class="p">,</span><span class="mi">5</span><span class="p">)</span><span class="o">-</span><span class="mf">2.5</span><span class="p">,</span><span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">250</span><span class="p">,</span><span class="mi">5</span><span class="p">)</span><span class="o">-</span><span class="mf">2.5</span><span class="p">])</span>
        <span class="n">relationship</span><span class="p">[</span><span class="s1">&#39;counts&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">counts</span>
        <span class="n">relationship</span><span class="p">[</span><span class="s1">&#39;yedges&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">yedges</span>
        <span class="n">relationship</span><span class="p">[</span><span class="s1">&#39;xedges&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">xedges</span>
        
        <span class="c1">#Return if plot is not requested</span>
        <span class="k">if</span> <span class="n">plot</span> <span class="o">==</span> <span class="kc">False</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">return_dict</span><span class="p">:</span>
                <span class="k">return</span> <span class="n">relationship</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">return</span>
        
        <span class="c1">#Create figure</span>
        <span class="n">fig</span><span class="p">,</span><span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">12</span><span class="p">,</span><span class="mf">9.5</span><span class="p">),</span><span class="n">dpi</span> <span class="o">=</span> <span class="mi">200</span><span class="p">)</span>

        <span class="c1">#Plot climatology</span>
        <span class="n">CS</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">pcolor</span><span class="p">(</span><span class="n">xedges</span><span class="p">,</span><span class="n">yedges</span><span class="p">,</span><span class="n">counts</span><span class="o">**</span><span class="mf">0.3</span><span class="p">,</span><span class="n">vmin</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span><span class="n">vmax</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">amax</span><span class="p">(</span><span class="n">counts</span><span class="p">)</span><span class="o">**</span><span class="mf">.3</span><span class="p">,</span><span class="n">cmap</span><span class="o">=</span><span class="s1">&#39;gnuplot2_r&#39;</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">xedges</span><span class="p">,[</span><span class="n">testfit</span><span class="p">(</span><span class="n">vp</span><span class="p">,</span><span class="n">x</span><span class="p">,</span><span class="mi">2</span><span class="p">)</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">xedges</span><span class="p">],</span><span class="s1">&#39;k--&#39;</span><span class="p">,</span><span class="n">linewidth</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
        
        <span class="c1">#Plot storm, if specified</span>
        <span class="k">if</span> <span class="n">storm</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            
            <span class="c1">#Check if storm is str or tuple</span>
            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">storm</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
                <span class="k">pass</span>
            <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">storm</span><span class="p">,</span> <span class="nb">tuple</span><span class="p">):</span>
                <span class="n">storm</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_storm_id</span><span class="p">((</span><span class="n">storm</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span><span class="n">storm</span><span class="p">[</span><span class="mi">1</span><span class="p">]))</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span><span class="s2">&quot;Storm must be a string (e.g., &#39;AL052019&#39;) or tuple (e.g., (&#39;Matthew&#39;,2016)).&quot;</span><span class="p">)</span>
                
            <span class="c1">#Plot storm</span>
            <span class="n">storm_data</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="n">storm</span><span class="p">]</span>
            <span class="n">V</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">storm_data</span><span class="p">[</span><span class="s1">&#39;vmax&#39;</span><span class="p">])</span>
            <span class="n">P</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">storm_data</span><span class="p">[</span><span class="s1">&#39;mslp&#39;</span><span class="p">])</span>
            <span class="n">T</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">storm_data</span><span class="p">[</span><span class="s1">&#39;type&#39;</span><span class="p">])</span>

            <span class="k">def</span> <span class="nf">get_color</span><span class="p">(</span><span class="n">itype</span><span class="p">):</span>
                <span class="k">if</span> <span class="n">itype</span> <span class="ow">in</span> <span class="n">constants</span><span class="o">.</span><span class="n">TROPICAL_STORM_TYPES</span><span class="p">:</span>
                    <span class="k">return</span> <span class="p">[</span><span class="s1">&#39;#00EE00&#39;</span><span class="p">,</span><span class="s1">&#39;palegreen&#39;</span><span class="p">]</span> <span class="c1">#lime</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="k">return</span> <span class="p">[</span><span class="s1">&#39;#00A600&#39;</span><span class="p">,</span><span class="s1">&#39;#3BD73B&#39;</span><span class="p">]</span>
                
            <span class="k">def</span> <span class="nf">getMarker</span><span class="p">(</span><span class="n">itype</span><span class="p">):</span>
                <span class="n">mtype</span> <span class="o">=</span> <span class="s1">&#39;^&#39;</span>
                <span class="k">if</span> <span class="n">itype</span> <span class="ow">in</span> <span class="n">constants</span><span class="o">.</span><span class="n">SUBTROPICAL_ONLY_STORM_TYPES</span><span class="p">:</span>
                    <span class="n">mtype</span> <span class="o">=</span> <span class="s1">&#39;s&#39;</span>
                <span class="k">elif</span> <span class="n">itype</span> <span class="ow">in</span> <span class="n">constants</span><span class="o">.</span><span class="n">TROPICAL_ONLY_STORM_TYPES</span><span class="p">:</span>
                    <span class="n">mtype</span> <span class="o">=</span> <span class="s1">&#39;o&#39;</span>
                <span class="k">return</span> <span class="n">mtype</span>
            
            <span class="n">xt_label</span> <span class="o">=</span> <span class="kc">False</span>
            <span class="n">tr_label</span> <span class="o">=</span> <span class="kc">False</span>
            <span class="k">for</span> <span class="n">i</span><span class="p">,(</span><span class="n">iv</span><span class="p">,</span><span class="n">ip</span><span class="p">,</span><span class="n">it</span><span class="p">)</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="nb">zip</span><span class="p">(</span><span class="n">V</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span><span class="n">P</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span><span class="n">T</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">])):</span>
                <span class="n">check</span> <span class="o">=</span> <span class="kc">False</span>
                <span class="k">if</span> <span class="n">it</span> <span class="ow">in</span> <span class="n">constants</span><span class="o">.</span><span class="n">TROPICAL_STORM_TYPES</span> <span class="ow">and</span> <span class="n">tr_label</span> <span class="o">==</span> <span class="kc">True</span><span class="p">:</span> <span class="n">check</span> <span class="o">=</span> <span class="kc">True</span>
                <span class="k">if</span> <span class="ow">not</span> <span class="n">it</span> <span class="ow">in</span> <span class="n">constants</span><span class="o">.</span><span class="n">TROPICAL_STORM_TYPES</span> <span class="ow">and</span> <span class="n">xt_label</span> <span class="o">==</span> <span class="kc">True</span><span class="p">:</span> <span class="n">check</span> <span class="o">=</span> <span class="kc">True</span>
                <span class="k">if</span> <span class="n">check</span><span class="p">:</span>
                    <span class="n">plt</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">iv</span><span class="p">,</span> <span class="n">ip</span><span class="p">,</span> <span class="n">marker</span><span class="o">=</span><span class="s1">&#39;o&#39;</span><span class="p">,</span><span class="n">s</span><span class="o">=</span><span class="mi">80</span><span class="p">,</span><span class="n">color</span><span class="o">=</span><span class="n">get_color</span><span class="p">(</span><span class="n">it</span><span class="p">)[</span><span class="mi">0</span><span class="p">],</span><span class="n">edgecolor</span><span class="o">=</span><span class="s1">&#39;k&#39;</span><span class="p">,</span><span class="n">zorder</span><span class="o">=</span><span class="mi">9</span><span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="k">if</span> <span class="n">it</span> <span class="ow">in</span> <span class="n">constants</span><span class="o">.</span><span class="n">TROPICAL_STORM_TYPES</span> <span class="ow">and</span> <span class="n">tr_label</span> <span class="o">==</span> <span class="kc">False</span><span class="p">:</span>
                        <span class="n">tr_label</span> <span class="o">=</span> <span class="kc">True</span>
                        <span class="n">label_content</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">storm_data</span><span class="p">[</span><span class="s1">&#39;name&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">title</span><span class="p">()</span><span class="si">}</span><span class="s2"> </span><span class="si">{</span><span class="n">storm_data</span><span class="p">[</span><span class="s1">&#39;year&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2"> (Tropical)&quot;</span>
                    <span class="k">if</span> <span class="n">it</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">constants</span><span class="o">.</span><span class="n">TROPICAL_STORM_TYPES</span> <span class="ow">and</span> <span class="n">xt_label</span> <span class="o">==</span> <span class="kc">False</span><span class="p">:</span>
                        <span class="n">xt_label</span> <span class="o">=</span> <span class="kc">True</span>
                        <span class="n">label_content</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">storm_data</span><span class="p">[</span><span class="s1">&#39;name&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">title</span><span class="p">()</span><span class="si">}</span><span class="s2"> </span><span class="si">{</span><span class="n">storm_data</span><span class="p">[</span><span class="s1">&#39;year&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2"> (Non-Tropical)&quot;</span>
                    <span class="n">plt</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">iv</span><span class="p">,</span> <span class="n">ip</span><span class="p">,</span> <span class="n">marker</span><span class="o">=</span><span class="s1">&#39;o&#39;</span><span class="p">,</span><span class="n">s</span><span class="o">=</span><span class="mi">80</span><span class="p">,</span><span class="n">color</span><span class="o">=</span><span class="n">get_color</span><span class="p">(</span><span class="n">it</span><span class="p">)[</span><span class="mi">0</span><span class="p">],</span><span class="n">edgecolor</span><span class="o">=</span><span class="s1">&#39;k&#39;</span><span class="p">,</span><span class="n">label</span><span class="o">=</span><span class="n">label_content</span><span class="p">,</span><span class="n">zorder</span><span class="o">=</span><span class="mi">9</span><span class="p">)</span>
            
            <span class="n">plt</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">V</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span> <span class="n">P</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span> <span class="n">marker</span><span class="o">=</span><span class="s1">&#39;D&#39;</span><span class="p">,</span><span class="n">s</span><span class="o">=</span><span class="mi">80</span><span class="p">,</span><span class="n">color</span><span class="o">=</span><span class="n">get_color</span><span class="p">(</span><span class="n">it</span><span class="p">)[</span><span class="mi">0</span><span class="p">],</span><span class="n">edgecolor</span><span class="o">=</span><span class="s1">&#39;k&#39;</span><span class="p">,</span><span class="n">linewidth</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span><span class="n">zorder</span><span class="o">=</span><span class="mi">9</span><span class="p">)</span>
            
            <span class="k">for</span> <span class="n">i</span><span class="p">,(</span><span class="n">iv</span><span class="p">,</span><span class="n">ip</span><span class="p">,</span><span class="n">it</span><span class="p">,</span><span class="n">mv</span><span class="p">,</span><span class="n">mp</span><span class="p">,</span><span class="n">mt</span><span class="p">)</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="nb">zip</span><span class="p">(</span><span class="n">V</span><span class="p">[</span><span class="mi">1</span><span class="p">:],</span><span class="n">P</span><span class="p">[</span><span class="mi">1</span><span class="p">:],</span><span class="n">T</span><span class="p">[</span><span class="mi">1</span><span class="p">:],</span><span class="n">V</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span><span class="n">P</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span><span class="n">T</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">])):</span>
                <span class="n">plt</span><span class="o">.</span><span class="n">quiver</span><span class="p">(</span><span class="n">mv</span><span class="p">,</span> <span class="n">mp</span><span class="p">,</span> <span class="n">iv</span><span class="o">-</span><span class="n">mv</span><span class="p">,</span> <span class="n">ip</span><span class="o">-</span><span class="n">mp</span><span class="p">,</span> <span class="n">scale_units</span><span class="o">=</span><span class="s1">&#39;xy&#39;</span><span class="p">,</span> <span class="n">angles</span><span class="o">=</span><span class="s1">&#39;xy&#39;</span><span class="p">,</span>
                           <span class="n">scale</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">width</span><span class="o">=</span><span class="mf">0.005</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="n">get_color</span><span class="p">(</span><span class="n">it</span><span class="p">)[</span><span class="mi">1</span><span class="p">],</span><span class="n">zorder</span><span class="o">=</span><span class="mi">8</span><span class="p">)</span>
            
            <span class="c1">#Add legend</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">loc</span><span class="o">=</span><span class="s1">&#39;upper right&#39;</span><span class="p">,</span><span class="n">scatterpoints</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span><span class="n">prop</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;weight&#39;</span><span class="p">:</span><span class="s1">&#39;bold&#39;</span><span class="p">,</span><span class="s1">&#39;size&#39;</span><span class="p">:</span><span class="mi">14</span><span class="p">})</span>
            
        
        <span class="c1">#Additional plot settings</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">&#39;Maximum sustained winds (kt)&#39;</span><span class="p">,</span><span class="n">fontsize</span><span class="o">=</span><span class="mi">14</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;Minimum central pressure (hPa)&#39;</span><span class="p">,</span><span class="n">fontsize</span><span class="o">=</span><span class="mi">14</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;TC Pressure vs. Wind </span><span class="se">\n</span><span class="s2"> </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">basin</span><span class="o">.</span><span class="n">title</span><span class="p">()</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;_&#39;</span><span class="p">,</span><span class="s1">&#39; &#39;</span><span class="p">)</span><span class="si">}</span><span class="s2"> | &quot;</span><span class="o">+</span>\
                  <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">start_year</span><span class="si">}</span><span class="s2">-</span><span class="si">{</span><span class="n">end_year</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span><span class="n">fontsize</span><span class="o">=</span><span class="mi">18</span><span class="p">,</span><span class="n">fontweight</span><span class="o">=</span><span class="s1">&#39;bold&#39;</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">xticks</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">20</span><span class="p">,</span><span class="mi">200</span><span class="p">,</span><span class="mi">20</span><span class="p">))</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">yticks</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">880</span><span class="p">,</span><span class="mi">1040</span><span class="p">,</span><span class="mi">20</span><span class="p">))</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">tick_params</span><span class="p">(</span><span class="n">labelsize</span><span class="o">=</span><span class="mi">14</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">grid</span><span class="p">()</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">axis</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span><span class="mi">200</span><span class="p">,</span><span class="mi">860</span><span class="p">,</span><span class="mi">1040</span><span class="p">])</span>
        <span class="n">cbar</span><span class="o">=</span><span class="n">fig</span><span class="o">.</span><span class="n">colorbar</span><span class="p">(</span><span class="n">CS</span><span class="p">)</span>
        <span class="n">cbar</span><span class="o">.</span><span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;Historical Frequency&#39;</span><span class="p">,</span><span class="n">fontsize</span><span class="o">=</span><span class="mi">14</span><span class="p">)</span>
        <span class="n">cbar</span><span class="o">.</span><span class="n">ax</span><span class="o">.</span><span class="n">tick_params</span><span class="p">(</span><span class="n">labelsize</span><span class="o">=</span><span class="mi">14</span><span class="p">)</span>
        <span class="n">cbar</span><span class="o">.</span><span class="n">set_ticks</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">i</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">5</span><span class="p">,</span><span class="mi">50</span><span class="p">,</span><span class="mi">200</span><span class="p">,</span><span class="mi">500</span><span class="p">,</span><span class="mi">1000</span><span class="p">,</span><span class="mi">2000</span><span class="p">]</span> <span class="k">if</span> <span class="n">i</span><span class="o">&lt;</span><span class="n">np</span><span class="o">.</span><span class="n">amax</span><span class="p">(</span><span class="n">counts</span><span class="p">)])</span><span class="o">**</span><span class="mf">0.3</span><span class="p">,</span> <span class="n">update_ticks</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="n">cbar</span><span class="o">.</span><span class="n">set_ticklabels</span><span class="p">([</span><span class="n">i</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">5</span><span class="p">,</span><span class="mi">50</span><span class="p">,</span><span class="mi">200</span><span class="p">,</span><span class="mi">500</span><span class="p">,</span><span class="mi">1000</span><span class="p">,</span><span class="mi">2000</span><span class="p">]</span> <span class="k">if</span> <span class="n">i</span><span class="o">&lt;</span><span class="n">np</span><span class="o">.</span><span class="n">amax</span><span class="p">(</span><span class="n">counts</span><span class="p">)],</span> <span class="n">update_ticks</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

        <span class="c1">#add credit</span>
        <span class="n">credit_text</span> <span class="o">=</span> <span class="n">Plot</span><span class="p">()</span><span class="o">.</span><span class="n">plot_credit</span><span class="p">()</span>        
        <span class="n">plt</span><span class="o">.</span><span class="n">text</span><span class="p">(</span><span class="mf">0.99</span><span class="p">,</span><span class="mf">0.01</span><span class="p">,</span><span class="n">credit_text</span><span class="p">,</span><span class="n">fontsize</span><span class="o">=</span><span class="mi">9</span><span class="p">,</span><span class="n">color</span><span class="o">=</span><span class="s1">&#39;k&#39;</span><span class="p">,</span><span class="n">alpha</span><span class="o">=</span><span class="mf">0.7</span><span class="p">,</span><span class="n">backgroundcolor</span><span class="o">=</span><span class="s1">&#39;w&#39;</span><span class="p">,</span>\
                <span class="n">transform</span><span class="o">=</span><span class="n">plt</span><span class="o">.</span><span class="n">gca</span><span class="p">()</span><span class="o">.</span><span class="n">transAxes</span><span class="p">,</span><span class="n">ha</span><span class="o">=</span><span class="s1">&#39;right&#39;</span><span class="p">,</span><span class="n">va</span><span class="o">=</span><span class="s1">&#39;bottom&#39;</span><span class="p">,</span><span class="n">zorder</span><span class="o">=</span><span class="mi">10</span><span class="p">)</span>        
        
        <span class="c1">#Show/save plot and close</span>
        <span class="k">if</span> <span class="n">save_path</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">save_path</span><span class="p">,</span><span class="nb">str</span><span class="p">):</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="n">save_path</span><span class="p">,</span><span class="n">bbox_inches</span><span class="o">=</span><span class="s1">&#39;tight&#39;</span><span class="p">)</span>
        
        <span class="k">if</span> <span class="n">return_dict</span><span class="p">:</span>
            <span class="k">return</span> <span class="p">{</span><span class="s1">&#39;ax&#39;</span><span class="p">:</span><span class="n">ax</span><span class="p">,</span><span class="s1">&#39;data&#39;</span><span class="p">:</span><span class="n">relationship</span><span class="p">}</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">ax</span></div>
    
<div class="viewcode-block" id="TrackDataset.rank_storm"><a class="viewcode-back" href="../../../api/generated/tropycal.tracks.TrackDataset.rank_storm.html#tropycal.tracks.TrackDataset.rank_storm">[docs]</a>    <span class="k">def</span> <span class="nf">rank_storm</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">metric</span><span class="p">,</span><span class="n">return_df</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span><span class="n">ascending</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span><span class="n">domain</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span><span class="n">year_range</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span><span class="n">date_range</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span><span class="n">subtropical</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
        
        <span class="sa">r</span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Ranks storm by a specified metric.</span>
<span class="sd">        </span>
<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        metric : str</span>
<span class="sd">            Metric to rank storms by. Can be any of the following:</span>
<span class="sd">            </span>
<span class="sd">            * **ace** = rank storms by ACE</span>
<span class="sd">            * **start_lat** = starting latitude of cyclone</span>
<span class="sd">            * **start_lon** = starting longitude of cyclone</span>
<span class="sd">            * **end_lat** = ending latitude of cyclone</span>
<span class="sd">            * **end_lon** = ending longitude of cyclone</span>
<span class="sd">            * **start_date** = formation date of cyclone</span>
<span class="sd">            * **start_date_indomain** = first time step a cyclone entered the domain</span>
<span class="sd">            * **max_wind** = first instance of the maximum sustained wind of cyclone</span>
<span class="sd">            * **min_mslp** = first instance of the minimum MSLP of cyclone</span>
<span class="sd">            * **wind_ge_XX** = first instance of wind greater than/equal to a certain threshold (knots)</span>
<span class="sd">        return_df : bool</span>
<span class="sd">            Whether to return a pandas.DataFrame (True) or dict (False). Default is True.</span>
<span class="sd">        ascending : bool</span>
<span class="sd">            Whether to return rank in ascending order (True) or descending order (False). Default is False.</span>
<span class="sd">        domain : str</span>
<span class="sd">            Geographic domain. Default is entire basin. Please refer to :ref:`options-domain` for available domain options.</span>
<span class="sd">        year_range : list or tuple</span>
<span class="sd">            List or tuple representing the start and end years (e.g., (1950,2018)). Default is start and end years of dataset.</span>
<span class="sd">        date_range : list or tuple</span>
<span class="sd">            List or tuple representing the start and end dates in &#39;month/day&#39; format (e.g., (6/1,8/15)). Default is entire year.</span>
<span class="sd">        subtropical : bool</span>
<span class="sd">            Whether to include subtropical storms in the ranking. Default is True.</span>
<span class="sd">        </span>
<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        pandas.DataFrame</span>
<span class="sd">            Returns a pandas DataFrame containing ranked storms. If pandas is not installed, a dict will be returned instead.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">source</span> <span class="o">==</span> <span class="s1">&#39;ibtracs&#39;</span><span class="p">:</span>
            <span class="n">warnings</span><span class="o">.</span><span class="n">warn</span><span class="p">(</span><span class="s2">&quot;This function is not currently configured to work for the ibtracs dataset.&quot;</span><span class="p">)</span>
        
        <span class="c1">#Revise metric if threshold included</span>
        <span class="k">if</span> <span class="s1">&#39;wind_ge&#39;</span> <span class="ow">in</span> <span class="n">metric</span><span class="p">:</span>
            <span class="n">thresh</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">metric</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;_&quot;</span><span class="p">)[</span><span class="mi">2</span><span class="p">])</span>
            <span class="n">metric</span> <span class="o">=</span> <span class="s1">&#39;wind_ge&#39;</span>
        
        <span class="c1">#Error check for metric</span>
        <span class="n">metric</span> <span class="o">=</span> <span class="n">metric</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span>
        <span class="n">metric_bank</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;ace&#39;</span><span class="p">:{</span><span class="s1">&#39;output&#39;</span><span class="p">:[</span><span class="s1">&#39;ace&#39;</span><span class="p">],</span><span class="s1">&#39;subset_type&#39;</span><span class="p">:</span><span class="s1">&#39;domain&#39;</span><span class="p">},</span>
                       <span class="s1">&#39;start_lat&#39;</span><span class="p">:{</span><span class="s1">&#39;output&#39;</span><span class="p">:[</span><span class="s1">&#39;lat&#39;</span><span class="p">,</span><span class="s1">&#39;lon&#39;</span><span class="p">,</span><span class="s1">&#39;type&#39;</span><span class="p">],</span><span class="s1">&#39;subset_type&#39;</span><span class="p">:</span><span class="s1">&#39;start&#39;</span><span class="p">},</span>
                       <span class="s1">&#39;start_lon&#39;</span><span class="p">:{</span><span class="s1">&#39;output&#39;</span><span class="p">:[</span><span class="s1">&#39;lon&#39;</span><span class="p">,</span><span class="s1">&#39;lat&#39;</span><span class="p">,</span><span class="s1">&#39;type&#39;</span><span class="p">],</span><span class="s1">&#39;subset_type&#39;</span><span class="p">:</span><span class="s1">&#39;start&#39;</span><span class="p">},</span>
                       <span class="s1">&#39;end_lat&#39;</span><span class="p">:{</span><span class="s1">&#39;output&#39;</span><span class="p">:[</span><span class="s1">&#39;lat&#39;</span><span class="p">,</span><span class="s1">&#39;lon&#39;</span><span class="p">,</span><span class="s1">&#39;type&#39;</span><span class="p">],</span><span class="s1">&#39;subset_type&#39;</span><span class="p">:</span><span class="s1">&#39;end&#39;</span><span class="p">},</span>
                       <span class="s1">&#39;end_lon&#39;</span><span class="p">:{</span><span class="s1">&#39;output&#39;</span><span class="p">:[</span><span class="s1">&#39;lon&#39;</span><span class="p">,</span><span class="s1">&#39;lat&#39;</span><span class="p">,</span><span class="s1">&#39;type&#39;</span><span class="p">],</span><span class="s1">&#39;subset_type&#39;</span><span class="p">:</span><span class="s1">&#39;end&#39;</span><span class="p">},</span>
                       <span class="s1">&#39;start_date&#39;</span><span class="p">:{</span><span class="s1">&#39;output&#39;</span><span class="p">:[</span><span class="s1">&#39;date&#39;</span><span class="p">,</span><span class="s1">&#39;lat&#39;</span><span class="p">,</span><span class="s1">&#39;lon&#39;</span><span class="p">,</span><span class="s1">&#39;type&#39;</span><span class="p">],</span><span class="s1">&#39;subset_type&#39;</span><span class="p">:</span><span class="s1">&#39;start&#39;</span><span class="p">},</span>
                       <span class="s1">&#39;start_date_indomain&#39;</span><span class="p">:{</span><span class="s1">&#39;output&#39;</span><span class="p">:[</span><span class="s1">&#39;date&#39;</span><span class="p">,</span><span class="s1">&#39;lat&#39;</span><span class="p">,</span><span class="s1">&#39;lon&#39;</span><span class="p">,</span><span class="s1">&#39;type&#39;</span><span class="p">],</span><span class="s1">&#39;subset_type&#39;</span><span class="p">:</span><span class="s1">&#39;domain&#39;</span><span class="p">},</span>
                       <span class="s1">&#39;max_wind&#39;</span><span class="p">:{</span><span class="s1">&#39;output&#39;</span><span class="p">:[</span><span class="s1">&#39;vmax&#39;</span><span class="p">,</span><span class="s1">&#39;mslp&#39;</span><span class="p">,</span><span class="s1">&#39;lat&#39;</span><span class="p">,</span><span class="s1">&#39;lon&#39;</span><span class="p">],</span><span class="s1">&#39;subset_type&#39;</span><span class="p">:</span><span class="s1">&#39;domain&#39;</span><span class="p">},</span>
                       <span class="s1">&#39;min_mslp&#39;</span><span class="p">:{</span><span class="s1">&#39;output&#39;</span><span class="p">:[</span><span class="s1">&#39;mslp&#39;</span><span class="p">,</span><span class="s1">&#39;vmax&#39;</span><span class="p">,</span><span class="s1">&#39;lat&#39;</span><span class="p">,</span><span class="s1">&#39;lon&#39;</span><span class="p">],</span><span class="s1">&#39;subset_type&#39;</span><span class="p">:</span><span class="s1">&#39;domain&#39;</span><span class="p">},</span>
                       <span class="s1">&#39;wind_ge&#39;</span><span class="p">:{</span><span class="s1">&#39;output&#39;</span><span class="p">:[</span><span class="s1">&#39;lat&#39;</span><span class="p">,</span><span class="s1">&#39;lon&#39;</span><span class="p">,</span><span class="s1">&#39;mslp&#39;</span><span class="p">,</span><span class="s1">&#39;vmax&#39;</span><span class="p">,</span><span class="s1">&#39;date&#39;</span><span class="p">],</span><span class="s1">&#39;subset_type&#39;</span><span class="p">:</span><span class="s1">&#39;start&#39;</span><span class="p">},</span>
                      <span class="p">}</span>
        <span class="k">if</span> <span class="n">metric</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">metric_bank</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Metric requested for sorting is not available. Please reference the documentation for acceptable entries for &#39;metric&#39;.&quot;</span><span class="p">)</span>
        
        <span class="c1">#Determine year range of dataset</span>
        <span class="k">if</span> <span class="n">year_range</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">start_year</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">keys</span><span class="p">[</span><span class="mi">0</span><span class="p">]][</span><span class="s1">&#39;year&#39;</span><span class="p">]</span>
            <span class="n">end_year</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">keys</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]][</span><span class="s1">&#39;year&#39;</span><span class="p">]</span>
        <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">year_range</span><span class="p">,(</span><span class="nb">list</span><span class="p">,</span><span class="nb">tuple</span><span class="p">)):</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">year_range</span><span class="p">)</span> <span class="o">!=</span> <span class="mi">2</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;year_range must be a tuple or list with 2 elements: (start_year, end_year)&quot;</span><span class="p">)</span>
            <span class="n">start_year</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">year_range</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
            <span class="n">end_year</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">year_range</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s2">&quot;year_range must be of type tuple or list&quot;</span><span class="p">)</span>
            
        <span class="c1">#Initialize empty dict</span>
        <span class="n">analyze_list</span> <span class="o">=</span> <span class="n">metric_bank</span><span class="p">[</span><span class="n">metric</span><span class="p">][</span><span class="s1">&#39;output&#39;</span><span class="p">]</span>
        <span class="n">analyze_list</span><span class="o">.</span><span class="n">insert</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="s1">&#39;id&#39;</span><span class="p">);</span> <span class="n">analyze_list</span><span class="o">.</span><span class="n">insert</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span><span class="s1">&#39;name&#39;</span><span class="p">);</span> <span class="n">analyze_list</span><span class="o">.</span><span class="n">insert</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span><span class="s1">&#39;year&#39;</span><span class="p">);</span>
        <span class="n">analyze_dict</span> <span class="o">=</span> <span class="p">{</span><span class="n">key</span><span class="p">:[]</span> <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="n">analyze_list</span><span class="p">}</span>
            
        <span class="c1">#Iterate over every storm in dataset</span>
        <span class="k">for</span> <span class="n">storm</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">keys</span><span class="p">:</span>
            
            <span class="c1">#Get entry for this storm</span>
            <span class="n">storm_data</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="n">storm</span><span class="p">]</span>
            
            <span class="c1">#Filter by year</span>
            <span class="k">if</span> <span class="n">storm_data</span><span class="p">[</span><span class="s1">&#39;year&#39;</span><span class="p">]</span> <span class="o">&lt;</span> <span class="n">start_year</span> <span class="ow">or</span> <span class="n">storm_data</span><span class="p">[</span><span class="s1">&#39;year&#39;</span><span class="p">]</span> <span class="o">&gt;</span> <span class="n">end_year</span><span class="p">:</span> <span class="k">continue</span>
            
            <span class="c1">#Filter for purely tropical/subtropical storm locations</span>
            <span class="n">type_array</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">storm_data</span><span class="p">[</span><span class="s1">&#39;type&#39;</span><span class="p">])</span>
            <span class="k">if</span> <span class="n">subtropical</span><span class="p">:</span>
                <span class="n">idx</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">((</span><span class="n">type_array</span> <span class="o">==</span> <span class="s1">&#39;SD&#39;</span><span class="p">)</span> <span class="o">|</span> <span class="p">(</span><span class="n">type_array</span> <span class="o">==</span> <span class="s1">&#39;SS&#39;</span><span class="p">)</span> <span class="o">|</span> <span class="p">(</span><span class="n">type_array</span> <span class="o">==</span> <span class="s1">&#39;TD&#39;</span><span class="p">)</span> <span class="o">|</span> <span class="p">(</span><span class="n">type_array</span> <span class="o">==</span> <span class="s1">&#39;TS&#39;</span><span class="p">)</span> <span class="o">|</span> <span class="p">(</span><span class="n">type_array</span> <span class="o">==</span> <span class="s1">&#39;HU&#39;</span><span class="p">))</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">idx</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">((</span><span class="n">type_array</span> <span class="o">==</span> <span class="s1">&#39;TD&#39;</span><span class="p">)</span> <span class="o">|</span> <span class="p">(</span><span class="n">type_array</span> <span class="o">==</span> <span class="s1">&#39;TS&#39;</span><span class="p">)</span> <span class="o">|</span> <span class="p">(</span><span class="n">type_array</span> <span class="o">==</span> <span class="s1">&#39;HU&#39;</span><span class="p">))</span>
            
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">idx</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span> <span class="k">continue</span>
            <span class="n">lat_tropical</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">storm_data</span><span class="p">[</span><span class="s1">&#39;lat&#39;</span><span class="p">])[</span><span class="n">idx</span><span class="p">]</span>
            <span class="n">lon_tropical</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">storm_data</span><span class="p">[</span><span class="s1">&#39;lon&#39;</span><span class="p">])[</span><span class="n">idx</span><span class="p">]</span>
            <span class="n">date_tropical</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">storm_data</span><span class="p">[</span><span class="s1">&#39;date&#39;</span><span class="p">])[</span><span class="n">idx</span><span class="p">]</span>
            <span class="n">type_tropical</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">storm_data</span><span class="p">[</span><span class="s1">&#39;type&#39;</span><span class="p">])[</span><span class="n">idx</span><span class="p">]</span>
            <span class="n">vmax_tropical</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">storm_data</span><span class="p">[</span><span class="s1">&#39;vmax&#39;</span><span class="p">])[</span><span class="n">idx</span><span class="p">]</span>
            <span class="n">mslp_tropical</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">storm_data</span><span class="p">[</span><span class="s1">&#39;mslp&#39;</span><span class="p">])[</span><span class="n">idx</span><span class="p">]</span>
            <span class="n">basin_tropical</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">storm_data</span><span class="p">[</span><span class="s1">&#39;wmo_basin&#39;</span><span class="p">])[</span><span class="n">idx</span><span class="p">]</span>
            
            <span class="c1">#Filter geographically</span>
            <span class="k">if</span> <span class="n">domain</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">domain</span><span class="p">,</span><span class="nb">dict</span><span class="p">):</span>
                    <span class="n">keys</span> <span class="o">=</span> <span class="n">domain</span><span class="o">.</span><span class="n">keys</span><span class="p">()</span>
                    <span class="n">check</span> <span class="o">=</span> <span class="p">[</span><span class="kc">False</span><span class="p">,</span> <span class="kc">False</span><span class="p">,</span> <span class="kc">False</span><span class="p">,</span> <span class="kc">False</span><span class="p">]</span>
                    <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="n">keys</span><span class="p">:</span>
                        <span class="k">if</span> <span class="n">key</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="o">==</span> <span class="s1">&#39;n&#39;</span><span class="p">:</span> <span class="n">check</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="kc">True</span><span class="p">;</span> <span class="n">bound_n</span> <span class="o">=</span> <span class="n">domain</span><span class="p">[</span><span class="n">key</span><span class="p">]</span>
                        <span class="k">if</span> <span class="n">key</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="o">==</span> <span class="s1">&#39;s&#39;</span><span class="p">:</span> <span class="n">check</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="kc">True</span><span class="p">;</span> <span class="n">bound_s</span> <span class="o">=</span> <span class="n">domain</span><span class="p">[</span><span class="n">key</span><span class="p">]</span>
                        <span class="k">if</span> <span class="n">key</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="o">==</span> <span class="s1">&#39;e&#39;</span><span class="p">:</span> <span class="n">check</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">=</span> <span class="kc">True</span><span class="p">;</span> <span class="n">bound_e</span> <span class="o">=</span> <span class="n">domain</span><span class="p">[</span><span class="n">key</span><span class="p">]</span>
                        <span class="k">if</span> <span class="n">key</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="o">==</span> <span class="s1">&#39;w&#39;</span><span class="p">:</span> <span class="n">check</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span> <span class="o">=</span> <span class="kc">True</span><span class="p">;</span> <span class="n">bound_w</span> <span class="o">=</span> <span class="n">domain</span><span class="p">[</span><span class="n">key</span><span class="p">]</span>
                    <span class="k">if</span> <span class="kc">False</span> <span class="ow">in</span> <span class="n">check</span><span class="p">:</span>
                        <span class="n">msg</span> <span class="o">=</span> <span class="s2">&quot;Custom domains must be of type dict with arguments for &#39;n&#39;, &#39;s&#39;, &#39;e&#39; and &#39;w&#39;.&quot;</span>
                        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>
                    <span class="n">idx</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">((</span><span class="n">lat_tropical</span> <span class="o">&gt;=</span> <span class="n">bound_s</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">lat_tropical</span> <span class="o">&lt;=</span> <span class="n">bound_n</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">lon_tropical</span> <span class="o">&gt;=</span> <span class="n">bound_w</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">lon_tropical</span> <span class="o">&lt;=</span> <span class="n">bound_e</span><span class="p">))</span>
                <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">domain</span><span class="p">,</span><span class="nb">str</span><span class="p">):</span>
                    <span class="n">idx</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">basin_tropical</span><span class="o">==</span><span class="n">domain</span><span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">msg</span> <span class="o">=</span> <span class="s2">&quot;domain must be of type str or dict.&quot;</span>
                    <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>
                <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">idx</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span> <span class="k">continue</span>
                
                <span class="c1">#Check for subset type</span>
                <span class="n">subset_type</span> <span class="o">=</span> <span class="n">metric_bank</span><span class="p">[</span><span class="n">metric</span><span class="p">][</span><span class="s1">&#39;subset_type&#39;</span><span class="p">]</span>
                <span class="k">if</span> <span class="n">subset_type</span> <span class="o">==</span> <span class="s1">&#39;domain&#39;</span><span class="p">:</span>
                    <span class="n">lat_tropical</span> <span class="o">=</span> <span class="n">lat_tropical</span><span class="p">[</span><span class="n">idx</span><span class="p">]</span>
                    <span class="n">lon_tropical</span> <span class="o">=</span> <span class="n">lon_tropical</span><span class="p">[</span><span class="n">idx</span><span class="p">]</span>
                    <span class="n">date_tropical</span> <span class="o">=</span> <span class="n">date_tropical</span><span class="p">[</span><span class="n">idx</span><span class="p">]</span>
                    <span class="n">type_tropical</span> <span class="o">=</span> <span class="n">type_tropical</span><span class="p">[</span><span class="n">idx</span><span class="p">]</span>
                    <span class="n">vmax_tropical</span> <span class="o">=</span> <span class="n">vmax_tropical</span><span class="p">[</span><span class="n">idx</span><span class="p">]</span>
                    <span class="n">mslp_tropical</span> <span class="o">=</span> <span class="n">mslp_tropical</span><span class="p">[</span><span class="n">idx</span><span class="p">]</span>
                    <span class="n">basin_tropical</span> <span class="o">=</span> <span class="n">basin_tropical</span><span class="p">[</span><span class="n">idx</span><span class="p">]</span>
            
            <span class="c1">#Filter by time</span>
            <span class="k">if</span> <span class="n">date_range</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">start_time</span> <span class="o">=</span> <span class="n">dt</span><span class="o">.</span><span class="n">strptime</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">storm_data</span><span class="p">[</span><span class="s1">&#39;year&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2">/</span><span class="si">{</span><span class="n">date_range</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span><span class="s1">&#39;%Y/%m/</span><span class="si">%d</span><span class="s1">&#39;</span><span class="p">)</span>
                <span class="n">end_time</span> <span class="o">=</span> <span class="n">dt</span><span class="o">.</span><span class="n">strptime</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">storm_data</span><span class="p">[</span><span class="s1">&#39;year&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2">/</span><span class="si">{</span><span class="n">date_range</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span><span class="s1">&#39;%Y/%m/</span><span class="si">%d</span><span class="s1">&#39;</span><span class="p">)</span>
                <span class="n">idx</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">i</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">lat_tropical</span><span class="p">))</span> <span class="k">if</span> <span class="n">date_tropical</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">&gt;=</span> <span class="n">start_time</span> <span class="ow">and</span> <span class="n">date_tropical</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">&lt;=</span> <span class="n">end_time</span><span class="p">])</span>
                <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">idx</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span> <span class="k">continue</span>
                
                <span class="c1">#Check for subset type</span>
                <span class="n">subset_type</span> <span class="o">=</span> <span class="n">metric_bank</span><span class="p">[</span><span class="n">metric</span><span class="p">][</span><span class="s1">&#39;subset_type&#39;</span><span class="p">]</span>
                <span class="k">if</span> <span class="n">subset_type</span> <span class="o">==</span> <span class="s1">&#39;domain&#39;</span><span class="p">:</span>
                    <span class="n">lat_tropical</span> <span class="o">=</span> <span class="n">lat_tropical</span><span class="p">[</span><span class="n">idx</span><span class="p">]</span>
                    <span class="n">lon_tropical</span> <span class="o">=</span> <span class="n">lon_tropical</span><span class="p">[</span><span class="n">idx</span><span class="p">]</span>
                    <span class="n">date_tropical</span> <span class="o">=</span> <span class="n">date_tropical</span><span class="p">[</span><span class="n">idx</span><span class="p">]</span>
                    <span class="n">type_tropical</span> <span class="o">=</span> <span class="n">type_tropical</span><span class="p">[</span><span class="n">idx</span><span class="p">]</span>
                    <span class="n">vmax_tropical</span> <span class="o">=</span> <span class="n">vmax_tropical</span><span class="p">[</span><span class="n">idx</span><span class="p">]</span>
                    <span class="n">mslp_tropical</span> <span class="o">=</span> <span class="n">mslp_tropical</span><span class="p">[</span><span class="n">idx</span><span class="p">]</span>
                    <span class="n">basin_tropical</span> <span class="o">=</span> <span class="n">basin_tropical</span><span class="p">[</span><span class="n">idx</span><span class="p">]</span>
            
            <span class="c1">#Filter by requested metric</span>
            <span class="k">if</span> <span class="n">metric</span> <span class="o">==</span> <span class="s1">&#39;ace&#39;</span><span class="p">:</span>
                
                <span class="k">if</span> <span class="n">storm_data</span><span class="p">[</span><span class="s1">&#39;ace&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span> <span class="k">continue</span>
                <span class="n">analyze_dict</span><span class="p">[</span><span class="s1">&#39;ace&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">round</span><span class="p">(</span><span class="n">storm_data</span><span class="p">[</span><span class="s1">&#39;ace&#39;</span><span class="p">],</span><span class="mi">4</span><span class="p">))</span>
                
            <span class="k">elif</span> <span class="n">metric</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;start_lat&#39;</span><span class="p">,</span><span class="s1">&#39;end_lat&#39;</span><span class="p">,</span><span class="s1">&#39;start_lon&#39;</span><span class="p">,</span><span class="s1">&#39;end_lon&#39;</span><span class="p">]:</span>
                
                <span class="n">use_idx</span> <span class="o">=</span> <span class="mi">0</span> <span class="k">if</span> <span class="s1">&#39;start&#39;</span> <span class="ow">in</span> <span class="n">metric</span> <span class="k">else</span> <span class="o">-</span><span class="mi">1</span>
                <span class="n">analyze_dict</span><span class="p">[</span><span class="s1">&#39;lat&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">lat_tropical</span><span class="p">[</span><span class="n">use_idx</span><span class="p">])</span>
                <span class="n">analyze_dict</span><span class="p">[</span><span class="s1">&#39;lon&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">lon_tropical</span><span class="p">[</span><span class="n">use_idx</span><span class="p">])</span>
                <span class="n">analyze_dict</span><span class="p">[</span><span class="s1">&#39;type&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">type_tropical</span><span class="p">[</span><span class="n">use_idx</span><span class="p">])</span>
                
            <span class="k">elif</span> <span class="n">metric</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;start_date&#39;</span><span class="p">]:</span>
                
                <span class="n">analyze_dict</span><span class="p">[</span><span class="s1">&#39;lat&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">lat_tropical</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
                <span class="n">analyze_dict</span><span class="p">[</span><span class="s1">&#39;lon&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">lon_tropical</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
                <span class="n">analyze_dict</span><span class="p">[</span><span class="s1">&#39;type&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">type_tropical</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
                <span class="n">analyze_dict</span><span class="p">[</span><span class="s1">&#39;date&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">date_tropical</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="n">year</span><span class="o">=</span><span class="mi">2016</span><span class="p">))</span>
                
            <span class="k">elif</span> <span class="n">metric</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;max_wind&#39;</span><span class="p">,</span><span class="s1">&#39;min_mslp&#39;</span><span class="p">]:</span>
                
                <span class="c1">#Find max wind or min MSLP</span>
                <span class="k">if</span> <span class="n">metric</span> <span class="o">==</span> <span class="s1">&#39;max_wind&#39;</span> <span class="ow">and</span> <span class="n">all_nan</span><span class="p">(</span><span class="n">vmax_tropical</span><span class="p">)</span> <span class="o">==</span> <span class="kc">True</span><span class="p">:</span> <span class="k">continue</span>
                <span class="k">if</span> <span class="n">metric</span> <span class="o">==</span> <span class="s1">&#39;min_mslp&#39;</span> <span class="ow">and</span> <span class="n">all_nan</span><span class="p">(</span><span class="n">mslp_tropical</span><span class="p">)</span> <span class="o">==</span> <span class="kc">True</span><span class="p">:</span> <span class="k">continue</span>
                <span class="n">use_idx</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">vmax_tropical</span><span class="o">==</span><span class="n">np</span><span class="o">.</span><span class="n">nanmax</span><span class="p">(</span><span class="n">vmax_tropical</span><span class="p">))[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>
                <span class="k">if</span> <span class="n">metric</span> <span class="o">==</span> <span class="s1">&#39;min_mslp&#39;</span><span class="p">:</span> <span class="n">use_idx</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">mslp_tropical</span><span class="o">==</span><span class="n">np</span><span class="o">.</span><span class="n">nanmin</span><span class="p">(</span><span class="n">mslp_tropical</span><span class="p">))[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>
                
                <span class="n">analyze_dict</span><span class="p">[</span><span class="s1">&#39;lat&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">lat_tropical</span><span class="p">[</span><span class="n">use_idx</span><span class="p">])</span>
                <span class="n">analyze_dict</span><span class="p">[</span><span class="s1">&#39;lon&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">lon_tropical</span><span class="p">[</span><span class="n">use_idx</span><span class="p">])</span>
                <span class="n">analyze_dict</span><span class="p">[</span><span class="s1">&#39;mslp&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">mslp_tropical</span><span class="p">[</span><span class="n">use_idx</span><span class="p">])</span>
                <span class="n">analyze_dict</span><span class="p">[</span><span class="s1">&#39;vmax&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">vmax_tropical</span><span class="p">[</span><span class="n">use_idx</span><span class="p">])</span>
            
            <span class="k">elif</span> <span class="n">metric</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;wind_ge&#39;</span><span class="p">]:</span>
                
                <span class="c1">#Find max wind or min MSLP</span>
                <span class="k">if</span> <span class="n">metric</span> <span class="o">==</span> <span class="s1">&#39;wind_ge&#39;</span> <span class="ow">and</span> <span class="n">all_nan</span><span class="p">(</span><span class="n">vmax_tropical</span><span class="p">)</span> <span class="o">==</span> <span class="kc">True</span><span class="p">:</span> <span class="k">continue</span>
                <span class="k">if</span> <span class="n">metric</span> <span class="o">==</span> <span class="s1">&#39;wind_ge&#39;</span> <span class="ow">and</span> <span class="n">np</span><span class="o">.</span><span class="n">nanmax</span><span class="p">(</span><span class="n">vmax_tropical</span><span class="p">)</span> <span class="o">&lt;</span> <span class="n">thresh</span><span class="p">:</span> <span class="k">continue</span>
                <span class="n">use_idx</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">vmax_tropical</span><span class="o">&gt;=</span><span class="n">thresh</span><span class="p">)[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>
                
                <span class="n">analyze_dict</span><span class="p">[</span><span class="s1">&#39;lat&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">lat_tropical</span><span class="p">[</span><span class="n">use_idx</span><span class="p">])</span>
                <span class="n">analyze_dict</span><span class="p">[</span><span class="s1">&#39;lon&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">lon_tropical</span><span class="p">[</span><span class="n">use_idx</span><span class="p">])</span>
                <span class="n">analyze_dict</span><span class="p">[</span><span class="s1">&#39;date&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">date_tropical</span><span class="p">[</span><span class="n">use_idx</span><span class="p">])</span>
                <span class="n">analyze_dict</span><span class="p">[</span><span class="s1">&#39;mslp&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">mslp_tropical</span><span class="p">[</span><span class="n">use_idx</span><span class="p">])</span>
                <span class="n">analyze_dict</span><span class="p">[</span><span class="s1">&#39;vmax&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">vmax_tropical</span><span class="p">[</span><span class="n">use_idx</span><span class="p">])</span>
            
            <span class="c1">#Append generic storm attributes</span>
            <span class="n">analyze_dict</span><span class="p">[</span><span class="s1">&#39;id&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">storm</span><span class="p">)</span>
            <span class="n">analyze_dict</span><span class="p">[</span><span class="s1">&#39;name&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">storm_data</span><span class="p">[</span><span class="s1">&#39;name&#39;</span><span class="p">])</span>
            <span class="n">analyze_dict</span><span class="p">[</span><span class="s1">&#39;year&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">storm_data</span><span class="p">[</span><span class="s1">&#39;year&#39;</span><span class="p">]))</span>
            
        <span class="c1">#Error check</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">analyze_dict</span><span class="p">[</span><span class="n">analyze_list</span><span class="p">[</span><span class="mi">0</span><span class="p">]])</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span><span class="s2">&quot;No storms were found given the requested criteria.&quot;</span><span class="p">)</span>
        
        <span class="c1">#Sort in requested order</span>
        <span class="n">arg_idx</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">argsort</span><span class="p">(</span><span class="n">analyze_dict</span><span class="p">[</span><span class="n">analyze_list</span><span class="p">[</span><span class="mi">0</span><span class="p">]])</span>
        <span class="k">if</span> <span class="n">ascending</span> <span class="o">==</span> <span class="kc">False</span><span class="p">:</span> <span class="n">arg_idx</span> <span class="o">=</span> <span class="n">arg_idx</span><span class="p">[::</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
            
        <span class="c1">#Sort all variables in requested order</span>
        <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="n">analyze_dict</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
            <span class="n">analyze_dict</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">analyze_dict</span><span class="p">[</span><span class="n">key</span><span class="p">])[</span><span class="n">arg_idx</span><span class="p">])</span>
        
        <span class="c1">#Enter into new ranked dict</span>
        <span class="n">ranked_dict</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">analyze_dict</span><span class="p">[</span><span class="s1">&#39;id&#39;</span><span class="p">])):</span>
            <span class="n">ranked_dict</span><span class="p">[</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span><span class="n">key</span><span class="p">:</span><span class="n">analyze_dict</span><span class="p">[</span><span class="n">key</span><span class="p">][</span><span class="n">i</span><span class="p">]</span> <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="n">analyze_list</span><span class="p">}</span>
            <span class="k">if</span> <span class="s1">&#39;date&#39;</span> <span class="ow">in</span> <span class="n">ranked_dict</span><span class="p">[</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
                <span class="n">ranked_dict</span><span class="p">[</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">][</span><span class="s1">&#39;date&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">ranked_dict</span><span class="p">[</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">][</span><span class="s1">&#39;date&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="n">year</span><span class="o">=</span><span class="n">ranked_dict</span><span class="p">[</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">][</span><span class="s1">&#39;year&#39;</span><span class="p">])</span>
            
        <span class="c1">#Return ranked dictionary</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>
            <span class="k">return</span> <span class="p">(</span><span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">ranked_dict</span><span class="p">)</span><span class="o">.</span><span class="n">transpose</span><span class="p">())[</span><span class="n">analyze_list</span><span class="p">]</span>
        <span class="k">except</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">ranked_dict</span></div>
        
<div class="viewcode-block" id="TrackDataset.storm_ace_vs_season"><a class="viewcode-back" href="../../../api/generated/tropycal.tracks.TrackDataset.storm_ace_vs_season.html#tropycal.tracks.TrackDataset.storm_ace_vs_season">[docs]</a>    <span class="k">def</span> <span class="nf">storm_ace_vs_season</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">storm</span><span class="p">,</span><span class="n">year_range</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        
        <span class="sa">r</span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Retrives a list of entire hurricane seasons with lower ACE than the storm provided.</span>
<span class="sd">        </span>
<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        storm : str or tuple</span>
<span class="sd">            Storm to rank seasons against. Can be either string of storm ID (e.g., &quot;AL052019&quot;), or tuple with storm name and year (e.g., (&quot;Matthew&quot;,2016)).</span>
<span class="sd">        year_range : list or tuple</span>
<span class="sd">            List or tuple representing the start and end years (e.g., (1950,2018)). Default is 1950 through the last year in the dataset.</span>
<span class="sd">        </span>
<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        dict</span>
<span class="sd">            Dictionary containing the seasons with less ACE than the requested storm.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        
        <span class="c1">#Warning for ibtracs</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">source</span> <span class="o">==</span> <span class="s1">&#39;ibtracs&#39;</span><span class="p">:</span>
            <span class="n">warning_str</span> <span class="o">=</span> <span class="s2">&quot;This function is not currently configured to optimally work for the ibtracs dataset.&quot;</span>
            <span class="n">warnings</span><span class="o">.</span><span class="n">warn</span><span class="p">(</span><span class="n">warning_str</span><span class="p">)</span>

        <span class="c1">#Determine year range of dataset</span>
        <span class="k">if</span> <span class="n">year_range</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">start_year</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">keys</span><span class="p">[</span><span class="mi">0</span><span class="p">]][</span><span class="s1">&#39;year&#39;</span><span class="p">]</span>
            <span class="k">if</span> <span class="n">start_year</span> <span class="o">&lt;</span> <span class="mi">1950</span><span class="p">:</span> <span class="n">start_year</span> <span class="o">=</span> <span class="mi">1950</span>
            <span class="n">end_year</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">keys</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]][</span><span class="s1">&#39;year&#39;</span><span class="p">]</span>
        <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">year_range</span><span class="p">,(</span><span class="nb">list</span><span class="p">,</span><span class="nb">tuple</span><span class="p">)):</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">year_range</span><span class="p">)</span> <span class="o">!=</span> <span class="mi">2</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;year_range must be a tuple or list with 2 elements: (start_year, end_year)&quot;</span><span class="p">)</span>
            <span class="n">start_year</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">year_range</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
            <span class="k">if</span> <span class="n">start_year</span> <span class="o">&lt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">keys</span><span class="p">[</span><span class="mi">0</span><span class="p">]][</span><span class="s1">&#39;year&#39;</span><span class="p">]:</span> <span class="n">start_year</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">keys</span><span class="p">[</span><span class="mi">0</span><span class="p">]][</span><span class="s1">&#39;year&#39;</span><span class="p">]</span>
            <span class="n">end_year</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">year_range</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
            <span class="k">if</span> <span class="n">end_year</span> <span class="o">&gt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">keys</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]][</span><span class="s1">&#39;year&#39;</span><span class="p">]:</span> <span class="n">end_year</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">keys</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]][</span><span class="s1">&#39;year&#39;</span><span class="p">]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s2">&quot;year_range must be of type tuple or list&quot;</span><span class="p">)</span>
            
        <span class="c1">#Check if storm is str or tuple</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">storm</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
            <span class="k">pass</span>
        <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">storm</span><span class="p">,</span> <span class="nb">tuple</span><span class="p">):</span>
            <span class="n">storm</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_storm_id</span><span class="p">((</span><span class="n">storm</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span><span class="n">storm</span><span class="p">[</span><span class="mi">1</span><span class="p">]))</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span><span class="s2">&quot;Storm must be a string (e.g., &#39;AL052019&#39;) or tuple (e.g., (&#39;Matthew&#39;,2016)).&quot;</span><span class="p">)</span>
            
        <span class="c1">#Get ACE for this storm</span>
        <span class="n">storm_data</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="n">storm</span><span class="p">]</span>
        
        <span class="c1">#Retrieve ACE for this event</span>
        <span class="n">storm_name</span> <span class="o">=</span> <span class="n">storm_data</span><span class="p">[</span><span class="s1">&#39;name&#39;</span><span class="p">]</span>
        <span class="n">storm_year</span> <span class="o">=</span> <span class="n">storm_data</span><span class="p">[</span><span class="s1">&#39;year&#39;</span><span class="p">]</span>
        <span class="n">storm_ace</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">round</span><span class="p">(</span><span class="n">storm_data</span><span class="p">[</span><span class="s1">&#39;ace&#39;</span><span class="p">],</span><span class="mi">4</span><span class="p">)</span>
        
        <span class="c1">#Initialize empty dict</span>
        <span class="n">ace_rank</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;year&#39;</span><span class="p">:[],</span><span class="s1">&#39;ace&#39;</span><span class="p">:[]}</span>
            
        <span class="c1">#Iterate over every season</span>
        <span class="k">for</span> <span class="n">year</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">start_year</span><span class="p">,</span><span class="n">end_year</span><span class="o">+</span><span class="mi">1</span><span class="p">):</span>
            <span class="n">season</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_season</span><span class="p">(</span><span class="n">year</span><span class="p">)</span>
            <span class="n">year_data</span> <span class="o">=</span> <span class="n">season</span><span class="o">.</span><span class="n">summary</span><span class="p">()</span>
            <span class="n">year_ace</span> <span class="o">=</span> <span class="n">year_data</span><span class="p">[</span><span class="s1">&#39;season_ace&#39;</span><span class="p">]</span>
            
            <span class="c1">#Compare year ACE against storm ACE</span>
            <span class="k">if</span> <span class="n">year_ace</span> <span class="o">&lt;</span> <span class="n">storm_ace</span><span class="p">:</span>
                
                <span class="n">ace_rank</span><span class="p">[</span><span class="s1">&#39;year&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">year</span><span class="p">)</span>
                <span class="n">ace_rank</span><span class="p">[</span><span class="s1">&#39;ace&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">year_ace</span><span class="p">)</span>
                
        <span class="k">return</span> <span class="n">ace_rank</span></div>

<div class="viewcode-block" id="TrackDataset.filter_storms"><a class="viewcode-back" href="../../../api/generated/tropycal.tracks.TrackDataset.filter_storms.html#tropycal.tracks.TrackDataset.filter_storms">[docs]</a>    <span class="k">def</span> <span class="nf">filter_storms</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">storm</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span><span class="n">year_range</span><span class="o">=</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">9999</span><span class="p">),</span><span class="n">date_range</span><span class="o">=</span><span class="p">(</span><span class="s1">&#39;1/1&#39;</span><span class="p">,</span><span class="s1">&#39;12/31&#39;</span><span class="p">),</span><span class="n">thresh</span><span class="o">=</span><span class="p">{},</span><span class="n">domain</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span><span class="n">interpolate_data</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span><span class="n">return_keys</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
        
        <span class="sa">r</span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Filters all storms by various thresholds.</span>
<span class="sd">        </span>
<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        year_range : list or tuple</span>
<span class="sd">            List or tuple representing the start and end years (e.g., (1950,2018)). Default is start and end years of dataset.</span>
<span class="sd">        date_range : list or tuple</span>
<span class="sd">            List or tuple representing the start and end dates as a string in &#39;month/day&#39; format (e.g., (&#39;6/1&#39;,&#39;8/15&#39;)). Default is (&#39;1/1&#39;,&#39;12/31&#39;) or full year.</span>
<span class="sd">        thresh : dict</span>
<span class="sd">            Keywords include:</span>
<span class="sd">                </span>
<span class="sd">            * **sample_min** - minimum number of storms in a grid box for the cmd_request to be applied. For the functions &#39;percentile&#39; and &#39;average&#39;, &#39;sample_min&#39; defaults to 5 and will override any value less than 5.</span>
<span class="sd">            * **v_min** - minimum wind for a given point to be included in the cmd_request.</span>
<span class="sd">            * **p_max** - maximum pressure for a given point to be included in the cmd_request.</span>
<span class="sd">            * **dv_min** - minimum change in wind over dt_window for a given point to be included in the cmd_request.</span>
<span class="sd">            * **dp_max** - maximum change in pressure over dt_window for a given point to be included in the cmd_request.</span>
<span class="sd">            * **dt_window** - time window over which change variables are calculated (hours). Default is 24.</span>
<span class="sd">            * **dt_align** - alignment of dt_window for change variables -- &#39;start&#39;,&#39;middle&#39;,&#39;end&#39; -- e.g. &#39;end&#39; for dt_window=24 associates a TC point with change over the past 24 hours. Default is middle.</span>
<span class="sd">            </span>
<span class="sd">            Units of all wind variables = kt, and pressure variables = hPa. These are added to the subtitle.</span>
<span class="sd">        domain : str</span>
<span class="sd">            Geographic domain. Default is entire basin. Please refer to :ref:`options-domain` for available domain options.</span>
<span class="sd">        interpolate_data : bool</span>
<span class="sd">            Whether to interpolate track data to hourly. Default is False.</span>
<span class="sd">        return_keys : bool</span>
<span class="sd">            If True, returns a list of storm IDs that match the specified criteria. Otherwise returns a pandas.DataFrame object with all matching data points. Default is True.</span>
<span class="sd">        </span>
<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        list or pandas.DataFrame</span>
<span class="sd">            Check return_keys for more information.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        
        <span class="c1">#Add interpolation automatically if requested threshold necessitates it</span>
        <span class="n">check_keys</span> <span class="o">=</span> <span class="p">[</span><span class="kc">True</span> <span class="k">if</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">thresh</span> <span class="k">else</span> <span class="kc">False</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;dv_min&#39;</span><span class="p">,</span><span class="s1">&#39;dv_max&#39;</span><span class="p">,</span><span class="s1">&#39;dp_min&#39;</span><span class="p">,</span><span class="s1">&#39;dp_max&#39;</span><span class="p">,</span><span class="s1">&#39;speed_min&#39;</span><span class="p">,</span><span class="s1">&#39;speed_max&#39;</span><span class="p">]]</span>
        <span class="k">if</span> <span class="kc">True</span> <span class="ow">in</span> <span class="n">check_keys</span><span class="p">:</span> <span class="n">interpolate_data</span> <span class="o">=</span> <span class="kc">True</span>
        
        <span class="c1">#Update thresh based on input</span>
        <span class="n">default_thresh</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;sample_min&#39;</span><span class="p">:</span><span class="mi">1</span><span class="p">,</span><span class="s1">&#39;p_max&#39;</span><span class="p">:</span><span class="mi">9999</span><span class="p">,</span><span class="s1">&#39;p_min&#39;</span><span class="p">:</span><span class="mi">0</span><span class="p">,</span><span class="s1">&#39;v_min&#39;</span><span class="p">:</span><span class="mi">0</span><span class="p">,</span><span class="s1">&#39;v_max&#39;</span><span class="p">:</span><span class="mi">9999</span><span class="p">,</span><span class="s1">&#39;dv_min&#39;</span><span class="p">:</span><span class="o">-</span><span class="mi">9999</span><span class="p">,</span><span class="s1">&#39;dp_max&#39;</span><span class="p">:</span><span class="mi">9999</span><span class="p">,</span><span class="s1">&#39;dv_max&#39;</span><span class="p">:</span><span class="mi">9999</span><span class="p">,</span><span class="s1">&#39;dp_min&#39;</span><span class="p">:</span><span class="o">-</span><span class="mi">9999</span><span class="p">,</span><span class="s1">&#39;speed_max&#39;</span><span class="p">:</span><span class="mi">9999</span><span class="p">,</span><span class="s1">&#39;speed_min&#39;</span><span class="p">:</span><span class="o">-</span><span class="mi">9999</span><span class="p">,</span><span class="s1">&#39;dt_window&#39;</span><span class="p">:</span><span class="mi">24</span><span class="p">,</span><span class="s1">&#39;dt_align&#39;</span><span class="p">:</span><span class="s1">&#39;middle&#39;</span><span class="p">}</span>
        <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="n">thresh</span><span class="p">:</span>
            <span class="n">default_thresh</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="n">thresh</span><span class="p">[</span><span class="n">key</span><span class="p">]</span>
        <span class="n">thresh</span> <span class="o">=</span> <span class="n">default_thresh</span>

        <span class="c1">#Determine domain over which to filter data</span>
        <span class="k">if</span> <span class="n">domain</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">lon_min</span> <span class="o">=</span> <span class="mi">0</span>
            <span class="n">lon_max</span> <span class="o">=</span> <span class="mi">360</span>
            <span class="n">lat_min</span> <span class="o">=</span> <span class="o">-</span><span class="mi">90</span>
            <span class="n">lat_max</span> <span class="o">=</span> <span class="mi">90</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">keys</span> <span class="o">=</span> <span class="n">domain</span><span class="o">.</span><span class="n">keys</span><span class="p">()</span>
            <span class="n">check</span> <span class="o">=</span> <span class="p">[</span><span class="kc">False</span><span class="p">,</span> <span class="kc">False</span><span class="p">,</span> <span class="kc">False</span><span class="p">,</span> <span class="kc">False</span><span class="p">]</span>
            <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="n">keys</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">key</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="o">==</span> <span class="s1">&#39;n&#39;</span><span class="p">:</span> <span class="n">check</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="kc">True</span><span class="p">;</span> <span class="n">lat_max</span> <span class="o">=</span> <span class="n">domain</span><span class="p">[</span><span class="n">key</span><span class="p">]</span>
                <span class="k">if</span> <span class="n">key</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="o">==</span> <span class="s1">&#39;s&#39;</span><span class="p">:</span> <span class="n">check</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="kc">True</span><span class="p">;</span> <span class="n">lat_min</span> <span class="o">=</span> <span class="n">domain</span><span class="p">[</span><span class="n">key</span><span class="p">]</span>
                <span class="k">if</span> <span class="n">key</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="o">==</span> <span class="s1">&#39;e&#39;</span><span class="p">:</span> <span class="n">check</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">=</span> <span class="kc">True</span><span class="p">;</span> <span class="n">lon_max</span> <span class="o">=</span> <span class="n">domain</span><span class="p">[</span><span class="n">key</span><span class="p">]</span>
                <span class="k">if</span> <span class="n">key</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="o">==</span> <span class="s1">&#39;w&#39;</span><span class="p">:</span> <span class="n">check</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span> <span class="o">=</span> <span class="kc">True</span><span class="p">;</span> <span class="n">lon_min</span> <span class="o">=</span> <span class="n">domain</span><span class="p">[</span><span class="n">key</span><span class="p">]</span>
            <span class="k">if</span> <span class="kc">False</span> <span class="ow">in</span> <span class="n">check</span><span class="p">:</span>
                <span class="n">msg</span> <span class="o">=</span> <span class="s2">&quot;Custom domains must be of type dict with arguments for &#39;n&#39;, &#39;s&#39;, &#39;e&#39; and &#39;w&#39;.&quot;</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">lon_max</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">:</span> <span class="n">lon_max</span> <span class="o">+=</span> <span class="mf">360.0</span>
            <span class="k">if</span> <span class="n">lon_min</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">:</span> <span class="n">lon_min</span> <span class="o">+=</span> <span class="mf">360.0</span>

        <span class="c1">#Determine year and date range</span>
        <span class="n">year_min</span><span class="p">,</span><span class="n">year_max</span> <span class="o">=</span> <span class="n">year_range</span>
        <span class="n">date_min</span><span class="p">,</span><span class="n">date_max</span> <span class="o">=</span> <span class="p">[</span><span class="n">dt</span><span class="o">.</span><span class="n">strptime</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="s1">&#39;%m/</span><span class="si">%d</span><span class="s1">&#39;</span><span class="p">)</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">date_range</span><span class="p">]</span>
        <span class="n">date_max</span> <span class="o">+=</span> <span class="n">timedelta</span><span class="p">(</span><span class="n">days</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span><span class="n">seconds</span><span class="o">=-</span><span class="mi">1</span><span class="p">)</span>
        
        <span class="c1">#Determine if a date falls within the date range</span>
        <span class="k">def</span> <span class="nf">date_range_test</span><span class="p">(</span><span class="n">t</span><span class="p">,</span><span class="n">t_min</span><span class="p">,</span><span class="n">t_max</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">date_min</span><span class="o">&lt;</span><span class="n">date_max</span><span class="p">:</span>
                <span class="n">test1</span> <span class="o">=</span> <span class="p">(</span><span class="n">t</span><span class="o">&gt;=</span><span class="n">t_min</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="n">year</span><span class="o">=</span><span class="n">t</span><span class="o">.</span><span class="n">year</span><span class="p">))</span>
                <span class="n">test2</span> <span class="o">=</span> <span class="p">(</span><span class="n">t</span><span class="o">&lt;=</span><span class="n">t_max</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="n">year</span><span class="o">=</span><span class="n">t</span><span class="o">.</span><span class="n">year</span><span class="p">))</span>
                <span class="k">return</span> <span class="n">test1</span> <span class="o">&amp;</span> <span class="n">test2</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">test1</span> <span class="o">=</span> <span class="p">(</span><span class="n">t_min</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="n">year</span><span class="o">=</span><span class="n">t</span><span class="o">.</span><span class="n">year</span><span class="p">)</span><span class="o">&lt;=</span><span class="n">t</span><span class="o">&lt;</span><span class="n">dt</span><span class="p">(</span><span class="n">t</span><span class="o">.</span><span class="n">year</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">))</span>
                <span class="n">test2</span> <span class="o">=</span> <span class="p">(</span><span class="n">dt</span><span class="p">(</span><span class="n">t</span><span class="o">.</span><span class="n">year</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">)</span><span class="o">&lt;=</span><span class="n">t</span><span class="o">&lt;=</span><span class="n">t_max</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="n">year</span><span class="o">=</span><span class="n">t</span><span class="o">.</span><span class="n">year</span><span class="p">))</span>
                <span class="k">return</span> <span class="n">test1</span> <span class="o">|</span> <span class="n">test2</span>
        
        <span class="c1">#Create empty dictionary to store output in</span>
        <span class="n">points</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="k">for</span> <span class="n">name</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;vmax&#39;</span><span class="p">,</span><span class="s1">&#39;mslp&#39;</span><span class="p">,</span><span class="s1">&#39;type&#39;</span><span class="p">,</span><span class="s1">&#39;lat&#39;</span><span class="p">,</span><span class="s1">&#39;lon&#39;</span><span class="p">,</span><span class="s1">&#39;date&#39;</span><span class="p">,</span><span class="s1">&#39;season&#39;</span><span class="p">,</span><span class="s1">&#39;stormid&#39;</span><span class="p">,</span><span class="s1">&#39;ace&#39;</span><span class="p">]</span><span class="o">+</span> \
                    <span class="p">[</span><span class="s1">&#39;dmslp_dt&#39;</span><span class="p">,</span><span class="s1">&#39;dvmax_dt&#39;</span><span class="p">,</span><span class="s1">&#39;acie&#39;</span><span class="p">,</span><span class="s1">&#39;dx_dt&#39;</span><span class="p">,</span><span class="s1">&#39;dy_dt&#39;</span><span class="p">,</span><span class="s1">&#39;speed&#39;</span><span class="p">]</span><span class="o">*</span><span class="nb">int</span><span class="p">(</span><span class="n">interpolate_data</span><span class="p">):</span>
            <span class="n">points</span><span class="p">[</span><span class="n">name</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span>
        
        <span class="c1">#Iterate over every storm in TrackDataset</span>
        <span class="k">if</span> <span class="n">storm</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">storm</span><span class="p">,</span><span class="nb">list</span><span class="p">):</span>
                <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">storm</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span><span class="nb">tuple</span><span class="p">):</span>
                    <span class="n">stormkeys</span> <span class="o">=</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">get_storm_id</span><span class="p">(</span><span class="n">s</span><span class="p">)</span> <span class="k">for</span> <span class="n">s</span> <span class="ow">in</span> <span class="n">storm</span><span class="p">]</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">stormkeys</span><span class="o">=</span><span class="n">storm</span>
            <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">storm</span><span class="p">,</span><span class="nb">tuple</span><span class="p">):</span>
                <span class="n">stormkeys</span> <span class="o">=</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">get_storm_id</span><span class="p">(</span><span class="n">storm</span><span class="p">)]</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">stormkeys</span> <span class="o">=</span> <span class="p">[</span><span class="n">storm</span><span class="p">]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">stormkeys</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">keys</span>
        
        <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="n">stormkeys</span><span class="p">:</span>
            
            <span class="c1">#Only interpolate storms within the provided temporal range</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="n">key</span><span class="p">][</span><span class="s1">&#39;year&#39;</span><span class="p">]</span> <span class="o">&lt;=</span> <span class="p">(</span><span class="n">year_range</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="n">key</span><span class="p">][</span><span class="s1">&#39;year&#39;</span><span class="p">]</span> <span class="o">&gt;=</span> <span class="p">(</span><span class="n">year_range</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">+</span><span class="mi">1</span><span class="p">):</span> <span class="k">continue</span>
            <span class="n">subset_dates</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="n">key</span><span class="p">][</span><span class="s1">&#39;date&#39;</span><span class="p">])[</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">i</span> <span class="ow">in</span> <span class="n">constants</span><span class="o">.</span><span class="n">TROPICAL_STORM_TYPES</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="n">key</span><span class="p">][</span><span class="s1">&#39;type&#39;</span><span class="p">]])]</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">subset_dates</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span> <span class="k">continue</span>
            <span class="n">verify_dates</span> <span class="o">=</span> <span class="p">[</span><span class="n">date_range_test</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">date_min</span><span class="p">,</span><span class="n">date_max</span><span class="p">)</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">subset_dates</span><span class="p">]</span>
            <span class="k">if</span> <span class="kc">True</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">verify_dates</span><span class="p">:</span> <span class="k">continue</span>
            
            <span class="c1">#Interpolate temporally if requested</span>
            <span class="k">if</span> <span class="n">interpolate_data</span><span class="p">:</span>
                <span class="k">try</span><span class="p">:</span>
                    <span class="n">istorm</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">data_interp</span><span class="p">[</span><span class="n">key</span><span class="p">]</span>
                <span class="k">except</span><span class="p">:</span>
                    <span class="n">istorm</span> <span class="o">=</span> <span class="n">interp_storm</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="n">key</span><span class="p">]</span><span class="o">.</span><span class="n">copy</span><span class="p">(),</span><span class="n">hours</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span><span class="n">dt_window</span><span class="o">=</span><span class="n">thresh</span><span class="p">[</span><span class="s1">&#39;dt_window&#39;</span><span class="p">],</span><span class="n">dt_align</span><span class="o">=</span><span class="n">thresh</span><span class="p">[</span><span class="s1">&#39;dt_align&#39;</span><span class="p">])</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">data_interp</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="n">istorm</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
                <span class="n">timeres</span> <span class="o">=</span> <span class="mi">1</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">istorm</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="n">key</span><span class="p">]</span>
                <span class="n">timeres</span> <span class="o">=</span> <span class="mi">6</span>
            
            <span class="c1">#Iterate over every timestep of the storm</span>
            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">istorm</span><span class="p">[</span><span class="s1">&#39;date&#39;</span><span class="p">])):</span>
                
                <span class="c1">#Filter to only tropical cyclones, and filter by dates &amp; coordiates</span>
                <span class="k">if</span> <span class="n">istorm</span><span class="p">[</span><span class="s1">&#39;type&#39;</span><span class="p">][</span><span class="n">i</span><span class="p">]</span> <span class="ow">in</span> <span class="n">constants</span><span class="o">.</span><span class="n">TROPICAL_STORM_TYPES</span> \
                <span class="ow">and</span> <span class="n">lat_min</span><span class="o">&lt;=</span><span class="n">istorm</span><span class="p">[</span><span class="s1">&#39;lat&#39;</span><span class="p">][</span><span class="n">i</span><span class="p">]</span><span class="o">&lt;=</span><span class="n">lat_max</span> <span class="ow">and</span> <span class="n">lon_min</span><span class="o">&lt;=</span><span class="n">istorm</span><span class="p">[</span><span class="s1">&#39;lon&#39;</span><span class="p">][</span><span class="n">i</span><span class="p">]</span><span class="o">%</span><span class="mi">360</span><span class="o">&lt;=</span><span class="n">lon_max</span> \
                <span class="ow">and</span> <span class="n">year_min</span><span class="o">&lt;=</span><span class="n">istorm</span><span class="p">[</span><span class="s1">&#39;date&#39;</span><span class="p">][</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">year</span><span class="o">&lt;=</span><span class="n">year_max</span> \
                <span class="ow">and</span> <span class="n">date_range_test</span><span class="p">(</span><span class="n">istorm</span><span class="p">[</span><span class="s1">&#39;date&#39;</span><span class="p">][</span><span class="n">i</span><span class="p">],</span><span class="n">date_min</span><span class="p">,</span><span class="n">date_max</span><span class="p">):</span>
                    
                    <span class="c1">#Append data points</span>
                    <span class="n">points</span><span class="p">[</span><span class="s1">&#39;vmax&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">istorm</span><span class="p">[</span><span class="s1">&#39;vmax&#39;</span><span class="p">][</span><span class="n">i</span><span class="p">])</span>
                    <span class="n">points</span><span class="p">[</span><span class="s1">&#39;mslp&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">istorm</span><span class="p">[</span><span class="s1">&#39;mslp&#39;</span><span class="p">][</span><span class="n">i</span><span class="p">])</span>
                    <span class="n">points</span><span class="p">[</span><span class="s1">&#39;type&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">istorm</span><span class="p">[</span><span class="s1">&#39;type&#39;</span><span class="p">][</span><span class="n">i</span><span class="p">])</span>
                    <span class="n">points</span><span class="p">[</span><span class="s1">&#39;lat&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">istorm</span><span class="p">[</span><span class="s1">&#39;lat&#39;</span><span class="p">][</span><span class="n">i</span><span class="p">])</span>
                    <span class="n">points</span><span class="p">[</span><span class="s1">&#39;lon&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">istorm</span><span class="p">[</span><span class="s1">&#39;lon&#39;</span><span class="p">][</span><span class="n">i</span><span class="p">])</span>
                    <span class="n">points</span><span class="p">[</span><span class="s1">&#39;date&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">istorm</span><span class="p">[</span><span class="s1">&#39;date&#39;</span><span class="p">][</span><span class="n">i</span><span class="p">])</span>
                    <span class="n">points</span><span class="p">[</span><span class="s1">&#39;season&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">istorm</span><span class="p">[</span><span class="s1">&#39;season&#39;</span><span class="p">])</span>
                    <span class="n">points</span><span class="p">[</span><span class="s1">&#39;stormid&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">key</span><span class="p">)</span>
                    <span class="k">if</span> <span class="n">istorm</span><span class="p">[</span><span class="s1">&#39;vmax&#39;</span><span class="p">][</span><span class="n">i</span><span class="p">]</span><span class="o">&gt;</span><span class="mi">34</span><span class="p">:</span>
                        <span class="n">points</span><span class="p">[</span><span class="s1">&#39;ace&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">istorm</span><span class="p">[</span><span class="s1">&#39;vmax&#39;</span><span class="p">][</span><span class="n">i</span><span class="p">]</span><span class="o">**</span><span class="mi">2</span><span class="o">*</span><span class="mf">1e-4</span><span class="o">*</span><span class="n">timeres</span><span class="o">/</span><span class="mi">6</span><span class="p">)</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="n">points</span><span class="p">[</span><span class="s1">&#39;ace&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>                        
                        
                    <span class="c1">#Append separately for interpolated data</span>
                    <span class="k">if</span> <span class="n">interpolate_data</span><span class="p">:</span>
                        <span class="n">points</span><span class="p">[</span><span class="s1">&#39;dvmax_dt&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">istorm</span><span class="p">[</span><span class="s1">&#39;dvmax_dt&#39;</span><span class="p">][</span><span class="n">i</span><span class="p">])</span>
                        <span class="n">points</span><span class="p">[</span><span class="s1">&#39;acie&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span><span class="n">istorm</span><span class="p">[</span><span class="s1">&#39;dvmax_dt&#39;</span><span class="p">][</span><span class="n">i</span><span class="p">]</span><span class="o">**</span><span class="mi">2</span><span class="o">*</span><span class="mf">1e-4</span><span class="o">*</span><span class="n">timeres</span><span class="o">/</span><span class="mi">6</span><span class="p">][</span><span class="n">istorm</span><span class="p">[</span><span class="s1">&#39;dvmax_dt&#39;</span><span class="p">][</span><span class="n">i</span><span class="p">]</span><span class="o">&gt;</span><span class="mi">0</span><span class="p">])</span>
                        <span class="n">points</span><span class="p">[</span><span class="s1">&#39;dmslp_dt&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">istorm</span><span class="p">[</span><span class="s1">&#39;dmslp_dt&#39;</span><span class="p">][</span><span class="n">i</span><span class="p">])</span>
                        <span class="n">points</span><span class="p">[</span><span class="s1">&#39;dx_dt&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">istorm</span><span class="p">[</span><span class="s1">&#39;dx_dt&#39;</span><span class="p">][</span><span class="n">i</span><span class="p">])</span>
                        <span class="n">points</span><span class="p">[</span><span class="s1">&#39;dy_dt&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">istorm</span><span class="p">[</span><span class="s1">&#39;dy_dt&#39;</span><span class="p">][</span><span class="n">i</span><span class="p">])</span>
                        <span class="n">points</span><span class="p">[</span><span class="s1">&#39;speed&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">istorm</span><span class="p">[</span><span class="s1">&#39;speed&#39;</span><span class="p">][</span><span class="n">i</span><span class="p">])</span>
        
        <span class="c1">#Create a DataFrame from the dictionary</span>
        <span class="n">p</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="o">.</span><span class="n">from_dict</span><span class="p">(</span><span class="n">points</span><span class="p">)</span>
        
        <span class="c1">#Filter by thresholds</span>
        <span class="k">if</span> <span class="n">thresh</span><span class="p">[</span><span class="s1">&#39;v_min&#39;</span><span class="p">]</span><span class="o">&gt;</span><span class="mi">0</span><span class="p">:</span>
            <span class="n">p</span> <span class="o">=</span> <span class="n">p</span><span class="o">.</span><span class="n">loc</span><span class="p">[(</span><span class="n">p</span><span class="p">[</span><span class="s1">&#39;vmax&#39;</span><span class="p">]</span><span class="o">&gt;=</span><span class="n">thresh</span><span class="p">[</span><span class="s1">&#39;v_min&#39;</span><span class="p">])]</span>
        <span class="k">if</span> <span class="n">thresh</span><span class="p">[</span><span class="s1">&#39;v_max&#39;</span><span class="p">]</span><span class="o">&lt;</span><span class="mi">9999</span><span class="p">:</span>
            <span class="n">p</span> <span class="o">=</span> <span class="n">p</span><span class="o">.</span><span class="n">loc</span><span class="p">[(</span><span class="n">p</span><span class="p">[</span><span class="s1">&#39;vmax&#39;</span><span class="p">]</span><span class="o">&lt;=</span><span class="n">thresh</span><span class="p">[</span><span class="s1">&#39;v_max&#39;</span><span class="p">])]</span>
        <span class="k">if</span> <span class="n">thresh</span><span class="p">[</span><span class="s1">&#39;p_max&#39;</span><span class="p">]</span><span class="o">&lt;</span><span class="mi">9999</span><span class="p">:</span>
            <span class="n">p</span> <span class="o">=</span> <span class="n">p</span><span class="o">.</span><span class="n">loc</span><span class="p">[(</span><span class="n">p</span><span class="p">[</span><span class="s1">&#39;mslp&#39;</span><span class="p">]</span><span class="o">&lt;=</span><span class="n">thresh</span><span class="p">[</span><span class="s1">&#39;p_max&#39;</span><span class="p">])]</span>
        <span class="k">if</span> <span class="n">thresh</span><span class="p">[</span><span class="s1">&#39;p_min&#39;</span><span class="p">]</span><span class="o">&gt;</span><span class="mi">0</span><span class="p">:</span>
            <span class="n">p</span> <span class="o">=</span> <span class="n">p</span><span class="o">.</span><span class="n">loc</span><span class="p">[(</span><span class="n">p</span><span class="p">[</span><span class="s1">&#39;mslp&#39;</span><span class="p">]</span><span class="o">&gt;=</span><span class="n">thresh</span><span class="p">[</span><span class="s1">&#39;p_min&#39;</span><span class="p">])]</span>
        <span class="k">if</span> <span class="n">interpolate_data</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">thresh</span><span class="p">[</span><span class="s1">&#39;dv_min&#39;</span><span class="p">]</span><span class="o">&gt;-</span><span class="mi">9999</span><span class="p">:</span>
                <span class="n">p</span> <span class="o">=</span> <span class="n">p</span><span class="o">.</span><span class="n">loc</span><span class="p">[(</span><span class="n">p</span><span class="p">[</span><span class="s1">&#39;dvmax_dt&#39;</span><span class="p">]</span><span class="o">&gt;=</span><span class="n">thresh</span><span class="p">[</span><span class="s1">&#39;dv_min&#39;</span><span class="p">])]</span>
            <span class="k">if</span> <span class="n">thresh</span><span class="p">[</span><span class="s1">&#39;dp_max&#39;</span><span class="p">]</span><span class="o">&lt;</span><span class="mi">9999</span><span class="p">:</span>
                <span class="n">p</span> <span class="o">=</span> <span class="n">p</span><span class="o">.</span><span class="n">loc</span><span class="p">[(</span><span class="n">p</span><span class="p">[</span><span class="s1">&#39;dmslp_dt&#39;</span><span class="p">]</span><span class="o">&lt;=</span><span class="n">thresh</span><span class="p">[</span><span class="s1">&#39;dp_max&#39;</span><span class="p">])]</span>
            <span class="k">if</span> <span class="n">thresh</span><span class="p">[</span><span class="s1">&#39;dv_max&#39;</span><span class="p">]</span><span class="o">&lt;</span><span class="mi">9999</span><span class="p">:</span>
                <span class="n">p</span> <span class="o">=</span> <span class="n">p</span><span class="o">.</span><span class="n">loc</span><span class="p">[(</span><span class="n">p</span><span class="p">[</span><span class="s1">&#39;dvmax_dt&#39;</span><span class="p">]</span><span class="o">&lt;=</span><span class="n">thresh</span><span class="p">[</span><span class="s1">&#39;dv_max&#39;</span><span class="p">])]</span>
            <span class="k">if</span> <span class="n">thresh</span><span class="p">[</span><span class="s1">&#39;dp_min&#39;</span><span class="p">]</span><span class="o">&gt;-</span><span class="mi">9999</span><span class="p">:</span>
                <span class="n">p</span> <span class="o">=</span> <span class="n">p</span><span class="o">.</span><span class="n">loc</span><span class="p">[(</span><span class="n">p</span><span class="p">[</span><span class="s1">&#39;dmslp_dt&#39;</span><span class="p">]</span><span class="o">&gt;=</span><span class="n">thresh</span><span class="p">[</span><span class="s1">&#39;dp_min&#39;</span><span class="p">])]</span>
            <span class="k">if</span> <span class="n">thresh</span><span class="p">[</span><span class="s1">&#39;speed_max&#39;</span><span class="p">]</span><span class="o">&lt;</span><span class="mi">9999</span><span class="p">:</span>
                <span class="n">p</span> <span class="o">=</span> <span class="n">p</span><span class="o">.</span><span class="n">loc</span><span class="p">[(</span><span class="n">p</span><span class="p">[</span><span class="s1">&#39;speed&#39;</span><span class="p">]</span><span class="o">&gt;=</span><span class="n">thresh</span><span class="p">[</span><span class="s1">&#39;speed_max&#39;</span><span class="p">])]</span>
            <span class="k">if</span> <span class="n">thresh</span><span class="p">[</span><span class="s1">&#39;speed_min&#39;</span><span class="p">]</span><span class="o">&gt;-</span><span class="mi">9999</span><span class="p">:</span>
                <span class="n">p</span> <span class="o">=</span> <span class="n">p</span><span class="o">.</span><span class="n">loc</span><span class="p">[(</span><span class="n">p</span><span class="p">[</span><span class="s1">&#39;speed&#39;</span><span class="p">]</span><span class="o">&gt;=</span><span class="n">thresh</span><span class="p">[</span><span class="s1">&#39;speed_min&#39;</span><span class="p">])]</span>
        
        <span class="c1">#Determine how to return data</span>
        <span class="k">if</span> <span class="n">return_keys</span><span class="p">:</span>
            <span class="k">return</span> <span class="p">[</span><span class="n">g</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="k">for</span> <span class="n">g</span> <span class="ow">in</span> <span class="n">p</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="s2">&quot;stormid&quot;</span><span class="p">)]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">p</span></div>

<div class="viewcode-block" id="TrackDataset.gridded_stats"><a class="viewcode-back" href="../../../api/generated/tropycal.tracks.TrackDataset.gridded_stats.html#tropycal.tracks.TrackDataset.gridded_stats">[docs]</a>    <span class="k">def</span> <span class="nf">gridded_stats</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">request</span><span class="p">,</span><span class="n">thresh</span><span class="o">=</span><span class="p">{},</span><span class="n">storm</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span><span class="n">year_range</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span><span class="n">year_range_subtract</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span><span class="n">year_average</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
                      <span class="n">date_range</span><span class="o">=</span><span class="p">(</span><span class="s1">&#39;1/1&#39;</span><span class="p">,</span><span class="s1">&#39;12/31&#39;</span><span class="p">),</span><span class="n">binsize</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span><span class="n">domain</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span><span class="n">ax</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                      <span class="n">return_array</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span><span class="n">cartopy_proj</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span><span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        
        <span class="sa">r</span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Creates a plot of gridded statistics.</span>
<span class="sd">        </span>
<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        request : str</span>
<span class="sd">            This string is a descriptor for what you want to plot.</span>
<span class="sd">            It will be used to define the variable (e.g. &#39;wind&#39; --&gt; &#39;vmax&#39;) and the function (e.g. &#39;maximum&#39; --&gt; np.max()).</span>
<span class="sd">            This string is also used as the plot title.</span>
<span class="sd">            </span>
<span class="sd">            Variable words to use in request:</span>
<span class="sd">                </span>
<span class="sd">            * **wind** - (kt). Sustained wind.</span>
<span class="sd">            * **pressure** - (hPa). Minimum pressure.</span>
<span class="sd">            * **wind change** - (kt/time). Must be followed by an integer value denoting the length of the time window &#39;__ hours&#39; (e.g., &quot;wind change in 24 hours&quot;).</span>
<span class="sd">            * **pressure change** - (hPa/time). Must be followed by an integer value denoting the length of the time window &#39;__ hours&#39; (e.g., &quot;pressure change in 24 hours&quot;).</span>
<span class="sd">            * **storm motion** - (km/hour). Can be followed a length of time window. Otherwise defaults to 24 hours.</span>
<span class="sd">            </span>
<span class="sd">            Units of all wind variables are knots and pressure variables are hPa. These are added into the title.</span>
<span class="sd">            </span>
<span class="sd">            Function words to use in request:</span>
<span class="sd">                </span>
<span class="sd">            * **maximum**</span>
<span class="sd">            * **minimum**</span>
<span class="sd">            * **average** </span>
<span class="sd">            * **percentile** - Percentile must be preceded by an integer [0,100].</span>
<span class="sd">            * **number** - Number of storms in grid box satisfying filter thresholds.</span>
<span class="sd">            </span>
<span class="sd">            Example usage: &quot;maximum wind change in 24 hours&quot;, &quot;50th percentile wind&quot;, &quot;number of storms&quot;</span>
<span class="sd">            </span>
<span class="sd">        thresh : dict, optional</span>
<span class="sd">            Keywords include:</span>
<span class="sd">                </span>
<span class="sd">            * **sample_min** - minimum number of storms in a grid box for the request to be applied. For the functions &#39;percentile&#39; and &#39;average&#39;, &#39;sample_min&#39; defaults to 5 and will override any value less than 5.</span>
<span class="sd">            * **v_min** - minimum wind for a given point to be included in the request.</span>
<span class="sd">            * **p_max** - maximum pressure for a given point to be included in the request.</span>
<span class="sd">            * **dv_min** - minimum change in wind over dt_window for a given point to be included in the request.</span>
<span class="sd">            * **dp_max** - maximum change in pressure over dt_window for a given point to be included in the request.</span>
<span class="sd">            * **dt_window** - time window over which change variables are calculated (hours). Default is 24.</span>
<span class="sd">            * **dt_align** - alignment of dt_window for change variables -- &#39;start&#39;,&#39;middle&#39;,&#39;end&#39; -- e.g. &#39;end&#39; for dt_window=24 associates a TC point with change over the past 24 hours. Default is middle.</span>
<span class="sd">            </span>
<span class="sd">            Units of all wind variables = kt, and pressure variables = hPa. These are added to the subtitle.</span>

<span class="sd">        year_range : list or tuple, optional</span>
<span class="sd">            List or tuple representing the start and end years (e.g., (1950,2018)). Default is start and end years of dataset.</span>
<span class="sd">        year_range_subtract : list or tuple, optional</span>
<span class="sd">            A year range to subtract from the previously specified &quot;year_range&quot;. If specified, will create a difference plot.</span>
<span class="sd">        year_average : bool, optional</span>
<span class="sd">            If True, both year ranges will be computed and plotted as an annual average.</span>
<span class="sd">        date_range : list or tuple, optional</span>
<span class="sd">            List or tuple representing the start and end dates as a string in &#39;month/day&#39; format (e.g., ``(&#39;6/1&#39;,&#39;8/15&#39;)``). Default is ``(&#39;1/1&#39;,&#39;12/31&#39;)`` i.e., the full year.</span>
<span class="sd">        binsize : float, optional</span>
<span class="sd">            Grid resolution in degrees. Default is 1 degree.</span>
<span class="sd">        domain : str, optional</span>
<span class="sd">            Domain for the plot. Default is &quot;dynamic&quot;. Please refer to :ref:`options-domain` for available domain options.</span>
<span class="sd">        ax : axes, optional</span>
<span class="sd">            Instance of axes to plot on. If none, one will be generated. Default is none.</span>
<span class="sd">        return_array : bool, optional</span>
<span class="sd">            If True, returns the gridded 2D array used to generate the plot. Default is False.</span>
<span class="sd">        cartopy_proj : ccrs, optional</span>
<span class="sd">            Instance of a cartopy projection to use. If none, one will be generated. Default is none.</span>
<span class="sd">        </span>
<span class="sd">        Other Parameters</span>
<span class="sd">        ----------------</span>
<span class="sd">        prop : dict, optional</span>
<span class="sd">            Customization properties of plot. Please refer to :ref:`options-prop-gridded` for available options.</span>
<span class="sd">        map_prop : dict, optional</span>
<span class="sd">            Customization properties of Cartopy map. Please refer to :ref:`options-map-prop` for available options.</span>
<span class="sd">        </span>
<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        By default, the plot axes is returned. If &quot;return_array&quot; are set to True, a dictionary is returned containing both the axes and data array.</span>
<span class="sd">        </span>
<span class="sd">        Notes</span>
<span class="sd">        -----</span>
<span class="sd">        The following properties are available for customizing the plot, via ``prop``:</span>
<span class="sd">        </span>
<span class="sd">        .. list-table:: </span>
<span class="sd">            :widths: 25 75</span>
<span class="sd">            :header-rows: 1</span>

<span class="sd">            * - Property</span>
<span class="sd">              - Description</span>
<span class="sd">            * - smooth</span>
<span class="sd">              - Number (in units of sigma) to smooth the data using scipy&#39;s gaussian filter. Default is 0 (no smoothing).</span>
<span class="sd">            * - cmap</span>
<span class="sd">              - Colormap to use for the plot. If string &#39;category&#39; is passed (default), uses a pre-defined color scale corresponding to the Saffir-Simpson Hurricane Wind Scale.</span>
<span class="sd">            * - clevs</span>
<span class="sd">              - Contour levels for the plot. Default is minimum and maximum values in the grid.</span>
<span class="sd">            * - left_title</span>
<span class="sd">              - Title string for the left side of the plot. Default is the string passed via the &#39;request&#39; keyword argument.</span>
<span class="sd">            * - right_title</span>
<span class="sd">              - Title string for the right side of the plot. Default is &#39;All storms&#39;.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        
        <span class="c1">#Retrieve kwargs</span>
        <span class="n">prop</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;prop&#39;</span><span class="p">,{})</span>
        <span class="n">map_prop</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;map_prop&#39;</span><span class="p">,{})</span>

        <span class="n">default_prop</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;smooth&#39;</span><span class="p">:</span><span class="kc">None</span><span class="p">}</span>
        <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="n">prop</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
            <span class="n">default_prop</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="n">prop</span><span class="p">[</span><span class="n">key</span><span class="p">]</span>
        <span class="n">prop</span> <span class="o">=</span> <span class="n">default_prop</span>
        
        <span class="c1">#Update thresh based on input</span>
        <span class="n">default_thresh</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;sample_min&#39;</span><span class="p">:</span><span class="n">np</span><span class="o">.</span><span class="n">nan</span><span class="p">,</span><span class="s1">&#39;p_max&#39;</span><span class="p">:</span><span class="n">np</span><span class="o">.</span><span class="n">nan</span><span class="p">,</span><span class="s1">&#39;v_min&#39;</span><span class="p">:</span><span class="n">np</span><span class="o">.</span><span class="n">nan</span><span class="p">,</span><span class="s1">&#39;dv_min&#39;</span><span class="p">:</span><span class="n">np</span><span class="o">.</span><span class="n">nan</span><span class="p">,</span><span class="s1">&#39;dp_max&#39;</span><span class="p">:</span><span class="n">np</span><span class="o">.</span><span class="n">nan</span><span class="p">,</span><span class="s1">&#39;dv_max&#39;</span><span class="p">:</span><span class="n">np</span><span class="o">.</span><span class="n">nan</span><span class="p">,</span><span class="s1">&#39;dp_min&#39;</span><span class="p">:</span><span class="n">np</span><span class="o">.</span><span class="n">nan</span><span class="p">,</span><span class="s1">&#39;dt_window&#39;</span><span class="p">:</span><span class="mi">24</span><span class="p">,</span><span class="s1">&#39;dt_align&#39;</span><span class="p">:</span><span class="s1">&#39;middle&#39;</span><span class="p">}</span>
        <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="n">thresh</span><span class="p">:</span>
            <span class="n">default_thresh</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="n">thresh</span><span class="p">[</span><span class="n">key</span><span class="p">]</span>
        <span class="n">thresh</span> <span class="o">=</span> <span class="n">default_thresh</span>
        
        <span class="c1">#Retrieve the requested function, variable for computing stats, and plot title. These modify thresh if necessary.</span>
        <span class="n">thresh</span><span class="p">,</span><span class="n">func</span> <span class="o">=</span> <span class="n">find_func</span><span class="p">(</span><span class="n">request</span><span class="p">,</span><span class="n">thresh</span><span class="p">)</span>
        <span class="n">thresh</span><span class="p">,</span><span class="n">varname</span> <span class="o">=</span> <span class="n">find_var</span><span class="p">(</span><span class="n">request</span><span class="p">,</span><span class="n">thresh</span><span class="p">)</span>
        <span class="n">thresh</span><span class="p">,</span><span class="n">plot_subtitle</span> <span class="o">=</span> <span class="n">construct_title</span><span class="p">(</span><span class="n">thresh</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">storm</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">thresh</span><span class="p">[</span><span class="s1">&#39;sample_min&#39;</span><span class="p">]</span><span class="o">=</span><span class="mi">1</span>
            <span class="n">plot_subtitle</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span>
            
        <span class="c1">#Determine whether request includes a vector (i.e., TC motion vector)</span>
        <span class="n">VEC_FLAG</span> <span class="o">=</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">varname</span><span class="p">,</span><span class="nb">tuple</span><span class="p">)</span>
        
        <span class="c1">#Determine year range of plot</span>
        <span class="k">def</span> <span class="nf">get_year_range</span><span class="p">(</span><span class="n">y_r</span><span class="p">):</span>
            <span class="n">start_year</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">keys</span><span class="p">[</span><span class="mi">0</span><span class="p">]][</span><span class="s1">&#39;year&#39;</span><span class="p">]</span>
            <span class="n">end_year</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">keys</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]][</span><span class="s1">&#39;year&#39;</span><span class="p">]</span>  
            <span class="k">if</span> <span class="n">y_r</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">new_y_r</span> <span class="o">=</span> <span class="p">(</span><span class="n">start_year</span><span class="p">,</span><span class="n">end_year</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">y_r</span><span class="p">,(</span><span class="nb">list</span><span class="p">,</span><span class="nb">tuple</span><span class="p">))</span> <span class="o">==</span> <span class="kc">False</span><span class="p">:</span>
                    <span class="n">msg</span> <span class="o">=</span> <span class="s2">&quot;</span><span class="se">\&quot;</span><span class="s2">year_range</span><span class="se">\&quot;</span><span class="s2"> and </span><span class="se">\&quot;</span><span class="s2">year_range_subtract</span><span class="se">\&quot;</span><span class="s2"> must be of type list or tuple.&quot;</span>
                    <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">year_range_subtract</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="nb">len</span><span class="p">(</span><span class="n">year_range_subtract</span><span class="p">)</span> <span class="o">!=</span> <span class="mi">2</span><span class="p">:</span>
                    <span class="n">msg</span> <span class="o">=</span> <span class="s2">&quot;</span><span class="se">\&quot;</span><span class="s2">year_range</span><span class="se">\&quot;</span><span class="s2"> and </span><span class="se">\&quot;</span><span class="s2">year_range_subtract</span><span class="se">\&quot;</span><span class="s2"> must contain 2 elements.&quot;</span>                
                    <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>
                <span class="n">new_y_r</span> <span class="o">=</span> <span class="p">(</span><span class="nb">max</span><span class="p">((</span><span class="n">start_year</span><span class="p">,</span><span class="nb">min</span><span class="p">(</span><span class="n">y_r</span><span class="p">))),</span><span class="nb">min</span><span class="p">((</span><span class="n">end_year</span><span class="p">,</span><span class="nb">max</span><span class="p">(</span><span class="n">y_r</span><span class="p">))))</span>
            <span class="k">return</span> <span class="n">new_y_r</span>
        
        <span class="n">year_range</span> <span class="o">=</span> <span class="n">get_year_range</span><span class="p">(</span><span class="n">year_range</span><span class="p">)</span>
        
        <span class="c1">#Start date in numpy datetime64</span>
        <span class="n">startdate</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">datetime64</span><span class="p">(</span><span class="s1">&#39;2000-&#39;</span><span class="o">+</span><span class="s1">&#39;-&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="nb">int</span><span class="p">(</span><span class="n">d</span><span class="p">)</span><span class="si">:</span><span class="s1">02</span><span class="si">}</span><span class="s1">&#39;</span> <span class="k">for</span> <span class="n">d</span> <span class="ow">in</span> <span class="n">date_range</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;/&#39;</span><span class="p">)]))</span>
        
        <span class="c1">#Determine year range to subtract, if making a difference plot</span>
        <span class="k">if</span> <span class="n">year_range_subtract</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">year_range_subtract</span> <span class="o">=</span> <span class="n">get_year_range</span><span class="p">(</span><span class="n">year_range_subtract</span><span class="p">)</span>
        
        <span class="c1">#---------------------------------------------------------------------------------------------------</span>
        
        <span class="c1">#Perform analysis either once or twice depending on year_range_subtract</span>
        <span class="k">if</span> <span class="n">year_range_subtract</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">years_analysis</span> <span class="o">=</span> <span class="p">[</span><span class="n">year_range</span><span class="p">]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">years_analysis</span> <span class="o">=</span> <span class="p">[</span><span class="n">year_range</span><span class="p">,</span><span class="n">year_range_subtract</span><span class="p">]</span>
        <span class="n">grid_x_years</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">grid_y_years</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">grid_z_years</span> <span class="o">=</span> <span class="p">[]</span>
        
        <span class="k">for</span> <span class="n">year_range_temp</span> <span class="ow">in</span> <span class="n">years_analysis</span><span class="p">:</span>

            <span class="c1">#Obtain all data points for the requested threshold and year/date ranges. Interpolate data to hourly.</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;--&gt; Getting filtered storm tracks&quot;</span><span class="p">)</span>
            <span class="n">points</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">filter_storms</span><span class="p">(</span><span class="n">storm</span><span class="p">,</span><span class="n">year_range_temp</span><span class="p">,</span><span class="n">date_range</span><span class="p">,</span><span class="n">thresh</span><span class="o">=</span><span class="n">thresh</span><span class="p">,</span><span class="n">interpolate_data</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span><span class="n">return_keys</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>

            <span class="c1">#Round lat/lon points down to nearest bin</span>
            <span class="n">to_bin</span> <span class="o">=</span> <span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">floor</span><span class="p">(</span><span class="n">x</span> <span class="o">/</span> <span class="n">binsize</span><span class="p">)</span> <span class="o">*</span> <span class="n">binsize</span>
            <span class="n">points</span><span class="p">[</span><span class="s2">&quot;latbin&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">points</span><span class="o">.</span><span class="n">lat</span><span class="o">.</span><span class="n">map</span><span class="p">(</span><span class="n">to_bin</span><span class="p">)</span>
            <span class="n">points</span><span class="p">[</span><span class="s2">&quot;lonbin&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">points</span><span class="o">.</span><span class="n">lon</span><span class="o">.</span><span class="n">map</span><span class="p">(</span><span class="n">to_bin</span><span class="p">)</span>

            <span class="c1">#---------------------------------------------------------------------------------------------------</span>

            <span class="c1">#Group by latbin,lonbin,stormid</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;--&gt; Grouping by lat/lon/storm&quot;</span><span class="p">)</span>
            <span class="n">groups</span> <span class="o">=</span> <span class="n">points</span><span class="o">.</span><span class="n">groupby</span><span class="p">([</span><span class="s2">&quot;latbin&quot;</span><span class="p">,</span><span class="s2">&quot;lonbin&quot;</span><span class="p">,</span><span class="s2">&quot;stormid&quot;</span><span class="p">,</span><span class="s2">&quot;season&quot;</span><span class="p">])</span>

            <span class="c1">#Loops through groups, and apply stat func to storms</span>
            <span class="c1">#Constructs a new dataframe containing the lat/lon bins, storm ID and the plotting variable</span>
            <span class="n">new_df</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;latbin&#39;</span><span class="p">:[],</span><span class="s1">&#39;lonbin&#39;</span><span class="p">:[],</span><span class="s1">&#39;stormid&#39;</span><span class="p">:[],</span><span class="s1">&#39;season&#39;</span><span class="p">:[],</span><span class="n">varname</span><span class="p">:[]}</span>
            <span class="k">for</span> <span class="n">g</span> <span class="ow">in</span> <span class="n">groups</span><span class="p">:</span>
                <span class="c1">#Apply function to all time steps in which a storm tracks within a gridbox</span>
                <span class="k">if</span> <span class="n">VEC_FLAG</span><span class="p">:</span>
                    <span class="n">new_df</span><span class="p">[</span><span class="n">varname</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">([</span><span class="n">func</span><span class="p">(</span><span class="n">g</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="n">v</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="p">)</span> <span class="k">for</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">varname</span><span class="p">])</span>
                <span class="k">elif</span> <span class="n">varname</span> <span class="o">==</span> <span class="s1">&#39;date&#39;</span><span class="p">:</span>
                    <span class="n">new_df</span><span class="p">[</span><span class="n">varname</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">func</span><span class="p">([</span><span class="n">date_diff</span><span class="p">(</span><span class="n">dt</span><span class="p">(</span><span class="mi">2000</span><span class="p">,</span><span class="n">t</span><span class="o">.</span><span class="n">month</span><span class="p">,</span><span class="n">t</span><span class="o">.</span><span class="n">day</span><span class="p">),</span><span class="n">startdate</span><span class="p">)</span>\
                          <span class="k">for</span> <span class="n">t</span> <span class="ow">in</span> <span class="n">pd</span><span class="o">.</span><span class="n">DatetimeIndex</span><span class="p">(</span><span class="n">g</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="n">varname</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="p">)]))</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">new_df</span><span class="p">[</span><span class="n">varname</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">func</span><span class="p">(</span><span class="n">g</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="n">varname</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="p">))</span>                    
                <span class="n">new_df</span><span class="p">[</span><span class="s1">&#39;latbin&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">g</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">])</span>
                <span class="n">new_df</span><span class="p">[</span><span class="s1">&#39;lonbin&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">g</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">1</span><span class="p">])</span>
                <span class="n">new_df</span><span class="p">[</span><span class="s1">&#39;stormid&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">g</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">2</span><span class="p">])</span>
                <span class="n">new_df</span><span class="p">[</span><span class="s1">&#39;season&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">g</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">3</span><span class="p">])</span>
            <span class="n">new_df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="o">.</span><span class="n">from_dict</span><span class="p">(</span><span class="n">new_df</span><span class="p">)</span>

            <span class="c1">#---------------------------------------------------------------------------------------------------</span>

            <span class="c1">#Group again by latbin,lonbin</span>
            <span class="c1">#Construct two 1D lists: zi (grid values) and coords, that correspond to the 2D grid</span>
            <span class="n">groups</span> <span class="o">=</span> <span class="n">new_df</span><span class="o">.</span><span class="n">groupby</span><span class="p">([</span><span class="s2">&quot;latbin&quot;</span><span class="p">,</span> <span class="s2">&quot;lonbin&quot;</span><span class="p">])</span>

            <span class="c1">#Apply the function to all storms that pass through a gridpoint</span>
            <span class="k">if</span> <span class="n">VEC_FLAG</span><span class="p">:</span>
                <span class="n">zi</span> <span class="o">=</span> <span class="p">[[</span><span class="n">func</span><span class="p">(</span><span class="n">v</span><span class="p">)</span> <span class="k">for</span> <span class="n">v</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="o">*</span><span class="n">g</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="n">varname</span><span class="p">])]</span> <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">g</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span> <span class="o">&gt;=</span> <span class="n">thresh</span><span class="p">[</span><span class="s1">&#39;sample_min&#39;</span><span class="p">]</span> <span class="k">else</span> <span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">nan</span><span class="p">]</span><span class="o">*</span><span class="mi">2</span> <span class="k">for</span> <span class="n">g</span> <span class="ow">in</span> <span class="n">groups</span><span class="p">]</span>
            <span class="k">elif</span> <span class="n">varname</span> <span class="o">==</span> <span class="s1">&#39;date&#39;</span><span class="p">:</span>
                <span class="n">zi</span> <span class="o">=</span> <span class="p">[</span><span class="n">func</span><span class="p">(</span><span class="n">g</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="n">varname</span><span class="p">])</span> <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">g</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span> <span class="o">&gt;=</span> <span class="n">thresh</span><span class="p">[</span><span class="s1">&#39;sample_min&#39;</span><span class="p">]</span> <span class="k">else</span> <span class="n">np</span><span class="o">.</span><span class="n">nan</span> <span class="k">for</span> <span class="n">g</span> <span class="ow">in</span> <span class="n">groups</span><span class="p">]</span>
                <span class="n">zi</span> <span class="o">=</span> <span class="p">[</span><span class="n">mdates</span><span class="o">.</span><span class="n">date2num</span><span class="p">(</span><span class="n">startdate</span><span class="o">+</span><span class="n">z</span><span class="p">)</span> <span class="k">for</span> <span class="n">z</span> <span class="ow">in</span> <span class="n">zi</span><span class="p">]</span>                
            <span class="k">else</span><span class="p">:</span>
                <span class="n">zi</span> <span class="o">=</span> <span class="p">[</span><span class="n">func</span><span class="p">(</span><span class="n">g</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="n">varname</span><span class="p">])</span> <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">g</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span> <span class="o">&gt;=</span> <span class="n">thresh</span><span class="p">[</span><span class="s1">&#39;sample_min&#39;</span><span class="p">]</span> <span class="k">else</span> <span class="n">np</span><span class="o">.</span><span class="n">nan</span> <span class="k">for</span> <span class="n">g</span> <span class="ow">in</span> <span class="n">groups</span><span class="p">]</span>

            <span class="c1">#Construct a 1D array of coordinates</span>
            <span class="n">coords</span> <span class="o">=</span> <span class="p">[</span><span class="n">g</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="k">for</span> <span class="n">g</span> <span class="ow">in</span> <span class="n">groups</span><span class="p">]</span>

            <span class="c1">#Construct a 2D longitude and latitude grid, using the specified binsize resolution</span>
            <span class="k">if</span> <span class="n">prop</span><span class="p">[</span><span class="s1">&#39;smooth&#39;</span><span class="p">]</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">all_lats</span> <span class="o">=</span> <span class="p">[(</span><span class="nb">round</span><span class="p">(</span><span class="n">l</span><span class="o">/</span><span class="n">binsize</span><span class="p">)</span><span class="o">*</span><span class="n">binsize</span><span class="p">)</span> <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">keys</span><span class="p">()</span> <span class="k">for</span> <span class="n">l</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="n">key</span><span class="p">][</span><span class="s1">&#39;lat&#39;</span><span class="p">]]</span>
                <span class="n">all_lons</span> <span class="o">=</span> <span class="p">[(</span><span class="nb">round</span><span class="p">(</span><span class="n">l</span><span class="o">/</span><span class="n">binsize</span><span class="p">)</span><span class="o">*</span><span class="n">binsize</span><span class="p">)</span><span class="o">%</span><span class="mi">360</span> <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">keys</span><span class="p">()</span> <span class="k">for</span> <span class="n">l</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="n">key</span><span class="p">][</span><span class="s1">&#39;lon&#39;</span><span class="p">]]</span>
                <span class="n">xi</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="nb">min</span><span class="p">(</span><span class="n">all_lons</span><span class="p">)</span><span class="o">-</span><span class="n">binsize</span><span class="p">,</span><span class="nb">max</span><span class="p">(</span><span class="n">all_lons</span><span class="p">)</span><span class="o">+</span><span class="mi">2</span><span class="o">*</span><span class="n">binsize</span><span class="p">,</span><span class="n">binsize</span><span class="p">)</span>
                <span class="n">yi</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="nb">min</span><span class="p">(</span><span class="n">all_lats</span><span class="p">)</span><span class="o">-</span><span class="n">binsize</span><span class="p">,</span><span class="nb">max</span><span class="p">(</span><span class="n">all_lats</span><span class="p">)</span><span class="o">+</span><span class="mi">2</span><span class="o">*</span><span class="n">binsize</span><span class="p">,</span><span class="n">binsize</span><span class="p">)</span>
                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">basin</span> <span class="o">==</span> <span class="s1">&#39;all&#39;</span><span class="p">:</span>
                    <span class="n">xi</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">360</span><span class="o">+</span><span class="n">binsize</span><span class="p">,</span><span class="n">binsize</span><span class="p">)</span>
                    <span class="n">yi</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="o">-</span><span class="mi">90</span><span class="p">,</span><span class="mi">90</span><span class="o">+</span><span class="n">binsize</span><span class="p">,</span><span class="n">binsize</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">xi</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">nanmin</span><span class="p">(</span><span class="n">points</span><span class="p">[</span><span class="s2">&quot;lonbin&quot;</span><span class="p">])</span><span class="o">-</span><span class="n">binsize</span><span class="p">,</span><span class="n">np</span><span class="o">.</span><span class="n">nanmax</span><span class="p">(</span><span class="n">points</span><span class="p">[</span><span class="s2">&quot;lonbin&quot;</span><span class="p">])</span><span class="o">+</span><span class="mi">2</span><span class="o">*</span><span class="n">binsize</span><span class="p">,</span><span class="n">binsize</span><span class="p">)</span>
                <span class="n">yi</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">nanmin</span><span class="p">(</span><span class="n">points</span><span class="p">[</span><span class="s2">&quot;latbin&quot;</span><span class="p">])</span><span class="o">-</span><span class="n">binsize</span><span class="p">,</span><span class="n">np</span><span class="o">.</span><span class="n">nanmax</span><span class="p">(</span><span class="n">points</span><span class="p">[</span><span class="s2">&quot;latbin&quot;</span><span class="p">])</span><span class="o">+</span><span class="mi">2</span><span class="o">*</span><span class="n">binsize</span><span class="p">,</span><span class="n">binsize</span><span class="p">)</span>
            <span class="n">grid_x</span><span class="p">,</span> <span class="n">grid_y</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">meshgrid</span><span class="p">(</span><span class="n">xi</span><span class="p">,</span><span class="n">yi</span><span class="p">)</span>
            <span class="n">grid_x_years</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">grid_x</span><span class="p">)</span>
            <span class="n">grid_y_years</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">grid_y</span><span class="p">)</span>

            <span class="c1">#Construct a 2D grid for the z value, depending on whether vector or scalar quantity</span>
            <span class="k">if</span> <span class="n">VEC_FLAG</span><span class="p">:</span>
                <span class="n">grid_z_u</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">(</span><span class="n">grid_x</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">nan</span>
                <span class="n">grid_z_v</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">(</span><span class="n">grid_x</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">nan</span>
                <span class="k">for</span> <span class="n">c</span><span class="p">,</span><span class="n">z</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">coords</span><span class="p">,</span><span class="n">zi</span><span class="p">):</span>
                    <span class="n">grid_z_u</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">((</span><span class="n">grid_y</span><span class="o">==</span><span class="n">c</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">grid_x</span><span class="o">==</span><span class="n">c</span><span class="p">[</span><span class="mi">1</span><span class="p">]))]</span> <span class="o">=</span> <span class="n">z</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
                    <span class="n">grid_z_v</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">((</span><span class="n">grid_y</span><span class="o">==</span><span class="n">c</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">grid_x</span><span class="o">==</span><span class="n">c</span><span class="p">[</span><span class="mi">1</span><span class="p">]))]</span> <span class="o">=</span> <span class="n">z</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
                <span class="n">grid_z</span> <span class="o">=</span> <span class="p">[</span><span class="n">grid_z_u</span><span class="p">,</span><span class="n">grid_z_v</span><span class="p">]</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">grid_z</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">(</span><span class="n">grid_x</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">nan</span>
                <span class="k">for</span> <span class="n">c</span><span class="p">,</span><span class="n">z</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">coords</span><span class="p">,</span><span class="n">zi</span><span class="p">):</span>
                    <span class="n">grid_z</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">((</span><span class="n">grid_y</span><span class="o">==</span><span class="n">c</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">grid_x</span><span class="o">==</span><span class="n">c</span><span class="p">[</span><span class="mi">1</span><span class="p">]))]</span> <span class="o">=</span> <span class="n">z</span>

            <span class="c1">#Set zero values to nan&#39;s if necessary</span>
            <span class="k">if</span> <span class="n">varname</span> <span class="o">==</span> <span class="s1">&#39;type&#39;</span><span class="p">:</span>
                <span class="n">grid_z</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">grid_z</span><span class="o">==</span><span class="mi">0</span><span class="p">)]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nan</span>
            
            <span class="c1">#Add to list of grid_z&#39;s</span>
            <span class="n">grid_z_years</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">grid_z</span><span class="p">)</span>
        
        <span class="c1">#---------------------------------------------------------------------------------------------------</span>
        
        <span class="c1">#Calculate difference between plots, if specified</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">grid_z_years</span><span class="p">)</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="c1">#Import xarray and construct DataArray</span>
                <span class="kn">import</span> <span class="nn">xarray</span> <span class="k">as</span> <span class="nn">xr</span>
                
                <span class="c1">#Determine whether to use averages</span>
                <span class="k">if</span> <span class="n">year_average</span><span class="p">:</span>
                    <span class="n">years_listed</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="n">year_range</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span><span class="n">year_range</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">+</span><span class="mi">1</span><span class="p">))</span>
                    <span class="n">grid_z_years</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">grid_z_years</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">/</span> <span class="n">years_listed</span>
                    <span class="n">years_listed</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="n">year_range_subtract</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span><span class="n">year_range_subtract</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">+</span><span class="mi">1</span><span class="p">))</span>
                    <span class="n">grid_z_years</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">grid_z_years</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">/</span> <span class="n">years_listed</span>
                   
                <span class="c1">#Construct DataArrays</span>
                <span class="n">grid_z_1</span> <span class="o">=</span> <span class="n">xr</span><span class="o">.</span><span class="n">DataArray</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">nan_to_num</span><span class="p">(</span><span class="n">grid_z_years</span><span class="p">[</span><span class="mi">0</span><span class="p">]),</span><span class="n">coords</span><span class="o">=</span><span class="p">[</span><span class="n">grid_y_years</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">T</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span><span class="n">grid_x_years</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">]],</span><span class="n">dims</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;lat&#39;</span><span class="p">,</span><span class="s1">&#39;lon&#39;</span><span class="p">])</span>
                <span class="n">grid_z_2</span> <span class="o">=</span> <span class="n">xr</span><span class="o">.</span><span class="n">DataArray</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">nan_to_num</span><span class="p">(</span><span class="n">grid_z_years</span><span class="p">[</span><span class="mi">1</span><span class="p">]),</span><span class="n">coords</span><span class="o">=</span><span class="p">[</span><span class="n">grid_y_years</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">T</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span><span class="n">grid_x_years</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="mi">0</span><span class="p">]],</span><span class="n">dims</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;lat&#39;</span><span class="p">,</span><span class="s1">&#39;lon&#39;</span><span class="p">])</span>
                
                <span class="c1">#Compute difference grid</span>
                <span class="n">grid_z</span> <span class="o">=</span> <span class="n">grid_z_1</span> <span class="o">-</span> <span class="n">grid_z_2</span>
                
                <span class="c1">#Reconstruct lat &amp; lon grids</span>
                <span class="n">xi</span> <span class="o">=</span> <span class="n">grid_z</span><span class="o">.</span><span class="n">lon</span><span class="o">.</span><span class="n">values</span>
                <span class="n">yi</span> <span class="o">=</span> <span class="n">grid_z</span><span class="o">.</span><span class="n">lat</span><span class="o">.</span><span class="n">values</span>
                <span class="n">grid_z</span> <span class="o">=</span> <span class="n">grid_z</span><span class="o">.</span><span class="n">values</span>
                <span class="n">grid_x</span><span class="p">,</span> <span class="n">grid_y</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">meshgrid</span><span class="p">(</span><span class="n">xi</span><span class="p">,</span><span class="n">yi</span><span class="p">)</span>
                
                <span class="c1">#Determine NaNs</span>
                <span class="n">grid_z_years</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="n">np</span><span class="o">.</span><span class="n">isnan</span><span class="p">(</span><span class="n">grid_z_years</span><span class="p">[</span><span class="mi">0</span><span class="p">])]</span> <span class="o">=</span> <span class="o">-</span><span class="mi">9999</span>
                <span class="n">grid_z_years</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="n">np</span><span class="o">.</span><span class="n">isnan</span><span class="p">(</span><span class="n">grid_z_years</span><span class="p">[</span><span class="mi">1</span><span class="p">])]</span> <span class="o">=</span> <span class="o">-</span><span class="mi">8999</span>
                <span class="n">grid_z_years</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="n">grid_z_years</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">!=-</span><span class="mi">9999</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span>
                <span class="n">grid_z_years</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="n">grid_z_years</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">!=-</span><span class="mi">8999</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span>
                <span class="n">grid_z_1</span> <span class="o">=</span> <span class="n">xr</span><span class="o">.</span><span class="n">DataArray</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">nan_to_num</span><span class="p">(</span><span class="n">grid_z_years</span><span class="p">[</span><span class="mi">0</span><span class="p">]),</span><span class="n">coords</span><span class="o">=</span><span class="p">[</span><span class="n">grid_y_years</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">T</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span><span class="n">grid_x_years</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">]],</span><span class="n">dims</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;lat&#39;</span><span class="p">,</span><span class="s1">&#39;lon&#39;</span><span class="p">])</span>
                <span class="n">grid_z_2</span> <span class="o">=</span> <span class="n">xr</span><span class="o">.</span><span class="n">DataArray</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">nan_to_num</span><span class="p">(</span><span class="n">grid_z_years</span><span class="p">[</span><span class="mi">1</span><span class="p">]),</span><span class="n">coords</span><span class="o">=</span><span class="p">[</span><span class="n">grid_y_years</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">T</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span><span class="n">grid_x_years</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="mi">0</span><span class="p">]],</span><span class="n">dims</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;lat&#39;</span><span class="p">,</span><span class="s1">&#39;lon&#39;</span><span class="p">])</span>
                <span class="n">grid_z_check</span> <span class="o">=</span> <span class="p">(</span><span class="n">grid_z_1</span> <span class="o">-</span> <span class="n">grid_z_2</span><span class="p">)</span><span class="o">.</span><span class="n">values</span>
                <span class="n">grid_z</span><span class="p">[</span><span class="n">grid_z_check</span><span class="o">==-</span><span class="mi">1000</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nan</span>
                <span class="nb">print</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">nanmin</span><span class="p">(</span><span class="n">grid_z</span><span class="p">))</span>
                
            <span class="k">except</span> <span class="ne">ImportError</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span><span class="s2">&quot;Error: xarray is not available. Install xarray in order to use the subtract year functionality.&quot;</span><span class="p">)</span> <span class="kn">from</span> <span class="nn">e</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="c1">#Determine whether to use averages</span>
            <span class="k">if</span> <span class="n">year_average</span><span class="p">:</span>
                <span class="n">years_listed</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="n">year_range</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span><span class="n">year_range</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">+</span><span class="mi">1</span><span class="p">))</span>
                <span class="n">grid_z</span> <span class="o">=</span> <span class="n">grid_z</span> <span class="o">/</span> <span class="n">years_listed</span>
        
        <span class="c1">#Create instance of plot object</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">plot_obj</span>
        <span class="k">except</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">plot_obj</span> <span class="o">=</span> <span class="n">TrackPlot</span><span class="p">()</span>
        
        <span class="c1">#Create cartopy projection using basin</span>
        <span class="k">if</span> <span class="n">domain</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">domain</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">basin</span>
        <span class="k">if</span> <span class="n">cartopy_proj</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">if</span> <span class="nb">max</span><span class="p">(</span><span class="n">points</span><span class="p">[</span><span class="s1">&#39;lon&#39;</span><span class="p">])</span> <span class="o">&gt;</span> <span class="mi">150</span> <span class="ow">or</span> <span class="nb">min</span><span class="p">(</span><span class="n">points</span><span class="p">[</span><span class="s1">&#39;lon&#39;</span><span class="p">])</span> <span class="o">&lt;</span> <span class="o">-</span><span class="mi">150</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">plot_obj</span><span class="o">.</span><span class="n">create_cartopy</span><span class="p">(</span><span class="n">proj</span><span class="o">=</span><span class="s1">&#39;PlateCarree&#39;</span><span class="p">,</span><span class="n">central_longitude</span><span class="o">=</span><span class="mf">180.0</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">plot_obj</span><span class="o">.</span><span class="n">create_cartopy</span><span class="p">(</span><span class="n">proj</span><span class="o">=</span><span class="s1">&#39;PlateCarree&#39;</span><span class="p">,</span><span class="n">central_longitude</span><span class="o">=</span><span class="mf">0.0</span><span class="p">)</span>
        
        <span class="c1">#Format left title for plot</span>
        <span class="n">endash</span> <span class="o">=</span> <span class="sa">u</span><span class="s2">&quot;</span><span class="se">\u2013</span><span class="s2">&quot;</span>
        <span class="n">dot</span> <span class="o">=</span> <span class="sa">u</span><span class="s2">&quot;</span><span class="se">\u2022</span><span class="s2">&quot;</span>
        <span class="n">title_L</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span>
        <span class="k">for</span> <span class="n">name</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;wind&#39;</span><span class="p">,</span><span class="s1">&#39;vmax&#39;</span><span class="p">]:</span>
            <span class="n">title_L</span> <span class="o">=</span> <span class="n">title_L</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="n">name</span><span class="p">,</span><span class="s1">&#39;wind (kt)&#39;</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">name</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;pressure&#39;</span><span class="p">,</span><span class="s1">&#39;mslp&#39;</span><span class="p">]:</span>
            <span class="n">title_L</span> <span class="o">=</span> <span class="n">title_L</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="n">name</span><span class="p">,</span><span class="s1">&#39;pressure (hPa)&#39;</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">name</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;heading&#39;</span><span class="p">,</span><span class="s1">&#39;motion&#39;</span><span class="p">]:</span>
            <span class="n">title_L</span> <span class="o">=</span> <span class="n">title_L</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="n">name</span><span class="p">,</span><span class="sa">f</span><span class="s1">&#39;heading (kt) over </span><span class="si">{</span><span class="n">thresh</span><span class="p">[</span><span class="s2">&quot;dt_window&quot;</span><span class="p">]</span><span class="si">}</span><span class="s1"> hours&#39;</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">name</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;speed&#39;</span><span class="p">,</span><span class="s1">&#39;movement&#39;</span><span class="p">]:</span>
            <span class="n">title_L</span> <span class="o">=</span> <span class="n">title_L</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="n">name</span><span class="p">,</span><span class="sa">f</span><span class="s1">&#39;forward speed (kt) over </span><span class="si">{</span><span class="n">thresh</span><span class="p">[</span><span class="s2">&quot;dt_window&quot;</span><span class="p">]</span><span class="si">}</span><span class="s1"> hours&#39;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">request</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s1">&#39;change&#39;</span><span class="p">)</span> <span class="o">&gt;=</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">title_L</span> <span class="o">=</span> <span class="n">title_L</span><span class="o">+</span><span class="sa">f</span><span class="s2">&quot;, </span><span class="si">{</span><span class="n">thresh</span><span class="p">[</span><span class="s1">&#39;dt_align&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2">&quot;</span>
        <span class="n">title_L</span> <span class="o">=</span> <span class="n">title_L</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">upper</span><span class="p">()</span> <span class="o">+</span> <span class="n">title_L</span><span class="p">[</span><span class="mi">1</span><span class="p">:]</span> <span class="o">+</span> <span class="n">plot_subtitle</span>
        
        <span class="c1">#Format right title for plot</span>
        <span class="k">if</span> <span class="n">storm</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">storm</span><span class="p">,</span><span class="nb">list</span><span class="p">):</span>
                <span class="n">title_R</span> <span class="o">=</span> <span class="s1">&#39;Storm Composite&#39;</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">storm</span><span class="p">,</span><span class="nb">str</span><span class="p">):</span>
                    <span class="n">storm</span> <span class="o">=</span> <span class="n">basin</span><span class="o">.</span><span class="n">get_storm_tuple</span><span class="p">(</span><span class="n">storm</span><span class="p">)</span>
                <span class="n">title_R</span> <span class="o">=</span> <span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">storm</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="si">}</span><span class="s1"> </span><span class="si">{</span><span class="n">storm</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="si">}</span><span class="s1">&#39;</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">date_range</span> <span class="o">=</span> <span class="p">[</span><span class="n">dt</span><span class="o">.</span><span class="n">strptime</span><span class="p">(</span><span class="n">d</span><span class="p">,</span><span class="s1">&#39;%m/</span><span class="si">%d</span><span class="s1">&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">strftime</span><span class="p">(</span><span class="s1">&#39;%b/</span><span class="si">%d</span><span class="s1">&#39;</span><span class="p">)</span> <span class="k">for</span> <span class="n">d</span> <span class="ow">in</span> <span class="n">date_range</span><span class="p">]</span>
            <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">subtract</span><span class="p">(</span><span class="o">*</span><span class="n">year_range</span><span class="p">)</span><span class="o">==</span><span class="mi">0</span><span class="p">:</span>
                <span class="n">y_r_title</span> <span class="o">=</span> <span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">year_range</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="si">}</span><span class="s1">&#39;</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">y_r_title</span> <span class="o">=</span> <span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">year_range</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="si">}</span><span class="s1"> </span><span class="si">{</span><span class="n">endash</span><span class="si">}</span><span class="s1"> </span><span class="si">{</span><span class="n">year_range</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="si">}</span><span class="s1">&#39;</span>
            <span class="n">add_avg</span> <span class="o">=</span> <span class="s1">&#39; year-avg&#39;</span> <span class="k">if</span> <span class="n">year_average</span> <span class="o">==</span> <span class="kc">True</span> <span class="k">else</span> <span class="s1">&#39;&#39;</span>
            <span class="k">if</span> <span class="n">year_range_subtract</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">title_R</span> <span class="o">=</span> <span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">date_range</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;/&quot;</span><span class="p">,</span><span class="s2">&quot; &quot;</span><span class="p">)</span><span class="si">}</span><span class="s1"> </span><span class="si">{</span><span class="n">endash</span><span class="si">}</span><span class="s1"> </span><span class="si">{</span><span class="n">date_range</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;/&quot;</span><span class="p">,</span><span class="s2">&quot; &quot;</span><span class="p">)</span><span class="si">}</span><span class="s1"> </span><span class="si">{</span><span class="n">dot</span><span class="si">}</span><span class="s1"> </span><span class="si">{</span><span class="n">y_r_title</span><span class="si">}{</span><span class="n">add_avg</span><span class="si">}</span><span class="s1">&#39;</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">subtract</span><span class="p">(</span><span class="o">*</span><span class="n">year_range_subtract</span><span class="p">)</span><span class="o">==</span><span class="mi">0</span><span class="p">:</span>
                    <span class="n">y_r_s_title</span> <span class="o">=</span> <span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">year_range_subtract</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="si">}</span><span class="s1">&#39;</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">y_r_s_title</span> <span class="o">=</span> <span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">year_range_subtract</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="si">}</span><span class="s1"> </span><span class="si">{</span><span class="n">endash</span><span class="si">}</span><span class="s1"> </span><span class="si">{</span><span class="n">year_range_subtract</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="si">}</span><span class="s1">&#39;</span>
                <span class="n">title_R</span> <span class="o">=</span> <span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">date_range</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;/&quot;</span><span class="p">,</span><span class="s2">&quot; &quot;</span><span class="p">)</span><span class="si">}</span><span class="s1"> </span><span class="si">{</span><span class="n">endash</span><span class="si">}</span><span class="s1"> </span><span class="si">{</span><span class="n">date_range</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;/&quot;</span><span class="p">,</span><span class="s2">&quot; &quot;</span><span class="p">)</span><span class="si">}</span><span class="se">\n</span><span class="si">{</span><span class="n">y_r_title</span><span class="si">}{</span><span class="n">add_avg</span><span class="si">}</span><span class="s1"> minus </span><span class="si">{</span><span class="n">y_r_s_title</span><span class="si">}{</span><span class="n">add_avg</span><span class="si">}</span><span class="s1">&#39;</span>
        <span class="n">prop</span><span class="p">[</span><span class="s1">&#39;title_L&#39;</span><span class="p">],</span><span class="n">prop</span><span class="p">[</span><span class="s1">&#39;title_R&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">title_L</span><span class="p">,</span><span class="n">title_R</span>
        
        <span class="c1">#Change the masking for variables that go out to zero near the edge of the data</span>
        <span class="k">if</span> <span class="n">prop</span><span class="p">[</span><span class="s1">&#39;smooth&#39;</span><span class="p">]</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            
            <span class="c1">#Replace NaNs with zeros to apply Gaussian filter</span>
            <span class="n">grid_z_zeros</span> <span class="o">=</span> <span class="n">grid_z</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
            <span class="n">grid_z_zeros</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">isnan</span><span class="p">(</span><span class="n">grid_z</span><span class="p">)]</span> <span class="o">=</span> <span class="mi">0</span>
            <span class="n">initial_mask</span> <span class="o">=</span> <span class="n">grid_z</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span> <span class="c1">#Save initial mask</span>
            <span class="n">initial_mask</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">isnan</span><span class="p">(</span><span class="n">grid_z</span><span class="p">)]</span> <span class="o">=</span> <span class="o">-</span><span class="mi">9999</span>
            <span class="n">grid_z_zeros</span> <span class="o">=</span> <span class="n">gfilt</span><span class="p">(</span><span class="n">grid_z_zeros</span><span class="p">,</span><span class="n">sigma</span><span class="o">=</span><span class="n">prop</span><span class="p">[</span><span class="s1">&#39;smooth&#39;</span><span class="p">])</span>
            
            
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">grid_z_years</span><span class="p">)</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>
                <span class="c1">#grid_z_1_zeros = np.asarray(grid_z_1)</span>
                <span class="c1">#grid_z_1_zeros[grid_z_1==-9999]=0</span>
                <span class="c1">#grid_z_1_zeros = gfilt(grid_z_1_zeros,sigma=prop[&#39;smooth&#39;])</span>
                
                <span class="c1">#grid_z_2_zeros = np.asarray(grid_z_2)</span>
                <span class="c1">#grid_z_2_zeros[grid_z_2==-8999]=0</span>
                <span class="c1">#grid_z_2_zeros = gfilt(grid_z_2_zeros,sigma=prop[&#39;smooth&#39;])</span>
                <span class="c1">#grid_z_zeros = grid_z_1_zeros - grid_z_2_zeros</span>
                <span class="c1">#test_zeros = (grid_z_1_zeros&lt;.02*np.nanmax(grid_z_1_zeros)) &amp; (grid_z_2_zeros&lt;.02*np.nanmax(grid_z_2_zeros))</span>
                <span class="k">pass</span>
            
            <span class="k">elif</span> <span class="n">varname</span> <span class="ow">not</span> <span class="ow">in</span> <span class="p">[(</span><span class="s1">&#39;dx_dt&#39;</span><span class="p">,</span><span class="s1">&#39;dy_dt&#39;</span><span class="p">),</span><span class="s1">&#39;speed&#39;</span><span class="p">,</span><span class="s1">&#39;mslp&#39;</span><span class="p">]:</span>
                
                <span class="c1">#Apply cutoff at 2% of maximum</span>
                <span class="n">test_zeros</span> <span class="o">=</span> <span class="p">(</span><span class="n">grid_z_zeros</span><span class="o">&lt;</span><span class="mf">.02</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">amax</span><span class="p">(</span><span class="n">grid_z_zeros</span><span class="p">))</span>
                <span class="n">grid_z_zeros</span><span class="p">[</span><span class="n">test_zeros</span><span class="p">]</span> <span class="o">=</span> <span class="o">-</span><span class="mi">9999</span>
                <span class="n">initial_mask</span> <span class="o">=</span> <span class="n">grid_z_zeros</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
                
            <span class="n">grid_z_zeros</span><span class="p">[</span><span class="n">initial_mask</span><span class="o">==-</span><span class="mi">9999</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nan</span>
            <span class="n">grid_z</span> <span class="o">=</span> <span class="n">grid_z_zeros</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
        
        <span class="c1">#Plot gridded field</span>
        <span class="n">plot_ax</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">plot_obj</span><span class="o">.</span><span class="n">plot_gridded</span><span class="p">(</span><span class="n">grid_x</span><span class="p">,</span><span class="n">grid_y</span><span class="p">,</span><span class="n">grid_z</span><span class="p">,</span><span class="n">varname</span><span class="p">,</span><span class="n">VEC_FLAG</span><span class="p">,</span><span class="n">domain</span><span class="p">,</span><span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">,</span><span class="n">prop</span><span class="o">=</span><span class="n">prop</span><span class="p">,</span><span class="n">map_prop</span><span class="o">=</span><span class="n">map_prop</span><span class="p">)</span>
        
        <span class="c1">#Format grid into xarray if specified</span>
        <span class="k">if</span> <span class="n">return_array</span><span class="p">:</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="c1">#Import xarray and construct DataArray, replacing NaNs with zeros</span>
                <span class="kn">import</span> <span class="nn">xarray</span> <span class="k">as</span> <span class="nn">xr</span>
                <span class="n">arr</span> <span class="o">=</span> <span class="n">xr</span><span class="o">.</span><span class="n">DataArray</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">nan_to_num</span><span class="p">(</span><span class="n">grid_z</span><span class="p">),</span><span class="n">coords</span><span class="o">=</span><span class="p">[</span><span class="n">grid_y</span><span class="o">.</span><span class="n">T</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span><span class="n">grid_x</span><span class="p">[</span><span class="mi">0</span><span class="p">]],</span><span class="n">dims</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;lat&#39;</span><span class="p">,</span><span class="s1">&#39;lon&#39;</span><span class="p">])</span>
                <span class="k">return</span> <span class="n">arr</span>
            <span class="k">except</span> <span class="ne">ImportError</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span><span class="s2">&quot;Error: xarray is not available. Install xarray in order to use the &#39;return_array&#39; flag.&quot;</span><span class="p">)</span> <span class="kn">from</span> <span class="nn">e</span>

        <span class="c1">#Return axis</span>
        <span class="k">if</span> <span class="n">return_array</span><span class="p">:</span>
            <span class="k">return</span> <span class="p">{</span><span class="s1">&#39;ax&#39;</span><span class="p">:</span><span class="n">plot_ax</span><span class="p">,</span><span class="s1">&#39;array&#39;</span><span class="p">:</span><span class="n">arr</span><span class="p">}</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">plot_ax</span></div>

    
<div class="viewcode-block" id="TrackDataset.assign_storm_tornadoes"><a class="viewcode-back" href="../../../api/generated/tropycal.tracks.TrackDataset.assign_storm_tornadoes.html#tropycal.tracks.TrackDataset.assign_storm_tornadoes">[docs]</a>    <span class="k">def</span> <span class="nf">assign_storm_tornadoes</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">dist_thresh</span><span class="o">=</span><span class="mi">1000</span><span class="p">,</span><span class="n">tornado_path</span><span class="o">=</span><span class="s1">&#39;spc&#39;</span><span class="p">):</span>
        
        <span class="sa">r</span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Assigns tornadoes to all North Atlantic tropical cyclones from TornadoDataset.</span>
<span class="sd">        </span>
<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        dist_thresh : int</span>
<span class="sd">            Distance threshold (in kilometers) from the tropical cyclone track over which to attribute tornadoes to the TC. Default is 1000 km.</span>
<span class="sd">        tornado_path : str</span>
<span class="sd">            Source to read tornado data from. Default is &quot;spc&quot;, which reads from the online Storm Prediction Center (SPC) 1950-present tornado database. Can change this to a local file.</span>
<span class="sd">        </span>
<span class="sd">        Notes</span>
<span class="sd">        -----</span>
<span class="sd">        If you intend on analyzing tornadoes for multiple tropical cyclones using a Storm object, it is recommended to run this function first to avoid the need to re-read the entire tornado database for each Storm object.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        
        <span class="c1">#Check to ensure data source is over North Atlantic</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">basin</span> <span class="o">!=</span> <span class="s2">&quot;north_atlantic&quot;</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span><span class="s2">&quot;Tropical cyclone tornado data is only available for the North Atlantic basin.&quot;</span><span class="p">)</span>
        
        <span class="c1">#Check to see if tornado data already exists in this instance</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">TorDataset</span> <span class="o">=</span> <span class="n">TornadoDataset</span><span class="p">(</span><span class="n">tornado_path</span><span class="o">=</span><span class="n">tornado_path</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">tornado_dist_thresh</span> <span class="o">=</span> <span class="n">dist_thresh</span>
        
        <span class="c1">#Iterate through all storms in dataset and assign them tornadoes, if they exist</span>
        <span class="n">timer_start</span> <span class="o">=</span> <span class="n">dt</span><span class="o">.</span><span class="n">now</span><span class="p">()</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;--&gt; Starting to assign tornadoes to storms&#39;</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">i</span><span class="p">,</span><span class="n">key</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">keys</span><span class="p">):</span>
            
            <span class="c1">#Skip years prior to 1950</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="n">key</span><span class="p">][</span><span class="s1">&#39;year&#39;</span><span class="p">]</span> <span class="o">&lt;</span> <span class="mi">1950</span><span class="p">:</span> <span class="k">continue</span>
                
            <span class="c1">#Get tornado data for storm</span>
            <span class="n">storm_obj</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_storm</span><span class="p">(</span><span class="n">key</span><span class="p">)</span>
            <span class="n">tor_data</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">TorDataset</span><span class="o">.</span><span class="n">get_storm_tornadoes</span><span class="p">(</span><span class="n">storm_obj</span><span class="p">,</span><span class="n">dist_thresh</span><span class="o">=</span><span class="n">dist_thresh</span><span class="p">)</span>
            <span class="n">tor_data</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">TorDataset</span><span class="o">.</span><span class="n">rotateToHeading</span><span class="p">(</span><span class="n">storm_obj</span><span class="p">,</span><span class="n">tor_data</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">data_tors</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="n">tor_data</span>
            
            <span class="c1">#Check if storm contains tornadoes</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">tor_data</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">keys_tors</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span>
                
        <span class="c1">#Update user on status</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;--&gt; Completed assigning tornadoes to storm (%.2f seconds)&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">dt</span><span class="o">.</span><span class="n">now</span><span class="p">()</span><span class="o">-</span><span class="n">timer_start</span><span class="p">)</span><span class="o">.</span><span class="n">total_seconds</span><span class="p">())</span></div>
        
<div class="viewcode-block" id="TrackDataset.plot_TCtors_rotated"><a class="viewcode-back" href="../../../api/generated/tropycal.tracks.TrackDataset.plot_TCtors_rotated.html#tropycal.tracks.TrackDataset.plot_TCtors_rotated">[docs]</a>    <span class="k">def</span> <span class="nf">plot_TCtors_rotated</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">storms</span><span class="p">,</span><span class="n">mag_thresh</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span><span class="n">return_df</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span><span class="n">save_path</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        
        <span class="sa">r</span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Plot tracks of tornadoes relative to the storm motion vector of the tropical cyclone.</span>
<span class="sd">        </span>
<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        storms : list or str</span>
<span class="sd">            Storm(s) for which to plot motion-relative tornado data for. Can be either a list of storm IDs/tuples for which to create a composite of, or a string &quot;all&quot; for all storms containing tornado data.</span>
<span class="sd">        mag_thresh : int</span>
<span class="sd">            Minimum threshold for tornado rating.</span>
<span class="sd">        return_df : bool</span>
<span class="sd">            Whether to return the pandas DataFrame containing the composite tornado data. Default is False.</span>
<span class="sd">        save_path : str</span>
<span class="sd">            Relative or full path of directory to save the image in. If none, image will not be saved.</span>
<span class="sd">        </span>
<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        ax or dict</span>
<span class="sd">            By default, the plot axes is returned. If &quot;return_df&quot; is set to True, returns a dict containing both the data and the axes plot</span>
<span class="sd">        </span>
<span class="sd">        Notes</span>
<span class="sd">        -----</span>
<span class="sd">        The motion vector is oriented upwards (in the +y direction).</span>
<span class="sd">        &quot;&quot;&quot;</span>
        
        <span class="c1">#Error check</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">TorDataset</span>
        <span class="k">except</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span><span class="s2">&quot;No tornado data has been attributed to this dataset. Please run </span><span class="se">\&quot;</span><span class="s2">TrackDataset.assign_storm_tornadoes()</span><span class="se">\&quot;</span><span class="s2"> first.&quot;</span><span class="p">)</span>
        
        <span class="c1">#Error check</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">mag_thresh</span><span class="p">,</span><span class="nb">int</span><span class="p">)</span> <span class="o">==</span> <span class="kc">False</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s2">&quot;mag_thresh must be of type int.&quot;</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">mag_thresh</span> <span class="ow">not</span> <span class="ow">in</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">3</span><span class="p">,</span><span class="mi">4</span><span class="p">,</span><span class="mi">5</span><span class="p">]:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;mag_thresh must be between 0 and 5.&quot;</span><span class="p">)</span>
        
        <span class="c1">#Get IDs of all storms to composite</span>
        <span class="k">if</span> <span class="n">storms</span> <span class="o">==</span> <span class="s1">&#39;all&#39;</span><span class="p">:</span>
            <span class="n">storms</span> <span class="o">=</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">keys</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">keys</span><span class="p">))</span> <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">keys_tors</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">==</span> <span class="mi">1</span><span class="p">]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">storms</span><span class="p">)</span><span class="o">==</span><span class="mi">2</span> <span class="ow">and</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">storms</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span><span class="nb">int</span><span class="p">):</span>
                <span class="n">use_storms</span> <span class="o">=</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">get_storm_id</span><span class="p">(</span><span class="n">storms</span><span class="p">)]</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">use_storms</span> <span class="o">=</span> <span class="p">[</span><span class="n">i</span> <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="nb">str</span><span class="p">)</span> <span class="o">==</span> <span class="kc">True</span> <span class="k">else</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_storm_id</span><span class="p">(</span><span class="n">i</span><span class="p">)</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">storms</span><span class="p">]</span>
            <span class="n">storms</span> <span class="o">=</span> <span class="p">[</span><span class="n">i</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">use_storms</span> <span class="k">if</span> <span class="n">i</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">keys</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">keys_tors</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">keys</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="n">i</span><span class="p">)]</span> <span class="o">==</span> <span class="mi">1</span><span class="p">]</span>
            
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">storms</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span><span class="s2">&quot;None of the requested storms produced any tornadoes.&quot;</span><span class="p">)</span>
        
        <span class="c1">#Get stormTors formatted with requested storm(s)</span>
        <span class="n">stormTors</span> <span class="o">=</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">data_tors</span><span class="p">[</span><span class="n">storms</span><span class="p">[</span><span class="mi">0</span><span class="p">]])</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
        <span class="n">stormTors</span><span class="p">[</span><span class="s1">&#39;storm_id&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="n">storms</span><span class="p">[</span><span class="mi">0</span><span class="p">]]</span><span class="o">*</span><span class="nb">len</span><span class="p">(</span><span class="n">stormTors</span><span class="p">)</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">storms</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">storm</span> <span class="ow">in</span> <span class="n">storms</span><span class="p">[</span><span class="mi">1</span><span class="p">:]:</span>
                <span class="n">storm_df</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">data_tors</span><span class="p">[</span><span class="n">storm</span><span class="p">]</span>
                <span class="n">storm_df</span><span class="p">[</span><span class="s1">&#39;storm_id&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="n">storm</span><span class="p">]</span><span class="o">*</span><span class="nb">len</span><span class="p">(</span><span class="n">storm_df</span><span class="p">)</span>
                <span class="n">stormTors</span> <span class="o">=</span> <span class="n">stormTors</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">storm_df</span><span class="p">)</span>
        
        <span class="c1">#Create figure for plotting</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">9</span><span class="p">,</span><span class="mi">9</span><span class="p">),</span><span class="n">dpi</span><span class="o">=</span><span class="mi">150</span><span class="p">)</span>
        <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplot</span><span class="p">()</span>
        
        <span class="c1">#Default EF color scale</span>
        <span class="n">EFcolors</span> <span class="o">=</span> <span class="n">get_colors_ef</span><span class="p">(</span><span class="s1">&#39;default&#39;</span><span class="p">)</span>
        
        <span class="c1">#Number of storms exceeding mag_thresh</span>
        <span class="n">num_storms</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">unique</span><span class="p">(</span><span class="n">stormTors</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">stormTors</span><span class="p">[</span><span class="s1">&#39;mag&#39;</span><span class="p">]</span><span class="o">&gt;=</span><span class="n">mag_thresh</span><span class="p">][</span><span class="s1">&#39;storm_id&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="p">))</span>
        
        <span class="c1">#Filter for mag &gt;= mag_thresh, and sort by mag so highest will be plotted on top</span>
        <span class="n">stormTors</span> <span class="o">=</span> <span class="n">stormTors</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">stormTors</span><span class="p">[</span><span class="s1">&#39;mag&#39;</span><span class="p">]</span><span class="o">&gt;=</span><span class="n">mag_thresh</span><span class="p">]</span><span class="o">.</span><span class="n">sort_values</span><span class="p">(</span><span class="s1">&#39;mag&#39;</span><span class="p">)</span>

        <span class="c1">#Plot all tornado tracks in motion relative coords</span>
        <span class="k">for</span> <span class="n">_</span><span class="p">,</span><span class="n">row</span> <span class="ow">in</span> <span class="n">stormTors</span><span class="o">.</span><span class="n">iterrows</span><span class="p">():</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">([</span><span class="n">row</span><span class="p">[</span><span class="s1">&#39;rot_xdist_s&#39;</span><span class="p">],</span><span class="n">row</span><span class="p">[</span><span class="s1">&#39;rot_xdist_e&#39;</span><span class="p">]</span><span class="o">+</span><span class="mf">.01</span><span class="p">],[</span><span class="n">row</span><span class="p">[</span><span class="s1">&#39;rot_ydist_s&#39;</span><span class="p">],</span><span class="n">row</span><span class="p">[</span><span class="s1">&#39;rot_ydist_e&#39;</span><span class="p">]</span><span class="o">+</span><span class="mf">.01</span><span class="p">],</span>\
                     <span class="n">lw</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span><span class="n">c</span><span class="o">=</span><span class="n">EFcolors</span><span class="p">[</span><span class="n">row</span><span class="p">[</span><span class="s1">&#39;mag&#39;</span><span class="p">]])</span>
            
        <span class="c1">#Plot dist_thresh radius</span>
        <span class="n">dist_thresh</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">tornado_dist_thresh</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">set_facecolor</span><span class="p">(</span><span class="s1">&#39;#F6F6F6&#39;</span><span class="p">)</span>
        <span class="n">circle</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">Circle</span><span class="p">((</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">),</span> <span class="n">dist_thresh</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;w&#39;</span><span class="p">)</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">add_artist</span><span class="p">(</span><span class="n">circle</span><span class="p">)</span>
        <span class="n">an</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="p">,</span> <span class="mi">100</span><span class="p">)</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">dist_thresh</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">an</span><span class="p">),</span> <span class="n">dist_thresh</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">an</span><span class="p">),</span><span class="s1">&#39;k&#39;</span><span class="p">)</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">([</span><span class="o">-</span><span class="n">dist_thresh</span><span class="p">,</span><span class="n">dist_thresh</span><span class="p">],[</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">],</span><span class="s1">&#39;k--&#39;</span><span class="p">,</span><span class="n">lw</span><span class="o">=</span><span class="mf">.5</span><span class="p">)</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">],[</span><span class="o">-</span><span class="n">dist_thresh</span><span class="p">,</span><span class="n">dist_thresh</span><span class="p">],</span><span class="s1">&#39;k--&#39;</span><span class="p">,</span><span class="n">lw</span><span class="o">=</span><span class="mf">.5</span><span class="p">)</span>
        
        <span class="c1">#Plot motion vector</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">arrow</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="o">-</span><span class="n">dist_thresh</span><span class="o">*</span><span class="mf">.1</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">dist_thresh</span><span class="o">*</span><span class="mf">.2</span><span class="p">,</span> <span class="n">length_includes_head</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
          <span class="n">head_width</span><span class="o">=</span><span class="mi">45</span><span class="p">,</span> <span class="n">head_length</span><span class="o">=</span><span class="mi">45</span><span class="p">,</span><span class="n">fc</span><span class="o">=</span><span class="s1">&#39;k&#39;</span><span class="p">,</span><span class="n">lw</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span><span class="n">zorder</span><span class="o">=</span><span class="mi">100</span><span class="p">)</span>
        
        <span class="c1">#Labels</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">set_aspect</span><span class="p">(</span><span class="s1">&#39;equal&#39;</span><span class="p">,</span> <span class="s1">&#39;box&#39;</span><span class="p">)</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;Left/Right of Storm Heading (km)&#39;</span><span class="p">,</span><span class="n">fontsize</span><span class="o">=</span><span class="mi">13</span><span class="p">)</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;Behind/Ahead of Storm Heading (km)&#39;</span><span class="p">,</span><span class="n">fontsize</span><span class="o">=</span><span class="mi">13</span><span class="p">)</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Composite motion-relative tornadoes</span><span class="se">\n</span><span class="s1">Min threshold: EF-</span><span class="si">{</span><span class="n">mag_thresh</span><span class="si">}</span><span class="s1"> | n=</span><span class="si">{</span><span class="n">num_storms</span><span class="si">}</span><span class="s1"> storms&#39;</span><span class="p">,</span><span class="n">fontsize</span><span class="o">=</span><span class="mi">14</span><span class="p">,</span><span class="n">fontweight</span><span class="o">=</span><span class="s1">&#39;bold&#39;</span><span class="p">)</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">tick_params</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="s1">&#39;both&#39;</span><span class="p">,</span> <span class="n">which</span><span class="o">=</span><span class="s1">&#39;major&#39;</span><span class="p">,</span> <span class="n">labelsize</span><span class="o">=</span><span class="mf">11.5</span><span class="p">)</span>
        
        <span class="c1">#Add legend</span>
        <span class="n">handles</span><span class="o">=</span><span class="p">[]</span>
        <span class="k">for</span> <span class="n">ef</span><span class="p">,</span><span class="n">color</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">EFcolors</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">ef</span> <span class="o">&gt;=</span> <span class="n">mag_thresh</span><span class="p">:</span>
                <span class="n">count</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">stormTors</span><span class="p">[</span><span class="n">stormTors</span><span class="p">[</span><span class="s1">&#39;mag&#39;</span><span class="p">]</span><span class="o">==</span><span class="n">ef</span><span class="p">])</span>
                <span class="n">handles</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">mlines</span><span class="o">.</span><span class="n">Line2D</span><span class="p">([],</span> <span class="p">[],</span> <span class="n">linestyle</span><span class="o">=</span><span class="s1">&#39;-&#39;</span><span class="p">,</span><span class="n">color</span><span class="o">=</span><span class="n">color</span><span class="p">,</span><span class="n">label</span><span class="o">=</span><span class="sa">f</span><span class="s1">&#39;EF-</span><span class="si">{</span><span class="n">ef</span><span class="si">}</span><span class="s1"> (</span><span class="si">{</span><span class="n">count</span><span class="si">}</span><span class="s1">)&#39;</span><span class="p">))</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">handles</span><span class="o">=</span><span class="n">handles</span><span class="p">,</span><span class="n">loc</span><span class="o">=</span><span class="s1">&#39;lower left&#39;</span><span class="p">,</span><span class="n">fontsize</span><span class="o">=</span><span class="mf">11.5</span><span class="p">)</span>
        
        <span class="c1">#Add attribution</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">text</span><span class="p">(</span><span class="mf">0.99</span><span class="p">,</span><span class="mf">0.01</span><span class="p">,</span><span class="n">plot_credit</span><span class="p">(),</span><span class="n">fontsize</span><span class="o">=</span><span class="mi">8</span><span class="p">,</span><span class="n">color</span><span class="o">=</span><span class="s1">&#39;k&#39;</span><span class="p">,</span><span class="n">alpha</span><span class="o">=</span><span class="mf">0.7</span><span class="p">,</span>
                <span class="n">transform</span><span class="o">=</span><span class="n">ax</span><span class="o">.</span><span class="n">transAxes</span><span class="p">,</span><span class="n">ha</span><span class="o">=</span><span class="s1">&#39;right&#39;</span><span class="p">,</span><span class="n">va</span><span class="o">=</span><span class="s1">&#39;bottom&#39;</span><span class="p">,</span><span class="n">zorder</span><span class="o">=</span><span class="mi">10</span><span class="p">)</span>
        
        <span class="c1">#Save image if specified</span>
        <span class="k">if</span> <span class="n">save_path</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">save_path</span><span class="p">,</span><span class="nb">str</span><span class="p">):</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="n">save_path</span><span class="p">,</span><span class="n">bbox_inches</span><span class="o">=</span><span class="s1">&#39;tight&#39;</span><span class="p">)</span>
        
        <span class="c1">#Return data</span>
        <span class="k">if</span> <span class="n">return_df</span><span class="p">:</span>
            <span class="k">return</span> <span class="p">{</span><span class="s1">&#39;ax&#39;</span><span class="p">:</span><span class="n">ax</span><span class="p">,</span><span class="s1">&#39;df&#39;</span><span class="p">:</span><span class="n">stormTors</span><span class="p">}</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">ax</span></div>

    
<div class="viewcode-block" id="TrackDataset.to_dataframe"><a class="viewcode-back" href="../../../api/generated/tropycal.tracks.TrackDataset.to_dataframe.html#tropycal.tracks.TrackDataset.to_dataframe">[docs]</a>    <span class="k">def</span> <span class="nf">to_dataframe</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>

        <span class="sa">r</span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Retrieve a Pandas DataFrame for all seasons within TrackDataset.</span>
<span class="sd">        </span>
<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        pandas.DataFrame</span>
<span class="sd">            Returns a Pandas DataFrame containing requested data.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="c1">#Get start and end seasons in this TrackDataset object</span>
        <span class="n">start_season</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">keys</span><span class="p">[</span><span class="mi">0</span><span class="p">]][</span><span class="s1">&#39;year&#39;</span><span class="p">]</span>
        <span class="n">end_season</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">keys</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]][</span><span class="s1">&#39;year&#39;</span><span class="p">]</span>

        <span class="c1">#Create empty dict to be used for making pandas DataFrame object</span>
        <span class="n">ds</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;season&#39;</span><span class="p">:[],</span><span class="s1">&#39;all_storms&#39;</span><span class="p">:[],</span><span class="s1">&#39;named_storms&#39;</span><span class="p">:[],</span><span class="s1">&#39;hurricanes&#39;</span><span class="p">:[],</span><span class="s1">&#39;major_hurricanes&#39;</span><span class="p">:[],</span><span class="s1">&#39;ace&#39;</span><span class="p">:[],</span><span class="s1">&#39;start_time&#39;</span><span class="p">:[],</span><span class="s1">&#39;end_time&#39;</span><span class="p">:[]}</span>

        <span class="c1">#Iterate over all seasons in the TrackDataset object</span>
        <span class="k">for</span> <span class="n">season</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">start_season</span><span class="p">,</span><span class="n">end_season</span><span class="o">+</span><span class="mi">1</span><span class="p">):</span>

            <span class="c1">#Get season summary, if season can be retrieved</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">season_summary</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_season</span><span class="p">(</span><span class="n">season</span><span class="p">)</span><span class="o">.</span><span class="n">summary</span><span class="p">()</span>
            <span class="k">except</span><span class="p">:</span>
                <span class="k">continue</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">season_summary</span><span class="p">[</span><span class="s1">&#39;id&#39;</span><span class="p">])</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span> <span class="k">continue</span>

            <span class="c1">#Add information to dict</span>
            <span class="n">ds</span><span class="p">[</span><span class="s1">&#39;season&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">season</span><span class="p">)</span>
            <span class="n">ds</span><span class="p">[</span><span class="s1">&#39;all_storms&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">season_summary</span><span class="p">[</span><span class="s1">&#39;season_storms&#39;</span><span class="p">])</span>
            <span class="n">ds</span><span class="p">[</span><span class="s1">&#39;named_storms&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">season_summary</span><span class="p">[</span><span class="s1">&#39;season_named&#39;</span><span class="p">])</span>
            <span class="n">ds</span><span class="p">[</span><span class="s1">&#39;hurricanes&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">season_summary</span><span class="p">[</span><span class="s1">&#39;season_hurricane&#39;</span><span class="p">])</span>
            <span class="n">ds</span><span class="p">[</span><span class="s1">&#39;major_hurricanes&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">season_summary</span><span class="p">[</span><span class="s1">&#39;season_major&#39;</span><span class="p">])</span>
            <span class="n">ds</span><span class="p">[</span><span class="s1">&#39;ace&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">season_summary</span><span class="p">[</span><span class="s1">&#39;season_ace&#39;</span><span class="p">])</span>
            <span class="n">ds</span><span class="p">[</span><span class="s1">&#39;start_time&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">season_summary</span><span class="p">[</span><span class="s1">&#39;season_start&#39;</span><span class="p">])</span>
            <span class="n">ds</span><span class="p">[</span><span class="s1">&#39;end_time&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">season_summary</span><span class="p">[</span><span class="s1">&#39;season_end&#39;</span><span class="p">])</span>

        <span class="c1">#Convert entire dict to a DataFrame</span>
        <span class="n">ds</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">ds</span><span class="p">)</span>

        <span class="c1">#Return dataset</span>
        <span class="k">return</span> <span class="n">ds</span><span class="o">.</span><span class="n">set_index</span><span class="p">(</span><span class="s1">&#39;season&#39;</span><span class="p">)</span></div>

<div class="viewcode-block" id="TrackDataset.climatology"><a class="viewcode-back" href="../../../api/generated/tropycal.tracks.TrackDataset.climatology.html#tropycal.tracks.TrackDataset.climatology">[docs]</a>    <span class="k">def</span> <span class="nf">climatology</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">year_range</span><span class="o">=</span><span class="p">(</span><span class="mi">1991</span><span class="p">,</span><span class="mi">2020</span><span class="p">)):</span>

        <span class="sa">r</span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Create a climatology for this dataset given start and end seasons. If none passed, defaults to 1991-2020.</span>
<span class="sd">        </span>
<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        year_range : list or tuple, optional</span>
<span class="sd">            Start and end year for the climatology range. Default is (1991,2020).</span>
<span class="sd">        </span>
<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        dict</span>
<span class="sd">            Dictionary containing the climatology for this dataset.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="c1">#Error check</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">year_range</span><span class="p">,(</span><span class="nb">list</span><span class="p">,</span><span class="nb">tuple</span><span class="p">)):</span>
            <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s2">&quot;year_range must be of type list or tuple.&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">year_range</span><span class="p">)</span> <span class="o">!=</span> <span class="mi">2</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s2">&quot;year_range must have two elements, start and end year.&quot;</span><span class="p">)</span>
        <span class="n">start_season</span><span class="p">,</span><span class="n">end_season</span> <span class="o">=</span> <span class="n">year_range</span>
        <span class="k">if</span> <span class="n">start_season</span> <span class="o">&gt;=</span> <span class="n">end_season</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;start_season cannot be greater than end_season.&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">start_season</span><span class="p">,(</span><span class="nb">int</span><span class="p">,</span><span class="n">np</span><span class="o">.</span><span class="n">int</span><span class="p">,</span><span class="n">np</span><span class="o">.</span><span class="n">integer</span><span class="p">,</span><span class="nb">float</span><span class="p">,</span><span class="n">np</span><span class="o">.</span><span class="n">floating</span><span class="p">))</span> <span class="ow">or</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">end_season</span><span class="p">,(</span><span class="nb">int</span><span class="p">,</span><span class="n">np</span><span class="o">.</span><span class="n">int</span><span class="p">,</span><span class="n">np</span><span class="o">.</span><span class="n">integer</span><span class="p">,</span><span class="nb">float</span><span class="p">,</span><span class="n">np</span><span class="o">.</span><span class="n">floating</span><span class="p">)):</span>
            <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s2">&quot;start_season and end_season must be of type int.&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">end_season</span> <span class="o">-</span> <span class="n">start_season</span><span class="p">)</span> <span class="o">&lt;</span> <span class="mi">5</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;A minimum of 5 seasons is required for constructing a climatology.&quot;</span><span class="p">)</span>

        <span class="c1">#Retrieve data for all seasons in this dataset</span>
        <span class="n">full_climo</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">to_dataframe</span><span class="p">()</span>
        <span class="n">subset_climo</span> <span class="o">=</span> <span class="n">full_climo</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">start_season</span><span class="p">:</span><span class="n">end_season</span><span class="o">+</span><span class="mi">1</span><span class="p">]</span>

        <span class="c1">#Convert dates to julian days</span>
        <span class="n">julian_start</span> <span class="o">=</span> <span class="p">[</span><span class="n">convert_to_julian</span><span class="p">(</span><span class="n">pd</span><span class="o">.</span><span class="n">to_datetime</span><span class="p">(</span><span class="n">i</span><span class="p">))</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">subset_climo</span><span class="p">[</span><span class="s1">&#39;start_time&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="p">]</span>
        <span class="n">julian_end</span> <span class="o">=</span> <span class="p">[</span><span class="n">convert_to_julian</span><span class="p">(</span><span class="n">pd</span><span class="o">.</span><span class="n">to_datetime</span><span class="p">(</span><span class="n">i</span><span class="p">))</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">subset_climo</span><span class="p">[</span><span class="s1">&#39;end_time&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="p">]</span>
        <span class="n">julian_end</span> <span class="o">=</span> <span class="p">[</span><span class="n">i</span><span class="o">+</span><span class="mi">365</span> <span class="k">if</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="mi">100</span> <span class="k">else</span> <span class="n">i</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">julian_end</span><span class="p">]</span>
        <span class="n">subset_climo</span> <span class="o">=</span> <span class="n">subset_climo</span><span class="o">.</span><span class="n">drop</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;start_time&#39;</span><span class="p">,</span><span class="s1">&#39;end_time&#39;</span><span class="p">])</span>
        <span class="n">subset_climo</span><span class="p">[</span><span class="s1">&#39;start_time&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">julian_start</span>
        <span class="n">subset_climo</span><span class="p">[</span><span class="s1">&#39;end_time&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">julian_end</span>

        <span class="n">subset_climo_means</span> <span class="o">=</span> <span class="p">(</span><span class="n">subset_climo</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">))</span><span class="o">.</span><span class="n">round</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>

        <span class="n">climatology</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;all_storms&#39;</span><span class="p">,</span><span class="s1">&#39;named_storms&#39;</span><span class="p">,</span><span class="s1">&#39;hurricanes&#39;</span><span class="p">,</span><span class="s1">&#39;major_hurricanes&#39;</span><span class="p">,</span><span class="s1">&#39;ace&#39;</span><span class="p">]:</span>
            <span class="n">climatology</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="n">subset_climo_means</span><span class="p">[</span><span class="n">key</span><span class="p">]</span>
        <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;start_time&#39;</span><span class="p">,</span><span class="s1">&#39;end_time&#39;</span><span class="p">]:</span>
            <span class="n">climatology</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="n">dt</span><span class="p">(</span><span class="n">dt</span><span class="o">.</span><span class="n">now</span><span class="p">()</span><span class="o">.</span><span class="n">year</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="mi">12</span><span class="p">,</span><span class="mi">31</span><span class="p">)</span><span class="o">+</span><span class="n">timedelta</span><span class="p">(</span><span class="n">hours</span><span class="o">=</span><span class="mi">24</span><span class="o">*</span><span class="n">subset_climo_means</span><span class="p">[</span><span class="n">key</span><span class="p">])</span>

        <span class="k">return</span> <span class="n">climatology</span></div>

<div class="viewcode-block" id="TrackDataset.season_composite"><a class="viewcode-back" href="../../../api/generated/tropycal.tracks.TrackDataset.season_composite.html#tropycal.tracks.TrackDataset.season_composite">[docs]</a>    <span class="k">def</span> <span class="nf">season_composite</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">seasons</span><span class="p">,</span><span class="n">climo_bounds</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>

        <span class="sa">r</span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Create composite statistics for a list of seasons.</span>
<span class="sd">        </span>
<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        seasons : list</span>
<span class="sd">            List of seasons to create a composite of. For Southern Hemisphere, season is the start of the two-year period.</span>
<span class="sd">        climo_bounds : list or tuple</span>
<span class="sd">            List or tuple of start and end years of climatology bounds. If none, defaults to (1991,2020).</span>
<span class="sd">        </span>
<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        dict</span>
<span class="sd">            Dictionary containing the composite of the requested seasons.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">seasons</span><span class="p">,</span><span class="nb">list</span><span class="p">)</span> <span class="o">==</span> <span class="kc">False</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s2">&quot;&#39;seasons&#39; must be of type list.&quot;</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">climo_bounds</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">climo_bounds</span> <span class="o">=</span> <span class="p">(</span><span class="mi">1991</span><span class="p">,</span><span class="mi">2020</span><span class="p">)</span>

        <span class="n">summary</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_season</span><span class="p">(</span><span class="n">seasons</span><span class="p">)</span><span class="o">.</span><span class="n">summary</span><span class="p">()</span>

        <span class="n">climatology</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">climatology</span><span class="p">(</span><span class="n">climo_bounds</span><span class="p">)</span>
        <span class="n">full_climo</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">to_dataframe</span><span class="p">()</span>
        <span class="n">subset_climo</span> <span class="o">=</span> <span class="n">full_climo</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">climo_bounds</span><span class="p">[</span><span class="mi">0</span><span class="p">]:</span><span class="n">climo_bounds</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">+</span><span class="mi">1</span><span class="p">]</span>

        <span class="c1">#Create composite dictionary</span>
        <span class="n">map_keys</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;all_storms&#39;</span><span class="p">:</span><span class="s1">&#39;season_storms&#39;</span><span class="p">,</span>
                    <span class="s1">&#39;named_storms&#39;</span><span class="p">:</span><span class="s1">&#39;season_named&#39;</span><span class="p">,</span>
                    <span class="s1">&#39;hurricanes&#39;</span><span class="p">:</span><span class="s1">&#39;season_hurricane&#39;</span><span class="p">,</span>
                    <span class="s1">&#39;major_hurricanes&#39;</span><span class="p">:</span><span class="s1">&#39;season_major&#39;</span><span class="p">,</span>
                    <span class="s1">&#39;ace&#39;</span><span class="p">:</span><span class="s1">&#39;season_ace&#39;</span><span class="p">,</span>
                   <span class="p">}</span>
        <span class="n">composite</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="n">map_keys</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>

            <span class="c1">#Get list from seasons</span>
            <span class="n">season_list</span> <span class="o">=</span> <span class="n">summary</span><span class="p">[</span><span class="n">map_keys</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">key</span><span class="p">)]</span>
            <span class="n">season_climo</span> <span class="o">=</span> <span class="n">climatology</span><span class="p">[</span><span class="n">key</span><span class="p">]</span>
            <span class="n">season_fullclimo</span> <span class="o">=</span> <span class="n">subset_climo</span><span class="p">[</span><span class="n">key</span><span class="p">]</span><span class="o">.</span><span class="n">values</span>

            <span class="c1">#Create dictionary of relevant calculations for this entry</span>
            <span class="n">composite</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;list&#39;</span><span class="p">:</span><span class="n">season_list</span><span class="p">,</span>
                              <span class="s1">&#39;average&#39;</span><span class="p">:</span><span class="n">np</span><span class="o">.</span><span class="n">round</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">average</span><span class="p">(</span><span class="n">season_list</span><span class="p">),</span><span class="mi">1</span><span class="p">),</span>
                              <span class="s1">&#39;composite_anomaly&#39;</span><span class="p">:</span><span class="n">np</span><span class="o">.</span><span class="n">round</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">average</span><span class="p">(</span><span class="n">season_list</span><span class="p">)</span><span class="o">-</span><span class="n">season_climo</span><span class="p">,</span><span class="mi">1</span><span class="p">),</span>
                              <span class="s1">&#39;percentile_ranks&#39;</span><span class="p">:[</span><span class="n">np</span><span class="o">.</span><span class="n">round</span><span class="p">(</span><span class="n">stats</span><span class="o">.</span><span class="n">percentileofscore</span><span class="p">(</span><span class="n">season_fullclimo</span><span class="p">,</span><span class="n">i</span><span class="p">),</span><span class="mi">1</span><span class="p">)</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">season_list</span><span class="p">],</span>
                             <span class="p">}</span>

        <span class="k">return</span> <span class="n">composite</span></div>
    
<div class="viewcode-block" id="TrackDataset.analogs_from_point"><a class="viewcode-back" href="../../../api/generated/tropycal.tracks.TrackDataset.analogs_from_point.html#tropycal.tracks.TrackDataset.analogs_from_point">[docs]</a>    <span class="k">def</span> <span class="nf">analogs_from_point</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">point</span><span class="p">,</span><span class="n">radius</span><span class="p">,</span><span class="n">units</span><span class="o">=</span><span class="s1">&#39;km&#39;</span><span class="p">,</span><span class="n">thresh</span><span class="o">=</span><span class="p">{},</span><span class="n">non_tropical</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span><span class="n">year_range</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span><span class="n">date_range</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        
        <span class="sa">r</span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Retrieve historical TC tracks surrounding a point.</span>
<span class="sd">        </span>
<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        point : tuple</span>
<span class="sd">            Tuple ordered by (latitude, longitude).</span>
<span class="sd">        radius : int or float</span>
<span class="sd">            Radius in kilometers surrounding the point to search for storms.</span>
<span class="sd">        units : str, optional</span>
<span class="sd">            Units of distance for radius. Can be &quot;miles&quot; or &quot;km&quot;. Default is &quot;km&quot;.</span>
<span class="sd">        thresh : dict</span>
<span class="sd">            Dict for threshold(s) that storms within the requested radius must meet. The following options are available:</span>
<span class="sd">            </span>
<span class="sd">            * **v_min** - Search for sustained wind (kt) above this threshold</span>
<span class="sd">            * **v_max** - Search for sustained wind (kt) below this threshold</span>
<span class="sd">            * **p_min** - Search for MSLP (hPa) below this threshold</span>
<span class="sd">            * **p_max** - Search for MSLP (hPa) above this threshold</span>
<span class="sd">        non_tropical : bool</span>
<span class="sd">            If True, non-tropical (e.g., tropical disturbance, extra-tropical cyclone) points are included in the search. Default is False.</span>
<span class="sd">        year_range : tuple</span>
<span class="sd">            Year range over which to search. If None, defaults to entire dataset.</span>
<span class="sd">        date_range : tuple</span>
<span class="sd">            Start and end dates, formatted as a &quot;month/day&quot; string. If None, defaults to year round.</span>
<span class="sd">        </span>
<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        dict</span>
<span class="sd">            Dict of tropical cyclones that meet the criteria, with storm ID as the key and its closest distance to point as the value.</span>
<span class="sd">        </span>
<span class="sd">        Notes</span>
<span class="sd">        -----</span>
<span class="sd">        This function automatically interpolates all storm data within this TrackDataset instance to hourly, if this hasn&#39;t already been done previously.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        
        <span class="c1">#Determine year range of dataset</span>
        <span class="k">if</span> <span class="n">year_range</span> <span class="o">==</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">start_year</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">keys</span><span class="p">[</span><span class="mi">0</span><span class="p">]][</span><span class="s1">&#39;year&#39;</span><span class="p">]</span>
            <span class="n">end_year</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">keys</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]][</span><span class="s1">&#39;year&#39;</span><span class="p">]</span>
        <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">year_range</span><span class="p">,(</span><span class="nb">list</span><span class="p">,</span><span class="nb">tuple</span><span class="p">)):</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">year_range</span><span class="p">)</span> <span class="o">!=</span> <span class="mi">2</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;year_range must be a tuple or list with 2 elements: (start_year, end_year)&quot;</span><span class="p">)</span>
            <span class="n">start_year</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">year_range</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
            <span class="k">if</span> <span class="n">start_year</span> <span class="o">&lt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">keys</span><span class="p">[</span><span class="mi">0</span><span class="p">]][</span><span class="s1">&#39;year&#39;</span><span class="p">]:</span> <span class="n">start_year</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">keys</span><span class="p">[</span><span class="mi">0</span><span class="p">]][</span><span class="s1">&#39;year&#39;</span><span class="p">]</span>
            <span class="n">end_year</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">year_range</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
            <span class="k">if</span> <span class="n">end_year</span> <span class="o">&gt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">keys</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]][</span><span class="s1">&#39;year&#39;</span><span class="p">]:</span> <span class="n">end_year</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">keys</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]][</span><span class="s1">&#39;year&#39;</span><span class="p">]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s2">&quot;year_range must be of type tuple or list&quot;</span><span class="p">)</span>
        
        <span class="c1">#Determine date range</span>
        <span class="k">if</span> <span class="n">date_range</span> <span class="o">==</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">date_range</span> <span class="o">=</span> <span class="p">(</span><span class="s1">&#39;1/1&#39;</span><span class="p">,</span><span class="s1">&#39;12/31&#39;</span><span class="p">)</span>
        
        <span class="c1">#Units error check</span>
        <span class="k">if</span> <span class="n">units</span> <span class="ow">not</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;km&#39;</span><span class="p">,</span><span class="s1">&#39;miles&#39;</span><span class="p">]:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;units must be &#39;km&#39; or &#39;miles&#39;.&quot;</span><span class="p">)</span>
        <span class="n">unit_factor</span> <span class="o">=</span> <span class="mf">1.0</span> <span class="k">if</span> <span class="n">units</span> <span class="o">==</span> <span class="s1">&#39;km&#39;</span> <span class="k">else</span> <span class="mf">0.621371</span>
        
        <span class="c1">#Interpolate all storm data, if hasn&#39;t been done already</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__interpolate_storms</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">keys</span><span class="p">)</span>
        
        <span class="n">data</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">keys</span><span class="p">:</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="n">key</span><span class="p">][</span><span class="s1">&#39;year&#39;</span><span class="p">]</span> <span class="o">&gt;</span> <span class="n">end_year</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="n">key</span><span class="p">][</span><span class="s1">&#39;year&#39;</span><span class="p">]</span> <span class="o">&lt;</span> <span class="n">start_year</span><span class="p">:</span> <span class="k">continue</span>
            <span class="n">storm_data</span> <span class="o">=</span> <span class="p">[[</span><span class="n">great_circle</span><span class="p">(</span><span class="n">point</span><span class="p">,(</span><span class="bp">self</span><span class="o">.</span><span class="n">data_interp</span><span class="p">[</span><span class="n">key</span><span class="p">][</span><span class="s1">&#39;lat&#39;</span><span class="p">][</span><span class="n">i</span><span class="p">],</span><span class="bp">self</span><span class="o">.</span><span class="n">data_interp</span><span class="p">[</span><span class="n">key</span><span class="p">][</span><span class="s1">&#39;lon&#39;</span><span class="p">][</span><span class="n">i</span><span class="p">]))</span><span class="o">.</span><span class="n">kilometers</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">data_interp</span><span class="p">[</span><span class="n">key</span><span class="p">][</span><span class="s1">&#39;vmax&#39;</span><span class="p">][</span><span class="n">i</span><span class="p">],</span><span class="bp">self</span><span class="o">.</span><span class="n">data_interp</span><span class="p">[</span><span class="n">key</span><span class="p">][</span><span class="s1">&#39;mslp&#39;</span><span class="p">][</span><span class="n">i</span><span class="p">],</span><span class="bp">self</span><span class="o">.</span><span class="n">data_interp</span><span class="p">[</span><span class="n">key</span><span class="p">][</span><span class="s1">&#39;date&#39;</span><span class="p">][</span><span class="n">i</span><span class="p">]]</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">data_interp</span><span class="p">[</span><span class="n">key</span><span class="p">][</span><span class="s1">&#39;lat&#39;</span><span class="p">]))</span> <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">data_interp</span><span class="p">[</span><span class="n">key</span><span class="p">][</span><span class="s1">&#39;type&#39;</span><span class="p">][</span><span class="n">i</span><span class="p">]</span> <span class="ow">in</span> <span class="n">constants</span><span class="o">.</span><span class="n">TROPICAL_STORM_TYPES</span> <span class="ow">or</span> <span class="n">non_tropical</span> <span class="o">==</span> <span class="kc">True</span><span class="p">]</span>
            <span class="n">storm_data</span> <span class="o">=</span> <span class="p">[</span><span class="n">i</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">storm_data</span> <span class="k">if</span> <span class="n">i</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">&lt;=</span> <span class="n">radius</span><span class="o">*</span><span class="n">unit_factor</span><span class="p">]</span>
            <span class="n">storm_data</span> <span class="o">=</span> <span class="p">[</span><span class="n">i</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">storm_data</span> <span class="k">if</span> <span class="n">i</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span> <span class="o">&gt;=</span> <span class="n">dt</span><span class="o">.</span><span class="n">strptime</span><span class="p">(</span><span class="n">date_range</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span><span class="s1">&#39;%m/</span><span class="si">%d</span><span class="s1">&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="n">year</span><span class="o">=</span><span class="n">i</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span><span class="o">.</span><span class="n">year</span><span class="p">)</span> <span class="ow">and</span> <span class="n">i</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span> <span class="o">&lt;=</span> <span class="n">dt</span><span class="o">.</span><span class="n">strptime</span><span class="p">(</span><span class="n">date_range</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span><span class="s1">&#39;%m/</span><span class="si">%d</span><span class="s1">&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="n">year</span><span class="o">=</span><span class="n">i</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span><span class="o">.</span><span class="n">year</span><span class="p">)]</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">storm_data</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span> <span class="k">continue</span>
            <span class="k">if</span> <span class="s1">&#39;v_min&#39;</span> <span class="ow">in</span> <span class="n">thresh</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
                <span class="n">storm_data</span> <span class="o">=</span> <span class="p">[</span><span class="n">i</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">storm_data</span> <span class="k">if</span> <span class="n">i</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">&gt;=</span> <span class="n">thresh</span><span class="p">[</span><span class="s1">&#39;v_min&#39;</span><span class="p">]]</span>
            <span class="k">if</span> <span class="s1">&#39;v_max&#39;</span> <span class="ow">in</span> <span class="n">thresh</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
                <span class="n">storm_data</span> <span class="o">=</span> <span class="p">[</span><span class="n">i</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">storm_data</span> <span class="k">if</span> <span class="n">i</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">&lt;=</span> <span class="n">thresh</span><span class="p">[</span><span class="s1">&#39;v_max&#39;</span><span class="p">]]</span>
            <span class="k">if</span> <span class="s1">&#39;p_min&#39;</span> <span class="ow">in</span> <span class="n">thresh</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
                <span class="n">storm_data</span> <span class="o">=</span> <span class="p">[</span><span class="n">i</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">storm_data</span> <span class="k">if</span> <span class="n">i</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">&gt;=</span> <span class="n">thresh</span><span class="p">[</span><span class="s1">&#39;p_min&#39;</span><span class="p">]]</span>
            <span class="k">if</span> <span class="s1">&#39;p_max&#39;</span> <span class="ow">in</span> <span class="n">thresh</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
                <span class="n">storm_data</span> <span class="o">=</span> <span class="p">[</span><span class="n">i</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">storm_data</span> <span class="k">if</span> <span class="n">i</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">&lt;=</span> <span class="n">thresh</span><span class="p">[</span><span class="s1">&#39;p_max&#39;</span><span class="p">]]</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">storm_data</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span> <span class="k">continue</span>
            
            <span class="n">data</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">round</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">nanmin</span><span class="p">([</span><span class="n">i</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">*</span><span class="n">unit_factor</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">storm_data</span><span class="p">]),</span><span class="mi">1</span><span class="p">)</span>
        
        <span class="k">return</span> <span class="n">data</span></div>
        
<div class="viewcode-block" id="TrackDataset.analogs_from_shape"><a class="viewcode-back" href="../../../api/generated/tropycal.tracks.TrackDataset.analogs_from_shape.html#tropycal.tracks.TrackDataset.analogs_from_shape">[docs]</a>    <span class="k">def</span> <span class="nf">analogs_from_shape</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">points</span><span class="p">,</span><span class="n">thresh</span><span class="o">=</span><span class="p">{},</span><span class="n">non_tropical</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span><span class="n">year_range</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span><span class="n">date_range</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        
        <span class="sa">r</span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Retrieve historical TC tracks within a bounded region.</span>
<span class="sd">        </span>
<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        points : list</span>
<span class="sd">            List of tuples ordered by (latitude, longitude) corresponding to the bounded region.</span>
<span class="sd">        thresh : dict</span>
<span class="sd">            Dict for threshold(s) that storms within the requested radius must meet. The following options are available:</span>
<span class="sd">            </span>
<span class="sd">            * **v_min** - Search for sustained wind (kt) above this threshold</span>
<span class="sd">            * **v_max** - Search for sustained wind (kt) below this threshold</span>
<span class="sd">            * **p_min** - Search for MSLP (hPa) below this threshold</span>
<span class="sd">            * **p_max** - Search for MSLP (hPa) above this threshold</span>
<span class="sd">        non_tropical : bool</span>
<span class="sd">            If True, non-tropical (e.g., tropical disturbance, extra-tropical cyclone) points are included in the search. Default is False.</span>
<span class="sd">        year_range : tuple</span>
<span class="sd">            Year range over which to search. If None, defaults to entire dataset.</span>
<span class="sd">        date_range : tuple</span>
<span class="sd">            Start and end dates, formatted as a &quot;month/day&quot; string. If None, defaults to year round.</span>
<span class="sd">        </span>
<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        list</span>
<span class="sd">            List of tropical cyclones that meet the criteria.</span>
<span class="sd">        </span>
<span class="sd">        Notes</span>
<span class="sd">        -----</span>
<span class="sd">        This function automatically interpolates all storm data within this TrackDataset instance to hourly, if this hasn&#39;t already been done previously.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        
        <span class="c1">#Determine year range of dataset</span>
        <span class="k">if</span> <span class="n">year_range</span> <span class="o">==</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">start_year</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">keys</span><span class="p">[</span><span class="mi">0</span><span class="p">]][</span><span class="s1">&#39;year&#39;</span><span class="p">]</span>
            <span class="n">end_year</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">keys</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]][</span><span class="s1">&#39;year&#39;</span><span class="p">]</span>
        <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">year_range</span><span class="p">,(</span><span class="nb">list</span><span class="p">,</span><span class="nb">tuple</span><span class="p">)):</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">year_range</span><span class="p">)</span> <span class="o">!=</span> <span class="mi">2</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;year_range must be a tuple or list with 2 elements: (start_year, end_year)&quot;</span><span class="p">)</span>
            <span class="n">start_year</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">year_range</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
            <span class="k">if</span> <span class="n">start_year</span> <span class="o">&lt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">keys</span><span class="p">[</span><span class="mi">0</span><span class="p">]][</span><span class="s1">&#39;year&#39;</span><span class="p">]:</span> <span class="n">start_year</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">keys</span><span class="p">[</span><span class="mi">0</span><span class="p">]][</span><span class="s1">&#39;year&#39;</span><span class="p">]</span>
            <span class="n">end_year</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">year_range</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
            <span class="k">if</span> <span class="n">end_year</span> <span class="o">&gt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">keys</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]][</span><span class="s1">&#39;year&#39;</span><span class="p">]:</span> <span class="n">end_year</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">keys</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]][</span><span class="s1">&#39;year&#39;</span><span class="p">]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s2">&quot;year_range must be of type tuple or list&quot;</span><span class="p">)</span>
        
        <span class="c1">#Determine date range</span>
        <span class="k">if</span> <span class="n">date_range</span> <span class="o">==</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">date_range</span> <span class="o">=</span> <span class="p">(</span><span class="s1">&#39;1/1&#39;</span><span class="p">,</span><span class="s1">&#39;12/31&#39;</span><span class="p">)</span>
        
        <span class="c1">#Interpolate all storm data, if hasn&#39;t been done already</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__interpolate_storms</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">keys</span><span class="p">)</span>
        
        <span class="c1">#Check for last entry of tuple</span>
        <span class="k">if</span> <span class="n">points</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">!=</span> <span class="n">points</span><span class="p">[</span><span class="mi">0</span><span class="p">]:</span> <span class="n">points</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">points</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
        <span class="n">p</span> <span class="o">=</span> <span class="n">path</span><span class="o">.</span><span class="n">Path</span><span class="p">(</span><span class="n">points</span><span class="p">)</span>
        
        <span class="c1">#Coerce points longitudes to -180 to 180</span>
        <span class="k">for</span> <span class="n">point</span> <span class="ow">in</span> <span class="n">points</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">point</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mf">180.0</span><span class="p">:</span> <span class="n">point</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">point</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="mf">360.0</span>
        
        <span class="n">data</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">keys</span><span class="p">:</span>
            <span class="n">lon_shift</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">data_interp</span><span class="p">[</span><span class="n">key</span><span class="p">][</span><span class="s1">&#39;lon&#39;</span><span class="p">]</span> <span class="o">+</span> <span class="mf">0.0</span>
            <span class="n">lon_shift</span><span class="p">[</span><span class="n">lon_shift</span> <span class="o">&gt;</span> <span class="mf">180.0</span><span class="p">]</span> <span class="o">=</span> <span class="n">lon_shift</span><span class="p">[</span><span class="n">lon_shift</span> <span class="o">&gt;</span> <span class="mf">180.0</span><span class="p">]</span> <span class="o">-</span> <span class="mf">360.0</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="n">key</span><span class="p">][</span><span class="s1">&#39;year&#39;</span><span class="p">]</span> <span class="o">&gt;</span> <span class="n">end_year</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="n">key</span><span class="p">][</span><span class="s1">&#39;year&#39;</span><span class="p">]</span> <span class="o">&lt;</span> <span class="n">start_year</span><span class="p">:</span> <span class="k">continue</span>
            <span class="n">storm_data</span> <span class="o">=</span> <span class="p">[[</span><span class="n">p</span><span class="o">.</span><span class="n">contains_point</span><span class="p">((</span><span class="bp">self</span><span class="o">.</span><span class="n">data_interp</span><span class="p">[</span><span class="n">key</span><span class="p">][</span><span class="s1">&#39;lat&#39;</span><span class="p">][</span><span class="n">i</span><span class="p">],</span><span class="n">lon_shift</span><span class="p">[</span><span class="n">i</span><span class="p">])),</span><span class="bp">self</span><span class="o">.</span><span class="n">data_interp</span><span class="p">[</span><span class="n">key</span><span class="p">][</span><span class="s1">&#39;vmax&#39;</span><span class="p">][</span><span class="n">i</span><span class="p">],</span><span class="bp">self</span><span class="o">.</span><span class="n">data_interp</span><span class="p">[</span><span class="n">key</span><span class="p">][</span><span class="s1">&#39;mslp&#39;</span><span class="p">][</span><span class="n">i</span><span class="p">],</span><span class="bp">self</span><span class="o">.</span><span class="n">data_interp</span><span class="p">[</span><span class="n">key</span><span class="p">][</span><span class="s1">&#39;date&#39;</span><span class="p">][</span><span class="n">i</span><span class="p">]]</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">data_interp</span><span class="p">[</span><span class="n">key</span><span class="p">][</span><span class="s1">&#39;lat&#39;</span><span class="p">]))</span> <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">data_interp</span><span class="p">[</span><span class="n">key</span><span class="p">][</span><span class="s1">&#39;type&#39;</span><span class="p">][</span><span class="n">i</span><span class="p">]</span> <span class="ow">in</span> <span class="n">constants</span><span class="o">.</span><span class="n">TROPICAL_STORM_TYPES</span> <span class="ow">or</span> <span class="n">non_tropical</span> <span class="o">==</span> <span class="kc">True</span><span class="p">]</span>
            <span class="n">storm_data</span> <span class="o">=</span> <span class="p">[</span><span class="n">i</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">storm_data</span> <span class="k">if</span> <span class="n">i</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="kc">True</span><span class="p">]</span>
            <span class="n">storm_data</span> <span class="o">=</span> <span class="p">[</span><span class="n">i</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">storm_data</span> <span class="k">if</span> <span class="n">i</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span> <span class="o">&gt;=</span> <span class="n">dt</span><span class="o">.</span><span class="n">strptime</span><span class="p">(</span><span class="n">date_range</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span><span class="s1">&#39;%m/</span><span class="si">%d</span><span class="s1">&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="n">year</span><span class="o">=</span><span class="n">i</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span><span class="o">.</span><span class="n">year</span><span class="p">)</span> <span class="ow">and</span> <span class="n">i</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span> <span class="o">&lt;=</span> <span class="n">dt</span><span class="o">.</span><span class="n">strptime</span><span class="p">(</span><span class="n">date_range</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span><span class="s1">&#39;%m/</span><span class="si">%d</span><span class="s1">&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="n">year</span><span class="o">=</span><span class="n">i</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span><span class="o">.</span><span class="n">year</span><span class="p">)]</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">storm_data</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span> <span class="k">continue</span>
            <span class="k">if</span> <span class="s1">&#39;v_min&#39;</span> <span class="ow">in</span> <span class="n">thresh</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
                <span class="n">storm_data</span> <span class="o">=</span> <span class="p">[</span><span class="n">i</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">storm_data</span> <span class="k">if</span> <span class="n">i</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">&gt;=</span> <span class="n">thresh</span><span class="p">[</span><span class="s1">&#39;v_min&#39;</span><span class="p">]]</span>
            <span class="k">if</span> <span class="s1">&#39;v_max&#39;</span> <span class="ow">in</span> <span class="n">thresh</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
                <span class="n">storm_data</span> <span class="o">=</span> <span class="p">[</span><span class="n">i</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">storm_data</span> <span class="k">if</span> <span class="n">i</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">&lt;=</span> <span class="n">thresh</span><span class="p">[</span><span class="s1">&#39;v_max&#39;</span><span class="p">]]</span>
            <span class="k">if</span> <span class="s1">&#39;p_min&#39;</span> <span class="ow">in</span> <span class="n">thresh</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
                <span class="n">storm_data</span> <span class="o">=</span> <span class="p">[</span><span class="n">i</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">storm_data</span> <span class="k">if</span> <span class="n">i</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">&gt;=</span> <span class="n">thresh</span><span class="p">[</span><span class="s1">&#39;p_min&#39;</span><span class="p">]]</span>
            <span class="k">if</span> <span class="s1">&#39;p_max&#39;</span> <span class="ow">in</span> <span class="n">thresh</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
                <span class="n">storm_data</span> <span class="o">=</span> <span class="p">[</span><span class="n">i</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">storm_data</span> <span class="k">if</span> <span class="n">i</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">&lt;=</span> <span class="n">thresh</span><span class="p">[</span><span class="s1">&#39;p_max&#39;</span><span class="p">]]</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">storm_data</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span> <span class="k">continue</span>
                
            <span class="n">data</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">key</span><span class="p">)</span>
        
        <span class="k">return</span> <span class="n">data</span></div>
        
<div class="viewcode-block" id="TrackDataset.plot_analogs_from_point"><a class="viewcode-back" href="../../../api/generated/tropycal.tracks.TrackDataset.plot_analogs_from_point.html#tropycal.tracks.TrackDataset.plot_analogs_from_point">[docs]</a>    <span class="k">def</span> <span class="nf">plot_analogs_from_point</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">point</span><span class="p">,</span><span class="n">radius</span><span class="p">,</span><span class="n">units</span><span class="o">=</span><span class="s1">&#39;km&#39;</span><span class="p">,</span><span class="n">thresh</span><span class="o">=</span><span class="p">{},</span><span class="n">non_tropical</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span><span class="n">year_range</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span><span class="n">date_range</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span><span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        
        <span class="sa">r</span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Plot historical TC tracks surrounding a point.</span>
<span class="sd">        </span>
<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        point : tuple</span>
<span class="sd">            Tuple ordered by (latitude, longitude).</span>
<span class="sd">        radius : int or float</span>
<span class="sd">            Radius in kilometers surrounding the point to search for storms.</span>
<span class="sd">        units : str, optional</span>
<span class="sd">            Units of distance for radius. Can be &quot;miles&quot; or &quot;km&quot;. Default is &quot;km&quot;.</span>
<span class="sd">        thresh : dict</span>
<span class="sd">            Dict for threshold(s) that storms within the requested radius must meet. The following options are available:</span>
<span class="sd">            </span>
<span class="sd">            * **v_min** - Search for sustained wind (kt) above this threshold</span>
<span class="sd">            * **v_max** - Search for sustained wind (kt) below this threshold</span>
<span class="sd">            * **p_min** - Search for MSLP (hPa) below this threshold</span>
<span class="sd">            * **p_max** - Search for MSLP (hPa) above this threshold</span>
<span class="sd">        non_tropical : bool</span>
<span class="sd">            If True, non-tropical (e.g., tropical disturbance, extra-tropical cyclone) points are included in the search. Default is False.</span>
<span class="sd">        year_range : tuple</span>
<span class="sd">            Year range over which to search. If None, defaults to entire dataset.</span>
<span class="sd">        date_range : tuple</span>
<span class="sd">            Start and end dates, formatted as a &quot;month/day&quot; string. If None, defaults to year round.</span>
<span class="sd">        </span>
<span class="sd">        Other Parameters</span>
<span class="sd">        ----------------</span>
<span class="sd">        **kwargs</span>
<span class="sd">            Refer to ``tropycal.tracks.TrackDataset.plot_storms`` for plotting keyword arguments.</span>
<span class="sd">        </span>
<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        ax</span>
<span class="sd">            Axes instance of the plot.</span>
<span class="sd">        </span>
<span class="sd">        Notes</span>
<span class="sd">        -----</span>
<span class="sd">        This function automatically interpolates all storm data within this TrackDataset instance to hourly, if this hasn&#39;t already been done previously.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        
        <span class="c1">#Determine year range of dataset</span>
        <span class="k">if</span> <span class="n">year_range</span> <span class="o">==</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">start_year</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">keys</span><span class="p">[</span><span class="mi">0</span><span class="p">]][</span><span class="s1">&#39;year&#39;</span><span class="p">]</span>
            <span class="n">end_year</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">keys</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]][</span><span class="s1">&#39;year&#39;</span><span class="p">]</span>
        <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">year_range</span><span class="p">,(</span><span class="nb">list</span><span class="p">,</span><span class="nb">tuple</span><span class="p">)):</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">year_range</span><span class="p">)</span> <span class="o">!=</span> <span class="mi">2</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;year_range must be a tuple or list with 2 elements: (start_year, end_year)&quot;</span><span class="p">)</span>
            <span class="n">start_year</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">year_range</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
            <span class="k">if</span> <span class="n">start_year</span> <span class="o">&lt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">keys</span><span class="p">[</span><span class="mi">0</span><span class="p">]][</span><span class="s1">&#39;year&#39;</span><span class="p">]:</span> <span class="n">start_year</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">keys</span><span class="p">[</span><span class="mi">0</span><span class="p">]][</span><span class="s1">&#39;year&#39;</span><span class="p">]</span>
            <span class="n">end_year</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">year_range</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
            <span class="k">if</span> <span class="n">end_year</span> <span class="o">&gt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">keys</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]][</span><span class="s1">&#39;year&#39;</span><span class="p">]:</span> <span class="n">end_year</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">keys</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]][</span><span class="s1">&#39;year&#39;</span><span class="p">]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s2">&quot;year_range must be of type tuple or list&quot;</span><span class="p">)</span>
        
        <span class="c1">#Determine date range</span>
        <span class="k">if</span> <span class="n">date_range</span> <span class="o">==</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">date_range</span> <span class="o">=</span> <span class="p">(</span><span class="s1">&#39;1/1&#39;</span><span class="p">,</span><span class="s1">&#39;12/31&#39;</span><span class="p">)</span>
        
        <span class="c1">#Reconfigure domain to be centered around circle</span>
        <span class="kn">import</span> <span class="nn">cartopy.geodesic</span> <span class="k">as</span> <span class="nn">geodesic</span>
        <span class="n">unit_factor</span> <span class="o">=</span> <span class="mf">1.0</span> <span class="k">if</span> <span class="n">units</span> <span class="o">==</span> <span class="s1">&#39;km&#39;</span> <span class="k">else</span> <span class="mf">0.621371</span>
        <span class="n">circle_points</span> <span class="o">=</span> <span class="n">geodesic</span><span class="o">.</span><span class="n">Geodesic</span><span class="p">()</span><span class="o">.</span><span class="n">circle</span><span class="p">(</span><span class="n">lon</span><span class="o">=</span><span class="n">point</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span><span class="n">lat</span><span class="o">=</span><span class="n">point</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span><span class="n">radius</span><span class="o">=</span><span class="n">radius</span><span class="o">*</span><span class="mi">1000</span><span class="o">*</span><span class="n">unit_factor</span><span class="p">,</span><span class="n">n_samples</span><span class="o">=</span><span class="mi">360</span><span class="p">,</span><span class="n">endpoint</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
        <span class="n">domain</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;domain&#39;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">domain</span> <span class="o">==</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">lons</span> <span class="o">=</span> <span class="p">[</span><span class="n">i</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">circle_points</span><span class="p">]</span>
            <span class="n">lats</span> <span class="o">=</span> <span class="p">[</span><span class="n">i</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">circle_points</span><span class="p">]</span>
            <span class="n">bounds</span> <span class="o">=</span> <span class="n">dynamic_map_extent</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">nanmin</span><span class="p">(</span><span class="n">lons</span><span class="p">),</span><span class="n">np</span><span class="o">.</span><span class="n">nanmax</span><span class="p">(</span><span class="n">lons</span><span class="p">),</span><span class="n">np</span><span class="o">.</span><span class="n">nanmin</span><span class="p">(</span><span class="n">lats</span><span class="p">),</span><span class="n">np</span><span class="o">.</span><span class="n">nanmax</span><span class="p">(</span><span class="n">lats</span><span class="p">))</span>
            <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;domain&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;w&#39;</span><span class="p">:</span><span class="n">bounds</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span><span class="s1">&#39;e&#39;</span><span class="p">:</span><span class="n">bounds</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span><span class="s1">&#39;s&#39;</span><span class="p">:</span><span class="n">bounds</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span><span class="s1">&#39;n&#39;</span><span class="p">:</span><span class="n">bounds</span><span class="p">[</span><span class="mi">3</span><span class="p">]}</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;domain&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">domain</span>
        
        <span class="c1">#Retrieve storms and plot on axes</span>
        <span class="n">storms</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">analogs_from_point</span><span class="p">(</span><span class="n">point</span><span class="p">,</span><span class="n">radius</span><span class="p">,</span><span class="n">units</span><span class="p">,</span><span class="n">thresh</span><span class="p">,</span><span class="n">non_tropical</span><span class="p">,</span><span class="n">year_range</span><span class="p">,</span><span class="n">date_range</span><span class="p">)</span><span class="o">.</span><span class="n">keys</span><span class="p">()</span>
        <span class="n">ax</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">plot_storms</span><span class="p">(</span><span class="n">storms</span><span class="p">,</span><span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        
        <span class="c1">#Plot circle and dot</span>
        <span class="kn">import</span> <span class="nn">cartopy</span>
        <span class="kn">import</span> <span class="nn">shapely</span>
        <span class="n">ms</span> <span class="o">=</span> <span class="mi">12</span>
        <span class="n">linewidth</span> <span class="o">=</span> <span class="mf">2.5</span>
        <span class="n">color</span> <span class="o">=</span> <span class="s1">&#39;k&#39;</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">point</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span><span class="n">point</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span><span class="s1">&#39;o&#39;</span><span class="p">,</span><span class="n">mfc</span><span class="o">=</span><span class="n">color</span><span class="p">,</span><span class="n">mec</span><span class="o">=</span><span class="n">color</span><span class="p">,</span><span class="n">ms</span><span class="o">=</span><span class="n">ms</span><span class="p">,</span><span class="n">zorder</span><span class="o">=</span><span class="mi">30</span><span class="p">)</span>
        <span class="n">geom</span> <span class="o">=</span> <span class="n">shapely</span><span class="o">.</span><span class="n">geometry</span><span class="o">.</span><span class="n">Polygon</span><span class="p">(</span><span class="n">circle_points</span><span class="p">)</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">add_geometries</span><span class="p">((</span><span class="n">geom</span><span class="p">,),</span> <span class="n">crs</span><span class="o">=</span><span class="n">cartopy</span><span class="o">.</span><span class="n">crs</span><span class="o">.</span><span class="n">PlateCarree</span><span class="p">(),</span> <span class="n">facecolor</span><span class="o">=</span><span class="s1">&#39;none&#39;</span><span class="p">,</span> <span class="n">edgecolor</span><span class="o">=</span><span class="n">color</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="n">linewidth</span><span class="p">,</span> <span class="n">zorder</span><span class="o">=</span><span class="mi">30</span><span class="p">)</span>
        
        <span class="c1">#Change title</span>
        <span class="n">title</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;title&#39;</span><span class="p">,</span><span class="s1">&#39;&#39;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">title</span> <span class="o">==</span> <span class="s1">&#39;&#39;</span><span class="p">:</span>
            <span class="n">endash</span> <span class="o">=</span> <span class="sa">u</span><span class="s2">&quot;</span><span class="se">\u2013</span><span class="s2">&quot;</span>
            <span class="n">dot</span> <span class="o">=</span> <span class="sa">u</span><span class="s2">&quot;</span><span class="se">\u2022</span><span class="s2">&quot;</span>
            <span class="n">degree_sign</span> <span class="o">=</span> <span class="sa">u</span><span class="s1">&#39;</span><span class="se">\N{DEGREE SIGN}</span><span class="s1">&#39;</span>
            <span class="n">lat_formatter</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">point</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="si">:</span><span class="s2">.1f</span><span class="si">}{</span><span class="n">degree_sign</span><span class="si">}</span><span class="s2">N&quot;</span>
            <span class="k">if</span> <span class="n">point</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">:</span> <span class="n">lat_formatter</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="nb">abs</span><span class="p">(</span><span class="n">point</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span><span class="si">:</span><span class="s2">.1f</span><span class="si">}{</span><span class="n">degree_sign</span><span class="si">}</span><span class="s2">S&quot;</span>
            <span class="n">lon_formatter</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">point</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="si">:</span><span class="s2">.1f</span><span class="si">}{</span><span class="n">degree_sign</span><span class="si">}</span><span class="s2">E&quot;</span>
            <span class="k">if</span> <span class="n">point</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">:</span> <span class="n">lon_formatter</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="nb">abs</span><span class="p">(</span><span class="n">point</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span><span class="si">:</span><span class="s2">.1f</span><span class="si">}{</span><span class="n">degree_sign</span><span class="si">}</span><span class="s2">W&quot;</span>
            <span class="k">if</span> <span class="n">point</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mi">180</span><span class="p">:</span> <span class="n">lon_formatter</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="nb">abs</span><span class="p">(</span><span class="n">point</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">-</span><span class="mf">360.0</span><span class="p">)</span><span class="si">:</span><span class="s2">.1f</span><span class="si">}{</span><span class="n">degree_sign</span><span class="si">}</span><span class="s2">W&quot;</span>
            <span class="n">start_day</span> <span class="o">=</span> <span class="n">dt</span><span class="o">.</span><span class="n">strptime</span><span class="p">(</span><span class="n">date_range</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span><span class="s1">&#39;%m/</span><span class="si">%d</span><span class="s1">&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">strftime</span><span class="p">(</span><span class="s1">&#39;%b </span><span class="si">%d</span><span class="s1">&#39;</span><span class="p">)</span>
            <span class="n">end_day</span> <span class="o">=</span> <span class="n">dt</span><span class="o">.</span><span class="n">strptime</span><span class="p">(</span><span class="n">date_range</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span><span class="s1">&#39;%m/</span><span class="si">%d</span><span class="s1">&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">strftime</span><span class="p">(</span><span class="s1">&#39;%b </span><span class="si">%d</span><span class="s1">&#39;</span><span class="p">)</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;TCs Within </span><span class="si">{</span><span class="n">radius</span><span class="si">}</span><span class="s2"> </span><span class="si">{</span><span class="n">units</span><span class="si">}</span><span class="s2"> of </span><span class="si">{</span><span class="n">lat_formatter</span><span class="si">}</span><span class="s2">, </span><span class="si">{</span><span class="n">lon_formatter</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span><span class="n">loc</span><span class="o">=</span><span class="s1">&#39;left&#39;</span><span class="p">,</span><span class="n">fontsize</span><span class="o">=</span><span class="mi">17</span><span class="p">,</span><span class="n">fontweight</span><span class="o">=</span><span class="s1">&#39;bold&#39;</span><span class="p">)</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Number of storms: </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">storms</span><span class="p">)</span><span class="si">}</span><span class="se">\n</span><span class="si">{</span><span class="n">start_day</span><span class="si">}</span><span class="s2"> </span><span class="si">{</span><span class="n">endash</span><span class="si">}</span><span class="s2"> </span><span class="si">{</span><span class="n">end_day</span><span class="si">}</span><span class="s2"> </span><span class="si">{</span><span class="n">dot</span><span class="si">}</span><span class="s2"> </span><span class="si">{</span><span class="n">start_year</span><span class="si">}</span><span class="s2"> </span><span class="si">{</span><span class="n">endash</span><span class="si">}</span><span class="s2"> </span><span class="si">{</span><span class="n">end_year</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span><span class="n">loc</span><span class="o">=</span><span class="s1">&#39;right&#39;</span><span class="p">,</span><span class="n">fontsize</span><span class="o">=</span><span class="mi">13</span><span class="p">)</span>
        
        <span class="k">return</span> <span class="n">ax</span></div>

<div class="viewcode-block" id="TrackDataset.plot_analogs_from_shape"><a class="viewcode-back" href="../../../api/generated/tropycal.tracks.TrackDataset.plot_analogs_from_shape.html#tropycal.tracks.TrackDataset.plot_analogs_from_shape">[docs]</a>    <span class="k">def</span> <span class="nf">plot_analogs_from_shape</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">points</span><span class="p">,</span><span class="n">thresh</span><span class="o">=</span><span class="p">{},</span><span class="n">non_tropical</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span><span class="n">year_range</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span><span class="n">date_range</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span><span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        
        <span class="sa">r</span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Plot historical TC tracks surrounding a point.</span>
<span class="sd">        </span>
<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        points : list</span>
<span class="sd">            List of tuples ordered by (latitude, longitude) corresponding to the bounded region.</span>
<span class="sd">        thresh : dict</span>
<span class="sd">            Dict for threshold(s) that storms within the requested radius must meet. The following options are available:</span>
<span class="sd">            </span>
<span class="sd">            * **v_min** - Search for sustained wind (kt) above this threshold</span>
<span class="sd">            * **v_max** - Search for sustained wind (kt) below this threshold</span>
<span class="sd">            * **p_min** - Search for MSLP (hPa) below this threshold</span>
<span class="sd">            * **p_max** - Search for MSLP (hPa) above this threshold</span>
<span class="sd">        non_tropical : bool</span>
<span class="sd">            If True, non-tropical (e.g., tropical disturbance, extra-tropical cyclone) points are included in the search. Default is False.</span>
<span class="sd">        year_range : tuple</span>
<span class="sd">            Year range over which to search. If None, defaults to entire dataset.</span>
<span class="sd">        date_range : tuple</span>
<span class="sd">            Start and end dates, formatted as a &quot;month/day&quot; string. If None, defaults to year round.</span>
<span class="sd">        </span>
<span class="sd">        Other Parameters</span>
<span class="sd">        ----------------</span>
<span class="sd">        linewidth : int or float</span>
<span class="sd">            Width of bounded shape line. Defaults to 2.0.</span>
<span class="sd">        color : str</span>
<span class="sd">            Color of bounded shape line. Defaults to black.</span>
<span class="sd">        **kwargs</span>
<span class="sd">            Refer to ``tropycal.tracks.TrackDataset.plot_storms`` for plotting keyword arguments.</span>
<span class="sd">        </span>
<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        ax</span>
<span class="sd">            Axes instance of the plot.</span>
<span class="sd">        </span>
<span class="sd">        Notes</span>
<span class="sd">        -----</span>
<span class="sd">        This function automatically interpolates all storm data within this TrackDataset instance to hourly, if this hasn&#39;t already been done previously.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        
        <span class="c1">#Determine year range of dataset</span>
        <span class="k">if</span> <span class="n">year_range</span> <span class="o">==</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">start_year</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">keys</span><span class="p">[</span><span class="mi">0</span><span class="p">]][</span><span class="s1">&#39;year&#39;</span><span class="p">]</span>
            <span class="n">end_year</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">keys</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]][</span><span class="s1">&#39;year&#39;</span><span class="p">]</span>
        <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">year_range</span><span class="p">,(</span><span class="nb">list</span><span class="p">,</span><span class="nb">tuple</span><span class="p">)):</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">year_range</span><span class="p">)</span> <span class="o">!=</span> <span class="mi">2</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;year_range must be a tuple or list with 2 elements: (start_year, end_year)&quot;</span><span class="p">)</span>
            <span class="n">start_year</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">year_range</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
            <span class="k">if</span> <span class="n">start_year</span> <span class="o">&lt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">keys</span><span class="p">[</span><span class="mi">0</span><span class="p">]][</span><span class="s1">&#39;year&#39;</span><span class="p">]:</span> <span class="n">start_year</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">keys</span><span class="p">[</span><span class="mi">0</span><span class="p">]][</span><span class="s1">&#39;year&#39;</span><span class="p">]</span>
            <span class="n">end_year</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">year_range</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
            <span class="k">if</span> <span class="n">end_year</span> <span class="o">&gt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">keys</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]][</span><span class="s1">&#39;year&#39;</span><span class="p">]:</span> <span class="n">end_year</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">keys</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]][</span><span class="s1">&#39;year&#39;</span><span class="p">]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s2">&quot;year_range must be of type tuple or list&quot;</span><span class="p">)</span>
        
        <span class="c1">#Determine date range</span>
        <span class="k">if</span> <span class="n">date_range</span> <span class="o">==</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">date_range</span> <span class="o">=</span> <span class="p">(</span><span class="s1">&#39;1/1&#39;</span><span class="p">,</span><span class="s1">&#39;12/31&#39;</span><span class="p">)</span>
        
        <span class="c1">#Reconfigure domain to be centered around circle</span>
        <span class="n">domain</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;domain&#39;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">domain</span> <span class="o">==</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">lons</span> <span class="o">=</span> <span class="p">[</span><span class="n">i</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">points</span><span class="p">]</span>
            <span class="n">lats</span> <span class="o">=</span> <span class="p">[</span><span class="n">i</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">points</span><span class="p">]</span>
            <span class="n">bounds</span> <span class="o">=</span> <span class="n">dynamic_map_extent</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">nanmin</span><span class="p">(</span><span class="n">lons</span><span class="p">),</span><span class="n">np</span><span class="o">.</span><span class="n">nanmax</span><span class="p">(</span><span class="n">lons</span><span class="p">),</span><span class="n">np</span><span class="o">.</span><span class="n">nanmin</span><span class="p">(</span><span class="n">lats</span><span class="p">),</span><span class="n">np</span><span class="o">.</span><span class="n">nanmax</span><span class="p">(</span><span class="n">lats</span><span class="p">))</span>
            <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;domain&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;w&#39;</span><span class="p">:</span><span class="n">bounds</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span><span class="s1">&#39;e&#39;</span><span class="p">:</span><span class="n">bounds</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span><span class="s1">&#39;s&#39;</span><span class="p">:</span><span class="n">bounds</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span><span class="s1">&#39;n&#39;</span><span class="p">:</span><span class="n">bounds</span><span class="p">[</span><span class="mi">3</span><span class="p">]}</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;domain&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">domain</span>
        
        <span class="c1">#Retrieve storms and plot on axes</span>
        <span class="n">storms</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">analogs_from_shape</span><span class="p">(</span><span class="n">points</span><span class="p">,</span><span class="n">thresh</span><span class="p">,</span><span class="n">non_tropical</span><span class="p">,</span><span class="n">year_range</span><span class="p">,</span><span class="n">date_range</span><span class="p">)</span>
        <span class="n">ax</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">plot_storms</span><span class="p">(</span><span class="n">storms</span><span class="p">,</span><span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        
        <span class="c1">#Plot circle and dot</span>
        <span class="kn">import</span> <span class="nn">cartopy.crs</span> <span class="k">as</span> <span class="nn">ccrs</span>
        <span class="n">linewidth</span> <span class="o">=</span> <span class="mf">3.0</span>
        <span class="n">color</span> <span class="o">=</span> <span class="s1">&#39;k&#39;</span>
        <span class="k">if</span> <span class="n">points</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">!=</span> <span class="n">points</span><span class="p">[</span><span class="mi">0</span><span class="p">]:</span> <span class="n">points</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">points</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">([</span><span class="n">i</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">points</span><span class="p">],[</span><span class="n">i</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">points</span><span class="p">],</span><span class="n">color</span><span class="o">=</span><span class="n">color</span><span class="p">,</span><span class="n">linewidth</span><span class="o">=</span><span class="n">linewidth</span><span class="p">,</span><span class="n">zorder</span><span class="o">=</span><span class="mi">30</span><span class="p">,</span><span class="n">transform</span><span class="o">=</span><span class="n">ccrs</span><span class="o">.</span><span class="n">PlateCarree</span><span class="p">())</span>
        
        <span class="c1">#Change title</span>
        <span class="n">title</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;title&#39;</span><span class="p">,</span><span class="s1">&#39;&#39;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">title</span> <span class="o">==</span> <span class="s1">&#39;&#39;</span><span class="p">:</span>
            <span class="n">endash</span> <span class="o">=</span> <span class="sa">u</span><span class="s2">&quot;</span><span class="se">\u2013</span><span class="s2">&quot;</span>
            <span class="n">dot</span> <span class="o">=</span> <span class="sa">u</span><span class="s2">&quot;</span><span class="se">\u2022</span><span class="s2">&quot;</span>
            <span class="n">start_day</span> <span class="o">=</span> <span class="n">dt</span><span class="o">.</span><span class="n">strptime</span><span class="p">(</span><span class="n">date_range</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span><span class="s1">&#39;%m/</span><span class="si">%d</span><span class="s1">&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">strftime</span><span class="p">(</span><span class="s1">&#39;%b </span><span class="si">%d</span><span class="s1">&#39;</span><span class="p">)</span>
            <span class="n">end_day</span> <span class="o">=</span> <span class="n">dt</span><span class="o">.</span><span class="n">strptime</span><span class="p">(</span><span class="n">date_range</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span><span class="s1">&#39;%m/</span><span class="si">%d</span><span class="s1">&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">strftime</span><span class="p">(</span><span class="s1">&#39;%b </span><span class="si">%d</span><span class="s1">&#39;</span><span class="p">)</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;TC Tracks Within Bounded Region&quot;</span><span class="p">,</span><span class="n">loc</span><span class="o">=</span><span class="s1">&#39;left&#39;</span><span class="p">,</span><span class="n">fontsize</span><span class="o">=</span><span class="mi">17</span><span class="p">,</span><span class="n">fontweight</span><span class="o">=</span><span class="s1">&#39;bold&#39;</span><span class="p">)</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Number of storms: </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">storms</span><span class="p">)</span><span class="si">}</span><span class="se">\n</span><span class="si">{</span><span class="n">start_day</span><span class="si">}</span><span class="s2"> </span><span class="si">{</span><span class="n">endash</span><span class="si">}</span><span class="s2"> </span><span class="si">{</span><span class="n">end_day</span><span class="si">}</span><span class="s2"> </span><span class="si">{</span><span class="n">dot</span><span class="si">}</span><span class="s2"> </span><span class="si">{</span><span class="n">start_year</span><span class="si">}</span><span class="s2"> </span><span class="si">{</span><span class="n">endash</span><span class="si">}</span><span class="s2"> </span><span class="si">{</span><span class="n">end_year</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span><span class="n">loc</span><span class="o">=</span><span class="s1">&#39;right&#39;</span><span class="p">,</span><span class="n">fontsize</span><span class="o">=</span><span class="mi">13</span><span class="p">)</span>
        
        <span class="k">return</span> <span class="n">ax</span></div>

<div class="viewcode-block" id="TrackDataset.plot_summary"><a class="viewcode-back" href="../../../api/generated/tropycal.tracks.TrackDataset.plot_summary.html#tropycal.tracks.TrackDataset.plot_summary">[docs]</a>    <span class="k">def</span> <span class="nf">plot_summary</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">time</span><span class="p">,</span><span class="n">domain</span><span class="o">=</span><span class="s1">&#39;all&#39;</span><span class="p">,</span><span class="n">ax</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span><span class="n">cartopy_proj</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span><span class="n">save_path</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span><span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        
        <span class="sa">r</span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Plot a summary map of past tropical cyclone and NHC potential development activity. Only valid for areas in NHC&#39;s area of responsibility at this time.</span>
<span class="sd">        </span>
<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        time : datetime</span>
<span class="sd">            Valid time for the summary plot.</span>
<span class="sd">        domain : str</span>
<span class="sd">            Domain for the plot. Default is &quot;all&quot;. Please refer to :ref:`options-domain` for available domain options.</span>
<span class="sd">        ax : axes, optional</span>
<span class="sd">            Instance of axes to plot on. If none, one will be generated. Default is none.</span>
<span class="sd">        cartopy_proj : ccrs, optional</span>
<span class="sd">            Instance of a cartopy projection to use. If none, one will be generated. Default is none.</span>
<span class="sd">        save_path : str, optional</span>
<span class="sd">            Relative or full path of directory to save the image in. If none, image will not be saved.</span>
<span class="sd">        </span>
<span class="sd">        Other Parameters</span>
<span class="sd">        ----------------</span>
<span class="sd">        two_prop : dict</span>
<span class="sd">            Customization properties of NHC Tropical Weather Outlook (TWO). Please refer to :ref:`options-summary` for available options.</span>
<span class="sd">        storm_prop : dict</span>
<span class="sd">            Customization properties of active storms. Please refer to :ref:`options-summary` for available options.</span>
<span class="sd">        cone_prop : dict</span>
<span class="sd">            Customization properties of cone of uncertainty. Please refer to :ref:`options-summary` for available options.</span>
<span class="sd">        map_prop : dict</span>
<span class="sd">            Customization properties of Cartopy map. Please refer to :ref:`options-map-prop` for available options.</span>
<span class="sd">        </span>
<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        ax</span>
<span class="sd">            Instance of axes containing the plot is returned.</span>
<span class="sd">        </span>
<span class="sd">        Notes</span>
<span class="sd">        -----</span>

<span class="sd">        The following properties are available for plotting NHC Tropical Weather Outlook (TWO), via ``two_prop``.</span>

<span class="sd">        .. list-table:: </span>
<span class="sd">           :widths: 25 75</span>
<span class="sd">           :header-rows: 1</span>

<span class="sd">           * - Property</span>
<span class="sd">             - Description</span>
<span class="sd">           * - plot</span>
<span class="sd">             - Boolean to determine whether to plot NHC TWO. Default is True.</span>
<span class="sd">           * - days</span>
<span class="sd">             - Number of days for TWO. Can be either 2 or 5. Default is 5.</span>
<span class="sd">           * - fontsize</span>
<span class="sd">             - Font size for text label. Default is 12.</span>
<span class="sd">           * - ms</span>
<span class="sd">             - Marker size for area location, if applicable. Default is 15.</span>

<span class="sd">        The following properties are available for plotting storms, via ``storm_prop``.</span>

<span class="sd">        .. list-table:: </span>
<span class="sd">           :widths: 25 75</span>
<span class="sd">           :header-rows: 1</span>

<span class="sd">           * - Property</span>
<span class="sd">             - Description</span>
<span class="sd">           * - plot</span>
<span class="sd">             - Boolean to determine whether to plot active storms. Default is True.</span>
<span class="sd">           * - linewidth</span>
<span class="sd">             - Line width for past track. Default is 0.8. Set to zero to not plot line.</span>
<span class="sd">           * - linecolor</span>
<span class="sd">             - Line color for past track. Default is black.</span>
<span class="sd">           * - linestyle</span>
<span class="sd">             - Line style for past track. Default is dotted.</span>
<span class="sd">           * - fontsize</span>
<span class="sd">             - Font size for storm name label. Default is 12.</span>
<span class="sd">           * - fillcolor</span>
<span class="sd">             - Fill color for storm location marker. Default is color by SSHWS category (&quot;category&quot;).</span>
<span class="sd">           * - label_category</span>
<span class="sd">             - Boolean for whether to plot SSHWS category on top of storm location marker. Default is True.</span>
<span class="sd">           * - ms</span>
<span class="sd">             - Marker size for storm location. Default is 14.</span>

<span class="sd">        The following properties are available for plotting realtime cone of uncertainty, via ``cone_prop``.</span>

<span class="sd">        .. list-table:: </span>
<span class="sd">           :widths: 25 75</span>
<span class="sd">           :header-rows: 1</span>

<span class="sd">           * - Property</span>
<span class="sd">             - Description</span>
<span class="sd">           * - plot</span>
<span class="sd">             - Boolean to determine whether to plot cone of uncertainty &amp; forecast track for active storms. Default is True.</span>
<span class="sd">           * - linewidth</span>
<span class="sd">             - Line width for forecast track. Default is 1.5. Set to zero to not plot line.</span>
<span class="sd">           * - alpha</span>
<span class="sd">             - Opacity for cone of uncertainty. Default is 0.6.</span>
<span class="sd">           * - days</span>
<span class="sd">             - Number of days for cone of uncertainty, from 2 through 5. Default is 5.</span>
<span class="sd">           * - fillcolor</span>
<span class="sd">             - Fill color for forecast dots. Default is color by SSHWS category (&quot;category&quot;).</span>
<span class="sd">           * - label_category</span>
<span class="sd">             - Boolean for whether to plot SSHWS category on top of forecast dots. Default is True.</span>
<span class="sd">           * - ms</span>
<span class="sd">             - Marker size for forecast dots. Default is 12.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        
        <span class="c1">#Error check</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">source</span> <span class="o">!=</span> <span class="s1">&#39;hurdat&#39;</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span><span class="s2">&quot;This function is only available for NHC&#39;s area of responsibility at this time.&quot;</span><span class="p">)</span>
        
        <span class="c1">#Find closest NHC shapefile</span>
        <span class="n">shapefiles</span> <span class="o">=</span> <span class="n">get_two_archive</span><span class="p">(</span><span class="n">time</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">shapefiles</span><span class="p">[</span><span class="s1">&#39;areas&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">two_prop</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;plot&#39;</span><span class="p">:</span><span class="kc">False</span><span class="p">}</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">two_prop</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;two_prop&#39;</span><span class="p">,{})</span>
        
        <span class="c1">#Search all valid storms at the time</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;--&gt; Reading storm data&quot;</span><span class="p">)</span>
        <span class="n">storms</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">forecasts</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">keys</span><span class="p">:</span>
            
            <span class="c1">#First filter</span>
            <span class="k">if</span> <span class="n">time</span> <span class="o">&lt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="n">key</span><span class="p">][</span><span class="s1">&#39;date&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">]:</span> <span class="k">continue</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="n">key</span><span class="p">][</span><span class="s1">&#39;date&#39;</span><span class="p">][</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">&lt;</span> <span class="n">time</span><span class="p">:</span> <span class="k">continue</span>
           
            <span class="c1">#Second filter</span>
            <span class="n">diff</span> <span class="o">=</span> <span class="p">[(</span><span class="n">time</span><span class="o">-</span><span class="n">i</span><span class="p">)</span><span class="o">.</span><span class="n">total_seconds</span><span class="p">()</span><span class="o">/</span><span class="mi">3600</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="n">key</span><span class="p">][</span><span class="s1">&#39;date&#39;</span><span class="p">]]</span>
            <span class="n">diff_maxes</span> <span class="o">=</span> <span class="p">[</span><span class="n">i</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">diff</span> <span class="k">if</span> <span class="n">i</span> <span class="o">&gt;=</span> <span class="mi">0</span><span class="p">]</span>
            <span class="n">idx</span> <span class="o">=</span> <span class="n">diff</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">nanmin</span><span class="p">(</span><span class="n">diff_maxes</span><span class="p">))</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="n">key</span><span class="p">][</span><span class="s1">&#39;type&#39;</span><span class="p">][</span><span class="n">idx</span><span class="p">]</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">constants</span><span class="o">.</span><span class="n">TROPICAL_STORM_TYPES</span><span class="p">:</span> <span class="k">continue</span>
            
            <span class="c1">#Get forecast</span>
            <span class="n">storm</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_storm</span><span class="p">(</span><span class="n">key</span><span class="p">)</span>
            <span class="n">storm</span><span class="o">.</span><span class="n">get_operational_forecasts</span><span class="p">()</span>

            <span class="c1">#Get all NHC forecast entries</span>
            <span class="n">nhc_forecasts</span> <span class="o">=</span> <span class="n">storm</span><span class="o">.</span><span class="n">forecast_dict</span><span class="p">[</span><span class="s1">&#39;OFCL&#39;</span><span class="p">]</span>
            <span class="n">carq_forecasts</span> <span class="o">=</span> <span class="n">storm</span><span class="o">.</span><span class="n">forecast_dict</span><span class="p">[</span><span class="s1">&#39;CARQ&#39;</span><span class="p">]</span>

            <span class="c1">#Get list of all NHC forecast initializations</span>
            <span class="n">nhc_forecast_init</span> <span class="o">=</span> <span class="p">[</span><span class="n">k</span> <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="n">nhc_forecasts</span><span class="o">.</span><span class="n">keys</span><span class="p">()]</span>
            <span class="n">carq_forecast_init</span> <span class="o">=</span> <span class="p">[</span><span class="n">k</span> <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="n">carq_forecasts</span><span class="o">.</span><span class="n">keys</span><span class="p">()]</span>

            <span class="c1">#Find closest matching time to the provided forecast date, or time</span>
            <span class="n">nhc_forecast_init_dt</span> <span class="o">=</span> <span class="p">[</span><span class="n">dt</span><span class="o">.</span><span class="n">strptime</span><span class="p">(</span><span class="n">k</span><span class="p">,</span><span class="s1">&#39;%Y%m</span><span class="si">%d</span><span class="s1">%H&#39;</span><span class="p">)</span> <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="n">nhc_forecast_init</span><span class="p">]</span>
            <span class="n">time_diff</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([(</span><span class="n">i</span><span class="o">-</span><span class="n">time</span><span class="p">)</span><span class="o">.</span><span class="n">days</span> <span class="o">+</span> <span class="p">(</span><span class="n">i</span><span class="o">-</span><span class="n">time</span><span class="p">)</span><span class="o">.</span><span class="n">seconds</span><span class="o">/</span><span class="mi">86400</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">nhc_forecast_init_dt</span><span class="p">])</span>
            <span class="n">closest_idx</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">time_diff</span><span class="p">)</span><span class="o">.</span><span class="n">argmin</span><span class="p">()</span>
            <span class="n">forecast_dict</span> <span class="o">=</span> <span class="n">nhc_forecasts</span><span class="p">[</span><span class="n">nhc_forecast_init</span><span class="p">[</span><span class="n">closest_idx</span><span class="p">]]</span>
            <span class="n">advisory_num</span> <span class="o">=</span> <span class="n">closest_idx</span><span class="o">+</span><span class="mi">1</span>

            <span class="c1">#Get observed track as per NHC analyses</span>
            <span class="n">track_dict</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;lat&#39;</span><span class="p">:[],</span><span class="s1">&#39;lon&#39;</span><span class="p">:[],</span><span class="s1">&#39;vmax&#39;</span><span class="p">:[],</span><span class="s1">&#39;type&#39;</span><span class="p">:[],</span><span class="s1">&#39;mslp&#39;</span><span class="p">:[],</span><span class="s1">&#39;date&#39;</span><span class="p">:[],</span><span class="s1">&#39;extra_obs&#39;</span><span class="p">:[],</span><span class="s1">&#39;special&#39;</span><span class="p">:[],</span><span class="s1">&#39;ace&#39;</span><span class="p">:</span><span class="mf">0.0</span><span class="p">}</span>
            <span class="n">use_carq</span> <span class="o">=</span> <span class="kc">True</span>
            <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="n">nhc_forecast_init</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">carq_forecasts</span><span class="p">[</span><span class="n">k</span><span class="p">][</span><span class="s1">&#39;init&#39;</span><span class="p">]</span> <span class="o">&gt;</span> <span class="n">time</span><span class="p">:</span> <span class="k">continue</span>
                <span class="n">hrs</span> <span class="o">=</span> <span class="n">nhc_forecasts</span><span class="p">[</span><span class="n">k</span><span class="p">][</span><span class="s1">&#39;fhr&#39;</span><span class="p">]</span>
                <span class="n">hrs_carq</span> <span class="o">=</span> <span class="n">carq_forecasts</span><span class="p">[</span><span class="n">k</span><span class="p">][</span><span class="s1">&#39;fhr&#39;</span><span class="p">]</span> <span class="k">if</span> <span class="n">k</span> <span class="ow">in</span> <span class="n">carq_forecast_init</span> <span class="k">else</span> <span class="p">[]</span>

                <span class="c1">#Account for old years when hour 0 wasn&#39;t included directly</span>
                <span class="c1">#if 0 not in hrs and k in carq_forecast_init and 0 in hrs_carq:</span>
                <span class="k">if</span> <span class="n">storm</span><span class="o">.</span><span class="n">dict</span><span class="p">[</span><span class="s1">&#39;year&#39;</span><span class="p">]</span> <span class="o">&lt;</span> <span class="mi">2000</span> <span class="ow">and</span> <span class="n">k</span> <span class="ow">in</span> <span class="n">carq_forecast_init</span> <span class="ow">and</span> <span class="mi">0</span> <span class="ow">in</span> <span class="n">hrs_carq</span><span class="p">:</span>

                    <span class="n">use_carq</span> <span class="o">=</span> <span class="kc">True</span>
                    <span class="n">hr_idx</span> <span class="o">=</span> <span class="n">hrs_carq</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
                    <span class="n">track_dict</span><span class="p">[</span><span class="s1">&#39;lat&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">carq_forecasts</span><span class="p">[</span><span class="n">k</span><span class="p">][</span><span class="s1">&#39;lat&#39;</span><span class="p">][</span><span class="n">hr_idx</span><span class="p">])</span>
                    <span class="n">track_dict</span><span class="p">[</span><span class="s1">&#39;lon&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">carq_forecasts</span><span class="p">[</span><span class="n">k</span><span class="p">][</span><span class="s1">&#39;lon&#39;</span><span class="p">][</span><span class="n">hr_idx</span><span class="p">])</span>
                    <span class="n">track_dict</span><span class="p">[</span><span class="s1">&#39;vmax&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">carq_forecasts</span><span class="p">[</span><span class="n">k</span><span class="p">][</span><span class="s1">&#39;vmax&#39;</span><span class="p">][</span><span class="n">hr_idx</span><span class="p">])</span>
                    <span class="n">track_dict</span><span class="p">[</span><span class="s1">&#39;mslp&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">nan</span><span class="p">)</span>
                    <span class="n">track_dict</span><span class="p">[</span><span class="s1">&#39;date&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">carq_forecasts</span><span class="p">[</span><span class="n">k</span><span class="p">][</span><span class="s1">&#39;init&#39;</span><span class="p">])</span>

                    <span class="n">itype</span> <span class="o">=</span> <span class="n">carq_forecasts</span><span class="p">[</span><span class="n">k</span><span class="p">][</span><span class="s1">&#39;type&#39;</span><span class="p">][</span><span class="n">hr_idx</span><span class="p">]</span>
                    <span class="k">if</span> <span class="n">itype</span> <span class="o">==</span> <span class="s2">&quot;&quot;</span><span class="p">:</span> <span class="n">itype</span> <span class="o">=</span> <span class="n">get_storm_type</span><span class="p">(</span><span class="n">carq_forecasts</span><span class="p">[</span><span class="n">k</span><span class="p">][</span><span class="s1">&#39;vmax&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">],</span><span class="kc">False</span><span class="p">)</span>
                    <span class="n">track_dict</span><span class="p">[</span><span class="s1">&#39;type&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">itype</span><span class="p">)</span>

                    <span class="n">hr</span> <span class="o">=</span> <span class="n">carq_forecasts</span><span class="p">[</span><span class="n">k</span><span class="p">][</span><span class="s1">&#39;init&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">strftime</span><span class="p">(</span><span class="s2">&quot;%H%M&quot;</span><span class="p">)</span>
                    <span class="n">track_dict</span><span class="p">[</span><span class="s1">&#39;extra_obs&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span> <span class="k">if</span> <span class="n">hr</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;0300&#39;</span><span class="p">,</span><span class="s1">&#39;0900&#39;</span><span class="p">,</span><span class="s1">&#39;1500&#39;</span><span class="p">,</span><span class="s1">&#39;2100&#39;</span><span class="p">]</span> <span class="k">else</span> <span class="n">track_dict</span><span class="p">[</span><span class="s1">&#39;extra_obs&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
                    <span class="n">track_dict</span><span class="p">[</span><span class="s1">&#39;special&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;&quot;</span><span class="p">)</span>

                <span class="k">else</span><span class="p">:</span>
                    <span class="n">use_carq</span> <span class="o">=</span> <span class="kc">False</span>
                    <span class="k">if</span> <span class="mi">3</span> <span class="ow">in</span> <span class="n">hrs</span><span class="p">:</span>
                        <span class="n">hr_idx</span> <span class="o">=</span> <span class="n">hrs</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span>
                        <span class="n">hr_add</span> <span class="o">=</span> <span class="mi">3</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="n">hr_idx</span> <span class="o">=</span> <span class="mi">0</span>
                        <span class="n">hr_add</span> <span class="o">=</span> <span class="mi">0</span>
                    <span class="n">track_dict</span><span class="p">[</span><span class="s1">&#39;lat&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">nhc_forecasts</span><span class="p">[</span><span class="n">k</span><span class="p">][</span><span class="s1">&#39;lat&#39;</span><span class="p">][</span><span class="n">hr_idx</span><span class="p">])</span>
                    <span class="n">track_dict</span><span class="p">[</span><span class="s1">&#39;lon&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">nhc_forecasts</span><span class="p">[</span><span class="n">k</span><span class="p">][</span><span class="s1">&#39;lon&#39;</span><span class="p">][</span><span class="n">hr_idx</span><span class="p">])</span>
                    <span class="n">track_dict</span><span class="p">[</span><span class="s1">&#39;vmax&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">nhc_forecasts</span><span class="p">[</span><span class="n">k</span><span class="p">][</span><span class="s1">&#39;vmax&#39;</span><span class="p">][</span><span class="n">hr_idx</span><span class="p">])</span>
                    <span class="n">track_dict</span><span class="p">[</span><span class="s1">&#39;mslp&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">nan</span><span class="p">)</span>
                    <span class="n">track_dict</span><span class="p">[</span><span class="s1">&#39;date&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">nhc_forecasts</span><span class="p">[</span><span class="n">k</span><span class="p">][</span><span class="s1">&#39;init&#39;</span><span class="p">]</span><span class="o">+</span><span class="n">timedelta</span><span class="p">(</span><span class="n">hours</span><span class="o">=</span><span class="n">hr_add</span><span class="p">))</span>

                    <span class="n">itype</span> <span class="o">=</span> <span class="n">nhc_forecasts</span><span class="p">[</span><span class="n">k</span><span class="p">][</span><span class="s1">&#39;type&#39;</span><span class="p">][</span><span class="n">hr_idx</span><span class="p">]</span>
                    <span class="k">if</span> <span class="n">itype</span> <span class="o">==</span> <span class="s2">&quot;&quot;</span><span class="p">:</span> <span class="n">itype</span> <span class="o">=</span> <span class="n">get_storm_type</span><span class="p">(</span><span class="n">nhc_forecasts</span><span class="p">[</span><span class="n">k</span><span class="p">][</span><span class="s1">&#39;vmax&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">],</span><span class="kc">False</span><span class="p">)</span>
                    <span class="n">track_dict</span><span class="p">[</span><span class="s1">&#39;type&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">itype</span><span class="p">)</span>

                    <span class="n">hr</span> <span class="o">=</span> <span class="n">nhc_forecasts</span><span class="p">[</span><span class="n">k</span><span class="p">][</span><span class="s1">&#39;init&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">strftime</span><span class="p">(</span><span class="s2">&quot;%H%M&quot;</span><span class="p">)</span>
                    <span class="n">track_dict</span><span class="p">[</span><span class="s1">&#39;extra_obs&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span> <span class="k">if</span> <span class="n">hr</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;0300&#39;</span><span class="p">,</span><span class="s1">&#39;0900&#39;</span><span class="p">,</span><span class="s1">&#39;1500&#39;</span><span class="p">,</span><span class="s1">&#39;2100&#39;</span><span class="p">]</span> <span class="k">else</span> <span class="n">track_dict</span><span class="p">[</span><span class="s1">&#39;extra_obs&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
                    <span class="n">track_dict</span><span class="p">[</span><span class="s1">&#39;special&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;&quot;</span><span class="p">)</span>

            <span class="c1">#Add main elements from storm dict</span>
            <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;id&#39;</span><span class="p">,</span><span class="s1">&#39;operational_id&#39;</span><span class="p">,</span><span class="s1">&#39;name&#39;</span><span class="p">,</span><span class="s1">&#39;year&#39;</span><span class="p">]:</span>
                <span class="n">track_dict</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="n">storm</span><span class="o">.</span><span class="n">dict</span><span class="p">[</span><span class="n">key</span><span class="p">]</span>

            <span class="c1">#Add carq to forecast dict as hour 0, if available</span>
            <span class="k">if</span> <span class="n">use_carq</span> <span class="o">==</span> <span class="kc">True</span> <span class="ow">and</span> <span class="n">forecast_dict</span><span class="p">[</span><span class="s1">&#39;init&#39;</span><span class="p">]</span> <span class="ow">in</span> <span class="n">track_dict</span><span class="p">[</span><span class="s1">&#39;date&#39;</span><span class="p">]:</span>
                <span class="n">insert_idx</span> <span class="o">=</span> <span class="n">track_dict</span><span class="p">[</span><span class="s1">&#39;date&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="n">forecast_dict</span><span class="p">[</span><span class="s1">&#39;init&#39;</span><span class="p">])</span>
                <span class="k">if</span> <span class="mi">0</span> <span class="ow">in</span> <span class="n">forecast_dict</span><span class="p">[</span><span class="s1">&#39;fhr&#39;</span><span class="p">]:</span>
                    <span class="n">forecast_dict</span><span class="p">[</span><span class="s1">&#39;lat&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">track_dict</span><span class="p">[</span><span class="s1">&#39;lat&#39;</span><span class="p">][</span><span class="n">insert_idx</span><span class="p">]</span>
                    <span class="n">forecast_dict</span><span class="p">[</span><span class="s1">&#39;lon&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">track_dict</span><span class="p">[</span><span class="s1">&#39;lon&#39;</span><span class="p">][</span><span class="n">insert_idx</span><span class="p">]</span>
                    <span class="n">forecast_dict</span><span class="p">[</span><span class="s1">&#39;vmax&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">track_dict</span><span class="p">[</span><span class="s1">&#39;vmax&#39;</span><span class="p">][</span><span class="n">insert_idx</span><span class="p">]</span>
                    <span class="n">forecast_dict</span><span class="p">[</span><span class="s1">&#39;mslp&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">track_dict</span><span class="p">[</span><span class="s1">&#39;mslp&#39;</span><span class="p">][</span><span class="n">insert_idx</span><span class="p">]</span>
                    <span class="n">forecast_dict</span><span class="p">[</span><span class="s1">&#39;type&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">track_dict</span><span class="p">[</span><span class="s1">&#39;type&#39;</span><span class="p">][</span><span class="n">insert_idx</span><span class="p">]</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">forecast_dict</span><span class="p">[</span><span class="s1">&#39;fhr&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">insert</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">)</span>
                    <span class="n">forecast_dict</span><span class="p">[</span><span class="s1">&#39;lat&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">insert</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="n">track_dict</span><span class="p">[</span><span class="s1">&#39;lat&#39;</span><span class="p">][</span><span class="n">insert_idx</span><span class="p">])</span>
                    <span class="n">forecast_dict</span><span class="p">[</span><span class="s1">&#39;lon&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">insert</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="n">track_dict</span><span class="p">[</span><span class="s1">&#39;lon&#39;</span><span class="p">][</span><span class="n">insert_idx</span><span class="p">])</span>
                    <span class="n">forecast_dict</span><span class="p">[</span><span class="s1">&#39;vmax&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">insert</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="n">track_dict</span><span class="p">[</span><span class="s1">&#39;vmax&#39;</span><span class="p">][</span><span class="n">insert_idx</span><span class="p">])</span>
                    <span class="n">forecast_dict</span><span class="p">[</span><span class="s1">&#39;mslp&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">insert</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="n">track_dict</span><span class="p">[</span><span class="s1">&#39;mslp&#39;</span><span class="p">][</span><span class="n">insert_idx</span><span class="p">])</span>
                    <span class="n">forecast_dict</span><span class="p">[</span><span class="s1">&#39;type&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">insert</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="n">track_dict</span><span class="p">[</span><span class="s1">&#39;type&#39;</span><span class="p">][</span><span class="n">insert_idx</span><span class="p">])</span>

            <span class="c1">#Add other info to forecast dict</span>
            <span class="n">forecast_dict</span><span class="p">[</span><span class="s1">&#39;advisory_num&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">advisory_num</span>
            <span class="n">forecast_dict</span><span class="p">[</span><span class="s1">&#39;basin&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">storm</span><span class="o">.</span><span class="n">basin</span>
            
            <span class="c1">#Append to storms</span>
            <span class="n">track_dict</span><span class="p">[</span><span class="s1">&#39;prob_2day&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;N/A&#39;</span>
            <span class="n">track_dict</span><span class="p">[</span><span class="s1">&#39;risk_2day&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;N/A&#39;</span>
            <span class="n">track_dict</span><span class="p">[</span><span class="s1">&#39;prob_5day&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;N/A&#39;</span>
            <span class="n">track_dict</span><span class="p">[</span><span class="s1">&#39;risk_5day&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;N/A&#39;</span>
            
            <span class="n">track_dict</span><span class="p">[</span><span class="s1">&#39;basin&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">storm</span><span class="o">.</span><span class="n">basin</span>
            <span class="n">storms</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">Storm</span><span class="p">(</span><span class="n">track_dict</span><span class="p">))</span>
            <span class="n">forecasts</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">forecast_dict</span><span class="p">)</span>
        
        <span class="c1">#Retrieve kwargs</span>
        <span class="n">invest_prop</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;plot&#39;</span><span class="p">:</span><span class="kc">False</span><span class="p">}</span>
        <span class="n">storm_prop</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;storm_prop&#39;</span><span class="p">,{})</span>
        <span class="n">cone_prop</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;cone_prop&#39;</span><span class="p">,{})</span>
        <span class="n">map_prop</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;map_prop&#39;</span><span class="p">,{})</span>
        
        <span class="c1">#Create instance of plot object</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">plot_obj</span>
        <span class="k">except</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">plot_obj</span> <span class="o">=</span> <span class="n">TrackPlot</span><span class="p">()</span>
        
        <span class="c1">#Create cartopy projection</span>
        <span class="k">if</span> <span class="n">cartopy_proj</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">plot_obj</span><span class="o">.</span><span class="n">proj</span> <span class="o">=</span> <span class="n">cartopy_proj</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">plot_obj</span><span class="o">.</span><span class="n">create_cartopy</span><span class="p">(</span><span class="n">proj</span><span class="o">=</span><span class="s1">&#39;PlateCarree&#39;</span><span class="p">,</span><span class="n">central_longitude</span><span class="o">=</span><span class="mf">180.0</span><span class="p">)</span> <span class="c1">#0.0</span>
        
        <span class="c1">#Plot</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;--&gt; Generating plot&quot;</span><span class="p">)</span>
        <span class="n">ax</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">plot_obj</span><span class="o">.</span><span class="n">plot_summary</span><span class="p">(</span><span class="n">storms</span><span class="p">,</span><span class="n">forecasts</span><span class="p">,</span><span class="n">shapefiles</span><span class="p">,</span><span class="n">time</span><span class="p">,</span><span class="n">domain</span><span class="p">,</span>
                                        <span class="n">ax</span><span class="p">,</span><span class="n">save_path</span><span class="p">,</span><span class="n">two_prop</span><span class="p">,</span><span class="n">invest_prop</span><span class="p">,</span><span class="n">storm_prop</span><span class="p">,</span><span class="n">cone_prop</span><span class="p">,</span><span class="n">map_prop</span><span class="p">)</span>
        
        <span class="k">return</span> <span class="n">ax</span></div></div>
        
</pre></div>

           </div>
          </div>
          <footer>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2021, Tropycal Developers.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>