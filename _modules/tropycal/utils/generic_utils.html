<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>tropycal.utils.generic_utils &mdash; tropycal </title>
      <link rel="stylesheet" href="../../../_static/pygments.css" type="text/css" />
      <link rel="stylesheet" href="../../../_static/css/theme.css" type="text/css" />
      <link rel="stylesheet" href="../../../_static/plot_directive.css" type="text/css" />
      <link rel="stylesheet" href="../../../_static/sg_gallery.css" type="text/css" />
      <link rel="stylesheet" href="../../../_static/sg_gallery-binder.css" type="text/css" />
      <link rel="stylesheet" href="../../../_static/sg_gallery-dataframe.css" type="text/css" />
      <link rel="stylesheet" href="../../../_static/sg_gallery-rendered-html.css" type="text/css" />
      <link rel="stylesheet" href="../../../_static/css/theme.css" type="text/css" />
    <link rel="shortcut icon" href="../../../_static/logo_32.ico"/>
  <!--[if lt IE 9]>
    <script src="../../../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
        <script data-url_root="../../../" id="documentation_options" src="../../../_static/documentation_options.js"></script>
        <script src="../../../_static/jquery.js"></script>
        <script src="../../../_static/underscore.js"></script>
        <script src="../../../_static/doctools.js"></script>
    <script src="../../../_static/js/theme.js"></script>
    <link rel="index" title="Index" href="../../../genindex.html" />
    <link rel="search" title="Search" href="../../../search.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
            <a href="../../../index.html" class="icon icon-home"> tropycal
            <img src="../../../_static/logo.png" class="logo" alt="Logo"/>
          </a>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <ul>
<li class="toctree-l1"><a class="reference internal" href="../../../install.html">Installation Guide</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../support.html">Support</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../examples/index.html">Example Scripts</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../api/index.html">API Reference</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../sample_usage.html">Example Gallery</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../data.html">Data Sources</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../../index.html">tropycal</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../../../index.html" class="icon icon-home"></a> &raquo;</li>
          <li><a href="../../index.html">Module code</a> &raquo;</li>
      <li>tropycal.utils.generic_utils</li>
      <li class="wy-breadcrumbs-aside">
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <h1>Source code for tropycal.utils.generic_utils</h1><div class="highlight"><pre>
<span></span><span class="sa">r</span><span class="sd">&quot;&quot;&quot;Utility functions that are used across modules.</span>

<span class="sd">Ensure these do not reference any function from colors.py. If a function does need to reference another function from colors.py,</span>
<span class="sd">add it in that file.</span>

<span class="sd">Public utility functions should be added to documentation in the &#39;/docs/_templates/overrides/tropycal.utils.rst&#39; file.&quot;&quot;&quot;</span>

<span class="kn">import</span> <span class="nn">os</span><span class="o">,</span> <span class="nn">sys</span>
<span class="kn">import</span> <span class="nn">math</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>
<span class="kn">from</span> <span class="nn">datetime</span> <span class="kn">import</span> <span class="n">datetime</span> <span class="k">as</span> <span class="n">dt</span><span class="p">,</span><span class="n">timedelta</span>
<span class="kn">import</span> <span class="nn">requests</span>
<span class="kn">import</span> <span class="nn">urllib</span>
<span class="kn">import</span> <span class="nn">matplotlib.dates</span> <span class="k">as</span> <span class="nn">mdates</span>
<span class="kn">import</span> <span class="nn">matplotlib.colors</span> <span class="k">as</span> <span class="nn">mcolors</span>
<span class="kn">import</span> <span class="nn">matplotlib</span> <span class="k">as</span> <span class="nn">mlib</span>
<span class="kn">from</span> <span class="nn">matplotlib</span> <span class="kn">import</span> <span class="n">path</span>
<span class="kn">import</span> <span class="nn">warnings</span>
<span class="kn">import</span> <span class="nn">scipy.interpolate</span> <span class="k">as</span> <span class="nn">interp</span>
<span class="kn">import</span> <span class="nn">re</span>
<span class="kn">import</span> <span class="nn">shapefile</span>
<span class="kn">import</span> <span class="nn">zipfile</span>
<span class="kn">from</span> <span class="nn">io</span> <span class="kn">import</span> <span class="n">StringIO</span><span class="p">,</span> <span class="n">BytesIO</span>

<span class="kn">from</span> <span class="nn">..</span> <span class="kn">import</span> <span class="n">constants</span>

<span class="c1">#===========================================================================================================</span>
<span class="c1"># Public utilities</span>
<span class="c1"># These are used internally and have use externally. Add these to documentation.</span>
<span class="c1">#===========================================================================================================</span>

<div class="viewcode-block" id="wind_to_category"><a class="viewcode-back" href="../../../api/generated/tropycal.utils.wind_to_category.html#tropycal.utils.wind_to_category">[docs]</a><span class="k">def</span> <span class="nf">wind_to_category</span><span class="p">(</span><span class="n">wind_speed</span><span class="p">):</span>
    
    <span class="sa">r</span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Convert sustained wind speed in knots to Saffir-Simpson Hurricane Wind Scale category.</span>
<span class="sd">    </span>
<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    wind_speed : int</span>
<span class="sd">        Sustained wind speed in knots.</span>
<span class="sd">    </span>
<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    int</span>
<span class="sd">        Category corresponding to the sustained wind. 0 is tropical storm, -1 is tropical depression.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    
    <span class="c1">#Category 5 hurricane</span>
    <span class="k">if</span> <span class="n">wind_speed</span> <span class="o">&gt;=</span> <span class="mi">137</span><span class="p">:</span>
        <span class="k">return</span> <span class="mi">5</span>
    
    <span class="c1">#Category 4 hurricane</span>
    <span class="k">elif</span> <span class="n">wind_speed</span> <span class="o">&gt;=</span> <span class="mi">113</span><span class="p">:</span>
        <span class="k">return</span> <span class="mi">4</span>
    
    <span class="c1">#Category 3 hurricane</span>
    <span class="k">elif</span> <span class="n">wind_speed</span> <span class="o">&gt;=</span> <span class="mi">96</span><span class="p">:</span>
        <span class="k">return</span> <span class="mi">3</span>
    
    <span class="c1">#Category 2 hurricane</span>
    <span class="k">elif</span> <span class="n">wind_speed</span> <span class="o">&gt;=</span> <span class="mi">83</span><span class="p">:</span>
        <span class="k">return</span> <span class="mi">2</span>
    
    <span class="c1">#Category 1 hurricane</span>
    <span class="k">elif</span> <span class="n">wind_speed</span> <span class="o">&gt;=</span> <span class="mi">64</span><span class="p">:</span>
        <span class="k">return</span> <span class="mi">1</span>
    
    <span class="c1">#Tropical storm</span>
    <span class="k">elif</span> <span class="n">wind_speed</span> <span class="o">&gt;=</span> <span class="mi">34</span><span class="p">:</span>
        <span class="k">return</span> <span class="mi">0</span>
    
    <span class="c1">#Tropical depression</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">return</span> <span class="o">-</span><span class="mi">1</span></div>

<div class="viewcode-block" id="category_to_wind"><a class="viewcode-back" href="../../../api/generated/tropycal.utils.category_to_wind.html#tropycal.utils.category_to_wind">[docs]</a><span class="k">def</span> <span class="nf">category_to_wind</span><span class="p">(</span><span class="n">category</span><span class="p">):</span>
    
    <span class="sa">r</span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Convert Saffir-Simpson Hurricane Wind Scale category to minimum threshold sustained wind speed in knots.</span>
<span class="sd">    </span>
<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    category : int</span>
<span class="sd">        Saffir-Simpson Hurricane Wind Scale category. Use 0 for tropical storm, -1 for tropical depression.</span>
<span class="sd">    </span>
<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    int</span>
<span class="sd">        Sustained wind speed in knots corresponding to the minimum threshold of the requested category.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    
    <span class="c1">#Construct dictionary of thresholds</span>
    <span class="n">conversion</span> <span class="o">=</span> <span class="p">{</span><span class="o">-</span><span class="mi">1</span><span class="p">:</span><span class="mi">5</span><span class="p">,</span>
                  <span class="mi">0</span><span class="p">:</span><span class="mi">34</span><span class="p">,</span>
                  <span class="mi">1</span><span class="p">:</span><span class="mi">64</span><span class="p">,</span>
                  <span class="mi">2</span><span class="p">:</span><span class="mi">83</span><span class="p">,</span>
                  <span class="mi">3</span><span class="p">:</span><span class="mi">96</span><span class="p">,</span>
                  <span class="mi">4</span><span class="p">:</span><span class="mi">113</span><span class="p">,</span>
                  <span class="mi">5</span><span class="p">:</span><span class="mi">137</span><span class="p">}</span>
    
    <span class="c1">#Return category</span>
    <span class="k">return</span> <span class="n">conversion</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">category</span><span class="p">,</span><span class="n">np</span><span class="o">.</span><span class="n">nan</span><span class="p">)</span></div>

<div class="viewcode-block" id="classify_subtropical"><a class="viewcode-back" href="../../../api/generated/tropycal.utils.classify_subtropical.html#tropycal.utils.classify_subtropical">[docs]</a><span class="k">def</span> <span class="nf">classify_subtropical</span><span class="p">(</span><span class="n">storm_type</span><span class="p">):</span>
    
    <span class="sa">r</span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Determine whether a tropical cyclone was purely subtropical.</span>
<span class="sd">    </span>
<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    storm_type : list or numpy.ndarray</span>
<span class="sd">        List or array containing storm types.</span>
<span class="sd">    </span>
<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    bool</span>
<span class="sd">        Boolean identifying whether the tropical cyclone was purely subtropical.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    
    <span class="c1">#Ensure storm_type is a numpy array</span>
    <span class="n">storm_type_check</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">storm_type</span><span class="p">)</span>
    
    <span class="c1">#Ensure all storm types are uppercase</span>
    <span class="n">storm_track_check</span> <span class="o">=</span> <span class="p">[</span><span class="n">i</span><span class="o">.</span><span class="n">upper</span><span class="p">()</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">storm_type_check</span><span class="p">]</span>
    
    <span class="c1">#Check for subtropical depression status</span>
    <span class="k">if</span> <span class="s1">&#39;SD&#39;</span> <span class="ow">in</span> <span class="n">storm_type_check</span><span class="p">:</span>
        <span class="k">if</span> <span class="s1">&#39;SD&#39;</span> <span class="ow">in</span> <span class="n">storm_type_check</span> <span class="ow">and</span> <span class="kc">True</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">np</span><span class="o">.</span><span class="n">isin</span><span class="p">(</span><span class="n">storm_type_check</span><span class="p">,[</span><span class="s1">&#39;TD&#39;</span><span class="p">,</span><span class="s1">&#39;TS&#39;</span><span class="p">,</span><span class="s1">&#39;HU&#39;</span><span class="p">]):</span>
            <span class="k">return</span> <span class="kc">True</span>
    
    <span class="c1">#Check for subtropical storm status</span>
    <span class="k">if</span> <span class="s1">&#39;SS&#39;</span> <span class="ow">in</span> <span class="n">storm_type_check</span> <span class="ow">and</span> <span class="kc">True</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">np</span><span class="o">.</span><span class="n">isin</span><span class="p">(</span><span class="n">storm_type_check</span><span class="p">,[</span><span class="s1">&#39;TD&#39;</span><span class="p">,</span><span class="s1">&#39;TS&#39;</span><span class="p">,</span><span class="s1">&#39;HU&#39;</span><span class="p">]):</span>
        <span class="k">return</span> <span class="kc">True</span>
    
    <span class="c1">#Otherwise, it was a tropical cyclone at some point in its life cycle</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">return</span> <span class="kc">False</span></div>

<div class="viewcode-block" id="get_storm_classification"><a class="viewcode-back" href="../../../api/generated/tropycal.utils.get_storm_classification.html#tropycal.utils.get_storm_classification">[docs]</a><span class="k">def</span> <span class="nf">get_storm_classification</span><span class="p">(</span><span class="n">wind_speed</span><span class="p">,</span><span class="n">subtropical_flag</span><span class="p">,</span><span class="n">basin</span><span class="p">):</span>
    
    <span class="sa">r</span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Retrieve the tropical cyclone classification given its subtropical status and current basin.</span>
<span class="sd">    </span>
<span class="sd">    These strings take the format of &quot;Tropical Storm&quot;, &quot;Hurricane&quot;, &quot;Typhoon&quot;, etc.</span>
<span class="sd">    </span>
<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    wind_speed : int</span>
<span class="sd">        Integer denoting sustained wind speed in knots.</span>
<span class="sd">    subtropical_flag : bool</span>
<span class="sd">        Boolean denoting whether the cyclone is subtropical or not.</span>
<span class="sd">    basin : str</span>
<span class="sd">        String denoting basin in which the tropical cyclone is located.</span>
<span class="sd">    </span>
<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    str</span>
<span class="sd">        String denoting the classification of the tropical cyclone.</span>
<span class="sd">    </span>
<span class="sd">    Notes</span>
<span class="sd">    -----</span>
<span class="sd">    </span>
<span class="sd">    .. warning::</span>

<span class="sd">        This function currently does not differentiate between 1-minute, 3-minute and 10-minute sustained wind speeds.</span>
<span class="sd">    </span>
<span class="sd">    &quot;&quot;&quot;</span>
    
    <span class="c1">#North Atlantic and East Pacific basins</span>
    <span class="k">if</span> <span class="n">basin</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;north_atlantic&#39;</span><span class="p">,</span><span class="s1">&#39;east_pacific&#39;</span><span class="p">]:</span>
        <span class="k">if</span> <span class="n">wind_speed</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="k">return</span> <span class="s2">&quot;Unknown&quot;</span>
        <span class="k">elif</span> <span class="n">wind_speed</span> <span class="o">&lt;</span> <span class="mi">34</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">subtropical_flag</span> <span class="o">==</span> <span class="kc">True</span><span class="p">:</span>
                <span class="k">return</span> <span class="s2">&quot;Subtropical Depression&quot;</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">return</span> <span class="s2">&quot;Tropical Depression&quot;</span>
        <span class="k">elif</span> <span class="n">wind_speed</span> <span class="o">&lt;</span> <span class="mi">63</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">subtropical_flag</span> <span class="o">==</span> <span class="kc">True</span><span class="p">:</span>
                <span class="k">return</span> <span class="s2">&quot;Subtropical Storm&quot;</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">return</span> <span class="s2">&quot;Tropical Storm&quot;</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="s2">&quot;Hurricane&quot;</span>
    
    <span class="c1">#West Pacific basin</span>
    <span class="k">elif</span> <span class="n">basin</span> <span class="o">==</span> <span class="s1">&#39;west_pacific&#39;</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">wind_speed</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="k">return</span> <span class="s2">&quot;Unknown&quot;</span>
        <span class="k">elif</span> <span class="n">wind_speed</span> <span class="o">&lt;</span> <span class="mi">34</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">subtropical_flag</span> <span class="o">==</span> <span class="kc">True</span><span class="p">:</span>
                <span class="k">return</span> <span class="s2">&quot;Subtropical Depression&quot;</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">return</span> <span class="s2">&quot;Tropical Depression&quot;</span>
        <span class="k">elif</span> <span class="n">wind_speed</span> <span class="o">&lt;</span> <span class="mi">63</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">subtropical_flag</span> <span class="o">==</span> <span class="kc">True</span><span class="p">:</span>
                <span class="k">return</span> <span class="s2">&quot;Subtropical Storm&quot;</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">return</span> <span class="s2">&quot;Tropical Storm&quot;</span>
        <span class="k">elif</span> <span class="n">wind_speed</span> <span class="o">&lt;</span> <span class="mi">130</span><span class="p">:</span>
            <span class="k">return</span> <span class="s2">&quot;Typhoon&quot;</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="s2">&quot;Super Typhoon&quot;</span>
    
    <span class="c1">#Australia and South Pacific basins</span>
    <span class="k">elif</span> <span class="n">basin</span> <span class="o">==</span> <span class="s1">&#39;australia&#39;</span> <span class="ow">or</span> <span class="n">basin</span> <span class="o">==</span> <span class="s1">&#39;south_pacific&#39;</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">wind_speed</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="k">return</span> <span class="s2">&quot;Unknown&quot;</span>
        <span class="k">elif</span> <span class="n">wind_speed</span> <span class="o">&lt;</span> <span class="mi">63</span><span class="p">:</span>
            <span class="k">return</span> <span class="s2">&quot;Tropical Cyclone&quot;</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="s2">&quot;Severe Tropical Cyclone&quot;</span>
    
    <span class="c1">#North Indian Ocean</span>
    <span class="k">elif</span> <span class="n">basin</span> <span class="o">==</span> <span class="s1">&#39;north_indian&#39;</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">wind_speed</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="k">return</span> <span class="s2">&quot;Unknown&quot;</span>
        <span class="k">elif</span> <span class="n">wind_speed</span> <span class="o">&lt;</span> <span class="mi">28</span><span class="p">:</span>
            <span class="k">return</span> <span class="s2">&quot;Depression&quot;</span>
        <span class="k">elif</span> <span class="n">wind_speed</span> <span class="o">&lt;</span> <span class="mi">34</span><span class="p">:</span>
            <span class="k">return</span> <span class="s2">&quot;Deep Depression&quot;</span>
        <span class="k">elif</span> <span class="n">wind_speed</span> <span class="o">&lt;</span> <span class="mi">48</span><span class="p">:</span>
            <span class="k">return</span> <span class="s2">&quot;Cyclonic Storm&quot;</span>
        <span class="k">elif</span> <span class="n">wind_speed</span> <span class="o">&lt;</span> <span class="mi">64</span><span class="p">:</span>
            <span class="k">return</span> <span class="s2">&quot;Severe Cyclonic Storm&quot;</span>
        <span class="k">elif</span> <span class="n">wind_speed</span> <span class="o">&lt;</span> <span class="mi">90</span><span class="p">:</span>
            <span class="k">return</span> <span class="s2">&quot;Very Severe Cyclonic Storm&quot;</span>
        <span class="k">elif</span> <span class="n">wind_speed</span> <span class="o">&lt;</span> <span class="mi">120</span><span class="p">:</span>
            <span class="k">return</span> <span class="s2">&quot;Extremely Severe Cyclonic Storm&quot;</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="s2">&quot;Super Cyclonic Storm&quot;</span>
    
    <span class="c1">#South Indian Ocean</span>
    <span class="k">elif</span> <span class="n">basin</span> <span class="o">==</span> <span class="s1">&#39;south_indian&#39;</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">wind_speed</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="k">return</span> <span class="s2">&quot;Unknown&quot;</span>
        <span class="k">elif</span> <span class="n">wind_speed</span> <span class="o">&lt;</span> <span class="mi">28</span><span class="p">:</span>
            <span class="k">return</span> <span class="s2">&quot;Tropical Disturbance&quot;</span>
        <span class="k">elif</span> <span class="n">wind_speed</span> <span class="o">&lt;</span> <span class="mi">34</span><span class="p">:</span>
            <span class="k">return</span> <span class="s2">&quot;Tropical Depression&quot;</span>
        <span class="k">elif</span> <span class="n">wind_speed</span> <span class="o">&lt;</span> <span class="mi">48</span><span class="p">:</span>
            <span class="k">return</span> <span class="s2">&quot;Moderate Tropical Storm&quot;</span>
        <span class="k">elif</span> <span class="n">wind_speed</span> <span class="o">&lt;</span> <span class="mi">64</span><span class="p">:</span>
            <span class="k">return</span> <span class="s2">&quot;Severe Tropical Storm&quot;</span>
        <span class="k">elif</span> <span class="n">wind_speed</span> <span class="o">&lt;</span> <span class="mi">90</span><span class="p">:</span>
            <span class="k">return</span> <span class="s2">&quot;Tropical Cyclone&quot;</span>
        <span class="k">elif</span> <span class="n">wind_speed</span> <span class="o">&lt;</span> <span class="mi">115</span><span class="p">:</span>
            <span class="k">return</span> <span class="s2">&quot;Intense Tropical Cyclone&quot;</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="s2">&quot;Very Intense Tropical Cyclone&quot;</span>
    
    <span class="c1">#Otherwise, return a generic &quot;Cyclone&quot; classification</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">return</span> <span class="s2">&quot;Cyclone&quot;</span></div>

<div class="viewcode-block" id="get_storm_type"><a class="viewcode-back" href="../../../api/generated/tropycal.utils.get_storm_type.html#tropycal.utils.get_storm_type">[docs]</a><span class="k">def</span> <span class="nf">get_storm_type</span><span class="p">(</span><span class="n">wind_speed</span><span class="p">,</span><span class="n">subtropical_flag</span><span class="p">):</span>
    
    <span class="sa">r</span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Retrieve the 2-character tropical cyclone type (e.g., &quot;TD&quot;, &quot;TS&quot;, &quot;HU&quot;) given its subtropical status.</span>
<span class="sd">    </span>
<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    wind_speed : int</span>
<span class="sd">        Integer denoting sustained wind speed in knots.</span>
<span class="sd">    subtropical_flag : bool</span>
<span class="sd">        Boolean denoting whether the cyclone is subtropical or not.</span>
<span class="sd">    </span>
<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    str</span>
<span class="sd">        String denoting the tropical cyclone type.</span>
<span class="sd">    </span>
<span class="sd">    Notes</span>
<span class="sd">    -----</span>
<span class="sd">    The available types and their descriptions are as follows:</span>
<span class="sd">    </span>
<span class="sd">    .. list-table:: </span>
<span class="sd">       :widths: 25 75</span>
<span class="sd">       :header-rows: 1</span>

<span class="sd">       * - Property</span>
<span class="sd">         - Description</span>
<span class="sd">       * - TD</span>
<span class="sd">         - Tropical Depression</span>
<span class="sd">       * - TS</span>
<span class="sd">         - Tropical Storm</span>
<span class="sd">       * - HU</span>
<span class="sd">         - Hurricane</span>
<span class="sd">       * - SD</span>
<span class="sd">         - Subtropical Depression</span>
<span class="sd">       * - SS</span>
<span class="sd">         - Subtropical Storm</span>
<span class="sd">    &quot;&quot;&quot;</span>
    
    <span class="c1">#Tropical depression</span>
    <span class="k">if</span> <span class="n">wind_speed</span> <span class="o">&lt;</span> <span class="mi">34</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">subtropical_flag</span> <span class="o">==</span> <span class="kc">True</span><span class="p">:</span>
            <span class="k">return</span> <span class="s2">&quot;SD&quot;</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="s2">&quot;TD&quot;</span>
    
    <span class="c1">#Tropical storm</span>
    <span class="k">elif</span> <span class="n">wind_speed</span> <span class="o">&lt;</span> <span class="mi">63</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">subtropical_flag</span> <span class="o">==</span> <span class="kc">True</span><span class="p">:</span>
            <span class="k">return</span> <span class="s2">&quot;SS&quot;</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="s2">&quot;TS&quot;</span>
    
    <span class="c1">#Hurricane</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">return</span> <span class="s2">&quot;HU&quot;</span></div>

<div class="viewcode-block" id="get_basin"><a class="viewcode-back" href="../../../api/generated/tropycal.utils.get_basin.html#tropycal.utils.get_basin">[docs]</a><span class="k">def</span> <span class="nf">get_basin</span><span class="p">(</span><span class="n">lat</span><span class="p">,</span><span class="n">lon</span><span class="p">,</span><span class="n">source_basin</span><span class="o">=</span><span class="s2">&quot;&quot;</span><span class="p">):</span>
    
    <span class="sa">r</span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Returns the current basin of the tropical cyclone.</span>
<span class="sd">    </span>
<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    lat : int or float</span>
<span class="sd">        Latitude of the storm.</span>
<span class="sd">    lon : int or float</span>
<span class="sd">        Longitude of the storm.</span>
<span class="sd">    </span>
<span class="sd">    Other Parameters</span>
<span class="sd">    ----------------</span>
<span class="sd">    source_basin : str, optional</span>
<span class="sd">        String representing the origin storm basin (e.g., &quot;north_atlantic&quot;, &quot;east_pacific&quot;).</span>
<span class="sd">    </span>
<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    str</span>
<span class="sd">        String representing the current basin (e.g., &quot;north_atlantic&quot;, &quot;east_pacific&quot;).</span>
<span class="sd">    </span>
<span class="sd">    Notes</span>
<span class="sd">    -----</span>
<span class="sd">    For storms in the North Atlantic or East Pacific basin, ``source_basin`` must be provided. This is because storms located over Mexico or Central America could be in either basin depending on where they originated (e.g., storms originated in the Atlantic basin are considered to be within the Atlantic basin while over Mexico or Central America until emerging in the Pacific Ocean).</span>
<span class="sd">    &quot;&quot;&quot;</span>
    
    <span class="c1">#Error check</span>
    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">lat</span><span class="p">,(</span><span class="nb">int</span><span class="p">,</span><span class="n">np</span><span class="o">.</span><span class="n">int</span><span class="p">,</span><span class="n">np</span><span class="o">.</span><span class="n">integer</span><span class="p">,</span><span class="nb">float</span><span class="p">,</span><span class="n">np</span><span class="o">.</span><span class="n">floating</span><span class="p">))</span> <span class="o">==</span> <span class="kc">False</span><span class="p">:</span>
        <span class="n">msg</span> <span class="o">=</span> <span class="s2">&quot;</span><span class="se">\&quot;</span><span class="s2">lat</span><span class="se">\&quot;</span><span class="s2"> must be of type int or float.&quot;</span>
        <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>
    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">lon</span><span class="p">,(</span><span class="nb">int</span><span class="p">,</span><span class="n">np</span><span class="o">.</span><span class="n">int</span><span class="p">,</span><span class="n">np</span><span class="o">.</span><span class="n">integer</span><span class="p">,</span><span class="nb">float</span><span class="p">,</span><span class="n">np</span><span class="o">.</span><span class="n">floating</span><span class="p">))</span> <span class="o">==</span> <span class="kc">False</span><span class="p">:</span>
        <span class="n">msg</span> <span class="o">=</span> <span class="s2">&quot;</span><span class="se">\&quot;</span><span class="s2">lon</span><span class="se">\&quot;</span><span class="s2"> must be of type int or float.&quot;</span>
        <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>
    
    <span class="c1">#Fix longitude</span>
    <span class="k">if</span> <span class="n">lon</span> <span class="o">&lt;</span> <span class="mf">0.0</span><span class="p">:</span> <span class="n">lon</span> <span class="o">=</span> <span class="n">lon</span> <span class="o">+</span> <span class="mf">360.0</span>
    
    <span class="c1">#Northern hemisphere check</span>
    <span class="k">if</span> <span class="n">lat</span> <span class="o">&gt;=</span> <span class="mf">0.0</span><span class="p">:</span>
        
        <span class="k">if</span> <span class="n">lon</span> <span class="o">&lt;</span> <span class="mf">100.0</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">lat</span> <span class="o">&lt;</span> <span class="mf">40.0</span><span class="p">:</span>
                <span class="k">return</span> <span class="s2">&quot;north_indian&quot;</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">lon</span> <span class="o">&lt;</span> <span class="mf">70.0</span><span class="p">:</span>
                    <span class="k">return</span> <span class="s2">&quot;north_atlantic&quot;</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="k">return</span> <span class="s2">&quot;west_pacific&quot;</span>
        <span class="k">elif</span> <span class="n">lon</span> <span class="o">&lt;=</span> <span class="mf">180.0</span><span class="p">:</span>
            <span class="k">return</span> <span class="s2">&quot;west_pacific&quot;</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">source_basin</span> <span class="o">==</span> <span class="s2">&quot;north_atlantic&quot;</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">constants</span><span class="o">.</span><span class="n">PATH_PACIFIC</span><span class="o">.</span><span class="n">contains_point</span><span class="p">((</span><span class="n">lat</span><span class="p">,</span><span class="n">lon</span><span class="p">)):</span>
                    <span class="k">return</span> <span class="s2">&quot;east_pacific&quot;</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="k">return</span> <span class="s2">&quot;north_atlantic&quot;</span>
            <span class="k">elif</span> <span class="n">source_basin</span> <span class="o">==</span> <span class="s2">&quot;east_pacific&quot;</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">constants</span><span class="o">.</span><span class="n">PATH_ATLANTIC</span><span class="o">.</span><span class="n">contains_point</span><span class="p">((</span><span class="n">lat</span><span class="p">,</span><span class="n">lon</span><span class="p">)):</span>
                    <span class="k">return</span> <span class="s2">&quot;north_atlantic&quot;</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="k">return</span> <span class="s2">&quot;east_pacific&quot;</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">msg</span> <span class="o">=</span> <span class="s2">&quot;Cannot determine whether storm is in North Atlantic or East Pacific basins.&quot;</span>
                <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>
    
    <span class="c1">#Southern hemisphere check</span>
    <span class="k">else</span><span class="p">:</span>
        
        <span class="k">if</span> <span class="n">lon</span> <span class="o">&lt;</span> <span class="mf">20.0</span><span class="p">:</span>
            <span class="k">return</span> <span class="s2">&quot;south_atlantic&quot;</span>
        <span class="k">elif</span> <span class="n">lon</span> <span class="o">&lt;</span> <span class="mf">90.0</span><span class="p">:</span>
            <span class="k">return</span> <span class="s2">&quot;south_indian&quot;</span>
        <span class="k">elif</span> <span class="n">lon</span> <span class="o">&lt;</span> <span class="mf">160.0</span><span class="p">:</span>
            <span class="k">return</span> <span class="s2">&quot;australia&quot;</span>
        <span class="k">elif</span> <span class="n">lon</span> <span class="o">&lt;</span> <span class="mf">280.0</span><span class="p">:</span>
            <span class="k">return</span> <span class="s2">&quot;south_pacific&quot;</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="s2">&quot;south_atlantic&quot;</span></div>

<div class="viewcode-block" id="knots_to_mph"><a class="viewcode-back" href="../../../api/generated/tropycal.utils.knots_to_mph.html#tropycal.utils.knots_to_mph">[docs]</a><span class="k">def</span> <span class="nf">knots_to_mph</span><span class="p">(</span><span class="n">wind_speed</span><span class="p">):</span>
    
    <span class="sa">r</span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Convert wind from knots to miles per hour, in increments of 5 as used by NHC.</span>
<span class="sd">    </span>
<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    wind_speed : int</span>
<span class="sd">        Sustained wind in knots.</span>
<span class="sd">    </span>
<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    int</span>
<span class="sd">        Sustained wind in miles per hour.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    
    <span class="c1">#Ensure input is rounded down to nearest multiple of 5</span>
    <span class="n">wind_speed</span> <span class="o">=</span> <span class="n">wind_speed</span> <span class="o">-</span> <span class="p">(</span><span class="n">wind_speed</span> <span class="o">%</span> <span class="mi">5</span><span class="p">)</span>

    <span class="c1">#Define knots and mph conversions</span>
    <span class="n">kts</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">5</span><span class="p">,</span><span class="mi">10</span><span class="p">,</span><span class="mi">15</span><span class="p">,</span><span class="mi">20</span><span class="p">,</span><span class="mi">25</span><span class="p">,</span><span class="mi">30</span><span class="p">,</span><span class="mi">35</span><span class="p">,</span><span class="mi">40</span><span class="p">,</span><span class="mi">45</span><span class="p">,</span><span class="mi">50</span><span class="p">,</span><span class="mi">55</span><span class="p">,</span><span class="mi">60</span><span class="p">,</span><span class="mi">65</span><span class="p">,</span><span class="mi">70</span><span class="p">,</span><span class="mi">75</span><span class="p">,</span><span class="mi">80</span><span class="p">,</span><span class="mi">85</span><span class="p">,</span><span class="mi">90</span><span class="p">,</span><span class="mi">95</span><span class="p">,</span><span class="mi">100</span><span class="p">,</span><span class="mi">105</span><span class="p">,</span><span class="mi">110</span><span class="p">,</span><span class="mi">115</span><span class="p">,</span><span class="mi">120</span><span class="p">,</span><span class="mi">125</span><span class="p">,</span><span class="mi">130</span><span class="p">,</span><span class="mi">135</span><span class="p">,</span><span class="mi">140</span><span class="p">,</span><span class="mi">145</span><span class="p">,</span><span class="mi">150</span><span class="p">,</span><span class="mi">155</span><span class="p">,</span><span class="mi">160</span><span class="p">,</span><span class="mi">165</span><span class="p">,</span><span class="mi">170</span><span class="p">,</span><span class="mi">175</span><span class="p">,</span><span class="mi">180</span><span class="p">,</span><span class="mi">185</span><span class="p">]</span>
    <span class="n">mphs</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">10</span><span class="p">,</span><span class="mi">15</span><span class="p">,</span><span class="mi">20</span><span class="p">,</span><span class="mi">25</span><span class="p">,</span><span class="mi">30</span><span class="p">,</span><span class="mi">35</span><span class="p">,</span><span class="mi">40</span><span class="p">,</span><span class="mi">45</span><span class="p">,</span><span class="mi">50</span><span class="p">,</span><span class="mi">60</span><span class="p">,</span><span class="mi">65</span><span class="p">,</span><span class="mi">70</span><span class="p">,</span><span class="mi">75</span><span class="p">,</span><span class="mi">80</span><span class="p">,</span><span class="mi">85</span><span class="p">,</span><span class="mi">90</span><span class="p">,</span><span class="mi">100</span><span class="p">,</span><span class="mi">105</span><span class="p">,</span><span class="mi">110</span><span class="p">,</span><span class="mi">115</span><span class="p">,</span><span class="mi">120</span><span class="p">,</span><span class="mi">125</span><span class="p">,</span><span class="mi">130</span><span class="p">,</span><span class="mi">140</span><span class="p">,</span><span class="mi">145</span><span class="p">,</span><span class="mi">150</span><span class="p">,</span><span class="mi">155</span><span class="p">,</span><span class="mi">160</span><span class="p">,</span><span class="mi">165</span><span class="p">,</span><span class="mi">175</span><span class="p">,</span><span class="mi">180</span><span class="p">,</span><span class="mi">185</span><span class="p">,</span><span class="mi">190</span><span class="p">,</span><span class="mi">195</span><span class="p">,</span><span class="mi">200</span><span class="p">,</span><span class="mi">205</span><span class="p">,</span><span class="mi">210</span><span class="p">]</span>
    
    <span class="c1">#If value is in list, return converted value</span>
    <span class="k">if</span> <span class="n">wind_speed</span> <span class="ow">in</span> <span class="n">kts</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">mphs</span><span class="p">[</span><span class="n">kts</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="n">wind_speed</span><span class="p">)]</span>
    
    <span class="c1">#Otherwise, return original value</span>
    <span class="k">return</span> <span class="n">wind_speed</span></div>

<div class="viewcode-block" id="accumulated_cyclone_energy"><a class="viewcode-back" href="../../../api/generated/tropycal.utils.accumulated_cyclone_energy.html#tropycal.utils.accumulated_cyclone_energy">[docs]</a><span class="k">def</span> <span class="nf">accumulated_cyclone_energy</span><span class="p">(</span><span class="n">wind_speed</span><span class="p">,</span><span class="n">hours</span><span class="o">=</span><span class="mi">6</span><span class="p">):</span>
    
    <span class="sa">r</span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Calculate Accumulated Cyclone Energy (ACE) based on sustained wind speed in knots.</span>
<span class="sd">    </span>
<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    wind_speed : int or list, numpy.ndarray</span>
<span class="sd">        Sustained wind in knots.</span>
<span class="sd">    hours : int, optional</span>
<span class="sd">        Duration in hours over which the sustained wind was observed. Default is 6 hours.</span>
<span class="sd">    </span>
<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    float</span>
<span class="sd">        Accumulated cyclone energy.</span>
<span class="sd">    </span>
<span class="sd">    Notes</span>
<span class="sd">    -----</span>
<span class="sd">    </span>
<span class="sd">    As defined in `Bell et al. (2000)`_, Accumulated Cyclone Energy (ACE) is calculated as follows:</span>
<span class="sd">    </span>
<span class="sd">    .. math:: ACE = 10^{-4} \sum v^{2}_{max}</span>
<span class="sd">    </span>
<span class="sd">    As shown above, ACE is the sum of the squares of the estimated maximum sustained wind speed (in knots). By default, this assumes data is provided every 6 hours, as is the standard in HURDATv2 and NHC&#39;s Best Track, though this function provides an option to use a different hour duration.</span>
<span class="sd">    </span>
<span class="sd">    .. _Bell et al. (2000): https://journals.ametsoc.org/view/journals/bams/81/6/1520-0477_2000_81_s1_caf_2_0_co_2.xml</span>
<span class="sd">    &quot;&quot;&quot;</span>
    
    <span class="c1">#Determine types</span>
    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">wind_speed</span><span class="p">,(</span><span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span><span class="nb">list</span><span class="p">)):</span>
        <span class="n">wind_speed</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">copy</span><span class="p">(</span><span class="n">wind_speed</span><span class="p">)</span>
    
    <span class="c1">#Calculate ACE</span>
    <span class="n">ace</span> <span class="o">=</span> <span class="p">((</span><span class="mi">10</span><span class="o">**-</span><span class="mi">4</span><span class="p">)</span> <span class="o">*</span> <span class="p">(</span><span class="n">wind_speed</span><span class="o">**</span><span class="mi">2</span><span class="p">))</span> <span class="o">*</span> <span class="p">(</span><span class="n">hours</span><span class="o">/</span><span class="mf">6.0</span><span class="p">)</span>
    
    <span class="c1">#Coerce to zero if wind speed less than TS force</span>
    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">ace</span><span class="p">,(</span><span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span><span class="nb">list</span><span class="p">)):</span>
        <span class="n">ace</span><span class="p">[</span><span class="n">wind_speed</span> <span class="o">&lt;</span> <span class="mi">34</span><span class="p">]</span> <span class="o">=</span> <span class="mf">0.0</span>
        <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">round</span><span class="p">(</span><span class="n">ace</span><span class="p">,</span><span class="mi">4</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">wind_speed</span> <span class="o">&lt;</span> <span class="mi">34</span><span class="p">:</span> <span class="n">ace</span> <span class="o">=</span> <span class="mf">0.0</span>
        <span class="k">return</span> <span class="nb">round</span><span class="p">(</span><span class="n">ace</span><span class="p">,</span><span class="mi">4</span><span class="p">)</span></div>

<div class="viewcode-block" id="dropsonde_mslp_estimate"><a class="viewcode-back" href="../../../api/generated/tropycal.utils.dropsonde_mslp_estimate.html#tropycal.utils.dropsonde_mslp_estimate">[docs]</a><span class="k">def</span> <span class="nf">dropsonde_mslp_estimate</span><span class="p">(</span><span class="n">mslp</span><span class="p">,</span><span class="n">surface_wind</span><span class="p">):</span>
    
    <span class="sa">r</span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Apply a NHC rule of thumb for estimating a TC&#39;s minimum central MSLP. This is intended for a dropsonde released in the eye, accounting for drifting by factoring in the surface wind in knots.</span>
<span class="sd">    </span>
<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    mslp : int or float</span>
<span class="sd">        Dropsonde surface MSLP, in hPa.</span>
<span class="sd">    surface_wind : int or float</span>
<span class="sd">        Surface wind as measured by the dropsonde. This **must** be surface wind; this cannot be substituted by a level just above the surface.</span>
<span class="sd">    </span>
<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    float</span>
<span class="sd">        Estimated TC minimum central MSLP using the NHC estimation method.</span>
<span class="sd">    </span>
<span class="sd">    Notes</span>
<span class="sd">    -----</span>
<span class="sd">    Source is from NHC presentation:</span>
<span class="sd">    https://www.nhc.noaa.gov/outreach/presentations/nhc2013_aircraftData.pdf</span>
<span class="sd">    &quot;&quot;&quot;</span>
    
    <span class="k">return</span> <span class="n">mslp</span> <span class="o">-</span> <span class="p">(</span><span class="n">surface_wind</span> <span class="o">/</span> <span class="mf">10.0</span><span class="p">)</span></div>

<div class="viewcode-block" id="get_two_current"><a class="viewcode-back" href="../../../api/generated/tropycal.utils.get_two_current.html#tropycal.utils.get_two_current">[docs]</a><span class="k">def</span> <span class="nf">get_two_current</span><span class="p">():</span>
    
    <span class="sa">r</span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Retrieve the latest NHC Tropical Weather Outlook (TWO).</span>
<span class="sd">    </span>
<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    dict</span>
<span class="sd">        A dictionary of shapefiles for points, areas and lines.</span>
<span class="sd">    </span>
<span class="sd">    Notes</span>
<span class="sd">    -----</span>
<span class="sd">    The shapefiles returned are modified versions of Cartopy&#39;s BasicReader, allowing to read in shapefiles directly from URL without having to download the shapefile locally first.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    
    <span class="c1">#Retrieve NHC shapefiles for development areas</span>
    <span class="n">shapefiles</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="k">for</span> <span class="n">name</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;areas&#39;</span><span class="p">,</span><span class="s1">&#39;lines&#39;</span><span class="p">,</span><span class="s1">&#39;points&#39;</span><span class="p">]:</span>

        <span class="k">try</span><span class="p">:</span>
            <span class="c1">#Read in shapefile zip from NHC</span>
            <span class="n">url</span> <span class="o">=</span> <span class="s1">&#39;https://www.nhc.noaa.gov/xgtwo/gtwo_shapefiles.zip&#39;</span>
            <span class="n">request</span> <span class="o">=</span> <span class="n">urllib</span><span class="o">.</span><span class="n">request</span><span class="o">.</span><span class="n">Request</span><span class="p">(</span><span class="n">url</span><span class="p">)</span>
            <span class="n">response</span> <span class="o">=</span> <span class="n">urllib</span><span class="o">.</span><span class="n">request</span><span class="o">.</span><span class="n">urlopen</span><span class="p">(</span><span class="n">request</span><span class="p">)</span>
            <span class="n">file_like_object</span> <span class="o">=</span> <span class="n">BytesIO</span><span class="p">(</span><span class="n">response</span><span class="o">.</span><span class="n">read</span><span class="p">())</span>
            <span class="n">tar</span> <span class="o">=</span> <span class="n">zipfile</span><span class="o">.</span><span class="n">ZipFile</span><span class="p">(</span><span class="n">file_like_object</span><span class="p">)</span>

            <span class="c1">#Get file list (points, areas)</span>
            <span class="n">members</span> <span class="o">=</span> <span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="n">i</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">tar</span><span class="o">.</span><span class="n">namelist</span><span class="p">()])</span>
            <span class="n">nums</span> <span class="o">=</span> <span class="s2">&quot;[0123456789]&quot;</span>
            <span class="n">search_pattern</span> <span class="o">=</span> <span class="sa">f</span><span class="s1">&#39;gtwo_</span><span class="si">{</span><span class="n">name</span><span class="si">}</span><span class="s1">_20</span><span class="si">{</span><span class="n">nums</span><span class="si">}{</span><span class="n">nums</span><span class="si">}{</span><span class="n">nums</span><span class="si">}{</span><span class="n">nums</span><span class="si">}{</span><span class="n">nums</span><span class="si">}{</span><span class="n">nums</span><span class="si">}{</span><span class="n">nums</span><span class="si">}{</span><span class="n">nums</span><span class="si">}{</span><span class="n">nums</span><span class="si">}{</span><span class="n">nums</span><span class="si">}</span><span class="s1">.shp&#39;</span>
            <span class="n">pattern</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">compile</span><span class="p">(</span><span class="n">search_pattern</span><span class="p">)</span>
            <span class="n">filelist</span> <span class="o">=</span> <span class="n">pattern</span><span class="o">.</span><span class="n">findall</span><span class="p">(</span><span class="n">members</span><span class="p">)</span>
            <span class="n">files</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="k">for</span> <span class="n">file</span> <span class="ow">in</span> <span class="n">filelist</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">file</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">files</span><span class="p">:</span> <span class="n">files</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">file</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;.shp&quot;</span><span class="p">)[</span><span class="mi">0</span><span class="p">])</span> <span class="c1">#remove duplicates</span>

            <span class="c1">#Retrieve necessary components for shapefile</span>
            <span class="n">members</span> <span class="o">=</span> <span class="n">tar</span><span class="o">.</span><span class="n">namelist</span><span class="p">()</span>
            <span class="n">members_names</span> <span class="o">=</span> <span class="p">[</span><span class="n">i</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">members</span><span class="p">]</span>
            <span class="n">data</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;shp&#39;</span><span class="p">:</span><span class="mi">0</span><span class="p">,</span><span class="s1">&#39;dbf&#39;</span><span class="p">:</span><span class="mi">0</span><span class="p">,</span><span class="s1">&#39;prj&#39;</span><span class="p">:</span><span class="mi">0</span><span class="p">,</span><span class="s1">&#39;shx&#39;</span><span class="p">:</span><span class="mi">0</span><span class="p">}</span>
            <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="n">data</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
                <span class="n">idx</span> <span class="o">=</span> <span class="n">members_names</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="n">files</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">+</span><span class="s2">&quot;.&quot;</span><span class="o">+</span><span class="n">key</span><span class="p">)</span>
                <span class="n">data</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="n">BytesIO</span><span class="p">(</span><span class="n">tar</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="n">members</span><span class="p">[</span><span class="n">idx</span><span class="p">]))</span>

            <span class="c1">#Read in shapefile</span>
            <span class="n">orig_reader</span> <span class="o">=</span> <span class="n">shapefile</span><span class="o">.</span><span class="n">Reader</span><span class="p">(</span><span class="n">shp</span><span class="o">=</span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;shp&#39;</span><span class="p">],</span> <span class="n">dbf</span><span class="o">=</span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;dbf&#39;</span><span class="p">],</span> <span class="n">prj</span><span class="o">=</span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;prj&#39;</span><span class="p">],</span> <span class="n">shx</span><span class="o">=</span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;shx&#39;</span><span class="p">])</span>
            <span class="n">shapefiles</span><span class="p">[</span><span class="n">name</span><span class="p">]</span> <span class="o">=</span> <span class="n">BasicReader</span><span class="p">(</span><span class="n">orig_reader</span><span class="p">)</span>
        <span class="k">except</span><span class="p">:</span>
            <span class="n">shapefiles</span><span class="p">[</span><span class="n">name</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
    
    <span class="k">return</span> <span class="n">shapefiles</span></div>
    
<div class="viewcode-block" id="get_two_archive"><a class="viewcode-back" href="../../../api/generated/tropycal.utils.get_two_archive.html#tropycal.utils.get_two_archive">[docs]</a><span class="k">def</span> <span class="nf">get_two_archive</span><span class="p">(</span><span class="n">time</span><span class="p">):</span>
    
    <span class="sa">r</span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Retrieve an archived NHC Tropical Weather Outlook (TWO). If none available within 30 hours of the specified date, an empty dict is returned.</span>
<span class="sd">    </span>
<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    time : datetime</span>
<span class="sd">        Valid time for archived shapefile.</span>
<span class="sd">    </span>
<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    dict</span>
<span class="sd">        A dictionary of shapefiles for points, areas and lines.</span>
<span class="sd">    </span>
<span class="sd">    Notes</span>
<span class="sd">    -----</span>
<span class="sd">    The shapefiles returned are modified versions of Cartopy&#39;s BasicReader, allowing to read in shapefiles directly from URL without having to download the shapefile locally first.</span>
<span class="sd">    </span>
<span class="sd">    TWO shapefiles are available courtesy of the National Hurricane Center beginning 28 July 2010.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    
    <span class="c1">#Find closest NHC shapefile if within 24 hours</span>
    <span class="n">url</span> <span class="o">=</span> <span class="s1">&#39;https://www.nhc.noaa.gov/gis/archive_gtwo.php&#39;</span>
    <span class="n">page</span> <span class="o">=</span> <span class="n">requests</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">url</span><span class="p">)</span><span class="o">.</span><span class="n">text</span>
    <span class="n">content</span> <span class="o">=</span> <span class="n">page</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
    <span class="n">files</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="n">content</span><span class="p">:</span>
        <span class="k">if</span> <span class="s1">&#39;&lt;a href=&quot;gtwo/archive/2&#39;</span> <span class="ow">in</span> <span class="n">line</span><span class="p">:</span>
            <span class="n">filename</span> <span class="o">=</span> <span class="n">line</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;zip&quot;&gt;&#39;</span><span class="p">)[</span><span class="mi">1</span><span class="p">]</span>
            <span class="n">filename</span> <span class="o">=</span> <span class="n">filename</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;&lt;/a&gt;&quot;</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
            <span class="n">files</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">filename</span><span class="p">)</span>
    <span class="k">del</span> <span class="n">content</span>
    <span class="n">dates</span> <span class="o">=</span> <span class="p">[</span><span class="n">dt</span><span class="o">.</span><span class="n">strptime</span><span class="p">(</span><span class="n">i</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;_&quot;</span><span class="p">)[</span><span class="mi">0</span><span class="p">],</span><span class="s1">&#39;%Y%m</span><span class="si">%d</span><span class="s1">%H%M&#39;</span><span class="p">)</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">files</span><span class="p">]</span>
    <span class="n">diff</span> <span class="o">=</span> <span class="p">[(</span><span class="n">time</span><span class="o">-</span><span class="n">i</span><span class="p">)</span><span class="o">.</span><span class="n">total_seconds</span><span class="p">()</span><span class="o">/</span><span class="mi">3600</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">dates</span><span class="p">]</span>
    <span class="n">diff</span> <span class="o">=</span> <span class="p">[</span><span class="n">i</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">diff</span> <span class="k">if</span> <span class="n">i</span> <span class="o">&gt;=</span> <span class="mi">0</span><span class="p">]</span>

    <span class="c1">#Continue if less than 24 hours difference</span>
    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">diff</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="ow">and</span> <span class="n">np</span><span class="o">.</span><span class="n">nanmin</span><span class="p">(</span><span class="n">diff</span><span class="p">)</span> <span class="o">&lt;=</span> <span class="mi">30</span><span class="p">:</span>
        <span class="n">two_date</span> <span class="o">=</span> <span class="n">dates</span><span class="p">[</span><span class="n">diff</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">nanmin</span><span class="p">(</span><span class="n">diff</span><span class="p">))]</span><span class="o">.</span><span class="n">strftime</span><span class="p">(</span><span class="s1">&#39;%Y%m</span><span class="si">%d</span><span class="s1">%H%M&#39;</span><span class="p">)</span>

        <span class="c1">#Retrieve NHC shapefiles for development areas</span>
        <span class="n">shapefiles</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="k">for</span> <span class="n">name</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;areas&#39;</span><span class="p">,</span><span class="s1">&#39;lines&#39;</span><span class="p">,</span><span class="s1">&#39;points&#39;</span><span class="p">]:</span>

            <span class="k">try</span><span class="p">:</span>
                <span class="c1">#Read in shapefile zip from NHC</span>
                <span class="n">url</span> <span class="o">=</span> <span class="sa">f</span><span class="s1">&#39;https://www.nhc.noaa.gov/gis/gtwo/archive/</span><span class="si">{</span><span class="n">two_date</span><span class="si">}</span><span class="s1">_gtwo.zip&#39;</span>
                <span class="n">request</span> <span class="o">=</span> <span class="n">urllib</span><span class="o">.</span><span class="n">request</span><span class="o">.</span><span class="n">Request</span><span class="p">(</span><span class="n">url</span><span class="p">)</span>
                <span class="n">response</span> <span class="o">=</span> <span class="n">urllib</span><span class="o">.</span><span class="n">request</span><span class="o">.</span><span class="n">urlopen</span><span class="p">(</span><span class="n">request</span><span class="p">)</span>
                <span class="n">file_like_object</span> <span class="o">=</span> <span class="n">BytesIO</span><span class="p">(</span><span class="n">response</span><span class="o">.</span><span class="n">read</span><span class="p">())</span>
                <span class="n">tar</span> <span class="o">=</span> <span class="n">zipfile</span><span class="o">.</span><span class="n">ZipFile</span><span class="p">(</span><span class="n">file_like_object</span><span class="p">)</span>

                <span class="c1">#Get file list (points, areas)</span>
                <span class="n">members</span> <span class="o">=</span> <span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="n">i</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">tar</span><span class="o">.</span><span class="n">namelist</span><span class="p">()])</span>
                <span class="n">nums</span> <span class="o">=</span> <span class="s2">&quot;[0123456789]&quot;</span>
                <span class="n">search_pattern</span> <span class="o">=</span> <span class="sa">f</span><span class="s1">&#39;gtwo_</span><span class="si">{</span><span class="n">name</span><span class="si">}</span><span class="s1">_20</span><span class="si">{</span><span class="n">nums</span><span class="si">}{</span><span class="n">nums</span><span class="si">}{</span><span class="n">nums</span><span class="si">}{</span><span class="n">nums</span><span class="si">}{</span><span class="n">nums</span><span class="si">}{</span><span class="n">nums</span><span class="si">}{</span><span class="n">nums</span><span class="si">}{</span><span class="n">nums</span><span class="si">}{</span><span class="n">nums</span><span class="si">}{</span><span class="n">nums</span><span class="si">}</span><span class="s1">.shp&#39;</span>
                <span class="n">pattern</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">compile</span><span class="p">(</span><span class="n">search_pattern</span><span class="p">)</span>
                <span class="n">filelist</span> <span class="o">=</span> <span class="n">pattern</span><span class="o">.</span><span class="n">findall</span><span class="p">(</span><span class="n">members</span><span class="p">)</span>
                <span class="n">files</span> <span class="o">=</span> <span class="p">[]</span>
                <span class="k">for</span> <span class="n">file</span> <span class="ow">in</span> <span class="n">filelist</span><span class="p">:</span>
                    <span class="k">if</span> <span class="n">file</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">files</span><span class="p">:</span> <span class="n">files</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">file</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;.shp&quot;</span><span class="p">)[</span><span class="mi">0</span><span class="p">])</span> <span class="c1">#remove duplicates</span>
                
                <span class="c1">#Alternatively, check files for older format (generally 2014 and earlier)</span>
                <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">files</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                    <span class="k">if</span> <span class="n">name</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;lines&#39;</span><span class="p">,</span><span class="s1">&#39;points&#39;</span><span class="p">]:</span>
                        <span class="n">shapefiles</span><span class="p">[</span><span class="n">name</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
                        <span class="k">continue</span>
                    <span class="n">search_pattern</span> <span class="o">=</span> <span class="sa">f</span><span class="s1">&#39;20</span><span class="si">{</span><span class="n">nums</span><span class="si">}{</span><span class="n">nums</span><span class="si">}{</span><span class="n">nums</span><span class="si">}{</span><span class="n">nums</span><span class="si">}{</span><span class="n">nums</span><span class="si">}{</span><span class="n">nums</span><span class="si">}{</span><span class="n">nums</span><span class="si">}{</span><span class="n">nums</span><span class="si">}{</span><span class="n">nums</span><span class="si">}{</span><span class="n">nums</span><span class="si">}</span><span class="s1">_gtwo.shp&#39;</span>
                    <span class="n">pattern</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">compile</span><span class="p">(</span><span class="n">search_pattern</span><span class="p">)</span>
                    <span class="n">filelist</span> <span class="o">=</span> <span class="n">pattern</span><span class="o">.</span><span class="n">findall</span><span class="p">(</span><span class="n">members</span><span class="p">)</span>
                    <span class="k">for</span> <span class="n">file</span> <span class="ow">in</span> <span class="n">filelist</span><span class="p">:</span>
                        <span class="k">if</span> <span class="n">file</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">files</span><span class="p">:</span> <span class="n">files</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">file</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;.shp&quot;</span><span class="p">)[</span><span class="mi">0</span><span class="p">])</span> <span class="c1">#remove duplicates</span>

                <span class="c1">#Retrieve necessary components for shapefile</span>
                <span class="n">members</span> <span class="o">=</span> <span class="n">tar</span><span class="o">.</span><span class="n">namelist</span><span class="p">()</span>
                <span class="n">members_names</span> <span class="o">=</span> <span class="p">[</span><span class="n">i</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">members</span><span class="p">]</span>
                <span class="n">data</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;shp&#39;</span><span class="p">:</span><span class="mi">0</span><span class="p">,</span><span class="s1">&#39;dbf&#39;</span><span class="p">:</span><span class="mi">0</span><span class="p">,</span><span class="s1">&#39;prj&#39;</span><span class="p">:</span><span class="mi">0</span><span class="p">,</span><span class="s1">&#39;shx&#39;</span><span class="p">:</span><span class="mi">0</span><span class="p">}</span>
                <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="n">data</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
                    <span class="n">idx</span> <span class="o">=</span> <span class="n">members_names</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="n">files</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">+</span><span class="s2">&quot;.&quot;</span><span class="o">+</span><span class="n">key</span><span class="p">)</span>
                    <span class="n">data</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="n">BytesIO</span><span class="p">(</span><span class="n">tar</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="n">members</span><span class="p">[</span><span class="n">idx</span><span class="p">]))</span>

                <span class="c1">#Read in shapefile</span>
                <span class="n">orig_reader</span> <span class="o">=</span> <span class="n">shapefile</span><span class="o">.</span><span class="n">Reader</span><span class="p">(</span><span class="n">shp</span><span class="o">=</span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;shp&#39;</span><span class="p">],</span> <span class="n">dbf</span><span class="o">=</span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;dbf&#39;</span><span class="p">],</span> <span class="n">prj</span><span class="o">=</span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;prj&#39;</span><span class="p">],</span> <span class="n">shx</span><span class="o">=</span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;shx&#39;</span><span class="p">])</span>
                <span class="n">shapefiles</span><span class="p">[</span><span class="n">name</span><span class="p">]</span> <span class="o">=</span> <span class="n">BasicReader</span><span class="p">(</span><span class="n">orig_reader</span><span class="p">)</span>
            <span class="k">except</span><span class="p">:</span>
                <span class="n">shapefiles</span><span class="p">[</span><span class="n">name</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">shapefiles</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;areas&#39;</span><span class="p">:</span><span class="kc">None</span><span class="p">,</span><span class="s1">&#39;lines&#39;</span><span class="p">:</span><span class="kc">None</span><span class="p">,</span><span class="s1">&#39;points&#39;</span><span class="p">:</span><span class="kc">None</span><span class="p">}</span>
    
    <span class="k">return</span> <span class="n">shapefiles</span></div>

<div class="viewcode-block" id="nhc_cone_radii"><a class="viewcode-back" href="../../../api/generated/tropycal.utils.nhc_cone_radii.html#tropycal.utils.nhc_cone_radii">[docs]</a><span class="k">def</span> <span class="nf">nhc_cone_radii</span><span class="p">(</span><span class="n">year</span><span class="p">,</span><span class="n">basin</span><span class="p">,</span><span class="n">forecast_hour</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
    
    <span class="sa">r</span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Retrieve the official NHC Cone of Uncertainty radii by basin, year and forecast hour(s). Units are in nautical miles.</span>
<span class="sd">    </span>
<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    year : int</span>
<span class="sd">        Valid year for cone of uncertainty radii.</span>
<span class="sd">    basin : str</span>
<span class="sd">        Basin for cone of uncertainty radii. If basin is invalid, return value will be an empty dict. Please refer to :ref:`options-domain` for available basin options.</span>
<span class="sd">    forecast_hour : int or list, optional</span>
<span class="sd">        Forecast hour(s) to retrieve the cone of uncertainty for. If empty, all available forecast hours will be retrieved.</span>
<span class="sd">    </span>
<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    dict</span>
<span class="sd">        Dictionary with forecast hour(s) as the keys, and the cone radius in nautical miles for each respective forecast hour as the values.</span>
<span class="sd">    </span>
<span class="sd">    Notes</span>
<span class="sd">    -----</span>
<span class="sd">    1. NHC cone radii are available beginning 2008 onward. Radii for years before 2008 will be defaulted to 2008, and if the current year&#39;s radii are not available yet, the radii for the most recent year will be returned.</span>
<span class="sd">    </span>
<span class="sd">    2. NHC began producing cone radii for forecast hour 60 in 2020. Years before 2020 do not have a forecast hour 60.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    
    <span class="c1">#Source: https://www.nhc.noaa.gov/verification/verify3.shtml</span>
    <span class="c1">#Source 2: https://www.nhc.noaa.gov/aboutcone.shtml</span>
    <span class="c1">#Radii are in nautical miles</span>
    <span class="n">cone_climo_hr</span> <span class="o">=</span> <span class="p">[</span><span class="mi">3</span><span class="p">,</span><span class="mi">12</span><span class="p">,</span><span class="mi">24</span><span class="p">,</span><span class="mi">36</span><span class="p">,</span><span class="mi">48</span><span class="p">,</span><span class="mi">72</span><span class="p">,</span><span class="mi">96</span><span class="p">,</span><span class="mi">120</span><span class="p">]</span>
    
    <span class="c1">#Basin check</span>
    <span class="k">if</span> <span class="n">basin</span> <span class="ow">not</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;north_atlantic&#39;</span><span class="p">,</span><span class="s1">&#39;east_pacific&#39;</span><span class="p">]:</span>
        <span class="k">return</span> <span class="p">{}</span>
    
    <span class="c1">#Fix for 2020 and later that incorporates 60 hour forecasts</span>
    <span class="k">if</span> <span class="n">year</span> <span class="o">&gt;=</span> <span class="mi">2020</span><span class="p">:</span>
        <span class="n">cone_climo_hr</span> <span class="o">=</span> <span class="p">[</span><span class="mi">3</span><span class="p">,</span><span class="mi">12</span><span class="p">,</span><span class="mi">24</span><span class="p">,</span><span class="mi">36</span><span class="p">,</span><span class="mi">48</span><span class="p">,</span><span class="mi">60</span><span class="p">,</span><span class="mi">72</span><span class="p">,</span><span class="mi">96</span><span class="p">,</span><span class="mi">120</span><span class="p">]</span>
    
    <span class="c1">#Forecast hour check</span>
    <span class="k">if</span> <span class="n">forecast_hour</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">forecast_hour</span> <span class="o">=</span> <span class="n">cone_climo_hr</span>
    <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">forecast_hour</span><span class="p">,</span><span class="nb">int</span><span class="p">)</span> <span class="o">==</span> <span class="kc">True</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">forecast_hour</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">cone_climo_hr</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Forecast hour </span><span class="si">{</span><span class="n">forecast_hour</span><span class="si">}</span><span class="s2"> is invalid. Available forecast hours for </span><span class="si">{</span><span class="n">year</span><span class="si">}</span><span class="s2"> are: </span><span class="si">{</span><span class="n">cone_climo_hr</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">forecast_hour</span> <span class="o">=</span> <span class="p">[</span><span class="n">forecast_hour</span><span class="p">]</span>
    <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">forecast_hour</span><span class="p">,</span><span class="nb">list</span><span class="p">)</span> <span class="o">==</span> <span class="kc">True</span><span class="p">:</span>
        <span class="n">forecast_hour</span> <span class="o">=</span> <span class="p">[</span><span class="n">i</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">forecast_hour</span> <span class="k">if</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">cone_climo_hr</span><span class="p">]</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">forecast_hour</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Requested forecast hours are invalid. Available forecast hours for </span><span class="si">{</span><span class="n">year</span><span class="si">}</span><span class="s2"> are: </span><span class="si">{</span><span class="n">cone_climo_hr</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s2">&quot;forecast_hour must be of type int or list&quot;</span><span class="p">)</span>
    
    <span class="c1">#Year check</span>
    <span class="k">if</span> <span class="n">year</span> <span class="o">&gt;</span> <span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">([</span><span class="n">k</span> <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="n">constants</span><span class="o">.</span><span class="n">CONE_SIZE_ATL</span><span class="o">.</span><span class="n">keys</span><span class="p">()]):</span>
        <span class="n">year</span> <span class="o">=</span> <span class="p">[</span><span class="n">k</span> <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="n">constants</span><span class="o">.</span><span class="n">CONE_SIZE_ATL</span><span class="o">.</span><span class="n">keys</span><span class="p">()][</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">warnings</span><span class="o">.</span><span class="n">warn</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;No cone information is available for the requested year. Defaulting to </span><span class="si">{</span><span class="n">year</span><span class="si">}</span><span class="s2"> cone.&quot;</span><span class="p">)</span>
    <span class="k">elif</span> <span class="n">year</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">constants</span><span class="o">.</span><span class="n">CONE_SIZE_ATL</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
        <span class="n">year</span> <span class="o">=</span> <span class="mi">2008</span>
        <span class="n">warnings</span><span class="o">.</span><span class="n">warn</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;No cone information is available for the requested year. Defaulting to 2008 cone.&quot;</span><span class="p">)</span>
    
    <span class="c1">#Retrieve data</span>
    <span class="n">cone_radii</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="k">for</span> <span class="n">hour</span> <span class="ow">in</span> <span class="nb">list</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">sort</span><span class="p">(</span><span class="n">forecast_hour</span><span class="p">)):</span>
        <span class="n">hour_index</span> <span class="o">=</span> <span class="n">cone_climo_hr</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="n">hour</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">basin</span> <span class="o">==</span> <span class="s1">&#39;north_atlantic&#39;</span><span class="p">:</span>
            <span class="n">cone_radii</span><span class="p">[</span><span class="n">hour</span><span class="p">]</span> <span class="o">=</span> <span class="n">constants</span><span class="o">.</span><span class="n">CONE_SIZE_ATL</span><span class="p">[</span><span class="n">year</span><span class="p">][</span><span class="n">hour_index</span><span class="p">]</span>
        <span class="k">elif</span> <span class="n">basin</span> <span class="o">==</span> <span class="s1">&#39;east_pacific&#39;</span><span class="p">:</span>
            <span class="n">cone_radii</span><span class="p">[</span><span class="n">hour</span><span class="p">]</span> <span class="o">=</span> <span class="n">constants</span><span class="o">.</span><span class="n">CONE_SIZE_PAC</span><span class="p">[</span><span class="n">year</span><span class="p">][</span><span class="n">hour_index</span><span class="p">]</span>
    
    <span class="k">return</span> <span class="n">cone_radii</span></div>

<div class="viewcode-block" id="generate_nhc_cone"><a class="viewcode-back" href="../../../api/generated/tropycal.utils.generate_nhc_cone.html#tropycal.utils.generate_nhc_cone">[docs]</a><span class="k">def</span> <span class="nf">generate_nhc_cone</span><span class="p">(</span><span class="n">forecast</span><span class="p">,</span><span class="n">basin</span><span class="p">,</span><span class="n">shift_lons</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span><span class="n">cone_days</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span><span class="n">cone_year</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span><span class="n">return_xarray</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>

    <span class="sa">r</span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Generates a gridded cone of uncertainty using forecast data from NHC.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    forecast : dict</span>
<span class="sd">        Dictionary containing forecast data</span>
<span class="sd">    basin : str</span>
<span class="sd">        Basin for cone of uncertainty radii. Please refer to :ref:`options-domain` for available basin options.</span>
<span class="sd">    shift_lons : bool, optional</span>
<span class="sd">        If true, grid will be shifted to +0 to +360 degrees longitude. Default is False (-180 to +180 degrees).</span>
<span class="sd">    cone_days : int, optional</span>
<span class="sd">        Number of forecast days to generate the cone through. Default is 5 days.</span>
<span class="sd">    cone_year : int, optional</span>
<span class="sd">        Year valid for cone radii. If None, this fuction will attempt to retrieve the year from the forecast dict.</span>
<span class="sd">    return_xarray : bool, optional</span>
<span class="sd">        If True, returns output as an xarray Dataset. Default is False, returning output as a dictionary.</span>
<span class="sd">    </span>
<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    dict or xarray.Dataset</span>
<span class="sd">        Depending on `return_xarray`, returns either a dictionary or an xarray Dataset containing the gridded cone of uncertainty and its accompanying attributes.</span>
<span class="sd">    </span>
<span class="sd">    Notes</span>
<span class="sd">    -----</span>
<span class="sd">    Forecast dicts can be retrieved for realtime storm objects using ``RealtimeStorm.get_forecast_realtime()``, and for archived storms using ``Storm.get_nhc_forecast_dict()``.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    
    <span class="c1">#Check forecast dict has all required keys</span>
    <span class="n">check_dict</span> <span class="o">=</span> <span class="p">[</span><span class="kc">True</span> <span class="k">if</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">forecast</span><span class="o">.</span><span class="n">keys</span><span class="p">()</span> <span class="k">else</span> <span class="kc">False</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;fhr&#39;</span><span class="p">,</span><span class="s1">&#39;lat&#39;</span><span class="p">,</span><span class="s1">&#39;lon&#39;</span><span class="p">,</span><span class="s1">&#39;init&#39;</span><span class="p">]]</span>
    <span class="k">if</span> <span class="kc">False</span> <span class="ow">in</span> <span class="n">check_dict</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;forecast dict must contain keys &#39;fhr&#39;, &#39;lat&#39;, &#39;lon&#39; and &#39;init&#39;. You may retrieve a forecast dict for a Storm object through &#39;storm.get_operational_forecasts()&#39;.&quot;</span><span class="p">)</span>
    
    <span class="c1">#Check forecast basin</span>
    <span class="k">if</span> <span class="n">basin</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">constants</span><span class="o">.</span><span class="n">ALL_BASINS</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;basin cannot be identified.&quot;</span><span class="p">)</span>

    <span class="c1">#Retrieve cone of uncertainty year</span>
    <span class="k">if</span> <span class="n">cone_year</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">cone_year</span> <span class="o">=</span> <span class="n">forecast</span><span class="p">[</span><span class="s1">&#39;init&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">year</span>
    <span class="k">if</span> <span class="n">cone_year</span> <span class="o">&gt;</span> <span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">([</span><span class="n">k</span> <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="n">constants</span><span class="o">.</span><span class="n">CONE_SIZE_ATL</span><span class="o">.</span><span class="n">keys</span><span class="p">()]):</span>
        <span class="n">cone_year</span> <span class="o">=</span> <span class="p">[</span><span class="n">k</span> <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="n">constants</span><span class="o">.</span><span class="n">CONE_SIZE_ATL</span><span class="o">.</span><span class="n">keys</span><span class="p">()][</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">warnings</span><span class="o">.</span><span class="n">warn</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;No cone information is available for the requested year. Defaulting to </span><span class="si">{</span><span class="n">cone_year</span><span class="si">}</span><span class="s2"> cone.&quot;</span><span class="p">)</span>
    <span class="k">elif</span> <span class="n">cone_year</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">constants</span><span class="o">.</span><span class="n">CONE_SIZE_ATL</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
        <span class="n">cone_year</span> <span class="o">=</span> <span class="mi">2008</span>
        <span class="n">warnings</span><span class="o">.</span><span class="n">warn</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;No cone information is available for the requested year. Defaulting to 2008 cone.&quot;</span><span class="p">)</span>

    <span class="c1">#Retrieve cone size and hours for given year</span>
    <span class="k">if</span> <span class="n">basin</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;north_atlantic&#39;</span><span class="p">,</span><span class="s1">&#39;east_pacific&#39;</span><span class="p">]:</span>
        <span class="n">output</span> <span class="o">=</span> <span class="n">nhc_cone_radii</span><span class="p">(</span><span class="n">cone_year</span><span class="p">,</span><span class="n">basin</span><span class="p">)</span>
        <span class="n">cone_climo_hr</span> <span class="o">=</span> <span class="p">[</span><span class="n">k</span> <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="n">output</span><span class="o">.</span><span class="n">keys</span><span class="p">()]</span>
        <span class="n">cone_size</span> <span class="o">=</span> <span class="p">[</span><span class="n">output</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="n">output</span><span class="o">.</span><span class="n">keys</span><span class="p">()]</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">cone_climo_hr</span> <span class="o">=</span> <span class="p">[</span><span class="mi">3</span><span class="p">,</span><span class="mi">12</span><span class="p">,</span><span class="mi">24</span><span class="p">,</span><span class="mi">36</span><span class="p">,</span><span class="mi">48</span><span class="p">,</span><span class="mi">72</span><span class="p">,</span><span class="mi">96</span><span class="p">,</span><span class="mi">120</span><span class="p">]</span>
        <span class="n">cone_size</span> <span class="o">=</span> <span class="mi">0</span>

    <span class="c1">#Function for interpolating between 2 times</span>
    <span class="k">def</span> <span class="nf">temporal_interpolation</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="n">orig_times</span><span class="p">,</span> <span class="n">target_times</span><span class="p">):</span>
        <span class="n">f</span> <span class="o">=</span> <span class="n">interp</span><span class="o">.</span><span class="n">interp1d</span><span class="p">(</span><span class="n">orig_times</span><span class="p">,</span><span class="n">value</span><span class="p">)</span>
        <span class="n">ynew</span> <span class="o">=</span> <span class="n">f</span><span class="p">(</span><span class="n">target_times</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">ynew</span>

    <span class="c1">#Function for plugging small array into larger array</span>
    <span class="k">def</span> <span class="nf">plug_array</span><span class="p">(</span><span class="n">small</span><span class="p">,</span><span class="n">large</span><span class="p">,</span><span class="n">small_coords</span><span class="p">,</span><span class="n">large_coords</span><span class="p">):</span>

        <span class="n">small_lat</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">round</span><span class="p">(</span><span class="n">small_coords</span><span class="p">[</span><span class="s1">&#39;lat&#39;</span><span class="p">],</span><span class="mi">2</span><span class="p">)</span>
        <span class="n">small_lon</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">round</span><span class="p">(</span><span class="n">small_coords</span><span class="p">[</span><span class="s1">&#39;lon&#39;</span><span class="p">],</span><span class="mi">2</span><span class="p">)</span>
        <span class="n">large_lat</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">round</span><span class="p">(</span><span class="n">large_coords</span><span class="p">[</span><span class="s1">&#39;lat&#39;</span><span class="p">],</span><span class="mi">2</span><span class="p">)</span>
        <span class="n">large_lon</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">round</span><span class="p">(</span><span class="n">large_coords</span><span class="p">[</span><span class="s1">&#39;lon&#39;</span><span class="p">],</span><span class="mi">2</span><span class="p">)</span>

        <span class="n">small_minlat</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="n">small_lat</span><span class="p">)</span>
        <span class="n">small_maxlat</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="n">small_lat</span><span class="p">)</span>
        <span class="n">small_minlon</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="n">small_lon</span><span class="p">)</span>
        <span class="n">small_maxlon</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="n">small_lon</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">small_minlat</span> <span class="ow">in</span> <span class="n">large_lat</span><span class="p">:</span>
            <span class="n">minlat</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">large_lat</span><span class="o">==</span><span class="n">small_minlat</span><span class="p">)[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">minlat</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="n">large_lat</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">small_maxlat</span> <span class="ow">in</span> <span class="n">large_lat</span><span class="p">:</span>
            <span class="n">maxlat</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">large_lat</span><span class="o">==</span><span class="n">small_maxlat</span><span class="p">)[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">maxlat</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="n">large_lat</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">small_minlon</span> <span class="ow">in</span> <span class="n">large_lon</span><span class="p">:</span>
            <span class="n">minlon</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">large_lon</span><span class="o">==</span><span class="n">small_minlon</span><span class="p">)[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">minlon</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="n">large_lon</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">small_maxlon</span> <span class="ow">in</span> <span class="n">large_lon</span><span class="p">:</span>
            <span class="n">maxlon</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">large_lon</span><span class="o">==</span><span class="n">small_maxlon</span><span class="p">)[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">maxlon</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="n">large_lon</span><span class="p">)</span>

        <span class="n">large</span><span class="p">[</span><span class="n">minlat</span><span class="p">:</span><span class="n">maxlat</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span><span class="n">minlon</span><span class="p">:</span><span class="n">maxlon</span><span class="o">+</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">small</span>

        <span class="k">return</span> <span class="n">large</span>

    <span class="c1">#Function for finding nearest value in an array</span>
    <span class="k">def</span> <span class="nf">findNearest</span><span class="p">(</span><span class="n">array</span><span class="p">,</span><span class="n">val</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">array</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">array</span> <span class="o">-</span> <span class="n">val</span><span class="p">)</span><span class="o">.</span><span class="n">argmin</span><span class="p">()]</span>

    <span class="c1">#Function for adding a radius surrounding a point</span>
    <span class="k">def</span> <span class="nf">add_radius</span><span class="p">(</span><span class="n">lats</span><span class="p">,</span><span class="n">lons</span><span class="p">,</span><span class="n">vlat</span><span class="p">,</span><span class="n">vlon</span><span class="p">,</span><span class="n">rad</span><span class="p">):</span>

        <span class="c1">#construct new array expanding slightly over rad from lat/lon center</span>
        <span class="n">grid_res</span> <span class="o">=</span> <span class="mf">0.05</span> <span class="c1">#1 degree is approx 111 km</span>
        <span class="n">grid_fac</span> <span class="o">=</span> <span class="p">(</span><span class="n">rad</span><span class="o">*</span><span class="mi">4</span><span class="p">)</span><span class="o">/</span><span class="mf">111.0</span>

        <span class="c1">#Make grid surrounding position coordinate &amp; radius of circle</span>
        <span class="n">nlon</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">findNearest</span><span class="p">(</span><span class="n">lons</span><span class="p">,</span><span class="n">vlon</span><span class="o">-</span><span class="n">grid_fac</span><span class="p">),</span><span class="n">findNearest</span><span class="p">(</span><span class="n">lons</span><span class="p">,</span><span class="n">vlon</span><span class="o">+</span><span class="n">grid_fac</span><span class="o">+</span><span class="n">grid_res</span><span class="p">),</span><span class="n">grid_res</span><span class="p">)</span>
        <span class="n">nlat</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">findNearest</span><span class="p">(</span><span class="n">lats</span><span class="p">,</span><span class="n">vlat</span><span class="o">-</span><span class="n">grid_fac</span><span class="p">),</span><span class="n">findNearest</span><span class="p">(</span><span class="n">lats</span><span class="p">,</span><span class="n">vlat</span><span class="o">+</span><span class="n">grid_fac</span><span class="o">+</span><span class="n">grid_res</span><span class="p">),</span><span class="n">grid_res</span><span class="p">)</span>
        <span class="n">lons</span><span class="p">,</span><span class="n">lats</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">meshgrid</span><span class="p">(</span><span class="n">nlon</span><span class="p">,</span><span class="n">nlat</span><span class="p">)</span>
        <span class="n">return_arr</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">lons</span><span class="o">.</span><span class="n">shape</span><span class="p">))</span>

        <span class="c1">#Calculate distance from vlat/vlon at each gridpoint</span>
        <span class="n">r_earth</span> <span class="o">=</span> <span class="mf">6.371</span> <span class="o">*</span> <span class="mi">10</span><span class="o">**</span><span class="mi">6</span>
        <span class="n">dlat</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">subtract</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">radians</span><span class="p">(</span><span class="n">lats</span><span class="p">),</span><span class="n">np</span><span class="o">.</span><span class="n">radians</span><span class="p">(</span><span class="n">vlat</span><span class="p">))</span>
        <span class="n">dlon</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">subtract</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">radians</span><span class="p">(</span><span class="n">lons</span><span class="p">),</span><span class="n">np</span><span class="o">.</span><span class="n">radians</span><span class="p">(</span><span class="n">vlon</span><span class="p">))</span>

        <span class="n">a</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">dlat</span><span class="o">/</span><span class="mi">2</span><span class="p">)</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">dlat</span><span class="o">/</span><span class="mi">2</span><span class="p">)</span> <span class="o">+</span> <span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">radians</span><span class="p">(</span><span class="n">lats</span><span class="p">))</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">radians</span><span class="p">(</span><span class="n">vlat</span><span class="p">))</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">dlon</span><span class="o">/</span><span class="mi">2</span><span class="p">)</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">dlon</span><span class="o">/</span><span class="mi">2</span><span class="p">)</span>
        <span class="n">c</span> <span class="o">=</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">arctan</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">a</span><span class="p">),</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="mi">1</span><span class="o">-</span><span class="n">a</span><span class="p">));</span>
        <span class="n">dist</span> <span class="o">=</span> <span class="p">(</span><span class="n">r_earth</span> <span class="o">*</span> <span class="n">c</span><span class="p">)</span><span class="o">/</span><span class="mf">1000.0</span>
        <span class="n">dist</span> <span class="o">=</span> <span class="n">dist</span> <span class="o">*</span> <span class="mf">0.621371</span> <span class="c1">#to miles</span>
        <span class="n">dist</span> <span class="o">=</span> <span class="n">dist</span> <span class="o">*</span> <span class="mf">0.868976</span> <span class="c1">#to nautical miles</span>

        <span class="c1">#Mask out values less than radius</span>
        <span class="n">return_arr</span><span class="p">[</span><span class="n">dist</span> <span class="o">&lt;=</span> <span class="n">rad</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span>

        <span class="c1">#Attach small array into larger subset array</span>
        <span class="n">small_coords</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;lat&#39;</span><span class="p">:</span><span class="n">nlat</span><span class="p">,</span><span class="s1">&#39;lon&#39;</span><span class="p">:</span><span class="n">nlon</span><span class="p">}</span>

        <span class="k">return</span> <span class="n">return_arr</span><span class="p">,</span> <span class="n">small_coords</span>

    <span class="c1">#--------------------------------------------------------------------</span>

    <span class="c1">#Check if fhr3 is available, then get forecast data</span>
    <span class="n">flag_12</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="k">if</span> <span class="n">forecast</span><span class="p">[</span><span class="s1">&#39;fhr&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="mi">12</span><span class="p">:</span>
        <span class="n">flag_12</span> <span class="o">=</span> <span class="mi">1</span>
        <span class="n">cone_climo_hr</span> <span class="o">=</span> <span class="n">cone_climo_hr</span><span class="p">[</span><span class="mi">1</span><span class="p">:]</span>
        <span class="n">fcst_lon</span> <span class="o">=</span> <span class="n">forecast</span><span class="p">[</span><span class="s1">&#39;lon&#39;</span><span class="p">]</span>
        <span class="n">fcst_lat</span> <span class="o">=</span> <span class="n">forecast</span><span class="p">[</span><span class="s1">&#39;lat&#39;</span><span class="p">]</span>
        <span class="n">fhr</span> <span class="o">=</span> <span class="n">forecast</span><span class="p">[</span><span class="s1">&#39;fhr&#39;</span><span class="p">]</span>
        <span class="n">t</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">forecast</span><span class="p">[</span><span class="s1">&#39;fhr&#39;</span><span class="p">])</span><span class="o">/</span><span class="mf">6.0</span>
        <span class="n">subtract_by</span> <span class="o">=</span> <span class="n">t</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">t</span> <span class="o">=</span> <span class="n">t</span> <span class="o">-</span> <span class="n">t</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">interp_fhr_idx</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">t</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span><span class="n">t</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">+</span><span class="mf">0.1</span><span class="p">,</span><span class="mf">0.1</span><span class="p">)</span> <span class="o">-</span> <span class="n">t</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
    <span class="k">elif</span> <span class="mi">3</span> <span class="ow">in</span> <span class="n">forecast</span><span class="p">[</span><span class="s1">&#39;fhr&#39;</span><span class="p">]</span> <span class="ow">and</span> <span class="mi">1</span> <span class="ow">in</span> <span class="n">forecast</span><span class="p">[</span><span class="s1">&#39;fhr&#39;</span><span class="p">]</span> <span class="ow">and</span> <span class="mi">0</span> <span class="ow">in</span> <span class="n">forecast</span><span class="p">[</span><span class="s1">&#39;fhr&#39;</span><span class="p">]:</span>
        <span class="n">fcst_lon</span> <span class="o">=</span> <span class="n">forecast</span><span class="p">[</span><span class="s1">&#39;lon&#39;</span><span class="p">][</span><span class="mi">2</span><span class="p">:]</span>
        <span class="n">fcst_lat</span> <span class="o">=</span> <span class="n">forecast</span><span class="p">[</span><span class="s1">&#39;lat&#39;</span><span class="p">][</span><span class="mi">2</span><span class="p">:]</span>
        <span class="n">fhr</span> <span class="o">=</span> <span class="n">forecast</span><span class="p">[</span><span class="s1">&#39;fhr&#39;</span><span class="p">][</span><span class="mi">2</span><span class="p">:]</span>
        <span class="n">t</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">fhr</span><span class="p">)</span><span class="o">/</span><span class="mf">6.0</span>
        <span class="n">interp_fhr_idx</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">t</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span><span class="n">t</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">+</span><span class="mf">0.01</span><span class="p">,</span><span class="mf">0.1</span><span class="p">)</span>
    <span class="k">elif</span> <span class="mi">3</span> <span class="ow">in</span> <span class="n">forecast</span><span class="p">[</span><span class="s1">&#39;fhr&#39;</span><span class="p">]</span> <span class="ow">and</span> <span class="mi">0</span> <span class="ow">in</span> <span class="n">forecast</span><span class="p">[</span><span class="s1">&#39;fhr&#39;</span><span class="p">]:</span>
        <span class="n">idx</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">i</span> <span class="k">for</span> <span class="n">i</span><span class="p">,</span><span class="n">j</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">forecast</span><span class="p">[</span><span class="s1">&#39;fhr&#39;</span><span class="p">])</span> <span class="k">if</span> <span class="n">j</span> <span class="ow">in</span> <span class="n">cone_climo_hr</span><span class="p">])</span>
        <span class="n">fcst_lon</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">forecast</span><span class="p">[</span><span class="s1">&#39;lon&#39;</span><span class="p">])[</span><span class="n">idx</span><span class="p">]</span>
        <span class="n">fcst_lat</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">forecast</span><span class="p">[</span><span class="s1">&#39;lat&#39;</span><span class="p">])[</span><span class="n">idx</span><span class="p">]</span>
        <span class="n">fhr</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">forecast</span><span class="p">[</span><span class="s1">&#39;fhr&#39;</span><span class="p">])[</span><span class="n">idx</span><span class="p">]</span>
        <span class="n">t</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">fhr</span><span class="p">)</span><span class="o">/</span><span class="mf">6.0</span>
        <span class="n">interp_fhr_idx</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">t</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span><span class="n">t</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">+</span><span class="mf">0.01</span><span class="p">,</span><span class="mf">0.1</span><span class="p">)</span>
    <span class="k">elif</span> <span class="n">forecast</span><span class="p">[</span><span class="s1">&#39;fhr&#39;</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span> <span class="o">&lt;</span> <span class="mi">12</span><span class="p">:</span>
        <span class="n">cone_climo_hr</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="n">fcst_lon</span> <span class="o">=</span> <span class="p">[</span><span class="n">forecast</span><span class="p">[</span><span class="s1">&#39;lon&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">]]</span><span class="o">+</span><span class="n">forecast</span><span class="p">[</span><span class="s1">&#39;lon&#39;</span><span class="p">][</span><span class="mi">2</span><span class="p">:]</span>
        <span class="n">fcst_lat</span> <span class="o">=</span> <span class="p">[</span><span class="n">forecast</span><span class="p">[</span><span class="s1">&#39;lat&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">]]</span><span class="o">+</span><span class="n">forecast</span><span class="p">[</span><span class="s1">&#39;lat&#39;</span><span class="p">][</span><span class="mi">2</span><span class="p">:]</span>
        <span class="n">fhr</span> <span class="o">=</span> <span class="p">[</span><span class="n">forecast</span><span class="p">[</span><span class="s1">&#39;fhr&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">]]</span><span class="o">+</span><span class="n">forecast</span><span class="p">[</span><span class="s1">&#39;fhr&#39;</span><span class="p">][</span><span class="mi">2</span><span class="p">:]</span>
        <span class="n">t</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">fhr</span><span class="p">)</span><span class="o">/</span><span class="mf">6.0</span>
        <span class="n">interp_fhr_idx</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">t</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">/</span><span class="mf">6.0</span><span class="p">,</span><span class="n">t</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">+</span><span class="mf">0.1</span><span class="p">,</span><span class="mf">0.1</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">cone_climo_hr</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="n">fcst_lon</span> <span class="o">=</span> <span class="n">forecast</span><span class="p">[</span><span class="s1">&#39;lon&#39;</span><span class="p">]</span>
        <span class="n">fcst_lat</span> <span class="o">=</span> <span class="n">forecast</span><span class="p">[</span><span class="s1">&#39;lat&#39;</span><span class="p">]</span>
        <span class="n">fhr</span> <span class="o">=</span> <span class="n">forecast</span><span class="p">[</span><span class="s1">&#39;fhr&#39;</span><span class="p">]</span>
        <span class="n">t</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">fhr</span><span class="p">)</span><span class="o">/</span><span class="mf">6.0</span>
        <span class="n">interp_fhr_idx</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">t</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span><span class="n">t</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">+</span><span class="mf">0.1</span><span class="p">,</span><span class="mf">0.1</span><span class="p">)</span>

    <span class="c1">#Determine index of forecast day cap</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">cone_days</span><span class="o">*</span><span class="mi">24</span><span class="p">)</span> <span class="ow">in</span> <span class="n">fhr</span><span class="p">:</span>
        <span class="n">cone_day_cap</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">fhr</span><span class="p">)</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="n">cone_days</span><span class="o">*</span><span class="mi">24</span><span class="p">)</span><span class="o">+</span><span class="mi">1</span>
        <span class="n">fcst_lon</span> <span class="o">=</span> <span class="n">fcst_lon</span><span class="p">[:</span><span class="n">cone_day_cap</span><span class="p">]</span>
        <span class="n">fcst_lat</span> <span class="o">=</span> <span class="n">fcst_lat</span><span class="p">[:</span><span class="n">cone_day_cap</span><span class="p">]</span>
        <span class="n">fhr</span> <span class="o">=</span> <span class="n">fhr</span><span class="p">[:</span><span class="n">cone_day_cap</span><span class="p">]</span>
        <span class="n">t</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">fhr</span><span class="p">)</span><span class="o">/</span><span class="mf">6.0</span>
        <span class="n">interp_fhr_idx</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">interp_fhr_idx</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span><span class="n">t</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">+</span><span class="mf">0.1</span><span class="p">,</span><span class="mf">0.1</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">cone_day_cap</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">fhr</span><span class="p">)</span>

    <span class="c1">#Account for dateline</span>
    <span class="k">if</span> <span class="n">shift_lons</span> <span class="o">==</span> <span class="kc">True</span><span class="p">:</span>
        <span class="n">temp_lon</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">fcst_lon</span><span class="p">)</span>
        <span class="n">temp_lon</span><span class="p">[</span><span class="n">temp_lon</span><span class="o">&lt;</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">temp_lon</span><span class="p">[</span><span class="n">temp_lon</span><span class="o">&lt;</span><span class="mi">0</span><span class="p">]</span><span class="o">+</span><span class="mf">360.0</span>
        <span class="n">fcst_lon</span> <span class="o">=</span> <span class="n">temp_lon</span><span class="o">.</span><span class="n">tolist</span><span class="p">()</span>

    <span class="c1">#Interpolate forecast data temporally and spatially</span>
    <span class="n">interp_kind</span> <span class="o">=</span> <span class="s1">&#39;quadratic&#39;</span>
    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">t</span><span class="p">)</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span> <span class="n">interp_kind</span> <span class="o">=</span> <span class="s1">&#39;linear&#39;</span> <span class="c1">#Interpolate linearly if only 2 forecast points</span>
    <span class="n">x1</span> <span class="o">=</span> <span class="n">interp</span><span class="o">.</span><span class="n">interp1d</span><span class="p">(</span><span class="n">t</span><span class="p">,</span><span class="n">fcst_lon</span><span class="p">,</span><span class="n">kind</span><span class="o">=</span><span class="n">interp_kind</span><span class="p">)</span>
    <span class="n">y1</span> <span class="o">=</span> <span class="n">interp</span><span class="o">.</span><span class="n">interp1d</span><span class="p">(</span><span class="n">t</span><span class="p">,</span><span class="n">fcst_lat</span><span class="p">,</span><span class="n">kind</span><span class="o">=</span><span class="n">interp_kind</span><span class="p">)</span>
    <span class="n">interp_fhr</span> <span class="o">=</span> <span class="n">interp_fhr_idx</span> <span class="o">*</span> <span class="mi">6</span>
    <span class="n">interp_lon</span> <span class="o">=</span> <span class="n">x1</span><span class="p">(</span><span class="n">interp_fhr_idx</span><span class="p">)</span>
    <span class="n">interp_lat</span> <span class="o">=</span> <span class="n">y1</span><span class="p">(</span><span class="n">interp_fhr_idx</span><span class="p">)</span>

    <span class="c1">#Return if no cone specified</span>
    <span class="k">if</span> <span class="n">cone_size</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
        <span class="n">return_dict</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;center_lon&#39;</span><span class="p">:</span><span class="n">interp_lon</span><span class="p">,</span><span class="s1">&#39;center_lat&#39;</span><span class="p">:</span><span class="n">interp_lat</span><span class="p">}</span>
        <span class="k">if</span> <span class="n">return_xarray</span><span class="p">:</span>
            <span class="kn">import</span> <span class="nn">xarray</span> <span class="k">as</span> <span class="nn">xr</span>
            <span class="k">return</span> <span class="n">xr</span><span class="o">.</span><span class="n">Dataset</span><span class="p">(</span><span class="n">return_dict</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">return_dict</span>

    <span class="c1">#Interpolate cone radius temporally</span>
    <span class="n">cone_climo_hr</span> <span class="o">=</span> <span class="n">cone_climo_hr</span><span class="p">[:</span><span class="n">cone_day_cap</span><span class="p">]</span>
    <span class="n">cone_size</span> <span class="o">=</span> <span class="n">cone_size</span><span class="p">[:</span><span class="n">cone_day_cap</span><span class="p">]</span>

    <span class="n">cone_climo_fhrs</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">cone_climo_hr</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">flag_12</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
        <span class="n">interp_fhr</span> <span class="o">+=</span> <span class="p">(</span><span class="n">subtract_by</span><span class="o">*</span><span class="mf">6.0</span><span class="p">)</span>
        <span class="n">cone_climo_fhrs</span> <span class="o">=</span> <span class="n">cone_climo_fhrs</span><span class="p">[</span><span class="mi">1</span><span class="p">:]</span>
    <span class="n">idxs</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nonzero</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">in1d</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">fhr</span><span class="p">),</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">cone_climo_hr</span><span class="p">)))</span>
    <span class="n">temp_arr</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">cone_size</span><span class="p">)[</span><span class="n">idxs</span><span class="p">]</span>
    <span class="n">interp_rad</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">apply_along_axis</span><span class="p">(</span><span class="k">lambda</span> <span class="n">n</span><span class="p">:</span> <span class="n">temporal_interpolation</span><span class="p">(</span><span class="n">n</span><span class="p">,</span><span class="n">fhr</span><span class="p">,</span><span class="n">interp_fhr</span><span class="p">),</span><span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span><span class="n">arr</span><span class="o">=</span><span class="n">temp_arr</span><span class="p">)</span>

    <span class="c1">#Initialize 0.05 degree grid</span>
    <span class="n">gridlats</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="nb">min</span><span class="p">(</span><span class="n">interp_lat</span><span class="p">)</span><span class="o">-</span><span class="mi">7</span><span class="p">,</span><span class="nb">max</span><span class="p">(</span><span class="n">interp_lat</span><span class="p">)</span><span class="o">+</span><span class="mi">7</span><span class="p">,</span><span class="mf">0.05</span><span class="p">)</span>
    <span class="n">gridlons</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="nb">min</span><span class="p">(</span><span class="n">interp_lon</span><span class="p">)</span><span class="o">-</span><span class="mi">7</span><span class="p">,</span><span class="nb">max</span><span class="p">(</span><span class="n">interp_lon</span><span class="p">)</span><span class="o">+</span><span class="mi">7</span><span class="p">,</span><span class="mf">0.05</span><span class="p">)</span>
    <span class="n">gridlons2d</span><span class="p">,</span><span class="n">gridlats2d</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">meshgrid</span><span class="p">(</span><span class="n">gridlons</span><span class="p">,</span><span class="n">gridlats</span><span class="p">)</span>

    <span class="c1">#Iterate through fhr, calculate cone &amp; add into grid</span>
    <span class="n">large_coords</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;lat&#39;</span><span class="p">:</span><span class="n">gridlats</span><span class="p">,</span><span class="s1">&#39;lon&#39;</span><span class="p">:</span><span class="n">gridlons</span><span class="p">}</span>
    <span class="n">griddata</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">gridlats2d</span><span class="o">.</span><span class="n">shape</span><span class="p">))</span>
    <span class="k">for</span> <span class="n">i</span><span class="p">,(</span><span class="n">ilat</span><span class="p">,</span><span class="n">ilon</span><span class="p">,</span><span class="n">irad</span><span class="p">)</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="nb">zip</span><span class="p">(</span><span class="n">interp_lat</span><span class="p">,</span><span class="n">interp_lon</span><span class="p">,</span><span class="n">interp_rad</span><span class="p">)):</span>
        <span class="n">temp_grid</span><span class="p">,</span> <span class="n">small_coords</span> <span class="o">=</span> <span class="n">add_radius</span><span class="p">(</span><span class="n">gridlats</span><span class="p">,</span><span class="n">gridlons</span><span class="p">,</span><span class="n">ilat</span><span class="p">,</span><span class="n">ilon</span><span class="p">,</span><span class="n">irad</span><span class="p">)</span>
        <span class="n">plug_grid</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">griddata</span><span class="o">.</span><span class="n">shape</span><span class="p">))</span>
        <span class="n">plug_grid</span> <span class="o">=</span> <span class="n">plug_array</span><span class="p">(</span><span class="n">temp_grid</span><span class="p">,</span><span class="n">plug_grid</span><span class="p">,</span><span class="n">small_coords</span><span class="p">,</span><span class="n">large_coords</span><span class="p">)</span>
        <span class="n">griddata</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">maximum</span><span class="p">(</span><span class="n">griddata</span><span class="p">,</span><span class="n">plug_grid</span><span class="p">)</span>
    
    <span class="k">if</span> <span class="n">return_xarray</span><span class="p">:</span>
        <span class="kn">import</span> <span class="nn">xarray</span> <span class="k">as</span> <span class="nn">xr</span>
        <span class="n">cone</span> <span class="o">=</span> <span class="n">xr</span><span class="o">.</span><span class="n">DataArray</span><span class="p">(</span><span class="n">griddata</span><span class="p">,</span><span class="n">coords</span><span class="o">=</span><span class="p">[</span><span class="n">gridlats</span><span class="p">,</span><span class="n">gridlons</span><span class="p">],</span><span class="n">dims</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;grid_lat&#39;</span><span class="p">,</span><span class="s1">&#39;grid_lon&#39;</span><span class="p">])</span>
        <span class="n">return_ds</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s1">&#39;cone&#39;</span><span class="p">:</span><span class="n">cone</span><span class="p">,</span>
            <span class="s1">&#39;center_lon&#39;</span><span class="p">:</span><span class="n">interp_lon</span><span class="p">,</span>
            <span class="s1">&#39;center_lat&#39;</span><span class="p">:</span><span class="n">interp_lat</span>
        <span class="p">}</span>
        <span class="n">return_ds</span> <span class="o">=</span> <span class="n">xr</span><span class="o">.</span><span class="n">Dataset</span><span class="p">(</span><span class="n">return_ds</span><span class="p">)</span>
        <span class="n">return_ds</span><span class="o">.</span><span class="n">attrs</span><span class="p">[</span><span class="s1">&#39;year&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">cone_year</span>
        <span class="k">return</span> <span class="n">return_ds</span>
    
    <span class="k">else</span><span class="p">:</span>
        <span class="n">return_dict</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;lat&#39;</span><span class="p">:</span><span class="n">gridlats</span><span class="p">,</span><span class="s1">&#39;lon&#39;</span><span class="p">:</span><span class="n">gridlons</span><span class="p">,</span><span class="s1">&#39;lat2d&#39;</span><span class="p">:</span><span class="n">gridlats2d</span><span class="p">,</span><span class="s1">&#39;lon2d&#39;</span><span class="p">:</span><span class="n">gridlons2d</span><span class="p">,</span><span class="s1">&#39;cone&#39;</span><span class="p">:</span><span class="n">griddata</span><span class="p">,</span>
                   <span class="s1">&#39;center_lon&#39;</span><span class="p">:</span><span class="n">interp_lon</span><span class="p">,</span><span class="s1">&#39;center_lat&#39;</span><span class="p">:</span><span class="n">interp_lat</span><span class="p">,</span><span class="s1">&#39;year&#39;</span><span class="p">:</span><span class="n">cone_year</span><span class="p">}</span>
        <span class="k">return</span> <span class="n">return_dict</span></div>

<div class="viewcode-block" id="calc_ensemble_ellipse"><a class="viewcode-back" href="../../../api/generated/tropycal.utils.calc_ensemble_ellipse.html#tropycal.utils.calc_ensemble_ellipse">[docs]</a><span class="k">def</span> <span class="nf">calc_ensemble_ellipse</span><span class="p">(</span><span class="n">member_lons</span><span class="p">,</span><span class="n">member_lats</span><span class="p">):</span>
    
    <span class="sa">r</span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Calculate an ellipse representing ensemble member location spread. This function follows the methodology of Hamill et al. (2011).</span>
<span class="sd">    </span>
<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    member_lons : list</span>
<span class="sd">        List containing longitudes of ensemble members valid at a single time.</span>
<span class="sd">    member_lats : list</span>
<span class="sd">        List containing latitudes of ensemble members valid at a single time.</span>
<span class="sd">    </span>
<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    dict</span>
<span class="sd">        Dictionary containing the longitude and latitude of the ellipse.</span>
<span class="sd">    </span>
<span class="sd">    Notes</span>
<span class="sd">    -----</span>
<span class="sd">    The ensemble ellipse used in this function follows the methodology of `Hamill et al. (2011)`_, denoting the spread in ensemble member cyclone positions. The size of the ellipse is calculated to contain 90% of ensemble members at any given time. This ellipse can be used to determine the primary type of ensemble variability:</span>

<span class="sd">    * **Along-track variability** - if the major axis of the ellipse is parallel to the ensemble mean motion vector.</span>
<span class="sd">    * **Across-track variability** - if the major axis of the ellipse is normal to the ensemble mean motion vector.</span>

<span class="sd">    .. _Hamill et al. (2011): https://doi.org/10.1175/2010MWR3456.1</span>
<span class="sd">    </span>
<span class="sd">    This code is adapted from NCAR Command Language (NCL) code courtesy of Ryan Torn and Thomas Hamill.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    
    <span class="c1">#Compute ensemble mean lon &amp; lat</span>
    <span class="n">mean_lon</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">average</span><span class="p">(</span><span class="n">member_lons</span><span class="p">)</span>
    <span class="n">mean_lat</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">average</span><span class="p">(</span><span class="n">member_lats</span><span class="p">)</span>

    <span class="n">Pb</span> <span class="o">=</span> <span class="p">[[</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">],[</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">]]</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">member_lats</span><span class="p">)):</span>
        <span class="n">Pb</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">Pb</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="p">(</span><span class="n">member_lons</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">-</span><span class="n">mean_lon</span><span class="p">)</span> <span class="o">*</span> <span class="p">(</span><span class="n">member_lons</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">-</span><span class="n">mean_lon</span><span class="p">)</span>
        <span class="n">Pb</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">Pb</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="p">(</span><span class="n">member_lats</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">-</span><span class="n">mean_lat</span><span class="p">)</span> <span class="o">*</span> <span class="p">(</span><span class="n">member_lats</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">-</span><span class="n">mean_lat</span><span class="p">)</span>
        <span class="n">Pb</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">Pb</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="p">(</span><span class="n">member_lats</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">-</span><span class="n">mean_lat</span><span class="p">)</span> <span class="o">*</span> <span class="p">(</span><span class="n">member_lons</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">-</span><span class="n">mean_lon</span><span class="p">)</span>
    <span class="n">Pb</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">Pb</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>
    <span class="n">Pb</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">Pb</span><span class="p">)</span> <span class="o">/</span> <span class="nb">float</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">member_lats</span><span class="p">)</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span>

    <span class="n">rho</span> <span class="o">=</span> <span class="n">Pb</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span> <span class="o">/</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">Pb</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">])</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">Pb</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="mi">1</span><span class="p">]))</span>
    <span class="n">sigmax</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">Pb</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">])</span>
    <span class="n">sigmay</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">Pb</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="mi">1</span><span class="p">])</span>
    <span class="n">fac</span> <span class="o">=</span> <span class="mf">1.0</span> <span class="o">/</span> <span class="p">(</span><span class="mf">2.0</span> <span class="o">*</span> <span class="p">(</span><span class="mi">1</span> <span class="o">-</span> <span class="n">rho</span><span class="o">**</span><span class="mi">2</span><span class="p">))</span>

    <span class="c1">#Calculate lon &amp; lat coordinates of ellipse</span>
    <span class="n">ellipse_lon</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">ellipse_lat</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">increment</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="o">/</span><span class="mf">180.0</span>
    <span class="k">for</span> <span class="n">radians</span> <span class="ow">in</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">0</span><span class="p">,(</span><span class="mf">2.0</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="p">)</span><span class="o">+</span><span class="n">increment</span><span class="p">,</span><span class="n">increment</span><span class="p">):</span>
        <span class="n">xstart</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">radians</span><span class="p">)</span>
        <span class="n">ystart</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">radians</span><span class="p">)</span>

        <span class="k">for</span> <span class="n">rdistance</span> <span class="ow">in</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mf">0.</span><span class="p">,</span><span class="mf">2400.</span><span class="p">):</span>
            <span class="n">xloc</span> <span class="o">=</span> <span class="n">xstart</span> <span class="o">*</span> <span class="n">rdistance</span><span class="o">/</span><span class="mf">80.0</span>
            <span class="n">yloc</span> <span class="o">=</span> <span class="n">ystart</span> <span class="o">*</span> <span class="n">rdistance</span><span class="o">/</span><span class="mf">80.0</span>
            <span class="n">dist</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">xloc</span> <span class="o">*</span> <span class="n">xloc</span> <span class="o">+</span> <span class="n">yloc</span> <span class="o">*</span> <span class="n">yloc</span><span class="p">)</span>
            <span class="n">prob</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="o">-</span><span class="mf">1.0</span> <span class="o">*</span> <span class="n">fac</span> <span class="o">*</span> <span class="p">((</span><span class="n">xloc</span><span class="o">/</span><span class="n">sigmax</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span> <span class="o">+</span> <span class="p">(</span><span class="n">yloc</span><span class="o">/</span><span class="n">sigmay</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span> <span class="o">-</span> <span class="mf">2.0</span> <span class="o">*</span> <span class="n">rho</span> <span class="o">*</span> <span class="p">(</span><span class="n">xloc</span><span class="o">/</span><span class="n">sigmax</span><span class="p">)</span><span class="o">*</span><span class="p">(</span><span class="n">yloc</span><span class="o">/</span><span class="n">sigmay</span><span class="p">)))</span>
            <span class="k">if</span> <span class="n">prob</span> <span class="o">&lt;</span> <span class="mf">0.256</span><span class="p">:</span>
                <span class="n">ellipse_lon</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">xloc</span> <span class="o">+</span> <span class="n">mean_lon</span><span class="p">)</span>
                <span class="n">ellipse_lat</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">yloc</span> <span class="o">+</span> <span class="n">mean_lat</span><span class="p">)</span>
                <span class="k">break</span>

    <span class="c1">#Return ellipse data</span>
    <span class="k">return</span> <span class="p">{</span><span class="s1">&#39;ellipse_lon&#39;</span><span class="p">:</span><span class="n">ellipse_lon</span><span class="p">,</span> <span class="s1">&#39;ellipse_lat&#39;</span><span class="p">:</span><span class="n">ellipse_lat</span><span class="p">}</span></div>

<div class="viewcode-block" id="create_storm_dict"><a class="viewcode-back" href="../../../api/generated/tropycal.utils.create_storm_dict.html#tropycal.utils.create_storm_dict">[docs]</a><span class="k">def</span> <span class="nf">create_storm_dict</span><span class="p">(</span><span class="n">filepath</span><span class="p">,</span><span class="n">storm_name</span><span class="p">,</span><span class="n">storm_id</span><span class="p">,</span><span class="n">delimiter</span><span class="o">=</span><span class="s1">&#39;,&#39;</span><span class="p">,</span><span class="n">time_format</span><span class="o">=</span><span class="s1">&#39;%Y%m</span><span class="si">%d</span><span class="s1">%H&#39;</span><span class="p">,</span><span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
    
    <span class="sa">r</span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Creates a storm dict from custom user-provided data.</span>
<span class="sd">    </span>
<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    filepath : str</span>
<span class="sd">        Relative or absolute file path containing custom storm data.</span>
<span class="sd">    storm_name : str</span>
<span class="sd">        Storm name for custom storm entry.</span>
<span class="sd">    storm_id : str</span>
<span class="sd">        Storm ID for custom storm entry.</span>
<span class="sd">    </span>
<span class="sd">    Other Parameters</span>
<span class="sd">    ----------------</span>
<span class="sd">    delimiter : str</span>
<span class="sd">        Delimiter separating columns for text files. Default is &quot;,&quot;.</span>
<span class="sd">    time_format : str</span>
<span class="sd">        Time format for which to convert times to Datetime objects. Default is ``&quot;%Y%m%d%H&quot;`` (e.g., ``&quot;2015070112&quot;`` for 1200 UTC 1 July 2015).</span>
<span class="sd">    time_header : str</span>
<span class="sd">        Name of time dimension. If not provided, function will attempt to locate it internally.</span>
<span class="sd">    lat_header : str</span>
<span class="sd">        Name of latitude dimension. If not provided, function will attempt to locate it internally.</span>
<span class="sd">    lon_header : str</span>
<span class="sd">        Name of longitude dimension. If not provided, function will attempt to locate it internally.</span>
<span class="sd">    vmax_header : str</span>
<span class="sd">        Name of maximum sustained wind (knots) dimension. If not provided, function will attempt to locate it internally.</span>
<span class="sd">    mslp_header : str</span>
<span class="sd">        Name of minimum MSLP (hPa) dimension. If not provided, function will attempt to locate it internally.</span>
<span class="sd">    type_header : str</span>
<span class="sd">        Name of storm type dimension. If not provided, function will attempt to locate it internally. If not part of entry data, storm type will be derived based on provided wind speed values.</span>
<span class="sd">    </span>
<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    dict</span>
<span class="sd">        Dictionary containing formatted custom storm data.</span>
<span class="sd">    </span>
<span class="sd">    Notes</span>
<span class="sd">    -----</span>
<span class="sd">    This function creates a formatted storm data dictionary using custom user-provided data. The constraints for the parser are as follows:</span>
<span class="sd">    </span>
<span class="sd">    1. Rows that begin with a ``#`` or ``\`` are automatically ignored.</span>
<span class="sd">    2. The first non-commented row must be a header row.</span>
<span class="sd">    3. The header row must contain entries for time, latitude, longitude, maximum sustained wind (knots), and minimum MSLP (hPa). The order of these columns does not matter.</span>
<span class="sd">    4. Preferred header names are &quot;date&quot;, &quot;lat&quot;, &quot;lon&quot;, &quot;vmax&quot; and &quot;mslp&quot; for the main 5 categories, but custom header names can be provided. Refer to the &quot;Other Parameters&quot; section above.</span>
<span class="sd">    5. Providing a &quot;type&quot; column (e.g., &quot;TS&quot;, &quot;HU&quot;, &quot;EX&quot;) is not required, but is recommended especially if dealing with subtropical or non-tropical types.</span>
<span class="sd">    </span>
<span class="sd">    Below is an example file which we&#39;ll call ``data.txt``::</span>

<span class="sd">        # The row below is a header row. The order of the columns doesn&#39;t matter.</span>
<span class="sd">        date,lat,lon,vmax,mslp,type</span>
<span class="sd">        2021080518,19.4,-59.9,25,1014,DB</span>
<span class="sd">        2021080600,19.7,-60.2,25,1014,DB</span>
<span class="sd">        2021080606,20.1,-60.5,30,1012,DB</span>
<span class="sd">        2021080612,20.5,-60.8,30,1011,TD</span>
<span class="sd">        2021080618,20.7,-61.3,30,1011,TD</span>
<span class="sd">        2021080700,20.8,-61.8,35,1008,TS</span>
<span class="sd">        2021080706,20.8,-62.6,35,1007,TS</span>
<span class="sd">        2021080712,21.0,-63.3,40,1004,TS</span>
<span class="sd">        2021080718,21.3,-64.1,45,1002,TS</span>
<span class="sd">        2021080800,21.6,-65.1,55,998,TS</span>
<span class="sd">        2021080806,22.0,-66.1,60,994,TS</span>
<span class="sd">        2021080812,22.5,-66.9,65,989,HU</span>
<span class="sd">        2021080818,23.2,-67.4,65,988,HU</span>
<span class="sd">        2021080900,23.9,-67.6,60,992,TS</span>
<span class="sd">        2021080906,25.0,-67.5,55,994,TS</span>
<span class="sd">        2021080912,26.5,-67.1,55,993,TS</span>
<span class="sd">        2021080918,28.0,-66.4,50,992,TS</span>
<span class="sd">        2021081000,29.5,-65.6,50,994,TS</span>
<span class="sd">        2021081006,31.4,-64.0,45,996,TS</span>
<span class="sd">        2021081012,33.4,-62.0,45,997,EX</span>
<span class="sd">        2021081018,35.4,-59.5,50,997,EX</span>
<span class="sd">    </span>
<span class="sd">    Reading it into the parser returns the following dict:</span>
<span class="sd">    </span>
<span class="sd">    &gt;&gt;&gt; from tropycal import utils</span>
<span class="sd">    &gt;&gt;&gt; storm_dict = utils.create_storm_dict(filename=&#39;data.txt&#39;, storm_name=&#39;Test&#39;, storm_id=&#39;AL502021&#39;)</span>
<span class="sd">    &gt;&gt;&gt; print(storm_dict)</span>
<span class="sd">    {&#39;id&#39;: &#39;AL502021&#39;,</span>
<span class="sd">     &#39;operational_id&#39;: &#39;AL502021&#39;,</span>
<span class="sd">     &#39;name&#39;: &#39;Test&#39;,</span>
<span class="sd">     &#39;source_info&#39;: &#39;Custom User Data&#39;,</span>
<span class="sd">     &#39;source&#39;: &#39;custom&#39;,</span>
<span class="sd">     &#39;date&#39;: [datetime.datetime(2021, 8, 5, 18, 0),</span>
<span class="sd">              datetime.datetime(2021, 8, 6, 0, 0),</span>
<span class="sd">              ....</span>
<span class="sd">              datetime.datetime(2021, 8, 10, 12, 0),</span>
<span class="sd">              datetime.datetime(2021, 8, 10, 18, 0)],</span>
<span class="sd">     &#39;extra_obs&#39;: [0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0],</span>
<span class="sd">     &#39;special&#39;: [&#39;&#39;,&#39;&#39;,....,&#39;&#39;,&#39;&#39;],</span>
<span class="sd">     &#39;type&#39;: [&#39;DB&#39;,&#39;DB&#39;,&#39;DB&#39;,&#39;TD&#39;,&#39;TD&#39;,&#39;TS&#39;,&#39;TS&#39;,&#39;TS&#39;,&#39;TS&#39;,&#39;TS&#39;,&#39;TS&#39;,&#39;HU&#39;,&#39;HU&#39;,&#39;TS&#39;,&#39;TS&#39;,&#39;TS&#39;,&#39;TS&#39;,&#39;TS&#39;,&#39;TS&#39;,&#39;EX&#39;,&#39;EX&#39;],</span>
<span class="sd">     &#39;lat&#39;: [19.4,19.7,20.1,20.5,20.7,20.8,20.8,21.0,21.3,21.6,22.0,22.5,23.2,23.9,25.0,26.5,28.0,29.5,31.4,33.4,35.4],</span>
<span class="sd">     &#39;lon&#39;: [-59.9,-60.2,-60.5,-60.8,-61.3,-61.8,-62.6,-63.3,-64.1,-65.1,-66.1,-66.9,-67.4,-67.6,-67.5,-67.1,-66.4,-65.6,-64.0,-62.0,-59.5],</span>
<span class="sd">     &#39;vmax&#39;: [25.0,25.0,30.0,30.0,30.0,35.0,35.0,40.0,45.0,55.0,60.0,65.0,65.0,60.0,55.0,55.0,50.0,50.0,45.0,45.0,50.0],</span>
<span class="sd">     &#39;mslp&#39;: [1014,1014,1012,1011,1011,1008,1007,1004,1002,998,994,989,988,992,994,993,992,994,996,997,997],</span>
<span class="sd">     &#39;wmo_basin&#39;: [&#39;north_atlantic&#39;,&#39;north_atlantic&#39;,....,&#39;north_atlantic&#39;,&#39;north_atlantic&#39;],</span>
<span class="sd">     &#39;ace&#39;: 3.7825,</span>
<span class="sd">     &#39;basin&#39;: &#39;north_atlantic&#39;,</span>
<span class="sd">     &#39;year&#39;: 2021,</span>
<span class="sd">     &#39;season&#39;: 2021}</span>
<span class="sd">    </span>
<span class="sd">    This custom data can then be plugged into a Storm object:</span>
<span class="sd">    </span>
<span class="sd">    &gt;&gt;&gt; from tropycal import tracks</span>
<span class="sd">    &gt;&gt;&gt; storm = tracks.Storm(storm_dict)</span>
<span class="sd">    &gt;&gt;&gt; print(storm)</span>
<span class="sd">    &lt;tropycal.tracks.Storm&gt;</span>
<span class="sd">    Storm Summary:</span>
<span class="sd">        Maximum Wind:      65 knots</span>
<span class="sd">        Minimum Pressure:  988 hPa</span>
<span class="sd">        Start Date:        1200 UTC 06 August 2021</span>
<span class="sd">        End Date:          0600 UTC 10 August 2021</span>
<span class="sd">    .</span>
<span class="sd">    Variables:</span>
<span class="sd">        date        (datetime) [2021-08-05 18:00:00 .... 2021-08-10 18:00:00]</span>
<span class="sd">        extra_obs   (int32) [0 .... 0]</span>
<span class="sd">        special     (str) [ .... ]</span>
<span class="sd">        type        (str) [DB .... EX]</span>
<span class="sd">        lat         (float64) [19.4 .... 35.4]</span>
<span class="sd">        lon         (float64) [-59.9 .... -59.5]</span>
<span class="sd">        vmax        (float64) [25.0 .... 50.0]</span>
<span class="sd">        mslp        (float64) [1014.0 .... 997.0]</span>
<span class="sd">        wmo_basin   (str) [north_atlantic .... north_atlantic]</span>
<span class="sd">    .</span>
<span class="sd">    More Information:</span>
<span class="sd">        id:              AL502021</span>
<span class="sd">        operational_id:  AL502021</span>
<span class="sd">        name:            Test</span>
<span class="sd">        source_info:     Custom User Data</span>
<span class="sd">        source:          custom</span>
<span class="sd">        ace:             3.8</span>
<span class="sd">        basin:           north_atlantic</span>
<span class="sd">        year:            2021</span>
<span class="sd">        season:          2021</span>
<span class="sd">        realtime:        False</span>
<span class="sd">        invest:          False</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="c1">#Pop kwargs</span>
    <span class="n">time_header</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;time_header&#39;</span><span class="p">,</span><span class="kc">None</span><span class="p">)</span>
    <span class="n">lat_header</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;lat_header&#39;</span><span class="p">,</span><span class="kc">None</span><span class="p">)</span>
    <span class="n">lon_header</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;lon_header&#39;</span><span class="p">,</span><span class="kc">None</span><span class="p">)</span>
    <span class="n">vmax_header</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;vmax_header&#39;</span><span class="p">,</span><span class="kc">None</span><span class="p">)</span>
    <span class="n">mslp_header</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;mslp_header&#39;</span><span class="p">,</span><span class="kc">None</span><span class="p">)</span>
    <span class="n">type_header</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;type_header&#39;</span><span class="p">,</span><span class="kc">None</span><span class="p">)</span>
    
    <span class="c1">#Check for file extension</span>
    <span class="n">netcdf</span> <span class="o">=</span> <span class="kc">True</span> <span class="k">if</span> <span class="n">filepath</span><span class="p">[</span><span class="o">-</span><span class="mi">3</span><span class="p">:]</span> <span class="o">==</span> <span class="s1">&#39;.nc&#39;</span> <span class="k">else</span> <span class="kc">False</span>
    
    <span class="c1">#Create empty dict</span>
    <span class="n">data</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;id&#39;</span><span class="p">:</span><span class="n">storm_id</span><span class="p">,</span>
            <span class="s1">&#39;operational_id&#39;</span><span class="p">:</span><span class="n">storm_id</span><span class="p">,</span>
            <span class="s1">&#39;name&#39;</span><span class="p">:</span><span class="n">storm_name</span><span class="p">,</span>
            <span class="s1">&#39;source_info&#39;</span><span class="p">:</span><span class="s1">&#39;Custom User Data&#39;</span><span class="p">,</span>
            <span class="s1">&#39;source&#39;</span><span class="p">:</span><span class="s1">&#39;custom&#39;</span><span class="p">,</span>
            <span class="s1">&#39;date&#39;</span><span class="p">:[],</span>
            <span class="s1">&#39;extra_obs&#39;</span><span class="p">:[],</span>
            <span class="s1">&#39;special&#39;</span><span class="p">:[],</span>
            <span class="s1">&#39;type&#39;</span><span class="p">:[],</span>
            <span class="s1">&#39;lat&#39;</span><span class="p">:[],</span>
            <span class="s1">&#39;lon&#39;</span><span class="p">:[],</span>
            <span class="s1">&#39;vmax&#39;</span><span class="p">:[],</span>
            <span class="s1">&#39;mslp&#39;</span><span class="p">:[],</span>
            <span class="s1">&#39;wmo_basin&#39;</span><span class="p">:[],</span>
            <span class="s1">&#39;ace&#39;</span><span class="p">:</span><span class="mf">0.0</span><span class="p">}</span>

    <span class="c1">#Parse text file</span>
    <span class="k">if</span> <span class="n">netcdf</span> <span class="o">==</span> <span class="kc">False</span><span class="p">:</span>
        
        <span class="c1">#Store header data</span>
        <span class="n">header</span> <span class="o">=</span> <span class="p">{}</span>
        
        <span class="c1">#Read file content</span>
        <span class="n">f</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span><span class="n">filepath</span><span class="p">,</span><span class="s2">&quot;r&quot;</span><span class="p">)</span>
        <span class="n">content</span> <span class="o">=</span> <span class="n">f</span><span class="o">.</span><span class="n">readlines</span><span class="p">()</span>
        <span class="n">f</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
        <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="n">content</span><span class="p">:</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">line</span><span class="p">)</span> <span class="o">&lt;</span> <span class="mi">5</span><span class="p">:</span> <span class="k">continue</span>
            <span class="k">if</span> <span class="n">line</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;#&#39;</span><span class="p">,</span><span class="s1">&#39;/&#39;</span><span class="p">]:</span> <span class="k">continue</span>
            <span class="n">line</span> <span class="o">=</span> <span class="n">line</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
            <span class="n">line</span> <span class="o">=</span> <span class="n">line</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\r</span><span class="s2">&quot;</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
            
            <span class="c1">#Split line</span>
            <span class="k">if</span> <span class="n">delimiter</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;&#39;</span><span class="p">,</span><span class="s1">&#39; &#39;</span><span class="p">]:</span> <span class="n">delimiter</span> <span class="o">=</span> <span class="kc">None</span>
            <span class="n">lineArray</span> <span class="o">=</span> <span class="n">line</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="n">delimiter</span><span class="p">)</span>
            <span class="n">lineArray</span> <span class="o">=</span> <span class="p">[</span><span class="n">i</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot; &quot;</span><span class="p">,</span><span class="s2">&quot;&quot;</span><span class="p">)</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">lineArray</span><span class="p">]</span>
            
            <span class="c1">#Determine header</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">header</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                <span class="k">for</span> <span class="n">value</span> <span class="ow">in</span> <span class="n">lineArray</span><span class="p">:</span>
                    <span class="k">if</span> <span class="n">value</span> <span class="o">==</span> <span class="n">time_header</span> <span class="ow">or</span> <span class="n">value</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;time&#39;</span><span class="p">,</span><span class="s1">&#39;date&#39;</span><span class="p">,</span><span class="s1">&#39;valid_time&#39;</span><span class="p">,</span><span class="s1">&#39;valid_date&#39;</span><span class="p">]:</span>
                        <span class="n">header</span><span class="p">[</span><span class="s1">&#39;date&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="n">value</span><span class="p">,</span><span class="n">lineArray</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="n">value</span><span class="p">)]</span>
                    <span class="k">elif</span> <span class="n">value</span> <span class="o">==</span> <span class="n">lat_header</span> <span class="ow">or</span> <span class="n">value</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;lat&#39;</span><span class="p">,</span><span class="s1">&#39;latitude&#39;</span><span class="p">,</span><span class="s1">&#39;lat_0&#39;</span><span class="p">]:</span>
                        <span class="n">header</span><span class="p">[</span><span class="s1">&#39;lat&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="n">value</span><span class="p">,</span><span class="n">lineArray</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="n">value</span><span class="p">)]</span>
                    <span class="k">elif</span> <span class="n">value</span> <span class="o">==</span> <span class="n">lon_header</span> <span class="ow">or</span> <span class="n">value</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;lon&#39;</span><span class="p">,</span><span class="s1">&#39;longitude&#39;</span><span class="p">,</span><span class="s1">&#39;lon_0&#39;</span><span class="p">]:</span>
                        <span class="n">header</span><span class="p">[</span><span class="s1">&#39;lon&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="n">value</span><span class="p">,</span><span class="n">lineArray</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="n">value</span><span class="p">)]</span>
                    <span class="k">elif</span> <span class="n">value</span> <span class="o">==</span> <span class="n">vmax_header</span> <span class="ow">or</span> <span class="n">value</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;vmax&#39;</span><span class="p">,</span><span class="s1">&#39;wind&#39;</span><span class="p">,</span><span class="s1">&#39;wspd&#39;</span><span class="p">,</span><span class="s1">&#39;max_wind&#39;</span><span class="p">,</span><span class="s1">&#39;wind_speed&#39;</span><span class="p">]:</span>
                        <span class="n">header</span><span class="p">[</span><span class="s1">&#39;vmax&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="n">value</span><span class="p">,</span><span class="n">lineArray</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="n">value</span><span class="p">)]</span>
                    <span class="k">elif</span> <span class="n">value</span> <span class="o">==</span> <span class="n">mslp_header</span> <span class="ow">or</span> <span class="n">value</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;mslp&#39;</span><span class="p">,</span><span class="s1">&#39;slp&#39;</span><span class="p">,</span><span class="s1">&#39;min_mslp&#39;</span><span class="p">,</span><span class="s1">&#39;pressure&#39;</span><span class="p">,</span><span class="s1">&#39;pres&#39;</span><span class="p">,</span><span class="s1">&#39;minimum_mslp&#39;</span><span class="p">]:</span>
                        <span class="n">header</span><span class="p">[</span><span class="s1">&#39;mslp&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="n">value</span><span class="p">,</span><span class="n">lineArray</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="n">value</span><span class="p">)]</span>
                    <span class="k">elif</span> <span class="n">value</span> <span class="o">==</span> <span class="n">type_header</span> <span class="ow">or</span> <span class="n">value</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;type&#39;</span><span class="p">,</span><span class="s1">&#39;storm_type&#39;</span><span class="p">]:</span>
                        <span class="n">header</span><span class="p">[</span><span class="s1">&#39;type&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="n">value</span><span class="p">,</span><span class="n">lineArray</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="n">value</span><span class="p">)]</span>
                <span class="n">found</span> <span class="o">=</span> <span class="p">[</span><span class="n">i</span> <span class="ow">in</span> <span class="n">header</span><span class="o">.</span><span class="n">keys</span><span class="p">()</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;date&#39;</span><span class="p">,</span><span class="s1">&#39;lat&#39;</span><span class="p">,</span><span class="s1">&#39;lon&#39;</span><span class="p">,</span><span class="s1">&#39;vmax&#39;</span><span class="p">,</span><span class="s1">&#39;mslp&#39;</span><span class="p">]]</span>
                <span class="k">if</span> <span class="kc">False</span> <span class="ow">in</span> <span class="n">found</span><span class="p">:</span> <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Data must have columns for &#39;date&#39;, &#39;lat&#39;, &#39;lon&#39;, &#39;vmax&#39; and &#39;mslp&#39;.&quot;</span><span class="p">)</span>
                <span class="k">continue</span>
                
            <span class="c1">#Enter standard data into dict</span>
            <span class="n">enter_date</span> <span class="o">=</span> <span class="n">dt</span><span class="o">.</span><span class="n">strptime</span><span class="p">(</span><span class="n">lineArray</span><span class="p">[</span><span class="n">header</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;date&#39;</span><span class="p">)[</span><span class="mi">1</span><span class="p">]],</span><span class="n">time_format</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">enter_date</span> <span class="ow">in</span> <span class="n">data</span><span class="p">[</span><span class="s1">&#39;date&#39;</span><span class="p">]:</span> <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Error: Multiple entries detected for the same valid time.&quot;</span><span class="p">)</span>
            <span class="n">data</span><span class="p">[</span><span class="s1">&#39;date&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">enter_date</span><span class="p">)</span>
            <span class="n">data</span><span class="p">[</span><span class="s1">&#39;lat&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">float</span><span class="p">(</span><span class="n">lineArray</span><span class="p">[</span><span class="n">header</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;lat&#39;</span><span class="p">)[</span><span class="mi">1</span><span class="p">]]))</span>
            <span class="n">data</span><span class="p">[</span><span class="s1">&#39;lon&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">float</span><span class="p">(</span><span class="n">lineArray</span><span class="p">[</span><span class="n">header</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;lon&#39;</span><span class="p">)[</span><span class="mi">1</span><span class="p">]]))</span>
            <span class="n">data</span><span class="p">[</span><span class="s1">&#39;vmax&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">float</span><span class="p">(</span><span class="n">lineArray</span><span class="p">[</span><span class="n">header</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;vmax&#39;</span><span class="p">)[</span><span class="mi">1</span><span class="p">]]))</span>
            <span class="n">data</span><span class="p">[</span><span class="s1">&#39;mslp&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">float</span><span class="p">(</span><span class="n">lineArray</span><span class="p">[</span><span class="n">header</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;mslp&#39;</span><span class="p">)[</span><span class="mi">1</span><span class="p">]]))</span>
            
            <span class="c1">#Derive storm type if needed</span>
            <span class="k">if</span> <span class="s1">&#39;type&#39;</span> <span class="ow">in</span> <span class="n">header</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
                <span class="n">temp_type</span> <span class="o">=</span> <span class="n">lineArray</span><span class="p">[</span><span class="n">header</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;type&#39;</span><span class="p">)[</span><span class="mi">1</span><span class="p">]]</span>
                <span class="k">if</span> <span class="n">temp_type</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;TY&#39;</span><span class="p">,</span><span class="s1">&#39;ST&#39;</span><span class="p">]:</span> <span class="n">temp_type</span> <span class="o">=</span> <span class="s1">&#39;HU&#39;</span>
                <span class="n">data</span><span class="p">[</span><span class="s1">&#39;type&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">temp_type</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">data</span><span class="p">[</span><span class="s1">&#39;type&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">get_storm_type</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;vmax&#39;</span><span class="p">][</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span><span class="kc">False</span><span class="p">))</span>
            
            <span class="c1">#Derive ACE</span>
            <span class="k">if</span> <span class="n">data</span><span class="p">[</span><span class="s1">&#39;date&#39;</span><span class="p">][</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">strftime</span><span class="p">(</span><span class="s1">&#39;%H%M&#39;</span><span class="p">)</span> <span class="ow">in</span> <span class="n">constants</span><span class="o">.</span><span class="n">STANDARD_HOURS</span> <span class="ow">and</span> <span class="n">data</span><span class="p">[</span><span class="s1">&#39;type&#39;</span><span class="p">][</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="ow">in</span> <span class="n">constants</span><span class="o">.</span><span class="n">NAMED_TROPICAL_STORM_TYPES</span><span class="p">:</span>
                <span class="n">data</span><span class="p">[</span><span class="s1">&#39;ace&#39;</span><span class="p">]</span> <span class="o">+=</span> <span class="n">accumulated_cyclone_energy</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;vmax&#39;</span><span class="p">][</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span>
            
            <span class="c1">#Derive basin</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;wmo_basin&#39;</span><span class="p">])</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                <span class="n">data</span><span class="p">[</span><span class="s1">&#39;wmo_basin&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">get_basin</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;lat&#39;</span><span class="p">][</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;lon&#39;</span><span class="p">][</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span><span class="s1">&#39;north_atlantic&#39;</span><span class="p">))</span>
                <span class="n">data</span><span class="p">[</span><span class="s1">&#39;basin&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="s1">&#39;wmo_basin&#39;</span><span class="p">][</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">data</span><span class="p">[</span><span class="s1">&#39;wmo_basin&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">get_basin</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;lat&#39;</span><span class="p">][</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;lon&#39;</span><span class="p">][</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;basin&#39;</span><span class="p">]))</span>
            
            <span class="c1">#Other entries</span>
            <span class="n">extra_obs</span> <span class="o">=</span> <span class="mi">0</span> <span class="k">if</span> <span class="n">data</span><span class="p">[</span><span class="s1">&#39;date&#39;</span><span class="p">][</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">strftime</span><span class="p">(</span><span class="s1">&#39;%H%M&#39;</span><span class="p">)</span> <span class="ow">in</span> <span class="n">constants</span><span class="o">.</span><span class="n">STANDARD_HOURS</span> <span class="k">else</span> <span class="mi">1</span>
            <span class="n">data</span><span class="p">[</span><span class="s1">&#39;extra_obs&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">extra_obs</span><span class="p">)</span>
            <span class="n">data</span><span class="p">[</span><span class="s1">&#39;special&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">&#39;&#39;</span><span class="p">)</span>
        
        <span class="c1">#Add other info</span>
        <span class="n">data</span><span class="p">[</span><span class="s1">&#39;year&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="s1">&#39;date&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">year</span>
        <span class="n">data</span><span class="p">[</span><span class="s1">&#39;season&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="s1">&#39;date&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">year</span>
        
        <span class="c1">#Return dict</span>
        <span class="k">return</span> <span class="n">data</span></div>
    

<span class="c1">#===========================================================================================================</span>
<span class="c1"># Private utilities</span>
<span class="c1"># These are primarily intended to be used internally. Do not add these to documentation.</span>
<span class="c1">#===========================================================================================================</span>

<span class="k">def</span> <span class="nf">all_nan</span><span class="p">(</span><span class="n">arr</span><span class="p">):</span>
    
    <span class="sa">r</span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Determine whether the entire array is filled with NaNs.</span>
<span class="sd">    </span>
<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    arr : list or numpy.ndarray</span>
<span class="sd">        List or array to be checked.</span>
<span class="sd">    </span>
<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    bool</span>
<span class="sd">        Returns whether the array is filled with all NaNs.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    
    <span class="c1">#Convert array to numpy array</span>
    <span class="n">arr_copy</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">arr</span><span class="p">)</span>
    
    <span class="c1">#Check if there are non-NaN values in the array</span>
    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">arr_copy</span><span class="p">[</span><span class="o">~</span><span class="n">np</span><span class="o">.</span><span class="n">isnan</span><span class="p">(</span><span class="n">arr_copy</span><span class="p">)])</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
        <span class="k">return</span> <span class="kc">True</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">return</span> <span class="kc">False</span>

<span class="k">def</span> <span class="nf">category_label_to_wind</span><span class="p">(</span><span class="n">category</span><span class="p">):</span>
    
    <span class="sa">r</span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Convert Saffir-Simpson Hurricane Wind Scale category label to minimum threshold sustained wind speed in knots. Internal function.</span>
<span class="sd">    </span>
<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    category : int</span>
<span class="sd">        Saffir-Simpson Hurricane Wind Scale category. Use 0 for tropical storm, -1 for tropical depression.</span>
<span class="sd">    </span>
<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    int</span>
<span class="sd">        Sustained wind speed in knots corresponding to the minimum threshold of the requested category.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    
    <span class="c1">#Convert category to lowercase</span>
    <span class="n">category_lowercase</span> <span class="o">=</span> <span class="n">category</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span>
    
    <span class="c1">#Return thresholds based on category label</span>
    <span class="k">if</span> <span class="n">category_lowercase</span> <span class="o">==</span> <span class="s1">&#39;td&#39;</span> <span class="ow">or</span> <span class="n">category_lowercase</span> <span class="o">==</span> <span class="s1">&#39;sd&#39;</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">category_to_wind</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span>
    <span class="k">elif</span> <span class="n">category_lowercase</span> <span class="o">==</span> <span class="s1">&#39;ts&#39;</span> <span class="ow">or</span> <span class="n">category_lowercase</span> <span class="o">==</span> <span class="s1">&#39;ss&#39;</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">category_to_wind</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
    <span class="k">elif</span> <span class="n">category_lowercase</span> <span class="o">==</span> <span class="s1">&#39;c1&#39;</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">category_to_wind</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
    <span class="k">elif</span> <span class="n">category_lowercase</span> <span class="o">==</span> <span class="s1">&#39;c2&#39;</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">category_to_wind</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span>
    <span class="k">elif</span> <span class="n">category_lowercase</span> <span class="o">==</span> <span class="s1">&#39;c3&#39;</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">category_to_wind</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span>
    <span class="k">elif</span> <span class="n">category_lowercase</span> <span class="o">==</span> <span class="s1">&#39;c4&#39;</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">category_to_wind</span><span class="p">(</span><span class="mi">4</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">category_to_wind</span><span class="p">(</span><span class="mi">5</span><span class="p">)</span>

<span class="k">def</span> <span class="nf">dynamic_map_extent</span><span class="p">(</span><span class="n">min_lon</span><span class="p">,</span><span class="n">max_lon</span><span class="p">,</span><span class="n">min_lat</span><span class="p">,</span><span class="n">max_lat</span><span class="p">,</span><span class="n">recon</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>

    <span class="sa">r</span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Sets up a dynamic map extent with an aspect ratio of 3:2 given latitude and longitude bounds.</span>

<span class="sd">    Parameters:</span>
<span class="sd">    -----------</span>
<span class="sd">    min_lon : float</span>
<span class="sd">        Minimum longitude bound.</span>
<span class="sd">    max_lon : float</span>
<span class="sd">        Maximum longitude bound.</span>
<span class="sd">    min_lat : float</span>
<span class="sd">        Minimum latitude bound.</span>
<span class="sd">    max_lat : float</span>
<span class="sd">        Maximum latitude bound.</span>
<span class="sd">    recon : bool</span>
<span class="sd">        Zoom in plots closer for recon plots.</span>

<span class="sd">    Returns:</span>
<span class="sd">    --------</span>
<span class="sd">    list</span>
<span class="sd">        List containing new west, east, north, south map bounds, respectively.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="c1">#Get lat/lon bounds</span>
    <span class="n">bound_w</span> <span class="o">=</span> <span class="n">min_lon</span><span class="o">+</span><span class="mf">0.0</span>
    <span class="n">bound_e</span> <span class="o">=</span> <span class="n">max_lon</span><span class="o">+</span><span class="mf">0.0</span>
    <span class="n">bound_s</span> <span class="o">=</span> <span class="n">min_lat</span><span class="o">+</span><span class="mf">0.0</span>
    <span class="n">bound_n</span> <span class="o">=</span> <span class="n">max_lat</span><span class="o">+</span><span class="mf">0.0</span>

    <span class="c1">#If only one coordinate point, artificially induce a spread</span>
    <span class="k">if</span> <span class="n">bound_w</span> <span class="o">==</span> <span class="n">bound_e</span><span class="p">:</span>
        <span class="n">bound_w</span> <span class="o">=</span> <span class="n">bound_w</span> <span class="o">-</span> <span class="mf">0.6</span>
        <span class="n">bound_e</span> <span class="o">=</span> <span class="n">bound_e</span> <span class="o">+</span> <span class="mf">0.6</span>
    <span class="k">if</span> <span class="n">bound_s</span> <span class="o">==</span> <span class="n">bound_n</span><span class="p">:</span>
        <span class="n">bound_n</span> <span class="o">=</span> <span class="n">bound_n</span> <span class="o">+</span> <span class="mf">0.6</span>
        <span class="n">bound_s</span> <span class="o">=</span> <span class="n">bound_s</span> <span class="o">-</span> <span class="mf">0.6</span>

    <span class="c1">#Function for fixing map ratio</span>
    <span class="k">def</span> <span class="nf">fix_map_ratio</span><span class="p">(</span><span class="n">bound_w</span><span class="p">,</span><span class="n">bound_e</span><span class="p">,</span><span class="n">bound_n</span><span class="p">,</span><span class="n">bound_s</span><span class="p">,</span><span class="n">nthres</span><span class="o">=</span><span class="mf">1.45</span><span class="p">):</span>
        <span class="n">xrng</span> <span class="o">=</span> <span class="nb">abs</span><span class="p">(</span><span class="n">bound_w</span><span class="o">-</span><span class="n">bound_e</span><span class="p">)</span>
        <span class="n">yrng</span> <span class="o">=</span> <span class="nb">abs</span><span class="p">(</span><span class="n">bound_n</span><span class="o">-</span><span class="n">bound_s</span><span class="p">)</span>
        <span class="n">diff</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">xrng</span><span class="p">)</span> <span class="o">/</span> <span class="nb">float</span><span class="p">(</span><span class="n">yrng</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">diff</span> <span class="o">&lt;</span> <span class="n">nthres</span><span class="p">:</span> <span class="c1">#plot too tall, need to make it wider</span>
            <span class="n">goal_diff</span> <span class="o">=</span> <span class="n">nthres</span> <span class="o">*</span> <span class="p">(</span><span class="n">yrng</span><span class="p">)</span>
            <span class="n">factor</span> <span class="o">=</span> <span class="nb">abs</span><span class="p">(</span><span class="n">xrng</span> <span class="o">-</span> <span class="n">goal_diff</span><span class="p">)</span> <span class="o">/</span> <span class="mf">2.0</span>
            <span class="n">bound_w</span> <span class="o">=</span> <span class="n">bound_w</span> <span class="o">-</span> <span class="n">factor</span>
            <span class="n">bound_e</span> <span class="o">=</span> <span class="n">bound_e</span> <span class="o">+</span> <span class="n">factor</span>
        <span class="k">elif</span> <span class="n">diff</span> <span class="o">&gt;</span> <span class="n">nthres</span><span class="p">:</span> <span class="c1">#plot too wide, need to make it taller</span>
            <span class="n">goal_diff</span> <span class="o">=</span> <span class="n">xrng</span> <span class="o">/</span> <span class="n">nthres</span>
            <span class="n">factor</span> <span class="o">=</span> <span class="nb">abs</span><span class="p">(</span><span class="n">yrng</span> <span class="o">-</span> <span class="n">goal_diff</span><span class="p">)</span> <span class="o">/</span> <span class="mf">2.0</span>
            <span class="n">bound_s</span> <span class="o">=</span> <span class="n">bound_s</span> <span class="o">-</span> <span class="n">factor</span>
            <span class="n">bound_n</span> <span class="o">=</span> <span class="n">bound_n</span> <span class="o">+</span> <span class="n">factor</span>
        <span class="k">return</span> <span class="n">bound_w</span><span class="p">,</span><span class="n">bound_e</span><span class="p">,</span><span class="n">bound_n</span><span class="p">,</span><span class="n">bound_s</span>

    <span class="c1">#First round of fixing ratio</span>
    <span class="n">bound_w</span><span class="p">,</span><span class="n">bound_e</span><span class="p">,</span><span class="n">bound_n</span><span class="p">,</span><span class="n">bound_s</span> <span class="o">=</span> <span class="n">fix_map_ratio</span><span class="p">(</span><span class="n">bound_w</span><span class="p">,</span><span class="n">bound_e</span><span class="p">,</span><span class="n">bound_n</span><span class="p">,</span><span class="n">bound_s</span><span class="p">,</span><span class="mf">1.45</span><span class="p">)</span>

    <span class="c1">#Adjust map width depending on extent of storm</span>
    <span class="n">xrng</span> <span class="o">=</span> <span class="nb">abs</span><span class="p">(</span><span class="n">bound_e</span><span class="o">-</span><span class="n">bound_w</span><span class="p">)</span>
    <span class="n">yrng</span> <span class="o">=</span> <span class="nb">abs</span><span class="p">(</span><span class="n">bound_n</span><span class="o">-</span><span class="n">bound_s</span><span class="p">)</span>
    <span class="n">factor</span> <span class="o">=</span> <span class="mf">0.1</span>
    <span class="k">if</span> <span class="nb">min</span><span class="p">(</span><span class="n">xrng</span><span class="p">,</span><span class="n">yrng</span><span class="p">)</span> <span class="o">&lt;</span> <span class="mf">15.0</span><span class="p">:</span>
        <span class="n">factor</span> <span class="o">=</span> <span class="mf">0.2</span>
    <span class="k">if</span> <span class="nb">min</span><span class="p">(</span><span class="n">xrng</span><span class="p">,</span><span class="n">yrng</span><span class="p">)</span> <span class="o">&lt;</span> <span class="mf">12.0</span><span class="p">:</span>
        <span class="n">factor</span> <span class="o">=</span> <span class="mf">0.4</span>
    <span class="k">if</span> <span class="nb">min</span><span class="p">(</span><span class="n">xrng</span><span class="p">,</span><span class="n">yrng</span><span class="p">)</span> <span class="o">&lt;</span> <span class="mf">10.0</span><span class="p">:</span>
        <span class="n">factor</span> <span class="o">=</span> <span class="mf">0.6</span>
    <span class="k">if</span> <span class="nb">min</span><span class="p">(</span><span class="n">xrng</span><span class="p">,</span><span class="n">yrng</span><span class="p">)</span> <span class="o">&lt;</span> <span class="mf">8.0</span><span class="p">:</span>
        <span class="n">factor</span> <span class="o">=</span> <span class="mf">0.75</span>
    <span class="k">if</span> <span class="nb">min</span><span class="p">(</span><span class="n">xrng</span><span class="p">,</span><span class="n">yrng</span><span class="p">)</span> <span class="o">&lt;</span> <span class="mf">6.0</span><span class="p">:</span>
        <span class="n">factor</span> <span class="o">=</span> <span class="mf">0.9</span>
    <span class="k">if</span> <span class="n">recon</span><span class="p">:</span> <span class="n">factor</span> <span class="o">=</span> <span class="n">factor</span> <span class="o">*</span> <span class="mf">0.3</span>
    <span class="n">bound_w</span> <span class="o">=</span> <span class="n">bound_w</span><span class="o">-</span><span class="p">(</span><span class="n">xrng</span><span class="o">*</span><span class="n">factor</span><span class="p">)</span>
    <span class="n">bound_e</span> <span class="o">=</span> <span class="n">bound_e</span><span class="o">+</span><span class="p">(</span><span class="n">xrng</span><span class="o">*</span><span class="n">factor</span><span class="p">)</span>
    <span class="n">bound_s</span> <span class="o">=</span> <span class="n">bound_s</span><span class="o">-</span><span class="p">(</span><span class="n">yrng</span><span class="o">*</span><span class="n">factor</span><span class="p">)</span>
    <span class="n">bound_n</span> <span class="o">=</span> <span class="n">bound_n</span><span class="o">+</span><span class="p">(</span><span class="n">yrng</span><span class="o">*</span><span class="n">factor</span><span class="p">)</span>

    <span class="c1">#Second round of fixing ratio</span>
    <span class="n">bound_w</span><span class="p">,</span><span class="n">bound_e</span><span class="p">,</span><span class="n">bound_n</span><span class="p">,</span><span class="n">bound_s</span> <span class="o">=</span> <span class="n">fix_map_ratio</span><span class="p">(</span><span class="n">bound_w</span><span class="p">,</span><span class="n">bound_e</span><span class="p">,</span><span class="n">bound_n</span><span class="p">,</span><span class="n">bound_s</span><span class="p">,</span><span class="mf">1.45</span><span class="p">)</span>

    <span class="c1">#Return map bounds</span>
    <span class="k">return</span> <span class="n">bound_w</span><span class="p">,</span><span class="n">bound_e</span><span class="p">,</span><span class="n">bound_s</span><span class="p">,</span><span class="n">bound_n</span>

<span class="k">def</span> <span class="nf">read_url</span><span class="p">(</span><span class="n">url</span><span class="p">,</span><span class="n">split</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span><span class="n">subsplit</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
    
    <span class="n">f</span> <span class="o">=</span> <span class="n">urllib</span><span class="o">.</span><span class="n">request</span><span class="o">.</span><span class="n">urlopen</span><span class="p">(</span><span class="n">url</span><span class="p">)</span>
    <span class="n">content</span> <span class="o">=</span> <span class="n">f</span><span class="o">.</span><span class="n">read</span><span class="p">()</span>
    <span class="n">content</span> <span class="o">=</span> <span class="n">content</span><span class="o">.</span><span class="n">decode</span><span class="p">(</span><span class="s2">&quot;utf-8&quot;</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">split</span><span class="p">:</span> <span class="n">content</span> <span class="o">=</span> <span class="n">content</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">subsplit</span><span class="p">:</span> <span class="n">content</span> <span class="o">=</span> <span class="p">[(</span><span class="n">i</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot; &quot;</span><span class="p">,</span><span class="s2">&quot;&quot;</span><span class="p">))</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;,&quot;</span><span class="p">)</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">content</span><span class="p">]</span>
    <span class="n">f</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
    
    <span class="k">return</span> <span class="n">content</span>

<span class="k">class</span> <span class="nc">Distance</span><span class="p">:</span>
    
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">dist</span><span class="p">,</span><span class="n">units</span><span class="o">=</span><span class="s1">&#39;kilometers&#39;</span><span class="p">):</span>
        
        <span class="c1"># Conversion fractions (numerator_denominator)</span>
        <span class="n">mi_km</span> <span class="o">=</span> <span class="mf">0.621371</span>
        <span class="n">nmi_km</span> <span class="o">=</span> <span class="mf">0.539957</span>
        <span class="n">m_km</span> <span class="o">=</span> <span class="mf">1000.</span>
        <span class="n">ft_km</span> <span class="o">=</span> <span class="mf">3280.84</span>
        
        <span class="k">if</span> <span class="n">units</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;kilometers&#39;</span><span class="p">,</span><span class="s1">&#39;km&#39;</span><span class="p">]:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">kilometers</span> <span class="o">=</span> <span class="n">dist</span>
        <span class="k">elif</span> <span class="n">units</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;miles&#39;</span><span class="p">,</span><span class="s1">&#39;mi&#39;</span><span class="p">]:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">kilometers</span> <span class="o">=</span> <span class="n">dist</span> <span class="o">/</span> <span class="n">mi_km</span>
        <span class="k">elif</span> <span class="n">units</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;nauticalmiles&#39;</span><span class="p">,</span><span class="s1">&#39;nautical&#39;</span><span class="p">,</span><span class="s1">&#39;nmi&#39;</span><span class="p">]:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">kilometers</span> <span class="o">=</span> <span class="n">dist</span> <span class="o">/</span> <span class="n">nmi_km</span>
        <span class="k">elif</span> <span class="n">units</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;feet&#39;</span><span class="p">,</span><span class="s1">&#39;ft&#39;</span><span class="p">]:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">kilometers</span> <span class="o">=</span> <span class="n">dist</span> <span class="o">/</span> <span class="n">ft_km</span>
        <span class="k">elif</span> <span class="n">units</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;meters&#39;</span><span class="p">,</span><span class="s1">&#39;m&#39;</span><span class="p">]:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">kilometers</span> <span class="o">=</span> <span class="n">dist</span> <span class="o">/</span> <span class="n">m_km</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">miles</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">kilometers</span> <span class="o">*</span> <span class="n">mi_km</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">nautical</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">kilometers</span> <span class="o">*</span> <span class="n">nmi_km</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">meters</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">kilometers</span> <span class="o">*</span> <span class="n">m_km</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">feet</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">kilometers</span> <span class="o">*</span> <span class="n">ft_km</span>


<span class="k">class</span> <span class="nc">great_circle</span><span class="p">(</span><span class="n">Distance</span><span class="p">):</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">start_point</span><span class="p">,</span> <span class="n">end_point</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="sa">r</span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        </span>
<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        start_point : tuple or int</span>
<span class="sd">            Starting pair of coordinates, in order of (latitde, longitude)</span>
<span class="sd">        end_point : tuple or int</span>
<span class="sd">            Starting pair of coordinates, in order of (latitde, longitude)</span>
<span class="sd">        radius : float, optional</span>
<span class="sd">            Radius of Earth. Default is 6371.009 km.</span>
<span class="sd">        </span>
<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        great_circle</span>
<span class="sd">            Instance of a great_circle object. To retrieve the distance, add the requested unit at the end (e.g., &quot;great_circle(start,end).kilometers&quot;).</span>
<span class="sd">        </span>
<span class="sd">        Notes</span>
<span class="sd">        -----</span>
<span class="sd">        Use spherical geometry to calculate the surface distance between two points. Uses the mean earth radius as defined by the International Union of Geodesy and Geophysics, approx 6371.009 km (for WGS-84), resulting in an error of up to about 0.5%. Otherwise set which radius of the earth to use by specifying a &#39;radius&#39; keyword argument. It must be in kilometers.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        
        <span class="c1">#Set Earth&#39;s radius</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">RADIUS</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;radius&#39;</span><span class="p">,</span> <span class="mf">6371.009</span><span class="p">)</span>
        
        <span class="c1">#Compute </span>
        <span class="n">dist</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">measure</span><span class="p">(</span><span class="n">start_point</span><span class="p">,</span><span class="n">end_point</span><span class="p">)</span>
        <span class="n">Distance</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">dist</span><span class="p">,</span><span class="n">units</span><span class="o">=</span><span class="s1">&#39;kilometers&#39;</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">measure</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">start_point</span><span class="p">,</span> <span class="n">end_point</span><span class="p">):</span>
        
        <span class="c1">#Retrieve latitude and longitude coordinates from input pairs</span>
        <span class="n">lat1</span><span class="p">,</span> <span class="n">lon1</span> <span class="o">=</span> <span class="n">math</span><span class="o">.</span><span class="n">radians</span><span class="p">(</span><span class="n">start_point</span><span class="p">[</span><span class="mi">0</span><span class="p">]),</span> <span class="n">math</span><span class="o">.</span><span class="n">radians</span><span class="p">(</span><span class="n">start_point</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">%</span><span class="mi">360</span><span class="p">)</span>
        <span class="n">lat2</span><span class="p">,</span> <span class="n">lon2</span> <span class="o">=</span> <span class="n">math</span><span class="o">.</span><span class="n">radians</span><span class="p">(</span><span class="n">end_point</span><span class="p">[</span><span class="mi">0</span><span class="p">]),</span> <span class="n">math</span><span class="o">.</span><span class="n">radians</span><span class="p">(</span><span class="n">end_point</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">%</span><span class="mi">360</span><span class="p">)</span>

        <span class="c1">#Compute sin and cos of coordinates</span>
        <span class="n">sin_lat1</span><span class="p">,</span> <span class="n">cos_lat1</span> <span class="o">=</span> <span class="n">math</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">lat1</span><span class="p">),</span> <span class="n">math</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">lat1</span><span class="p">)</span>
        <span class="n">sin_lat2</span><span class="p">,</span> <span class="n">cos_lat2</span> <span class="o">=</span> <span class="n">math</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">lat2</span><span class="p">),</span> <span class="n">math</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">lat2</span><span class="p">)</span>

        <span class="c1">#Compute sin and cos of delta longitude</span>
        <span class="n">delta_lon</span> <span class="o">=</span> <span class="n">lon2</span> <span class="o">-</span> <span class="n">lon1</span>
        <span class="n">cos_delta_lon</span><span class="p">,</span> <span class="n">sin_delta_lon</span> <span class="o">=</span> <span class="n">math</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">delta_lon</span><span class="p">),</span> <span class="n">math</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">delta_lon</span><span class="p">)</span>

        <span class="c1">#Compute great circle distance</span>
        <span class="n">d</span> <span class="o">=</span> <span class="n">math</span><span class="o">.</span><span class="n">atan2</span><span class="p">(</span><span class="n">math</span><span class="o">.</span><span class="n">sqrt</span><span class="p">((</span><span class="n">cos_lat2</span> <span class="o">*</span> <span class="n">sin_delta_lon</span><span class="p">)</span> <span class="o">**</span> <span class="mi">2</span> <span class="o">+</span>
                       <span class="p">(</span><span class="n">cos_lat1</span> <span class="o">*</span> <span class="n">sin_lat2</span> <span class="o">-</span>
                        <span class="n">sin_lat1</span> <span class="o">*</span> <span class="n">cos_lat2</span> <span class="o">*</span> <span class="n">cos_delta_lon</span><span class="p">)</span> <span class="o">**</span> <span class="mi">2</span><span class="p">),</span>
                <span class="n">sin_lat1</span> <span class="o">*</span> <span class="n">sin_lat2</span> <span class="o">+</span> <span class="n">cos_lat1</span> <span class="o">*</span> <span class="n">cos_lat2</span> <span class="o">*</span> <span class="n">cos_delta_lon</span><span class="p">)</span>

        <span class="c1">#Return great circle distance</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">RADIUS</span> <span class="o">*</span> <span class="n">d</span>

<span class="sa">r</span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">This is a modified version of Cartopy&#39;s shapereader functionality, specified to directly read in an already-existing</span>
<span class="sd">Shapely object as opposed to expecting a local shapefile to be read in.</span>
<span class="sd">&quot;&quot;&quot;</span>
<span class="kn">import</span> <span class="nn">shapely.geometry</span> <span class="k">as</span> <span class="nn">sgeom</span>
<span class="kn">import</span> <span class="nn">shapefile</span>

<span class="k">class</span> <span class="nc">Record</span><span class="p">:</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    A single logical entry from a shapefile, combining the attributes with</span>
<span class="sd">    their associated geometry.</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">shape</span><span class="p">,</span> <span class="n">attributes</span><span class="p">,</span> <span class="n">fields</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_shape</span> <span class="o">=</span> <span class="n">shape</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_bounds</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="c1"># if the record defines a bbox, then use that for the shape&#39;s bounds,</span>
        <span class="c1"># rather than using the full geometry in the bounds property</span>
        <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">shape</span><span class="p">,</span> <span class="s1">&#39;bbox&#39;</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_bounds</span> <span class="o">=</span> <span class="nb">tuple</span><span class="p">(</span><span class="n">shape</span><span class="o">.</span><span class="n">bbox</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_geometry</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="sd">&quot;&quot;&quot;The cached geometry instance for this Record.&quot;&quot;&quot;</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">attributes</span> <span class="o">=</span> <span class="n">attributes</span>
        <span class="sd">&quot;&quot;&quot;A dictionary mapping attribute names to attribute values.&quot;&quot;&quot;</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_fields</span> <span class="o">=</span> <span class="n">fields</span>

    <span class="k">def</span> <span class="fm">__repr__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="sa">f</span><span class="s1">&#39;&lt;Record: </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">geometry</span><span class="si">!r}</span><span class="s1">, </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">attributes</span><span class="si">!r}</span><span class="s1">, &lt;fields&gt;&gt;&#39;</span>

    <span class="k">def</span> <span class="fm">__str__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="sa">f</span><span class="s1">&#39;Record(</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">geometry</span><span class="si">}</span><span class="s1">, </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">attributes</span><span class="si">}</span><span class="s1">, &lt;fields&gt;)&#39;</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">bounds</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        The bounds of this Record&#39;s :meth:`~Record.geometry`.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_bounds</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_bounds</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">geometry</span><span class="o">.</span><span class="n">bounds</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_bounds</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">geometry</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        A shapely.geometry instance for this Record.</span>

<span class="sd">        The geometry may be ``None`` if a null shape is defined in the</span>
<span class="sd">        shapefile.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">_geometry</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">_shape</span><span class="o">.</span><span class="n">shapeType</span> <span class="o">!=</span> <span class="n">shapefile</span><span class="o">.</span><span class="n">NULL</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_geometry</span> <span class="o">=</span> <span class="n">sgeom</span><span class="o">.</span><span class="n">shape</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_shape</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_geometry</span>

<span class="k">class</span> <span class="nc">BasicReader</span><span class="p">:</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Provide an interface for accessing the contents of a shapefile.</span>

<span class="sd">    The primary methods used on a Reader instance are</span>
<span class="sd">    :meth:`~Reader.records` and :meth:`~Reader.geometries`.</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">reader</span><span class="p">):</span>
        <span class="c1"># Validate the filename/shapefile</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_reader</span> <span class="o">=</span> <span class="n">reader</span>
        <span class="k">if</span> <span class="n">reader</span><span class="o">.</span><span class="n">shp</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">or</span> <span class="n">reader</span><span class="o">.</span><span class="n">shx</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">or</span> <span class="n">reader</span><span class="o">.</span><span class="n">dbf</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Incomplete shapefile definition &quot;</span>
                             <span class="s2">&quot;in &#39;</span><span class="si">%s</span><span class="s2">&#39;.&quot;</span> <span class="o">%</span> <span class="n">filename</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_fields</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_reader</span><span class="o">.</span><span class="n">fields</span>


    <span class="k">def</span> <span class="nf">close</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_reader</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>

    <span class="k">def</span> <span class="fm">__len__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_reader</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">geometries</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Return an iterator of shapely geometries from the shapefile.</span>

<span class="sd">        This interface is useful for accessing the geometries of the</span>
<span class="sd">        shapefile where knowledge of the associated metadata is not necessary.</span>
<span class="sd">        In the case where further metadata is needed use the</span>
<span class="sd">        :meth:`~Reader.records`</span>
<span class="sd">        interface instead, extracting the geometry from the record with the</span>
<span class="sd">        :meth:`~Record.geometry` method.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">to_return</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">shape</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_reader</span><span class="o">.</span><span class="n">iterShapes</span><span class="p">():</span>
            <span class="c1"># Skip the shape that can not be represented as geometry.</span>
            <span class="k">if</span> <span class="n">shape</span><span class="o">.</span><span class="n">shapeType</span> <span class="o">!=</span> <span class="n">shapefile</span><span class="o">.</span><span class="n">NULL</span><span class="p">:</span>
                <span class="n">to_return</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">sgeom</span><span class="o">.</span><span class="n">shape</span><span class="p">(</span><span class="n">shape</span><span class="p">))</span>
        <span class="k">return</span> <span class="n">to_return</span>

    <span class="k">def</span> <span class="nf">records</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Return an iterator of :class:`~Record` instances.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># Ignore the &quot;DeletionFlag&quot; field which always comes first</span>
        <span class="n">to_return</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">fields</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_reader</span><span class="o">.</span><span class="n">fields</span><span class="p">[</span><span class="mi">1</span><span class="p">:]</span>
        <span class="k">for</span> <span class="n">shape_record</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_reader</span><span class="o">.</span><span class="n">iterShapeRecords</span><span class="p">():</span>
            <span class="n">attributes</span> <span class="o">=</span> <span class="n">shape_record</span><span class="o">.</span><span class="n">record</span><span class="o">.</span><span class="n">as_dict</span><span class="p">()</span>
            <span class="n">to_return</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">Record</span><span class="p">(</span><span class="n">shape_record</span><span class="o">.</span><span class="n">shape</span><span class="p">,</span> <span class="n">attributes</span><span class="p">,</span> <span class="n">fields</span><span class="p">))</span>
        <span class="k">return</span> <span class="n">to_return</span>
</pre></div>

           </div>
          </div>
          <footer>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2022, Tropycal Developers.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>