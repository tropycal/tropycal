<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>tropycal.tracks.storm &mdash; tropycal </title>
      <link rel="stylesheet" href="../../../_static/pygments.css" type="text/css" />
      <link rel="stylesheet" href="../../../_static/css/theme.css" type="text/css" />
      <link rel="stylesheet" href="../../../_static/plot_directive.css" type="text/css" />
      <link rel="stylesheet" href="../../../_static/sg_gallery.css" type="text/css" />
      <link rel="stylesheet" href="../../../_static/sg_gallery-binder.css" type="text/css" />
      <link rel="stylesheet" href="../../../_static/sg_gallery-dataframe.css" type="text/css" />
      <link rel="stylesheet" href="../../../_static/sg_gallery-rendered-html.css" type="text/css" />
      <link rel="stylesheet" href="../../../_static/css/theme.css" type="text/css" />
    <link rel="shortcut icon" href="../../../_static/logo_32.ico"/>
  <!--[if lt IE 9]>
    <script src="../../../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
        <script data-url_root="../../../" id="documentation_options" src="../../../_static/documentation_options.js"></script>
        <script src="../../../_static/jquery.js"></script>
        <script src="../../../_static/underscore.js"></script>
        <script src="../../../_static/doctools.js"></script>
    <script src="../../../_static/js/theme.js"></script>
    <link rel="index" title="Index" href="../../../genindex.html" />
    <link rel="search" title="Search" href="../../../search.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
            <a href="../../../index.html" class="icon icon-home"> tropycal
            <img src="../../../_static/logo.png" class="logo" alt="Logo"/>
          </a>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <ul>
<li class="toctree-l1"><a class="reference internal" href="../../../install.html">Installation Guide</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../support.html">Support</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../examples/index.html">Example Scripts</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../api/index.html">API Reference</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../sample_usage.html">Example Gallery</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../data.html">Data Sources</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../../index.html">tropycal</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../../../index.html" class="icon icon-home"></a> &raquo;</li>
          <li><a href="../../index.html">Module code</a> &raquo;</li>
      <li>tropycal.tracks.storm</li>
      <li class="wy-breadcrumbs-aside">
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <h1>Source code for tropycal.tracks.storm</h1><div class="highlight"><pre>
<span></span><span class="sa">r</span><span class="sd">&quot;&quot;&quot;Functionality for storing and analyzing an individual storm.&quot;&quot;&quot;</span>

<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>
<span class="kn">import</span> <span class="nn">re</span>
<span class="kn">import</span> <span class="nn">scipy.interpolate</span> <span class="k">as</span> <span class="nn">interp</span>
<span class="kn">import</span> <span class="nn">urllib</span>
<span class="kn">import</span> <span class="nn">warnings</span>
<span class="kn">from</span> <span class="nn">datetime</span> <span class="kn">import</span> <span class="n">datetime</span> <span class="k">as</span> <span class="n">dt</span><span class="p">,</span><span class="n">timedelta</span>
<span class="kn">import</span> <span class="nn">requests</span>
<span class="kn">import</span> <span class="nn">copy</span>

<span class="c1">#Import internal scripts</span>
<span class="kn">from</span> <span class="nn">.plot</span> <span class="kn">import</span> <span class="n">TrackPlot</span>
<span class="kn">from</span> <span class="nn">..tornado</span> <span class="kn">import</span> <span class="o">*</span>
<span class="kn">from</span> <span class="nn">..recon</span> <span class="kn">import</span> <span class="o">*</span>

<span class="c1">#Import tools</span>
<span class="kn">from</span> <span class="nn">.tools</span> <span class="kn">import</span> <span class="o">*</span>
<span class="kn">from</span> <span class="nn">..utils</span> <span class="kn">import</span> <span class="o">*</span>

<span class="k">try</span><span class="p">:</span>
    <span class="kn">import</span> <span class="nn">zipfile</span>
    <span class="kn">import</span> <span class="nn">gzip</span>
    <span class="kn">from</span> <span class="nn">io</span> <span class="kn">import</span> <span class="n">StringIO</span><span class="p">,</span> <span class="n">BytesIO</span>
    <span class="kn">import</span> <span class="nn">tarfile</span>
<span class="k">except</span><span class="p">:</span>
    <span class="n">warnings</span><span class="o">.</span><span class="n">warn</span><span class="p">(</span><span class="s2">&quot;Warning: The libraries necessary for online NHC forecast retrieval aren&#39;t available (gzip, io, tarfile).&quot;</span><span class="p">)</span>

<span class="k">try</span><span class="p">:</span>
    <span class="kn">import</span> <span class="nn">matplotlib.lines</span> <span class="k">as</span> <span class="nn">mlines</span>
    <span class="kn">import</span> <span class="nn">matplotlib.patheffects</span> <span class="k">as</span> <span class="nn">path_effects</span>
    <span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>
    <span class="kn">import</span> <span class="nn">matplotlib.ticker</span> <span class="k">as</span> <span class="nn">mticker</span>
<span class="k">except</span><span class="p">:</span>
    <span class="n">warnings</span><span class="o">.</span><span class="n">warn</span><span class="p">(</span><span class="s2">&quot;Warning: Matplotlib is not installed in your python environment. Plotting functions will not work.&quot;</span><span class="p">)</span>

<div class="viewcode-block" id="Storm"><a class="viewcode-back" href="../../../api/generated/tropycal.tracks.Storm.html#tropycal.tracks.Storm">[docs]</a><span class="k">class</span> <span class="nc">Storm</span><span class="p">:</span>
    
    <span class="sa">r</span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Initializes an instance of Storm, retrieved via ``TrackDataset.get_storm()``.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    storm : dict</span>
<span class="sd">        Dict entry of the requested storm.</span>
<span class="sd">    </span>
<span class="sd">    Other Parameters</span>
<span class="sd">    ----------------</span>
<span class="sd">    stormTors : dict, optional</span>
<span class="sd">        Dict entry containing tornado data assicated with the storm. Populated directly from tropycal.tracks.TrackDataset.</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    Storm</span>
<span class="sd">        Instance of a Storm object.</span>
<span class="sd">    </span>
<span class="sd">    Notes</span>
<span class="sd">    -----</span>
<span class="sd">    A Storm object is retrieved from TrackDataset&#39;s ``get_storm()`` method. For example, if the dataset read in is the default North Atlantic and the desired storm is Hurricane Michael (2018), it would be retrieved as follows:</span>
<span class="sd">    </span>
<span class="sd">    .. code-block:: python</span>
<span class="sd">    </span>
<span class="sd">        from tropycal import tracks</span>
<span class="sd">        basin = tracks.TrackDataset()</span>
<span class="sd">        storm = basin.get_storm((&#39;michael&#39;,2018))</span>
<span class="sd">    </span>
<span class="sd">    Now Hurricane Michael&#39;s data is stored in the variable ``storm``, which is an instance of Storm and can access all of the methods and attributes of a Storm object.</span>
<span class="sd">    </span>
<span class="sd">    All the variables associated with a Storm object (e.g., lat, lon, date, vmax) can be accessed in two ways. The first is directly from the Storm object:</span>
<span class="sd">    </span>
<span class="sd">    &gt;&gt;&gt; storm.lat</span>
<span class="sd">    array([17.8, 18.1, 18.4, 18.8, 19.1, 19.7, 20.2, 20.9, 21.7, 22.7, 23.7,</span>
<span class="sd">           24.6, 25.6, 26.6, 27.7, 29. , 30. , 30.2, 31.5, 32.8, 34.1, 35.6,</span>
<span class="sd">           36.5, 37.3, 39.1, 41.1, 43.1, 44.8, 46.4, 47.6, 48.4, 48.8, 48.6,</span>
<span class="sd">           47.5, 45.9, 44.4, 42.8, 41.2])</span>
<span class="sd">    </span>
<span class="sd">    The second is via ``storm.vars``, which returns a dictionary of the variables associated with the Storm object. This is also a quick way to access all of the variables associated with a Storm object:</span>
<span class="sd">    </span>
<span class="sd">    &gt;&gt;&gt; variable_dict = storm.vars</span>
<span class="sd">    &gt;&gt;&gt; lat = variable_dict[&#39;lat&#39;]</span>
<span class="sd">    &gt;&gt;&gt; lon = variable_dict[&#39;lon&#39;]</span>
<span class="sd">    &gt;&gt;&gt; print(variable_dict.keys())</span>
<span class="sd">    dict_keys([&#39;date&#39;, &#39;extra_obs&#39;, &#39;special&#39;, &#39;type&#39;, &#39;lat&#39;, &#39;lon&#39;, &#39;vmax&#39;, &#39;mslp&#39;, &#39;wmo_basin&#39;])</span>
<span class="sd">    </span>
<span class="sd">    Storm objects also have numerous attributes with information about the storm. ``storm.attrs`` returns a dictionary of the attributes for this Storm object.</span>
<span class="sd">    </span>
<span class="sd">    &gt;&gt;&gt; print(storm.attrs)</span>
<span class="sd">    {&#39;id&#39;: &#39;AL142018&#39;,</span>
<span class="sd">     &#39;operational_id&#39;: &#39;AL142018&#39;,</span>
<span class="sd">     &#39;name&#39;: &#39;MICHAEL&#39;,</span>
<span class="sd">     &#39;year&#39;: 2018,</span>
<span class="sd">     &#39;season&#39;: 2018,</span>
<span class="sd">     &#39;basin&#39;: &#39;north_atlantic&#39;,</span>
<span class="sd">     &#39;source_info&#39;: &#39;NHC Hurricane Database&#39;,</span>
<span class="sd">     &#39;source&#39;: &#39;hurdat&#39;,</span>
<span class="sd">     &#39;ace&#39;: 12.5,</span>
<span class="sd">     &#39;realtime&#39;: False,</span>
<span class="sd">     &#39;invest&#39;: False}</span>
<span class="sd">    </span>
<span class="sd">    </span>
<span class="sd">    &quot;&quot;&quot;</span>
    
    <span class="k">def</span> <span class="fm">__setitem__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">key</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="vm">__dict__</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="n">value</span>
        
    <span class="k">def</span> <span class="fm">__getitem__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">key</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="vm">__dict__</span><span class="p">[</span><span class="n">key</span><span class="p">]</span>
    
    <span class="k">def</span> <span class="fm">__repr__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
         
        <span class="c1">#Label object</span>
        <span class="n">summary</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;&lt;tropycal.tracks.Storm&gt;&quot;</span><span class="p">]</span>
        
        <span class="c1">#Format keys for summary</span>
        <span class="n">type_array</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">dict</span><span class="p">[</span><span class="s1">&#39;type&#39;</span><span class="p">])</span>
        <span class="n">idx</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">((</span><span class="n">type_array</span> <span class="o">==</span> <span class="s1">&#39;SD&#39;</span><span class="p">)</span> <span class="o">|</span> <span class="p">(</span><span class="n">type_array</span> <span class="o">==</span> <span class="s1">&#39;SS&#39;</span><span class="p">)</span> <span class="o">|</span> <span class="p">(</span><span class="n">type_array</span> <span class="o">==</span> <span class="s1">&#39;TD&#39;</span><span class="p">)</span> <span class="o">|</span> <span class="p">(</span><span class="n">type_array</span> <span class="o">==</span> <span class="s1">&#39;TS&#39;</span><span class="p">)</span> <span class="o">|</span> <span class="p">(</span><span class="n">type_array</span> <span class="o">==</span> <span class="s1">&#39;HU&#39;</span><span class="p">))[</span><span class="mi">0</span><span class="p">]</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">invest</span> <span class="ow">and</span> <span class="nb">len</span><span class="p">(</span><span class="n">idx</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span> <span class="n">idx</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="kc">True</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">type_array</span><span class="p">])</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">idx</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">start_date</span> <span class="o">=</span> <span class="s1">&#39;N/A&#39;</span>
            <span class="n">end_date</span> <span class="o">=</span> <span class="s1">&#39;N/A&#39;</span>
            <span class="n">max_wind</span> <span class="o">=</span> <span class="s1">&#39;N/A&#39;</span>
            <span class="n">min_mslp</span> <span class="o">=</span> <span class="s1">&#39;N/A&#39;</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">time_tropical</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">dict</span><span class="p">[</span><span class="s1">&#39;date&#39;</span><span class="p">])[</span><span class="n">idx</span><span class="p">]</span>
            <span class="n">start_date</span> <span class="o">=</span> <span class="n">time_tropical</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">strftime</span><span class="p">(</span><span class="s2">&quot;%H00 UTC </span><span class="si">%d</span><span class="s2"> %B %Y&quot;</span><span class="p">)</span>
            <span class="n">end_date</span> <span class="o">=</span> <span class="n">time_tropical</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">strftime</span><span class="p">(</span><span class="s2">&quot;%H00 UTC </span><span class="si">%d</span><span class="s2"> %B %Y&quot;</span><span class="p">)</span>
            <span class="n">max_wind</span> <span class="o">=</span> <span class="s1">&#39;N/A&#39;</span> <span class="k">if</span> <span class="n">all_nan</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">dict</span><span class="p">[</span><span class="s1">&#39;vmax&#39;</span><span class="p">])[</span><span class="n">idx</span><span class="p">])</span> <span class="o">==</span> <span class="kc">True</span> <span class="k">else</span> <span class="n">np</span><span class="o">.</span><span class="n">nanmax</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">dict</span><span class="p">[</span><span class="s1">&#39;vmax&#39;</span><span class="p">])[</span><span class="n">idx</span><span class="p">])</span>
            <span class="n">min_mslp</span> <span class="o">=</span> <span class="s1">&#39;N/A&#39;</span> <span class="k">if</span> <span class="n">all_nan</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">dict</span><span class="p">[</span><span class="s1">&#39;mslp&#39;</span><span class="p">])[</span><span class="n">idx</span><span class="p">])</span> <span class="o">==</span> <span class="kc">True</span> <span class="k">else</span> <span class="n">np</span><span class="o">.</span><span class="n">nanmin</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">dict</span><span class="p">[</span><span class="s1">&#39;mslp&#39;</span><span class="p">])[</span><span class="n">idx</span><span class="p">])</span>
        <span class="n">summary_keys</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;Maximum Wind&#39;</span><span class="p">:</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">max_wind</span><span class="si">}</span><span class="s2"> knots&quot;</span><span class="p">,</span>
                        <span class="s1">&#39;Minimum Pressure&#39;</span><span class="p">:</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">min_mslp</span><span class="si">}</span><span class="s2"> hPa&quot;</span><span class="p">,</span>
                        <span class="s1">&#39;Start Date&#39;</span><span class="p">:</span><span class="n">start_date</span><span class="p">,</span>
                        <span class="s1">&#39;End Date&#39;</span><span class="p">:</span><span class="n">end_date</span><span class="p">}</span>
        
        <span class="c1">#Format keys for coordinates</span>
        <span class="n">variable_keys</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">vars</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
            <span class="n">dtype</span> <span class="o">=</span> <span class="nb">type</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">vars</span><span class="p">[</span><span class="n">key</span><span class="p">][</span><span class="mi">0</span><span class="p">])</span><span class="o">.</span><span class="vm">__name__</span>
            <span class="n">dtype</span> <span class="o">=</span> <span class="n">dtype</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;_&quot;</span><span class="p">,</span><span class="s2">&quot;&quot;</span><span class="p">)</span>
            <span class="n">variable_keys</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;(</span><span class="si">{</span><span class="n">dtype</span><span class="si">}</span><span class="s2">) [</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">vars</span><span class="p">[</span><span class="n">key</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span><span class="si">}</span><span class="s2"> .... </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">vars</span><span class="p">[</span><span class="n">key</span><span class="p">][</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="si">}</span><span class="s2">]&quot;</span>

        <span class="c1">#Add storm summary</span>
        <span class="n">summary</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;Storm Summary:&quot;</span><span class="p">)</span>
        <span class="n">add_space</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">([</span><span class="nb">len</span><span class="p">(</span><span class="n">key</span><span class="p">)</span> <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="n">summary_keys</span><span class="o">.</span><span class="n">keys</span><span class="p">()])</span><span class="o">+</span><span class="mi">3</span>
        <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="n">summary_keys</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
            <span class="n">key_name</span> <span class="o">=</span> <span class="n">key</span><span class="o">+</span><span class="s2">&quot;:&quot;</span>
            <span class="n">summary</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="s2">&quot; &quot;</span><span class="o">*</span><span class="mi">4</span><span class="si">}{</span><span class="n">key_name</span><span class="si">:</span><span class="s1">&lt;</span><span class="si">{</span><span class="n">add_space</span><span class="si">}}{</span><span class="n">summary_keys</span><span class="p">[</span><span class="n">key</span><span class="p">]</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
        
        <span class="c1">#Add coordinates</span>
        <span class="n">summary</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">Variables:&quot;</span><span class="p">)</span>
        <span class="n">add_space</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">([</span><span class="nb">len</span><span class="p">(</span><span class="n">key</span><span class="p">)</span> <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="n">variable_keys</span><span class="o">.</span><span class="n">keys</span><span class="p">()])</span><span class="o">+</span><span class="mi">3</span>
        <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="n">variable_keys</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
            <span class="n">key_name</span> <span class="o">=</span> <span class="n">key</span>
            <span class="n">summary</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="s2">&quot; &quot;</span><span class="o">*</span><span class="mi">4</span><span class="si">}{</span><span class="n">key_name</span><span class="si">:</span><span class="s1">&lt;</span><span class="si">{</span><span class="n">add_space</span><span class="si">}}{</span><span class="n">variable_keys</span><span class="p">[</span><span class="n">key</span><span class="p">]</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
        
        <span class="c1">#Add additional information</span>
        <span class="n">summary</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">More Information:&quot;</span><span class="p">)</span>
        <span class="n">add_space</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">([</span><span class="nb">len</span><span class="p">(</span><span class="n">key</span><span class="p">)</span> <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">attrs</span><span class="o">.</span><span class="n">keys</span><span class="p">()])</span><span class="o">+</span><span class="mi">3</span>
        <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">attrs</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
            <span class="n">key_name</span> <span class="o">=</span> <span class="n">key</span><span class="o">+</span><span class="s2">&quot;:&quot;</span>
            <span class="n">val</span> <span class="o">=</span> <span class="s1">&#39;</span><span class="si">%0.1f</span><span class="s1">&#39;</span><span class="o">%</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">attrs</span><span class="p">[</span><span class="n">key</span><span class="p">])</span> <span class="k">if</span> <span class="n">key</span> <span class="o">==</span> <span class="s1">&#39;ace&#39;</span> <span class="k">else</span> <span class="bp">self</span><span class="o">.</span><span class="n">attrs</span><span class="p">[</span><span class="n">key</span><span class="p">]</span>
            <span class="n">summary</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="s2">&quot; &quot;</span><span class="o">*</span><span class="mi">4</span><span class="si">}{</span><span class="n">key_name</span><span class="si">:</span><span class="s1">&lt;</span><span class="si">{</span><span class="n">add_space</span><span class="si">}}{</span><span class="n">val</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>

        <span class="k">return</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">summary</span><span class="p">)</span>
    
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">storm</span><span class="p">,</span><span class="n">stormTors</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span><span class="n">read_path</span><span class="o">=</span><span class="s2">&quot;&quot;</span><span class="p">):</span>
        
        <span class="k">if</span> <span class="n">read_path</span> <span class="o">==</span> <span class="s2">&quot;&quot;</span> <span class="ow">or</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isfile</span><span class="p">(</span><span class="n">read_path</span><span class="p">)</span> <span class="o">==</span> <span class="kc">False</span><span class="p">:</span>

            <span class="c1">#Save the dict entry of the storm</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">dict</span> <span class="o">=</span> <span class="n">storm</span>

            <span class="c1">#Add other attributes about the storm</span>
            <span class="n">keys</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">dict</span><span class="o">.</span><span class="n">keys</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">attrs</span> <span class="o">=</span> <span class="p">{}</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">vars</span> <span class="o">=</span> <span class="p">{}</span>
            <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="n">keys</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">key</span> <span class="o">==</span> <span class="s1">&#39;realtime&#39;</span><span class="p">:</span> <span class="k">continue</span>
                <span class="k">if</span> <span class="n">key</span> <span class="o">==</span> <span class="s1">&#39;invest&#39;</span><span class="p">:</span> <span class="k">continue</span>
                <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">dict</span><span class="p">[</span><span class="n">key</span><span class="p">],</span> <span class="nb">list</span><span class="p">)</span> <span class="o">==</span> <span class="kc">False</span> <span class="ow">and</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">dict</span><span class="p">[</span><span class="n">key</span><span class="p">],</span> <span class="nb">dict</span><span class="p">)</span> <span class="o">==</span> <span class="kc">False</span><span class="p">:</span>
                    <span class="bp">self</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">dict</span><span class="p">[</span><span class="n">key</span><span class="p">]</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">attrs</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">dict</span><span class="p">[</span><span class="n">key</span><span class="p">]</span>
                <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">dict</span><span class="p">[</span><span class="n">key</span><span class="p">],</span> <span class="nb">list</span><span class="p">)</span> <span class="o">==</span> <span class="kc">True</span> <span class="ow">and</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">dict</span><span class="p">[</span><span class="n">key</span><span class="p">],</span> <span class="nb">dict</span><span class="p">)</span> <span class="o">==</span> <span class="kc">False</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">vars</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">dict</span><span class="p">[</span><span class="n">key</span><span class="p">])</span>
                    <span class="bp">self</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">dict</span><span class="p">[</span><span class="n">key</span><span class="p">])</span>

            <span class="c1">#Assign tornado data</span>
            <span class="k">if</span> <span class="n">stormTors</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">stormTors</span><span class="p">,</span><span class="nb">dict</span><span class="p">):</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">stormTors</span> <span class="o">=</span> <span class="n">stormTors</span><span class="p">[</span><span class="s1">&#39;data&#39;</span><span class="p">]</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">tornado_dist_thresh</span> <span class="o">=</span> <span class="n">stormTors</span><span class="p">[</span><span class="s1">&#39;dist_thresh&#39;</span><span class="p">]</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">attrs</span><span class="p">[</span><span class="s1">&#39;Tornado Count&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">stormTors</span><span class="p">[</span><span class="s1">&#39;data&#39;</span><span class="p">])</span>

            <span class="c1">#Get Archer track data for this storm, if it exists</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">get_archer</span><span class="p">()</span>
            <span class="k">except</span><span class="p">:</span>
                <span class="k">pass</span>
                
            <span class="c1">#Initialize recon dataset instance</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">recon</span> <span class="o">=</span> <span class="n">ReconDataset</span><span class="p">(</span><span class="n">storm</span><span class="o">=</span><span class="bp">self</span><span class="p">)</span>

            <span class="c1">#Determine if storm object was retrieved via realtime object</span>
            <span class="k">if</span> <span class="s1">&#39;realtime&#39;</span> <span class="ow">in</span> <span class="n">keys</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">dict</span><span class="p">[</span><span class="s1">&#39;realtime&#39;</span><span class="p">]:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">realtime</span> <span class="o">=</span> <span class="kc">True</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">attrs</span><span class="p">[</span><span class="s1">&#39;realtime&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">True</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">realtime</span> <span class="o">=</span> <span class="kc">False</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">attrs</span><span class="p">[</span><span class="s1">&#39;realtime&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">False</span>
            
            <span class="c1">#Determine if storm object is an invest</span>
            <span class="k">if</span> <span class="s1">&#39;invest&#39;</span> <span class="ow">in</span> <span class="n">keys</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">dict</span><span class="p">[</span><span class="s1">&#39;invest&#39;</span><span class="p">]:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">invest</span> <span class="o">=</span> <span class="kc">True</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">attrs</span><span class="p">[</span><span class="s1">&#39;invest&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">True</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">invest</span> <span class="o">=</span> <span class="kc">False</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">attrs</span><span class="p">[</span><span class="s1">&#39;invest&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">False</span>
        
        <span class="k">else</span><span class="p">:</span>
            
            <span class="c1">#This functionality currently does not exist</span>
            <span class="k">raise</span> <span class="n">ExceptionError</span><span class="p">(</span><span class="s2">&quot;This functionality has not been implemented yet.&quot;</span><span class="p">)</span>
    
<div class="viewcode-block" id="Storm.sel"><a class="viewcode-back" href="../../../api/generated/tropycal.tracks.Storm.sel.html#tropycal.tracks.Storm.sel">[docs]</a>    <span class="k">def</span> <span class="nf">sel</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">time</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span><span class="n">lat</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span><span class="n">lon</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span><span class="n">vmax</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span><span class="n">mslp</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>\
            <span class="n">dvmax_dt</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span><span class="n">dmslp_dt</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span><span class="n">stormtype</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span><span class="n">method</span><span class="o">=</span><span class="s1">&#39;exact&#39;</span><span class="p">):</span>
        
        <span class="sa">r</span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Subset this storm by any of its parameters and return a new storm object.</span>
<span class="sd">        </span>
<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        time : datetime.datetime or list/tuple of datetimes</span>
<span class="sd">            Datetime object for single point, or list/tuple of start time and end time.</span>
<span class="sd">            Default is None, which returns all points</span>
<span class="sd">        lat : float/int or list/tuple of float/int</span>
<span class="sd">            Float/int for single point, or list/tuple of latitude bounds (S,N).</span>
<span class="sd">            None in either position of a tuple means it is boundless on that side.</span>
<span class="sd">        lon : float/int or list/tuple of float/int</span>
<span class="sd">            Float/int for single point, or list/tuple of longitude bounds (W,E).</span>
<span class="sd">            If either lat or lon is a tuple, the other can be None for no bounds.</span>
<span class="sd">            If either is a tuple, the other canNOT be a float/int.</span>
<span class="sd">        vmax : list/tuple of float/int</span>
<span class="sd">            list/tuple of vmax bounds (min,max).</span>
<span class="sd">            None in either position of a tuple means it is boundless on that side. </span>
<span class="sd">        mslp : list/tuple of float/int</span>
<span class="sd">            list/tuple of mslp bounds (min,max).</span>
<span class="sd">            None in either position of a tuple means it is boundless on that side. </span>
<span class="sd">        dvmax_dt : list/tuple of float/int</span>
<span class="sd">            list/tuple of vmax bounds (min,max). ONLY AVAILABLE AFTER INTERP.</span>
<span class="sd">            None in either position of a tuple means it is boundless on that side. </span>
<span class="sd">        dmslp_dt : list/tuple of float/int</span>
<span class="sd">            list/tuple of mslp bounds (min,max). ONLY AVAILABLE AFTER INTERP.</span>
<span class="sd">            None in either position of a tuple means it is boundless on that side.</span>
<span class="sd">        stormtype : list/tuple of str</span>
<span class="sd">            list/tuple of stormtypes (options: &#39;LO&#39;,&#39;EX&#39;,&#39;TD&#39;,&#39;SD&#39;,&#39;TS&#39;,&#39;SS&#39;,&#39;HU&#39;)</span>
<span class="sd">        method : str</span>
<span class="sd">            Applies for single point selection in time and lat/lon.</span>
<span class="sd">            &#39;exact&#39; requires a point to match exactly with the request. (default)</span>
<span class="sd">            &#39;nearest&#39; returns the nearest point to the request</span>
<span class="sd">            &#39;floor&#39; ONLY for time, returns the nearest point before the request</span>
<span class="sd">            &#39;ceil&#39; ONLY for time, returns the neartest point after the request</span>
<span class="sd">        </span>
<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        storm object</span>
<span class="sd">            A new storm object that satisfies the intersection of all subsetting.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        
        <span class="c1">#create copy of storm object</span>
        <span class="n">NEW_STORM</span> <span class="o">=</span> <span class="n">Storm</span><span class="p">(</span><span class="n">copy</span><span class="o">.</span><span class="n">deepcopy</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">dict</span><span class="p">))</span>
        <span class="n">idx_final</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">date</span><span class="p">))</span>
        
        <span class="c1">#apply time filter</span>
        <span class="k">if</span> <span class="n">time</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">idx</span> <span class="o">=</span> <span class="n">copy</span><span class="o">.</span><span class="n">copy</span><span class="p">(</span><span class="n">idx_final</span><span class="p">)</span>
        
        <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">time</span><span class="p">,</span><span class="n">dt</span><span class="p">):</span>
            <span class="n">time_diff</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([(</span><span class="n">time</span><span class="o">-</span><span class="n">i</span><span class="p">)</span><span class="o">.</span><span class="n">total_seconds</span><span class="p">()</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">NEW_STORM</span><span class="o">.</span><span class="n">date</span><span class="p">])</span>
            <span class="n">idx</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">time_diff</span><span class="p">)</span><span class="o">.</span><span class="n">argmin</span><span class="p">()</span>
            <span class="k">if</span> <span class="n">time_diff</span><span class="p">[</span><span class="n">idx</span><span class="p">]</span><span class="o">!=</span><span class="mi">0</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">method</span><span class="o">==</span><span class="s1">&#39;exact&#39;</span><span class="p">:</span>
                    <span class="n">msg</span> <span class="o">=</span> <span class="sa">f</span><span class="s1">&#39;no exact match for </span><span class="si">{</span><span class="n">time</span><span class="si">}</span><span class="s1">. Use different time or method.&#39;</span>
                    <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>
                <span class="k">elif</span> <span class="n">method</span><span class="o">==</span><span class="s1">&#39;floor&#39;</span> <span class="ow">and</span> <span class="n">time_diff</span><span class="p">[</span><span class="n">idx</span><span class="p">]</span><span class="o">&lt;</span><span class="mi">0</span><span class="p">:</span>
                    <span class="n">idx</span> <span class="o">+=</span> <span class="o">-</span><span class="mi">1</span>
                    <span class="k">if</span> <span class="n">idx</span><span class="o">&lt;</span><span class="mi">0</span><span class="p">:</span>
                        <span class="n">msg</span> <span class="o">=</span> <span class="sa">f</span><span class="s1">&#39;no points before </span><span class="si">{</span><span class="n">time</span><span class="si">}</span><span class="s1">. Use different time or method.&#39;</span>
                        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>
                <span class="k">elif</span> <span class="n">method</span><span class="o">==</span><span class="s1">&#39;ceil&#39;</span> <span class="ow">and</span> <span class="n">time_diff</span><span class="p">[</span><span class="n">idx</span><span class="p">]</span><span class="o">&gt;</span><span class="mi">0</span><span class="p">:</span>
                    <span class="n">idx</span> <span class="o">+=</span> <span class="mi">1</span>
                    <span class="k">if</span> <span class="n">idx</span><span class="o">&gt;=</span><span class="nb">len</span><span class="p">(</span><span class="n">time_diff</span><span class="p">):</span>
                        <span class="n">msg</span> <span class="o">=</span> <span class="sa">f</span><span class="s1">&#39;no points after </span><span class="si">{</span><span class="n">time</span><span class="si">}</span><span class="s1">. Use different time or method.&#39;</span>
                        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>
        
        <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">time</span><span class="p">,(</span><span class="nb">tuple</span><span class="p">,</span><span class="nb">list</span><span class="p">))</span> <span class="ow">and</span> <span class="nb">len</span><span class="p">(</span><span class="n">time</span><span class="p">)</span><span class="o">==</span><span class="mi">2</span><span class="p">:</span>
            <span class="n">time0</span><span class="p">,</span><span class="n">time1</span> <span class="o">=</span> <span class="n">time</span>
            <span class="k">if</span> <span class="n">time0</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">time0</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="n">NEW_STORM</span><span class="o">.</span><span class="n">date</span><span class="p">)</span>
            <span class="k">elif</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">time0</span><span class="p">,</span><span class="n">dt</span><span class="p">):</span>
                <span class="n">msg</span> <span class="o">=</span> <span class="s1">&#39;time bounds must be of type datetime.datetime or None.&#39;</span>
                <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">time1</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">time1</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="n">NEW_STORM</span><span class="o">.</span><span class="n">date</span><span class="p">)</span>
            <span class="k">elif</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">time1</span><span class="p">,</span><span class="n">dt</span><span class="p">):</span>
                <span class="n">msg</span> <span class="o">=</span> <span class="s1">&#39;time bounds must be of type datetime.datetime or None.&#39;</span>
                <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>            
            <span class="n">tmptimes</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">NEW_STORM</span><span class="o">.</span><span class="n">date</span><span class="p">)</span>
            <span class="n">idx</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">((</span><span class="n">tmptimes</span><span class="o">&gt;=</span><span class="n">time0</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">tmptimes</span><span class="o">&lt;=</span><span class="n">time1</span><span class="p">))[</span><span class="mi">0</span><span class="p">]</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">idx</span><span class="p">)</span><span class="o">==</span><span class="mi">0</span><span class="p">:</span>
                <span class="n">msg</span> <span class="o">=</span> <span class="sa">f</span><span class="s1">&#39;no points between </span><span class="si">{</span><span class="n">time</span><span class="si">}</span><span class="s1">. Use different time bounds.&#39;</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>
                
        <span class="k">else</span><span class="p">:</span>
            <span class="n">msg</span> <span class="o">=</span> <span class="s1">&#39;time must be of type datetime.datetime, tuple/list, or None.&#39;</span>
            <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>
        
        <span class="c1">#update idx_final</span>
        <span class="n">idx_final</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="n">idx_final</span><span class="p">)</span> <span class="o">&amp;</span> <span class="nb">set</span><span class="p">(</span><span class="n">listify</span><span class="p">(</span><span class="n">idx</span><span class="p">)))</span>

        <span class="c1">#apply lat/lon filter</span>
        <span class="k">if</span> <span class="n">lat</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">lon</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">idx</span> <span class="o">=</span> <span class="n">copy</span><span class="o">.</span><span class="n">copy</span><span class="p">(</span><span class="n">idx_final</span><span class="p">)</span>
            
        <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">lat</span><span class="p">,(</span><span class="nb">int</span><span class="p">,</span><span class="n">np</span><span class="o">.</span><span class="n">int</span><span class="p">,</span><span class="n">np</span><span class="o">.</span><span class="n">integer</span><span class="p">,</span><span class="nb">float</span><span class="p">,</span><span class="n">np</span><span class="o">.</span><span class="n">floating</span><span class="p">))</span> <span class="ow">and</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">lon</span><span class="p">,(</span><span class="nb">int</span><span class="p">,</span><span class="n">np</span><span class="o">.</span><span class="n">int</span><span class="p">,</span><span class="n">np</span><span class="o">.</span><span class="n">integer</span><span class="p">,</span><span class="nb">float</span><span class="p">,</span><span class="n">np</span><span class="o">.</span><span class="n">floating</span><span class="p">)):</span>
            <span class="n">dist</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">great_circle</span><span class="p">((</span><span class="n">lat</span><span class="p">,</span><span class="n">lon</span><span class="p">),(</span><span class="n">x</span><span class="p">,</span><span class="n">y</span><span class="p">))</span><span class="o">.</span><span class="n">kilometers</span> <span class="k">for</span> <span class="n">x</span><span class="p">,</span><span class="n">y</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">NEW_STORM</span><span class="o">.</span><span class="n">lon</span><span class="p">,</span><span class="n">NEW_STORM</span><span class="o">.</span><span class="n">lat</span><span class="p">)])</span>
            <span class="n">idx</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">dist</span><span class="p">)</span><span class="o">.</span><span class="n">argmin</span><span class="p">()</span>
            <span class="k">if</span> <span class="n">dist</span><span class="p">[</span><span class="n">idx</span><span class="p">]</span><span class="o">!=</span><span class="mi">0</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">method</span><span class="o">==</span><span class="s1">&#39;exact&#39;</span><span class="p">:</span>
                    <span class="n">msg</span> <span class="o">=</span> <span class="sa">f</span><span class="s1">&#39;no exact match for </span><span class="si">{</span><span class="n">lat</span><span class="si">}</span><span class="s1">/</span><span class="si">{</span><span class="n">lon</span><span class="si">}</span><span class="s1">. Use different location or method.&#39;</span>
                    <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>
                <span class="k">elif</span> <span class="n">method</span> <span class="ow">in</span> <span class="p">(</span><span class="s1">&#39;floor&#39;</span><span class="p">,</span><span class="s1">&#39;ceil&#39;</span><span class="p">):</span>
                    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;floor and ceil do not apply to lat/lon filtering. Using nearest instead.&#39;</span><span class="p">)</span>

        <span class="k">elif</span> <span class="p">(</span><span class="nb">isinstance</span><span class="p">(</span><span class="n">lat</span><span class="p">,(</span><span class="nb">tuple</span><span class="p">,</span><span class="nb">list</span><span class="p">))</span> <span class="ow">and</span> <span class="nb">len</span><span class="p">(</span><span class="n">lat</span><span class="p">)</span><span class="o">==</span><span class="mi">2</span><span class="p">)</span> \
            <span class="ow">or</span> <span class="p">(</span><span class="nb">isinstance</span><span class="p">(</span><span class="n">lon</span><span class="p">,(</span><span class="nb">tuple</span><span class="p">,</span><span class="nb">list</span><span class="p">))</span> <span class="ow">and</span> <span class="nb">len</span><span class="p">(</span><span class="n">lon</span><span class="p">)</span><span class="o">==</span><span class="mi">2</span><span class="p">):</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">lat</span><span class="p">,(</span><span class="nb">tuple</span><span class="p">,</span><span class="nb">list</span><span class="p">)):</span>
                <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Using no lat bounds&#39;</span><span class="p">)</span>
                <span class="n">lat</span> <span class="o">=</span> <span class="p">(</span><span class="kc">None</span><span class="p">,</span><span class="kc">None</span><span class="p">)</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">lon</span><span class="p">,(</span><span class="nb">tuple</span><span class="p">,</span><span class="nb">list</span><span class="p">)):</span>
                <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Using no lon bounds&#39;</span><span class="p">)</span>
                <span class="n">lon</span> <span class="o">=</span> <span class="p">(</span><span class="kc">None</span><span class="p">,</span><span class="kc">None</span><span class="p">)</span>
            <span class="n">lat0</span><span class="p">,</span><span class="n">lat1</span> <span class="o">=</span> <span class="n">lat</span>
            <span class="n">lon0</span><span class="p">,</span><span class="n">lon1</span> <span class="o">=</span> <span class="n">lon</span>
            <span class="k">if</span> <span class="n">lat0</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">lat0</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="n">NEW_STORM</span><span class="o">.</span><span class="n">lat</span><span class="p">)</span>
            <span class="k">elif</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">lat0</span><span class="p">,(</span><span class="nb">int</span><span class="p">,</span><span class="n">np</span><span class="o">.</span><span class="n">int</span><span class="p">,</span><span class="n">np</span><span class="o">.</span><span class="n">integer</span><span class="p">,</span><span class="nb">float</span><span class="p">,</span><span class="n">np</span><span class="o">.</span><span class="n">floating</span><span class="p">)):</span>
                <span class="n">msg</span> <span class="o">=</span> <span class="s1">&#39;lat/lon bounds must be of type float/int or None.&#39;</span>
                <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">lat1</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">lat1</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="n">NEW_STORM</span><span class="o">.</span><span class="n">lat</span><span class="p">)</span>
            <span class="k">elif</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">lat1</span><span class="p">,(</span><span class="nb">int</span><span class="p">,</span><span class="n">np</span><span class="o">.</span><span class="n">int</span><span class="p">,</span><span class="n">np</span><span class="o">.</span><span class="n">integer</span><span class="p">,</span><span class="nb">float</span><span class="p">,</span><span class="n">np</span><span class="o">.</span><span class="n">floating</span><span class="p">)):</span>
                <span class="n">msg</span> <span class="o">=</span> <span class="s1">&#39;lat/lon bounds must be of type float/int or None.&#39;</span>
                <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">lon0</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">lon0</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="n">NEW_STORM</span><span class="o">.</span><span class="n">lon</span><span class="p">)</span>
            <span class="k">elif</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">lon0</span><span class="p">,(</span><span class="nb">int</span><span class="p">,</span><span class="n">np</span><span class="o">.</span><span class="n">int</span><span class="p">,</span><span class="n">np</span><span class="o">.</span><span class="n">integer</span><span class="p">,</span><span class="nb">float</span><span class="p">,</span><span class="n">np</span><span class="o">.</span><span class="n">floating</span><span class="p">)):</span>
                <span class="n">msg</span> <span class="o">=</span> <span class="s1">&#39;lat/lon bounds must be of type float/int or None.&#39;</span>
                <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">lon1</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">lon1</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="n">NEW_STORM</span><span class="o">.</span><span class="n">lon</span><span class="p">)</span>
            <span class="k">elif</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">lon1</span><span class="p">,(</span><span class="nb">int</span><span class="p">,</span><span class="n">np</span><span class="o">.</span><span class="n">int</span><span class="p">,</span><span class="n">np</span><span class="o">.</span><span class="n">integer</span><span class="p">,</span><span class="nb">float</span><span class="p">,</span><span class="n">np</span><span class="o">.</span><span class="n">floating</span><span class="p">)):</span>
                <span class="n">msg</span> <span class="o">=</span> <span class="s1">&#39;lat/lon bounds must be of type float/int or None.&#39;</span>
                <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>
                
            <span class="n">tmplat</span><span class="p">,</span><span class="n">tmplon</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">NEW_STORM</span><span class="o">.</span><span class="n">lat</span><span class="p">),</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">NEW_STORM</span><span class="o">.</span><span class="n">lon</span><span class="p">)</span><span class="o">%</span><span class="mi">360</span>
            <span class="n">idx</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">((</span><span class="n">tmplat</span><span class="o">&gt;=</span><span class="n">lat0</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">tmplat</span><span class="o">&lt;=</span><span class="n">lat1</span><span class="p">)</span> <span class="o">&amp;</span> \
                           <span class="p">(</span><span class="n">tmplon</span><span class="o">&gt;=</span><span class="n">lon0</span><span class="o">%</span><span class="mi">360</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">tmplon</span><span class="o">&lt;=</span><span class="n">lon1</span><span class="o">%</span><span class="mi">360</span><span class="p">))[</span><span class="mi">0</span><span class="p">]</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">idx</span><span class="p">)</span><span class="o">==</span><span class="mi">0</span><span class="p">:</span>
                <span class="n">msg</span> <span class="o">=</span> <span class="sa">f</span><span class="s1">&#39;no points in </span><span class="si">{</span><span class="n">lat</span><span class="si">}</span><span class="s1">/</span><span class="si">{</span><span class="n">lon</span><span class="si">}</span><span class="s1"> box. Use different lat/lon bounds.&#39;</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>
                
        <span class="k">else</span><span class="p">:</span>
            <span class="n">msg</span> <span class="o">=</span> <span class="s1">&#39;lat and lon must be of the same type: float/int, tuple/list, or None.&#39;</span>
            <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>  

        <span class="c1">#update idx_final</span>
        <span class="n">idx_final</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="n">idx_final</span><span class="p">)</span> <span class="o">&amp;</span> <span class="nb">set</span><span class="p">(</span><span class="n">listify</span><span class="p">(</span><span class="n">idx</span><span class="p">)))</span>

        <span class="c1">#apply vmax filter</span>
        <span class="k">if</span> <span class="n">vmax</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">idx</span> <span class="o">=</span> <span class="n">copy</span><span class="o">.</span><span class="n">copy</span><span class="p">(</span><span class="n">idx_final</span><span class="p">)</span>
        
        <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">vmax</span><span class="p">,(</span><span class="nb">tuple</span><span class="p">,</span><span class="nb">list</span><span class="p">))</span> <span class="ow">and</span> <span class="nb">len</span><span class="p">(</span><span class="n">vmax</span><span class="p">)</span><span class="o">==</span><span class="mi">2</span><span class="p">:</span>
            <span class="n">vmax0</span><span class="p">,</span><span class="n">vmax1</span> <span class="o">=</span> <span class="n">vmax</span>
            <span class="k">if</span> <span class="n">vmax0</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">vmax0</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nanmin</span><span class="p">(</span><span class="n">NEW_STORM</span><span class="o">.</span><span class="n">vmax</span><span class="p">)</span>
            <span class="k">elif</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">vmax0</span><span class="p">,(</span><span class="nb">int</span><span class="p">,</span><span class="n">np</span><span class="o">.</span><span class="n">int</span><span class="p">,</span><span class="n">np</span><span class="o">.</span><span class="n">integer</span><span class="p">,</span><span class="nb">float</span><span class="p">,</span><span class="n">np</span><span class="o">.</span><span class="n">floating</span><span class="p">)):</span>
                <span class="n">msg</span> <span class="o">=</span> <span class="s1">&#39;vmax bounds must be of type float/int or None.&#39;</span>
                <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">vmax1</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">vmax1</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nanmax</span><span class="p">(</span><span class="n">NEW_STORM</span><span class="o">.</span><span class="n">vmax</span><span class="p">)</span>
            <span class="k">elif</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">vmax1</span><span class="p">,(</span><span class="nb">int</span><span class="p">,</span><span class="n">np</span><span class="o">.</span><span class="n">int</span><span class="p">,</span><span class="n">np</span><span class="o">.</span><span class="n">integer</span><span class="p">,</span><span class="nb">float</span><span class="p">,</span><span class="n">np</span><span class="o">.</span><span class="n">floating</span><span class="p">)):</span>
                <span class="n">msg</span> <span class="o">=</span> <span class="s1">&#39;vmax bounds must be of type float/int or None.&#39;</span>
                <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>            
            <span class="n">tmpvmax</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">NEW_STORM</span><span class="o">.</span><span class="n">vmax</span><span class="p">)</span>
            <span class="n">idx</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">((</span><span class="n">tmpvmax</span><span class="o">&gt;=</span><span class="n">vmax0</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">tmpvmax</span><span class="o">&lt;=</span><span class="n">vmax1</span><span class="p">))[</span><span class="mi">0</span><span class="p">]</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">idx</span><span class="p">)</span><span class="o">==</span><span class="mi">0</span><span class="p">:</span>
                <span class="n">msg</span> <span class="o">=</span> <span class="sa">f</span><span class="s1">&#39;no points with vmax between </span><span class="si">{</span><span class="n">vmax</span><span class="si">}</span><span class="s1">. Use different vmax bounds.&#39;</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>
                
        <span class="k">else</span><span class="p">:</span>
            <span class="n">msg</span> <span class="o">=</span> <span class="s1">&#39;vmax must be of type tuple/list, or None.&#39;</span>
            <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>

        <span class="c1">#update idx_final</span>
        <span class="n">idx_final</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="n">idx_final</span><span class="p">)</span> <span class="o">&amp;</span> <span class="nb">set</span><span class="p">(</span><span class="n">listify</span><span class="p">(</span><span class="n">idx</span><span class="p">)))</span>

        <span class="c1">#apply mslp filter</span>
        <span class="k">if</span> <span class="n">mslp</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">idx</span> <span class="o">=</span> <span class="n">copy</span><span class="o">.</span><span class="n">copy</span><span class="p">(</span><span class="n">idx_final</span><span class="p">)</span>
        
        <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">mslp</span><span class="p">,(</span><span class="nb">tuple</span><span class="p">,</span><span class="nb">list</span><span class="p">))</span> <span class="ow">and</span> <span class="nb">len</span><span class="p">(</span><span class="n">mslp</span><span class="p">)</span><span class="o">==</span><span class="mi">2</span><span class="p">:</span>
            <span class="n">mslp0</span><span class="p">,</span><span class="n">mslp1</span> <span class="o">=</span> <span class="n">mslp</span>
            <span class="k">if</span> <span class="n">mslp0</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">mslp0</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nanmin</span><span class="p">(</span><span class="n">NEW_STORM</span><span class="o">.</span><span class="n">mslp</span><span class="p">)</span>
            <span class="k">elif</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">mslp0</span><span class="p">,(</span><span class="nb">int</span><span class="p">,</span><span class="n">np</span><span class="o">.</span><span class="n">int</span><span class="p">,</span><span class="n">np</span><span class="o">.</span><span class="n">integer</span><span class="p">,</span><span class="nb">float</span><span class="p">,</span><span class="n">np</span><span class="o">.</span><span class="n">floating</span><span class="p">)):</span>
                <span class="n">msg</span> <span class="o">=</span> <span class="s1">&#39;mslp bounds must be of type float/int or None.&#39;</span>
                <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">mslp1</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">mslp1</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nanmax</span><span class="p">(</span><span class="n">NEW_STORM</span><span class="o">.</span><span class="n">mslp</span><span class="p">)</span>
            <span class="k">elif</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">mslp1</span><span class="p">,(</span><span class="nb">int</span><span class="p">,</span><span class="n">np</span><span class="o">.</span><span class="n">int</span><span class="p">,</span><span class="n">np</span><span class="o">.</span><span class="n">integer</span><span class="p">,</span><span class="nb">float</span><span class="p">,</span><span class="n">np</span><span class="o">.</span><span class="n">floating</span><span class="p">)):</span>
                <span class="n">msg</span> <span class="o">=</span> <span class="s1">&#39;mslp bounds must be of type float/int or None.&#39;</span>
                <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>            
            <span class="n">tmpmslp</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">NEW_STORM</span><span class="o">.</span><span class="n">mslp</span><span class="p">)</span>
            <span class="n">idx</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">((</span><span class="n">tmpmslp</span><span class="o">&gt;=</span><span class="n">mslp0</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">tmpmslp</span><span class="o">&lt;=</span><span class="n">mslp1</span><span class="p">))[</span><span class="mi">0</span><span class="p">]</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">idx</span><span class="p">)</span><span class="o">==</span><span class="mi">0</span><span class="p">:</span>
                <span class="n">msg</span> <span class="o">=</span> <span class="sa">f</span><span class="s1">&#39;no points with mslp between </span><span class="si">{</span><span class="n">mslp</span><span class="si">}</span><span class="s1">. Use different dmslp_dt bounds.&#39;</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>
                
        <span class="k">else</span><span class="p">:</span>
            <span class="n">msg</span> <span class="o">=</span> <span class="s1">&#39;vmax must be of type tuple/list, or None.&#39;</span>
            <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>

        <span class="c1">#update idx_final</span>
        <span class="n">idx_final</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="n">idx_final</span><span class="p">)</span> <span class="o">&amp;</span> <span class="nb">set</span><span class="p">(</span><span class="n">listify</span><span class="p">(</span><span class="n">idx</span><span class="p">)))</span>

        <span class="c1">#apply dvmax_dt filter</span>
        <span class="k">if</span> <span class="n">dvmax_dt</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">idx</span> <span class="o">=</span> <span class="n">copy</span><span class="o">.</span><span class="n">copy</span><span class="p">(</span><span class="n">idx_final</span><span class="p">)</span>
        
        <span class="k">elif</span> <span class="s1">&#39;dvmax_dt&#39;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">NEW_STORM</span><span class="o">.</span><span class="n">dict</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
            <span class="n">msg</span> <span class="o">=</span> <span class="sa">f</span><span class="s1">&#39;dvmax_dt not in storm data. Create new object with interp first.&#39;</span>
            <span class="k">raise</span> <span class="ne">KeyError</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>            
        
        <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">dvmax_dt</span><span class="p">,(</span><span class="nb">tuple</span><span class="p">,</span><span class="nb">list</span><span class="p">))</span> <span class="ow">and</span> <span class="nb">len</span><span class="p">(</span><span class="n">dvmax_dt</span><span class="p">)</span><span class="o">==</span><span class="mi">2</span><span class="p">:</span>
            <span class="n">dvmax_dt0</span><span class="p">,</span><span class="n">dvmax_dt1</span> <span class="o">=</span> <span class="n">dvmax_dt</span>
            <span class="k">if</span> <span class="n">dvmax_dt0</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">dvmax_dt0</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nanmin</span><span class="p">(</span><span class="n">NEW_STORM</span><span class="o">.</span><span class="n">dvmax_dt</span><span class="p">)</span>
            <span class="k">elif</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">dvmax_dt0</span><span class="p">,(</span><span class="nb">int</span><span class="p">,</span><span class="n">np</span><span class="o">.</span><span class="n">int</span><span class="p">,</span><span class="n">np</span><span class="o">.</span><span class="n">integer</span><span class="p">,</span><span class="nb">float</span><span class="p">,</span><span class="n">np</span><span class="o">.</span><span class="n">floating</span><span class="p">)):</span>
                <span class="n">msg</span> <span class="o">=</span> <span class="s1">&#39;dmslp_dt bounds must be of type float/int or None.&#39;</span>
                <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">dvmax_dt1</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">dvmax_dt1</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nanmax</span><span class="p">(</span><span class="n">NEW_STORM</span><span class="o">.</span><span class="n">dvmax_dt</span><span class="p">)</span>
            <span class="k">elif</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">dvmax_dt1</span><span class="p">,(</span><span class="nb">int</span><span class="p">,</span><span class="n">np</span><span class="o">.</span><span class="n">int</span><span class="p">,</span><span class="n">np</span><span class="o">.</span><span class="n">integer</span><span class="p">,</span><span class="nb">float</span><span class="p">,</span><span class="n">np</span><span class="o">.</span><span class="n">floating</span><span class="p">)):</span>
                <span class="n">msg</span> <span class="o">=</span> <span class="s1">&#39;dmslp_dt bounds must be of type float/int or None.&#39;</span>
                <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>     
                        
            <span class="n">tmpvmax</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">NEW_STORM</span><span class="o">.</span><span class="n">dvmax_dt</span><span class="p">)</span>
            <span class="n">idx</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">((</span><span class="n">tmpvmax</span><span class="o">&gt;=</span><span class="n">dvmax_dt0</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">tmpvmax</span><span class="o">&lt;=</span><span class="n">dvmax_dt1</span><span class="p">))[</span><span class="mi">0</span><span class="p">]</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">idx</span><span class="p">)</span><span class="o">==</span><span class="mi">0</span><span class="p">:</span>
                <span class="n">msg</span> <span class="o">=</span> <span class="sa">f</span><span class="s1">&#39;no points with dvmax_dt between </span><span class="si">{</span><span class="n">dvmax_dt</span><span class="si">}</span><span class="s1">. Use different dvmax_dt bounds.&#39;</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>

        <span class="c1">#update idx_final</span>
        <span class="n">idx_final</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="n">idx_final</span><span class="p">)</span> <span class="o">&amp;</span> <span class="nb">set</span><span class="p">(</span><span class="n">listify</span><span class="p">(</span><span class="n">idx</span><span class="p">)))</span>

        <span class="c1">#apply dmslp_dt filter</span>
        <span class="k">if</span> <span class="n">dmslp_dt</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">idx</span> <span class="o">=</span> <span class="n">copy</span><span class="o">.</span><span class="n">copy</span><span class="p">(</span><span class="n">idx_final</span><span class="p">)</span>
            
        <span class="k">elif</span> <span class="s1">&#39;dmslp_dt&#39;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">NEW_STORM</span><span class="o">.</span><span class="n">dict</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
            <span class="n">msg</span> <span class="o">=</span> <span class="sa">f</span><span class="s1">&#39;dmslp_dt not in storm data. Create new object with interp first.&#39;</span>
            <span class="k">raise</span> <span class="ne">KeyError</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>   
            
        <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">dmslp_dt</span><span class="p">,(</span><span class="nb">tuple</span><span class="p">,</span><span class="nb">list</span><span class="p">))</span> <span class="ow">and</span> <span class="nb">len</span><span class="p">(</span><span class="n">dmslp_dt</span><span class="p">)</span><span class="o">==</span><span class="mi">2</span><span class="p">:</span>
            <span class="n">dmslp_dt0</span><span class="p">,</span><span class="n">dmslp_dt1</span> <span class="o">=</span> <span class="n">dmslp_dt</span>
            <span class="k">if</span> <span class="n">dmslp_dt0</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">dmslp_dt0</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nanmin</span><span class="p">(</span><span class="n">NEW_STORM</span><span class="o">.</span><span class="n">dmslp_dt</span><span class="p">)</span>
            <span class="k">elif</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">dmslp_dt0</span><span class="p">,(</span><span class="nb">int</span><span class="p">,</span><span class="n">np</span><span class="o">.</span><span class="n">int</span><span class="p">,</span><span class="n">np</span><span class="o">.</span><span class="n">integer</span><span class="p">,</span><span class="nb">float</span><span class="p">,</span><span class="n">np</span><span class="o">.</span><span class="n">floating</span><span class="p">)):</span>
                <span class="n">msg</span> <span class="o">=</span> <span class="s1">&#39;dmslp_dt bounds must be of type float/int or None.&#39;</span>
                <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">dmslp_dt1</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">dmslp_dt1</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nanmax</span><span class="p">(</span><span class="n">NEW_STORM</span><span class="o">.</span><span class="n">dmslp_dt</span><span class="p">)</span>
            <span class="k">elif</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">dmslp_dt1</span><span class="p">,(</span><span class="nb">int</span><span class="p">,</span><span class="n">np</span><span class="o">.</span><span class="n">int</span><span class="p">,</span><span class="n">np</span><span class="o">.</span><span class="n">integer</span><span class="p">,</span><span class="nb">float</span><span class="p">,</span><span class="n">np</span><span class="o">.</span><span class="n">floating</span><span class="p">)):</span>
                <span class="n">msg</span> <span class="o">=</span> <span class="s1">&#39;dmslp_dt bounds must be of type float/int or None.&#39;</span>
                <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>            
            <span class="n">tmpmslp</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">NEW_STORM</span><span class="o">.</span><span class="n">dmslp_dt</span><span class="p">)</span>
            <span class="n">idx</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">((</span><span class="n">tmpmslp</span><span class="o">&gt;=</span><span class="n">dmslp_dt0</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">tmpmslp</span><span class="o">&lt;=</span><span class="n">dmslp_dt1</span><span class="p">))[</span><span class="mi">0</span><span class="p">]</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">idx</span><span class="p">)</span><span class="o">==</span><span class="mi">0</span><span class="p">:</span>
                <span class="n">msg</span> <span class="o">=</span> <span class="sa">f</span><span class="s1">&#39;no points with dmslp_dt between </span><span class="si">{</span><span class="n">dmslp_dt</span><span class="si">}</span><span class="s1">. Use different dmslp_dt bounds.&#39;</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>
                
        <span class="c1">#update idx_final</span>
        <span class="n">idx_final</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="n">idx_final</span><span class="p">)</span> <span class="o">&amp;</span> <span class="nb">set</span><span class="p">(</span><span class="n">listify</span><span class="p">(</span><span class="n">idx</span><span class="p">)))</span>

        <span class="c1">#apply stormtype filter</span>
        <span class="k">if</span> <span class="n">stormtype</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">idx</span> <span class="o">=</span> <span class="n">copy</span><span class="o">.</span><span class="n">copy</span><span class="p">(</span><span class="n">idx_final</span><span class="p">)</span>
        
        <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">stormtype</span><span class="p">,(</span><span class="nb">tuple</span><span class="p">,</span><span class="nb">list</span><span class="p">,</span><span class="nb">str</span><span class="p">)):</span>
            <span class="n">idx</span> <span class="o">=</span> <span class="p">[</span><span class="n">i</span> <span class="k">for</span> <span class="n">i</span><span class="p">,</span><span class="n">j</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">NEW_STORM</span><span class="o">.</span><span class="n">type</span><span class="p">)</span> <span class="k">if</span> <span class="n">j</span> <span class="ow">in</span> <span class="n">listify</span><span class="p">(</span><span class="n">stormtype</span><span class="p">)]</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">idx</span><span class="p">)</span><span class="o">==</span><span class="mi">0</span><span class="p">:</span>
                <span class="n">msg</span> <span class="o">=</span> <span class="sa">f</span><span class="s1">&#39;no points with type </span><span class="si">{</span><span class="n">stormtype</span><span class="si">}</span><span class="s1">. Use different stormtype.&#39;</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>
                
        <span class="k">else</span><span class="p">:</span>
            <span class="n">msg</span> <span class="o">=</span> <span class="s1">&#39;stormtype must be of type tuple/list, str, or None.&#39;</span>
            <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>
        
        <span class="c1">#update idx_final</span>
        <span class="n">idx_final</span> <span class="o">=</span> <span class="nb">sorted</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="n">idx_final</span><span class="p">)</span> <span class="o">&amp;</span> <span class="nb">set</span><span class="p">(</span><span class="n">listify</span><span class="p">(</span><span class="n">idx</span><span class="p">))))</span>

        <span class="c1">#Construct new storm dict with subset elements</span>
        <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="n">NEW_STORM</span><span class="o">.</span><span class="n">dict</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">NEW_STORM</span><span class="o">.</span><span class="n">dict</span><span class="p">[</span><span class="n">key</span><span class="p">],</span> <span class="nb">list</span><span class="p">):</span>
                <span class="n">NEW_STORM</span><span class="o">.</span><span class="n">dict</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="n">NEW_STORM</span><span class="o">.</span><span class="n">dict</span><span class="p">[</span><span class="n">key</span><span class="p">][</span><span class="n">i</span><span class="p">]</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">idx_final</span><span class="p">]</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">NEW_STORM</span><span class="o">.</span><span class="n">dict</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="n">NEW_STORM</span><span class="o">.</span><span class="n">dict</span><span class="p">[</span><span class="n">key</span><span class="p">]</span>
            
            <span class="c1">#Add other attributes to new storm object</span>
            <span class="k">if</span> <span class="n">key</span> <span class="o">==</span> <span class="s1">&#39;realtime&#39;</span><span class="p">:</span> <span class="k">continue</span>
            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">NEW_STORM</span><span class="o">.</span><span class="n">dict</span><span class="p">[</span><span class="n">key</span><span class="p">],</span> <span class="nb">list</span><span class="p">)</span> <span class="o">==</span> <span class="kc">False</span> <span class="ow">and</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">NEW_STORM</span><span class="o">.</span><span class="n">dict</span><span class="p">[</span><span class="n">key</span><span class="p">],</span> <span class="nb">dict</span><span class="p">)</span> <span class="o">==</span> <span class="kc">False</span><span class="p">:</span>
                <span class="n">NEW_STORM</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="n">NEW_STORM</span><span class="o">.</span><span class="n">dict</span><span class="p">[</span><span class="n">key</span><span class="p">]</span>
                <span class="n">NEW_STORM</span><span class="o">.</span><span class="n">attrs</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="n">NEW_STORM</span><span class="o">.</span><span class="n">dict</span><span class="p">[</span><span class="n">key</span><span class="p">]</span>
            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">NEW_STORM</span><span class="o">.</span><span class="n">dict</span><span class="p">[</span><span class="n">key</span><span class="p">],</span> <span class="nb">list</span><span class="p">)</span> <span class="o">==</span> <span class="kc">True</span> <span class="ow">and</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">NEW_STORM</span><span class="o">.</span><span class="n">dict</span><span class="p">[</span><span class="n">key</span><span class="p">],</span> <span class="nb">dict</span><span class="p">)</span> <span class="o">==</span> <span class="kc">False</span><span class="p">:</span>
                <span class="n">NEW_STORM</span><span class="o">.</span><span class="n">vars</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">NEW_STORM</span><span class="o">.</span><span class="n">dict</span><span class="p">[</span><span class="n">key</span><span class="p">])</span>
                <span class="n">NEW_STORM</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">NEW_STORM</span><span class="o">.</span><span class="n">dict</span><span class="p">[</span><span class="n">key</span><span class="p">])</span>                
                
        <span class="k">return</span> <span class="n">NEW_STORM</span></div>

<div class="viewcode-block" id="Storm.interp"><a class="viewcode-back" href="../../../api/generated/tropycal.tracks.Storm.interp.html#tropycal.tracks.Storm.interp">[docs]</a>    <span class="k">def</span> <span class="nf">interp</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">timeres</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span><span class="n">dt_window</span><span class="o">=</span><span class="mi">24</span><span class="p">,</span><span class="n">dt_align</span><span class="o">=</span><span class="s1">&#39;middle&#39;</span><span class="p">):</span>
        
        <span class="sa">r</span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Interpolate a storm temporally to a specified time resolution.</span>
<span class="sd">        </span>
<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        timeres : int</span>
<span class="sd">            Temporal resolution in hours to interpolate storm data to. Default is 1 hour.</span>
<span class="sd">        dt_window : int</span>
<span class="sd">            Time window in hours over which to calculate temporal change data. Default is 24 hours.</span>
<span class="sd">        dt_align : str</span>
<span class="sd">            Whether to align the temporal change window as &quot;start&quot;, &quot;middle&quot; or &quot;end&quot; of the dt_window time period.</span>
<span class="sd">        </span>
<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        tropycal.tracks.Storm</span>
<span class="sd">            New Storm object containing the updated dictionary.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        
        <span class="n">NEW_STORM</span> <span class="o">=</span> <span class="n">copy</span><span class="o">.</span><span class="n">deepcopy</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
        <span class="n">newdict</span> <span class="o">=</span> <span class="n">interp_storm</span><span class="p">(</span><span class="n">NEW_STORM</span><span class="o">.</span><span class="n">dict</span><span class="p">,</span><span class="n">timeres</span><span class="p">,</span><span class="n">dt_window</span><span class="p">,</span><span class="n">dt_align</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="n">newdict</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span> 
            <span class="n">NEW_STORM</span><span class="o">.</span><span class="n">dict</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="n">newdict</span><span class="p">[</span><span class="n">key</span><span class="p">]</span>

        <span class="c1">#Add other attributes to new storm object</span>
        <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="n">NEW_STORM</span><span class="o">.</span><span class="n">dict</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
            <span class="k">if</span> <span class="n">key</span> <span class="o">==</span> <span class="s1">&#39;realtime&#39;</span><span class="p">:</span> <span class="k">continue</span>
            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">NEW_STORM</span><span class="o">.</span><span class="n">dict</span><span class="p">[</span><span class="n">key</span><span class="p">],</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span><span class="nb">list</span><span class="p">))</span> <span class="o">==</span> <span class="kc">False</span> <span class="ow">and</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">NEW_STORM</span><span class="o">.</span><span class="n">dict</span><span class="p">[</span><span class="n">key</span><span class="p">],</span> <span class="nb">dict</span><span class="p">)</span> <span class="o">==</span> <span class="kc">False</span><span class="p">:</span>
                <span class="n">NEW_STORM</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="n">NEW_STORM</span><span class="o">.</span><span class="n">dict</span><span class="p">[</span><span class="n">key</span><span class="p">]</span>
                <span class="n">NEW_STORM</span><span class="o">.</span><span class="n">attrs</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="n">NEW_STORM</span><span class="o">.</span><span class="n">dict</span><span class="p">[</span><span class="n">key</span><span class="p">]</span>
            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">NEW_STORM</span><span class="o">.</span><span class="n">dict</span><span class="p">[</span><span class="n">key</span><span class="p">],</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span><span class="nb">list</span><span class="p">))</span> <span class="o">==</span> <span class="kc">True</span> <span class="ow">and</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">NEW_STORM</span><span class="o">.</span><span class="n">dict</span><span class="p">[</span><span class="n">key</span><span class="p">],</span> <span class="nb">dict</span><span class="p">)</span> <span class="o">==</span> <span class="kc">False</span><span class="p">:</span>
                <span class="n">NEW_STORM</span><span class="o">.</span><span class="n">dict</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">NEW_STORM</span><span class="o">.</span><span class="n">dict</span><span class="p">[</span><span class="n">key</span><span class="p">])</span>
                <span class="n">NEW_STORM</span><span class="o">.</span><span class="n">vars</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">NEW_STORM</span><span class="o">.</span><span class="n">dict</span><span class="p">[</span><span class="n">key</span><span class="p">])</span>
                <span class="n">NEW_STORM</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">NEW_STORM</span><span class="o">.</span><span class="n">dict</span><span class="p">[</span><span class="n">key</span><span class="p">])</span>
                
        <span class="k">return</span> <span class="n">NEW_STORM</span></div>

<div class="viewcode-block" id="Storm.to_dict"><a class="viewcode-back" href="../../../api/generated/tropycal.tracks.Storm.to_dict.html#tropycal.tracks.Storm.to_dict">[docs]</a>    <span class="k">def</span> <span class="nf">to_dict</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        
        <span class="sa">r</span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Returns the dict entry for the storm.</span>
<span class="sd">        </span>
<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        dict</span>
<span class="sd">            A dictionary containing information about the storm.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        
        <span class="c1">#Return dict</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">dict</span></div>
        
<div class="viewcode-block" id="Storm.to_xarray"><a class="viewcode-back" href="../../../api/generated/tropycal.tracks.Storm.to_xarray.html#tropycal.tracks.Storm.to_xarray">[docs]</a>    <span class="k">def</span> <span class="nf">to_xarray</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        
        <span class="sa">r</span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Converts the storm dict into an xarray Dataset object.</span>
<span class="sd">        </span>
<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        xarray.Dataset</span>
<span class="sd">            An xarray Dataset object containing information about the storm.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        
        <span class="c1">#Try importing xarray</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="kn">import</span> <span class="nn">xarray</span> <span class="k">as</span> <span class="nn">xr</span>
        <span class="k">except</span> <span class="ne">ImportError</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span><span class="s2">&quot;Error: xarray is not available. Install xarray in order to use this function.&quot;</span><span class="p">)</span> <span class="kn">from</span> <span class="nn">e</span>
            
        <span class="c1">#Set up empty dict for dataset</span>
        <span class="n">time</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">dict</span><span class="p">[</span><span class="s1">&#39;date&#39;</span><span class="p">]</span>
        <span class="n">ds</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="n">attrs</span> <span class="o">=</span> <span class="p">{}</span>
        
        <span class="c1">#Add every key containing a list into the dict, otherwise add as an attribute</span>
        <span class="n">keys</span> <span class="o">=</span> <span class="p">[</span><span class="n">k</span> <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">dict</span><span class="o">.</span><span class="n">keys</span><span class="p">()</span> <span class="k">if</span> <span class="n">k</span> <span class="o">!=</span> <span class="s1">&#39;date&#39;</span><span class="p">]</span>
        <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="n">keys</span><span class="p">:</span>
            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">dict</span><span class="p">[</span><span class="n">key</span><span class="p">],</span> <span class="nb">list</span><span class="p">):</span>
                <span class="n">ds</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="n">xr</span><span class="o">.</span><span class="n">DataArray</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">dict</span><span class="p">[</span><span class="n">key</span><span class="p">],</span><span class="n">coords</span><span class="o">=</span><span class="p">[</span><span class="n">time</span><span class="p">],</span><span class="n">dims</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;time&#39;</span><span class="p">])</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">attrs</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">dict</span><span class="p">[</span><span class="n">key</span><span class="p">]</span>
                    
        <span class="c1">#Convert entire dict to a Dataset</span>
        <span class="n">ds</span> <span class="o">=</span> <span class="n">xr</span><span class="o">.</span><span class="n">Dataset</span><span class="p">(</span><span class="n">ds</span><span class="p">,</span><span class="n">attrs</span><span class="o">=</span><span class="n">attrs</span><span class="p">)</span>

        <span class="c1">#Return dataset</span>
        <span class="k">return</span> <span class="n">ds</span></div>

<div class="viewcode-block" id="Storm.to_dataframe"><a class="viewcode-back" href="../../../api/generated/tropycal.tracks.Storm.to_dataframe.html#tropycal.tracks.Storm.to_dataframe">[docs]</a>    <span class="k">def</span> <span class="nf">to_dataframe</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">attrs_as_columns</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
        
        <span class="sa">r</span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Converts the storm dict into a pandas DataFrame object.</span>
<span class="sd">        </span>
<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        attrs_as_columns : bool</span>
<span class="sd">            If True, adds Storm object attributes as columns in the DataFrame returned. Default is False.</span>
<span class="sd">        </span>
<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        pandas.DataFrame</span>
<span class="sd">            A pandas DataFrame object containing information about the storm.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        
        <span class="c1">#Try importing pandas</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>
        <span class="k">except</span> <span class="ne">ImportError</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span><span class="s2">&quot;Error: pandas is not available. Install pandas in order to use this function.&quot;</span><span class="p">)</span> <span class="kn">from</span> <span class="nn">e</span>
            
        <span class="c1">#Set up empty dict for dataframe</span>
        <span class="n">time</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">dict</span><span class="p">[</span><span class="s1">&#39;date&#39;</span><span class="p">]</span>
        <span class="n">ds</span> <span class="o">=</span> <span class="p">{}</span>
        
        <span class="c1">#Add every key containing a list into the dict</span>
        <span class="n">keys</span> <span class="o">=</span> <span class="p">[</span><span class="n">k</span> <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">dict</span><span class="o">.</span><span class="n">keys</span><span class="p">()]</span>
        <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="n">keys</span><span class="p">:</span>
            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">dict</span><span class="p">[</span><span class="n">key</span><span class="p">],</span> <span class="nb">list</span><span class="p">):</span>
                <span class="n">ds</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">dict</span><span class="p">[</span><span class="n">key</span><span class="p">]</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">attrs_as_columns</span><span class="p">:</span>
                    <span class="n">ds</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">dict</span><span class="p">[</span><span class="n">key</span><span class="p">]</span>

        <span class="c1">#Convert entire dict to a DataFrame</span>
        <span class="n">ds</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">ds</span><span class="p">)</span>

        <span class="c1">#Return dataset</span>
        <span class="k">return</span> <span class="n">ds</span></div>
    
<div class="viewcode-block" id="Storm.plot"><a class="viewcode-back" href="../../../api/generated/tropycal.tracks.Storm.plot.html#tropycal.tracks.Storm.plot">[docs]</a>    <span class="k">def</span> <span class="nf">plot</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">domain</span><span class="o">=</span><span class="s2">&quot;dynamic&quot;</span><span class="p">,</span><span class="n">plot_all_dots</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span><span class="n">ax</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span><span class="n">cartopy_proj</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span><span class="n">save_path</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span><span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        
        <span class="sa">r</span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Creates a plot of the observed track of the storm.</span>
<span class="sd">        </span>
<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        domain : str</span>
<span class="sd">            Domain for the plot. Default is &quot;dynamic&quot;. &quot;dynamic_tropical&quot; is also available. Please refer to :ref:`options-domain` for available domain options.</span>
<span class="sd">        plot_all_dots : bool</span>
<span class="sd">            Whether to plot dots for all observations along the track. If false, dots will be plotted every 6 hours. Default is false.</span>
<span class="sd">        ax : axes</span>
<span class="sd">            Instance of axes to plot on. If none, one will be generated. Default is none.</span>
<span class="sd">        cartopy_proj : ccrs</span>
<span class="sd">            Instance of a cartopy projection to use. If none, one will be generated. Default is none.</span>
<span class="sd">        save_path : str</span>
<span class="sd">            Relative or full path of directory to save the image in. If none, image will not be saved.</span>
<span class="sd">        </span>
<span class="sd">        Other Parameters</span>
<span class="sd">        ----------------</span>
<span class="sd">        prop : dict</span>
<span class="sd">            Customization properties of storm track lines. Please refer to :ref:`options-prop` for available options.</span>
<span class="sd">        map_prop : dict</span>
<span class="sd">            Customization properties of Cartopy map. Please refer to :ref:`options-map-prop` for available options.</span>
<span class="sd">        </span>
<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        ax</span>
<span class="sd">            Instance of axes containing the plot is returned.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        
        <span class="c1">#Retrieve kwargs</span>
        <span class="n">prop</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;prop&#39;</span><span class="p">,{})</span>
        <span class="n">map_prop</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;map_prop&#39;</span><span class="p">,{})</span>
        
        <span class="c1">#Create instance of plot object</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">plot_obj</span>
        <span class="k">except</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">plot_obj</span> <span class="o">=</span> <span class="n">TrackPlot</span><span class="p">()</span>
        
        <span class="c1">#Create cartopy projection</span>
        <span class="k">if</span> <span class="n">cartopy_proj</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">plot_obj</span><span class="o">.</span><span class="n">proj</span> <span class="o">=</span> <span class="n">cartopy_proj</span>
        <span class="k">elif</span> <span class="nb">max</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">dict</span><span class="p">[</span><span class="s1">&#39;lon&#39;</span><span class="p">])</span> <span class="o">&gt;</span> <span class="mi">150</span> <span class="ow">or</span> <span class="nb">min</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">dict</span><span class="p">[</span><span class="s1">&#39;lon&#39;</span><span class="p">])</span> <span class="o">&lt;</span> <span class="o">-</span><span class="mi">150</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">plot_obj</span><span class="o">.</span><span class="n">create_cartopy</span><span class="p">(</span><span class="n">proj</span><span class="o">=</span><span class="s1">&#39;PlateCarree&#39;</span><span class="p">,</span><span class="n">central_longitude</span><span class="o">=</span><span class="mf">180.0</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">plot_obj</span><span class="o">.</span><span class="n">create_cartopy</span><span class="p">(</span><span class="n">proj</span><span class="o">=</span><span class="s1">&#39;PlateCarree&#39;</span><span class="p">,</span><span class="n">central_longitude</span><span class="o">=</span><span class="mf">0.0</span><span class="p">)</span>
            
        <span class="c1">#Plot storm</span>
        <span class="n">plot_ax</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">plot_obj</span><span class="o">.</span><span class="n">plot_storms</span><span class="p">([</span><span class="bp">self</span><span class="o">.</span><span class="n">dict</span><span class="p">],</span><span class="n">domain</span><span class="p">,</span><span class="n">plot_all_dots</span><span class="o">=</span><span class="n">plot_all_dots</span><span class="p">,</span><span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">,</span><span class="n">prop</span><span class="o">=</span><span class="n">prop</span><span class="p">,</span><span class="n">map_prop</span><span class="o">=</span><span class="n">map_prop</span><span class="p">,</span><span class="n">save_path</span><span class="o">=</span><span class="n">save_path</span><span class="p">)</span>
        
        <span class="c1">#Return axis</span>
        <span class="k">return</span> <span class="n">plot_ax</span></div>
        
    <span class="c1">#PLOT FUNCTION FOR HURDAT</span>
<div class="viewcode-block" id="Storm.plot_nhc_forecast"><a class="viewcode-back" href="../../../api/generated/tropycal.tracks.Storm.plot_nhc_forecast.html#tropycal.tracks.Storm.plot_nhc_forecast">[docs]</a>    <span class="k">def</span> <span class="nf">plot_nhc_forecast</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">forecast</span><span class="p">,</span><span class="n">track_labels</span><span class="o">=</span><span class="s1">&#39;fhr&#39;</span><span class="p">,</span><span class="n">cone_days</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span><span class="n">domain</span><span class="o">=</span><span class="s2">&quot;dynamic_forecast&quot;</span><span class="p">,</span>
                          <span class="n">ax</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span><span class="n">cartopy_proj</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span><span class="n">save_path</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span><span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        
        <span class="sa">r</span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Creates a plot of the operational NHC forecast track along with observed track data.</span>
<span class="sd">        </span>
<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        forecast : int or datetime.datetime</span>
<span class="sd">            Integer representing the forecast number, or datetime object for the closest issued forecast to this date.</span>
<span class="sd">        track_labels : str</span>
<span class="sd">            Label forecast hours with the following methods:</span>
<span class="sd">            </span>
<span class="sd">            * **&quot;&quot;** = no label</span>
<span class="sd">            * **&quot;fhr&quot;** = forecast hour (default)</span>
<span class="sd">            * **&quot;valid_utc&quot;** = UTC valid time</span>
<span class="sd">            * **&quot;valid_edt&quot;** = EDT valid time</span>
<span class="sd">        cone_days : int</span>
<span class="sd">            Number of days to plot the forecast cone. Default is 5 days. Can select 2, 3, 4 or 5 days.</span>
<span class="sd">        domain : str</span>
<span class="sd">            Domain for the plot. Default is &quot;dynamic_forecast&quot;. Please refer to :ref:`options-domain` for available domain options.</span>
<span class="sd">        ax : axes</span>
<span class="sd">            Instance of axes to plot on. If none, one will be generated. Default is none.</span>
<span class="sd">        cartopy_proj : ccrs</span>
<span class="sd">            Instance of a cartopy projection to use. If none, one will be generated. Default is none.</span>
<span class="sd">        save_path : str</span>
<span class="sd">            Relative or full path of directory to save the image in. If none, image will not be saved.</span>
<span class="sd">        </span>
<span class="sd">        Other Parameters</span>
<span class="sd">        ----------------</span>
<span class="sd">        prop : dict</span>
<span class="sd">            Customization properties of NHC forecast plot. Please refer to :ref:`options-prop-nhc` for available options.</span>
<span class="sd">        map_prop : dict</span>
<span class="sd">            Customization properties of Cartopy map. Please refer to :ref:`options-map-prop` for available options.</span>
<span class="sd">        </span>
<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        ax</span>
<span class="sd">            Instance of axes containing the plot is returned.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        
        <span class="c1">#Retrieve kwargs</span>
        <span class="n">prop</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;prop&#39;</span><span class="p">,{})</span>
        <span class="n">map_prop</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;map_prop&#39;</span><span class="p">,{})</span>
        
        <span class="c1">#Check to ensure the data source is HURDAT</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">source</span> <span class="o">!=</span> <span class="s2">&quot;hurdat&quot;</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span><span class="s2">&quot;Error: NHC data can only be accessed when HURDAT is used as the data source.&quot;</span><span class="p">)</span>
        
        <span class="c1">#Check to ensure storm is not an invest</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">invest</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span><span class="s2">&quot;Error: NHC does not issue advisories for invests that have not been designated as Potential Tropical Cyclones.&quot;</span><span class="p">)</span>
        
        <span class="c1">#Create instance of plot object</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">plot_obj</span>
        <span class="k">except</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">plot_obj</span> <span class="o">=</span> <span class="n">TrackPlot</span><span class="p">()</span>
        
        <span class="c1">#Create cartopy projection</span>
        <span class="k">if</span> <span class="n">cartopy_proj</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">if</span> <span class="nb">max</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">dict</span><span class="p">[</span><span class="s1">&#39;lon&#39;</span><span class="p">])</span> <span class="o">&gt;</span> <span class="mi">140</span> <span class="ow">or</span> <span class="nb">min</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">dict</span><span class="p">[</span><span class="s1">&#39;lon&#39;</span><span class="p">])</span> <span class="o">&lt;</span> <span class="o">-</span><span class="mi">140</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">plot_obj</span><span class="o">.</span><span class="n">create_cartopy</span><span class="p">(</span><span class="n">proj</span><span class="o">=</span><span class="s1">&#39;PlateCarree&#39;</span><span class="p">,</span><span class="n">central_longitude</span><span class="o">=</span><span class="mf">180.0</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">plot_obj</span><span class="o">.</span><span class="n">create_cartopy</span><span class="p">(</span><span class="n">proj</span><span class="o">=</span><span class="s1">&#39;PlateCarree&#39;</span><span class="p">,</span><span class="n">central_longitude</span><span class="o">=</span><span class="mf">0.0</span><span class="p">)</span>
            
        <span class="c1">#Get forecasts dict saved into storm object, if it hasn&#39;t been already</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">forecast_dict</span>
        <span class="k">except</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">get_operational_forecasts</span><span class="p">()</span>

        <span class="c1">#Get all NHC forecast entries</span>
        <span class="n">nhc_forecasts</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">forecast_dict</span><span class="p">[</span><span class="s1">&#39;OFCL&#39;</span><span class="p">]</span>
        <span class="n">carq_forecasts</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">forecast_dict</span><span class="p">[</span><span class="s1">&#39;CARQ&#39;</span><span class="p">]</span>

        <span class="c1">#Get list of all NHC forecast initializations</span>
        <span class="n">nhc_forecast_init</span> <span class="o">=</span> <span class="p">[</span><span class="n">k</span> <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="n">nhc_forecasts</span><span class="o">.</span><span class="n">keys</span><span class="p">()]</span>
        <span class="n">carq_forecast_init</span> <span class="o">=</span> <span class="p">[</span><span class="n">k</span> <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="n">carq_forecasts</span><span class="o">.</span><span class="n">keys</span><span class="p">()]</span>

        <span class="c1">#Find closest matching time to the provided forecast date, or time</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">forecast</span><span class="p">,</span><span class="nb">int</span><span class="p">):</span>
            <span class="n">forecast_dict</span> <span class="o">=</span> <span class="n">nhc_forecasts</span><span class="p">[</span><span class="n">nhc_forecast_init</span><span class="p">[</span><span class="n">forecast</span><span class="o">-</span><span class="mi">1</span><span class="p">]]</span>
            <span class="n">advisory_num</span> <span class="o">=</span> <span class="n">forecast</span><span class="o">+</span><span class="mi">0</span>
        <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">forecast</span><span class="p">,</span><span class="n">dt</span><span class="p">):</span>
            <span class="n">nhc_forecast_init_dt</span> <span class="o">=</span> <span class="p">[</span><span class="n">dt</span><span class="o">.</span><span class="n">strptime</span><span class="p">(</span><span class="n">k</span><span class="p">,</span><span class="s1">&#39;%Y%m</span><span class="si">%d</span><span class="s1">%H&#39;</span><span class="p">)</span> <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="n">nhc_forecast_init</span><span class="p">]</span>
            <span class="n">time_diff</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([(</span><span class="n">i</span><span class="o">-</span><span class="n">forecast</span><span class="p">)</span><span class="o">.</span><span class="n">days</span> <span class="o">+</span> <span class="p">(</span><span class="n">i</span><span class="o">-</span><span class="n">forecast</span><span class="p">)</span><span class="o">.</span><span class="n">seconds</span><span class="o">/</span><span class="mi">86400</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">nhc_forecast_init_dt</span><span class="p">])</span>
            <span class="n">closest_idx</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">time_diff</span><span class="p">)</span><span class="o">.</span><span class="n">argmin</span><span class="p">()</span>
            <span class="n">forecast_dict</span> <span class="o">=</span> <span class="n">nhc_forecasts</span><span class="p">[</span><span class="n">nhc_forecast_init</span><span class="p">[</span><span class="n">closest_idx</span><span class="p">]]</span>
            <span class="n">advisory_num</span> <span class="o">=</span> <span class="n">closest_idx</span><span class="o">+</span><span class="mi">1</span>
            <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">time_diff</span><span class="p">[</span><span class="n">closest_idx</span><span class="p">])</span> <span class="o">&gt;=</span> <span class="mf">1.0</span><span class="p">:</span>
                <span class="n">warnings</span><span class="o">.</span><span class="n">warn</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;The date provided is outside of the duration of the storm. Returning the closest available NHC forecast.&quot;</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span><span class="s2">&quot;Error: Input variable &#39;forecast&#39; must be of type &#39;int&#39; or &#39;datetime.datetime&#39;&quot;</span><span class="p">)</span>

        <span class="c1">#Get observed track as per NHC analyses</span>
        <span class="n">track_dict</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;lat&#39;</span><span class="p">:[],</span><span class="s1">&#39;lon&#39;</span><span class="p">:[],</span><span class="s1">&#39;vmax&#39;</span><span class="p">:[],</span><span class="s1">&#39;type&#39;</span><span class="p">:[],</span><span class="s1">&#39;mslp&#39;</span><span class="p">:[],</span><span class="s1">&#39;date&#39;</span><span class="p">:[],</span><span class="s1">&#39;extra_obs&#39;</span><span class="p">:[],</span><span class="s1">&#39;special&#39;</span><span class="p">:[],</span><span class="s1">&#39;ace&#39;</span><span class="p">:</span><span class="mf">0.0</span><span class="p">}</span>
        <span class="n">use_carq</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="n">nhc_forecast_init</span><span class="p">:</span>
            <span class="n">hrs</span> <span class="o">=</span> <span class="n">nhc_forecasts</span><span class="p">[</span><span class="n">k</span><span class="p">][</span><span class="s1">&#39;fhr&#39;</span><span class="p">]</span>
            <span class="n">hrs_carq</span> <span class="o">=</span> <span class="n">carq_forecasts</span><span class="p">[</span><span class="n">k</span><span class="p">][</span><span class="s1">&#39;fhr&#39;</span><span class="p">]</span> <span class="k">if</span> <span class="n">k</span> <span class="ow">in</span> <span class="n">carq_forecast_init</span> <span class="k">else</span> <span class="p">[]</span>
            
            <span class="c1">#Account for old years when hour 0 wasn&#39;t included directly</span>
            <span class="c1">#if 0 not in hrs and k in carq_forecast_init and 0 in hrs_carq:</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">dict</span><span class="p">[</span><span class="s1">&#39;year&#39;</span><span class="p">]</span> <span class="o">&lt;</span> <span class="mi">2000</span> <span class="ow">and</span> <span class="n">k</span> <span class="ow">in</span> <span class="n">carq_forecast_init</span> <span class="ow">and</span> <span class="mi">0</span> <span class="ow">in</span> <span class="n">hrs_carq</span><span class="p">:</span>
                
                <span class="n">use_carq</span> <span class="o">=</span> <span class="kc">True</span>
                <span class="n">hr_idx</span> <span class="o">=</span> <span class="n">hrs_carq</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
                <span class="n">track_dict</span><span class="p">[</span><span class="s1">&#39;lat&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">carq_forecasts</span><span class="p">[</span><span class="n">k</span><span class="p">][</span><span class="s1">&#39;lat&#39;</span><span class="p">][</span><span class="n">hr_idx</span><span class="p">])</span>
                <span class="n">track_dict</span><span class="p">[</span><span class="s1">&#39;lon&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">carq_forecasts</span><span class="p">[</span><span class="n">k</span><span class="p">][</span><span class="s1">&#39;lon&#39;</span><span class="p">][</span><span class="n">hr_idx</span><span class="p">])</span>
                <span class="n">track_dict</span><span class="p">[</span><span class="s1">&#39;vmax&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">carq_forecasts</span><span class="p">[</span><span class="n">k</span><span class="p">][</span><span class="s1">&#39;vmax&#39;</span><span class="p">][</span><span class="n">hr_idx</span><span class="p">])</span>
                <span class="n">track_dict</span><span class="p">[</span><span class="s1">&#39;mslp&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">nan</span><span class="p">)</span>
                <span class="n">track_dict</span><span class="p">[</span><span class="s1">&#39;date&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">carq_forecasts</span><span class="p">[</span><span class="n">k</span><span class="p">][</span><span class="s1">&#39;init&#39;</span><span class="p">])</span>

                <span class="n">itype</span> <span class="o">=</span> <span class="n">carq_forecasts</span><span class="p">[</span><span class="n">k</span><span class="p">][</span><span class="s1">&#39;type&#39;</span><span class="p">][</span><span class="n">hr_idx</span><span class="p">]</span>
                <span class="k">if</span> <span class="n">itype</span> <span class="o">==</span> <span class="s2">&quot;&quot;</span><span class="p">:</span> <span class="n">itype</span> <span class="o">=</span> <span class="n">get_storm_type</span><span class="p">(</span><span class="n">carq_forecasts</span><span class="p">[</span><span class="n">k</span><span class="p">][</span><span class="s1">&#39;vmax&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">],</span><span class="kc">False</span><span class="p">)</span>
                <span class="n">track_dict</span><span class="p">[</span><span class="s1">&#39;type&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">itype</span><span class="p">)</span>

                <span class="n">hr</span> <span class="o">=</span> <span class="n">carq_forecasts</span><span class="p">[</span><span class="n">k</span><span class="p">][</span><span class="s1">&#39;init&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">strftime</span><span class="p">(</span><span class="s2">&quot;%H%M&quot;</span><span class="p">)</span>
                <span class="n">track_dict</span><span class="p">[</span><span class="s1">&#39;extra_obs&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span> <span class="k">if</span> <span class="n">hr</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;0300&#39;</span><span class="p">,</span><span class="s1">&#39;0900&#39;</span><span class="p">,</span><span class="s1">&#39;1500&#39;</span><span class="p">,</span><span class="s1">&#39;2100&#39;</span><span class="p">]</span> <span class="k">else</span> <span class="n">track_dict</span><span class="p">[</span><span class="s1">&#39;extra_obs&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
                <span class="n">track_dict</span><span class="p">[</span><span class="s1">&#39;special&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;&quot;</span><span class="p">)</span>
                
            <span class="k">else</span><span class="p">:</span>
                <span class="n">use_carq</span> <span class="o">=</span> <span class="kc">False</span>
                <span class="k">if</span> <span class="mi">3</span> <span class="ow">in</span> <span class="n">hrs</span><span class="p">:</span>
                    <span class="n">hr_idx</span> <span class="o">=</span> <span class="n">hrs</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span>
                    <span class="n">hr_add</span> <span class="o">=</span> <span class="mi">3</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">hr_idx</span> <span class="o">=</span> <span class="mi">0</span>
                    <span class="n">hr_add</span> <span class="o">=</span> <span class="mi">0</span>
                <span class="n">track_dict</span><span class="p">[</span><span class="s1">&#39;lat&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">nhc_forecasts</span><span class="p">[</span><span class="n">k</span><span class="p">][</span><span class="s1">&#39;lat&#39;</span><span class="p">][</span><span class="n">hr_idx</span><span class="p">])</span>
                <span class="n">track_dict</span><span class="p">[</span><span class="s1">&#39;lon&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">nhc_forecasts</span><span class="p">[</span><span class="n">k</span><span class="p">][</span><span class="s1">&#39;lon&#39;</span><span class="p">][</span><span class="n">hr_idx</span><span class="p">])</span>
                <span class="n">track_dict</span><span class="p">[</span><span class="s1">&#39;vmax&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">nhc_forecasts</span><span class="p">[</span><span class="n">k</span><span class="p">][</span><span class="s1">&#39;vmax&#39;</span><span class="p">][</span><span class="n">hr_idx</span><span class="p">])</span>
                <span class="n">track_dict</span><span class="p">[</span><span class="s1">&#39;mslp&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">nan</span><span class="p">)</span>
                <span class="n">track_dict</span><span class="p">[</span><span class="s1">&#39;date&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">nhc_forecasts</span><span class="p">[</span><span class="n">k</span><span class="p">][</span><span class="s1">&#39;init&#39;</span><span class="p">]</span><span class="o">+</span><span class="n">timedelta</span><span class="p">(</span><span class="n">hours</span><span class="o">=</span><span class="n">hr_add</span><span class="p">))</span>

                <span class="n">itype</span> <span class="o">=</span> <span class="n">nhc_forecasts</span><span class="p">[</span><span class="n">k</span><span class="p">][</span><span class="s1">&#39;type&#39;</span><span class="p">][</span><span class="n">hr_idx</span><span class="p">]</span>
                <span class="k">if</span> <span class="n">itype</span> <span class="o">==</span> <span class="s2">&quot;&quot;</span><span class="p">:</span> <span class="n">itype</span> <span class="o">=</span> <span class="n">get_storm_type</span><span class="p">(</span><span class="n">nhc_forecasts</span><span class="p">[</span><span class="n">k</span><span class="p">][</span><span class="s1">&#39;vmax&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">],</span><span class="kc">False</span><span class="p">)</span>
                <span class="n">track_dict</span><span class="p">[</span><span class="s1">&#39;type&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">itype</span><span class="p">)</span>

                <span class="n">hr</span> <span class="o">=</span> <span class="n">nhc_forecasts</span><span class="p">[</span><span class="n">k</span><span class="p">][</span><span class="s1">&#39;init&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">strftime</span><span class="p">(</span><span class="s2">&quot;%H%M&quot;</span><span class="p">)</span>
                <span class="n">track_dict</span><span class="p">[</span><span class="s1">&#39;extra_obs&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span> <span class="k">if</span> <span class="n">hr</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;0300&#39;</span><span class="p">,</span><span class="s1">&#39;0900&#39;</span><span class="p">,</span><span class="s1">&#39;1500&#39;</span><span class="p">,</span><span class="s1">&#39;2100&#39;</span><span class="p">]</span> <span class="k">else</span> <span class="n">track_dict</span><span class="p">[</span><span class="s1">&#39;extra_obs&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
                <span class="n">track_dict</span><span class="p">[</span><span class="s1">&#39;special&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;&quot;</span><span class="p">)</span>
        
        <span class="c1">#Add main elements from storm dict</span>
        <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;id&#39;</span><span class="p">,</span><span class="s1">&#39;operational_id&#39;</span><span class="p">,</span><span class="s1">&#39;name&#39;</span><span class="p">,</span><span class="s1">&#39;year&#39;</span><span class="p">]:</span>
            <span class="n">track_dict</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">dict</span><span class="p">[</span><span class="n">key</span><span class="p">]</span>

        
        <span class="c1">#Add carq to forecast dict as hour 0, if available</span>
        <span class="k">if</span> <span class="n">use_carq</span> <span class="o">==</span> <span class="kc">True</span> <span class="ow">and</span> <span class="n">forecast_dict</span><span class="p">[</span><span class="s1">&#39;init&#39;</span><span class="p">]</span> <span class="ow">in</span> <span class="n">track_dict</span><span class="p">[</span><span class="s1">&#39;date&#39;</span><span class="p">]:</span>
            <span class="n">insert_idx</span> <span class="o">=</span> <span class="n">track_dict</span><span class="p">[</span><span class="s1">&#39;date&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="n">forecast_dict</span><span class="p">[</span><span class="s1">&#39;init&#39;</span><span class="p">])</span>
            <span class="k">if</span> <span class="mi">0</span> <span class="ow">in</span> <span class="n">forecast_dict</span><span class="p">[</span><span class="s1">&#39;fhr&#39;</span><span class="p">]:</span>
                <span class="n">forecast_dict</span><span class="p">[</span><span class="s1">&#39;lat&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">track_dict</span><span class="p">[</span><span class="s1">&#39;lat&#39;</span><span class="p">][</span><span class="n">insert_idx</span><span class="p">]</span>
                <span class="n">forecast_dict</span><span class="p">[</span><span class="s1">&#39;lon&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">track_dict</span><span class="p">[</span><span class="s1">&#39;lon&#39;</span><span class="p">][</span><span class="n">insert_idx</span><span class="p">]</span>
                <span class="n">forecast_dict</span><span class="p">[</span><span class="s1">&#39;vmax&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">track_dict</span><span class="p">[</span><span class="s1">&#39;vmax&#39;</span><span class="p">][</span><span class="n">insert_idx</span><span class="p">]</span>
                <span class="n">forecast_dict</span><span class="p">[</span><span class="s1">&#39;mslp&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">track_dict</span><span class="p">[</span><span class="s1">&#39;mslp&#39;</span><span class="p">][</span><span class="n">insert_idx</span><span class="p">]</span>
                <span class="n">forecast_dict</span><span class="p">[</span><span class="s1">&#39;type&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">track_dict</span><span class="p">[</span><span class="s1">&#39;type&#39;</span><span class="p">][</span><span class="n">insert_idx</span><span class="p">]</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">forecast_dict</span><span class="p">[</span><span class="s1">&#39;fhr&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">insert</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">)</span>
                <span class="n">forecast_dict</span><span class="p">[</span><span class="s1">&#39;lat&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">insert</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="n">track_dict</span><span class="p">[</span><span class="s1">&#39;lat&#39;</span><span class="p">][</span><span class="n">insert_idx</span><span class="p">])</span>
                <span class="n">forecast_dict</span><span class="p">[</span><span class="s1">&#39;lon&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">insert</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="n">track_dict</span><span class="p">[</span><span class="s1">&#39;lon&#39;</span><span class="p">][</span><span class="n">insert_idx</span><span class="p">])</span>
                <span class="n">forecast_dict</span><span class="p">[</span><span class="s1">&#39;vmax&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">insert</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="n">track_dict</span><span class="p">[</span><span class="s1">&#39;vmax&#39;</span><span class="p">][</span><span class="n">insert_idx</span><span class="p">])</span>
                <span class="n">forecast_dict</span><span class="p">[</span><span class="s1">&#39;mslp&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">insert</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="n">track_dict</span><span class="p">[</span><span class="s1">&#39;mslp&#39;</span><span class="p">][</span><span class="n">insert_idx</span><span class="p">])</span>
                <span class="n">forecast_dict</span><span class="p">[</span><span class="s1">&#39;type&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">insert</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="n">track_dict</span><span class="p">[</span><span class="s1">&#39;type&#39;</span><span class="p">][</span><span class="n">insert_idx</span><span class="p">])</span>
            
        <span class="c1">#Add other info to forecast dict</span>
        <span class="n">forecast_dict</span><span class="p">[</span><span class="s1">&#39;advisory_num&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">advisory_num</span>
        <span class="n">forecast_dict</span><span class="p">[</span><span class="s1">&#39;basin&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">basin</span>
        
        <span class="c1">#Plot storm</span>
        <span class="n">plot_ax</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">plot_obj</span><span class="o">.</span><span class="n">plot_storm_nhc</span><span class="p">(</span><span class="n">forecast_dict</span><span class="p">,</span><span class="n">track_dict</span><span class="p">,</span><span class="n">track_labels</span><span class="p">,</span><span class="n">cone_days</span><span class="p">,</span><span class="n">domain</span><span class="p">,</span><span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">,</span><span class="n">save_path</span><span class="o">=</span><span class="n">save_path</span><span class="p">,</span><span class="n">prop</span><span class="o">=</span><span class="n">prop</span><span class="p">,</span><span class="n">map_prop</span><span class="o">=</span><span class="n">map_prop</span><span class="p">)</span>
        
        <span class="c1">#Return axis</span>
        <span class="k">return</span> <span class="n">plot_ax</span></div>
        
    
    <span class="c1">#PLOT FUNCTION FOR HURDAT</span>
<div class="viewcode-block" id="Storm.plot_gefs_ensembles"><a class="viewcode-back" href="../../../api/generated/tropycal.tracks.Storm.plot_gefs_ensembles.html#tropycal.tracks.Storm.plot_gefs_ensembles">[docs]</a>    <span class="k">def</span> <span class="nf">plot_gefs_ensembles</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">forecast</span><span class="p">,</span><span class="n">fhr</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                            <span class="n">prop_members</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;linewidth&#39;</span><span class="p">:</span><span class="mf">0.5</span><span class="p">,</span> <span class="s1">&#39;linecolor&#39;</span><span class="p">:</span><span class="s1">&#39;k&#39;</span><span class="p">},</span>
                            <span class="n">prop_mean</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;linewidth&#39;</span><span class="p">:</span><span class="mf">2.0</span><span class="p">,</span> <span class="s1">&#39;linecolor&#39;</span><span class="p">:</span><span class="s1">&#39;k&#39;</span><span class="p">},</span>
                            <span class="n">prop_gfs</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;linewidth&#39;</span><span class="p">:</span><span class="mf">2.0</span><span class="p">,</span> <span class="s1">&#39;linecolor&#39;</span><span class="p">:</span><span class="s1">&#39;b&#39;</span><span class="p">},</span>
                            <span class="n">prop_ellipse</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;linewidth&#39;</span><span class="p">:</span><span class="mf">2.0</span><span class="p">,</span> <span class="s1">&#39;linecolor&#39;</span><span class="p">:</span><span class="s1">&#39;r&#39;</span><span class="p">},</span>
                            <span class="n">prop_density</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;radius&#39;</span><span class="p">:</span><span class="mi">200</span><span class="p">,</span> <span class="s1">&#39;cmap&#39;</span><span class="p">:</span><span class="n">plt</span><span class="o">.</span><span class="n">cm</span><span class="o">.</span><span class="n">YlOrRd</span><span class="p">,</span> <span class="s1">&#39;levels&#39;</span><span class="p">:[</span><span class="n">i</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">5</span><span class="p">,</span><span class="mi">105</span><span class="p">,</span><span class="mi">5</span><span class="p">)]},</span>
                            <span class="n">domain</span><span class="o">=</span><span class="s2">&quot;dynamic&quot;</span><span class="p">,</span><span class="n">ax</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span><span class="n">cartopy_proj</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span><span class="n">save_path</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span><span class="n">map_prop</span><span class="o">=</span><span class="p">{}):</span>
        
        <span class="sa">r</span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Creates a plot of individual GEFS ensemble tracks.</span>
<span class="sd">        </span>
<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        forecast : datetime.datetime</span>
<span class="sd">            Datetime object representing the GEFS run initialization.</span>
<span class="sd">        fhr : int or list, optional</span>
<span class="sd">            Forecast hour(s) to plot. If None (default), a plot of all forecast hours will be produced. If a list, multiple plots will be produced. If an integer, a single plot will be produced.</span>
<span class="sd">        plot_density : bool, optional</span>
<span class="sd">            If True, track density will be computed and plotted in addition to individual ensemble tracks.</span>
<span class="sd">        domain : str</span>
<span class="sd">            Domain for the plot. Default is &quot;dynamic&quot;. Please refer to :ref:`options-domain` for available domain options.</span>
<span class="sd">        ax : axes</span>
<span class="sd">            Instance of axes to plot on. If none, one will be generated. Default is none.</span>
<span class="sd">        cartopy_proj : ccrs</span>
<span class="sd">            Instance of a cartopy projection to use. If none, one will be generated. Default is none.</span>
<span class="sd">        save_path : str</span>
<span class="sd">            Relative or full path of directory to save the image in. If none, image will not be saved.</span>
<span class="sd">        </span>
<span class="sd">        Other Parameters</span>
<span class="sd">        ----------------</span>
<span class="sd">        prop : dict</span>
<span class="sd">            Customization properties of storm track lines. Please refer to :ref:`options-prop` for available options.</span>
<span class="sd">        map_prop : dict</span>
<span class="sd">            Customization properties of Cartopy map. Please refer to :ref:`options-map-prop` for available options.</span>
<span class="sd">        </span>
<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        ax</span>
<span class="sd">            Instance of axes containing the plot is returned.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        
        <span class="c1">#Create instance of plot object</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">plot_obj</span>
        <span class="k">except</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">plot_obj</span> <span class="o">=</span> <span class="n">TrackPlot</span><span class="p">()</span>
        
        <span class="c1">#Create cartopy projection</span>
        <span class="k">if</span> <span class="n">cartopy_proj</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">plot_obj</span><span class="o">.</span><span class="n">proj</span> <span class="o">=</span> <span class="n">cartopy_proj</span>
        <span class="k">elif</span> <span class="nb">max</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">dict</span><span class="p">[</span><span class="s1">&#39;lon&#39;</span><span class="p">])</span> <span class="o">&gt;</span> <span class="mi">150</span> <span class="ow">or</span> <span class="nb">min</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">dict</span><span class="p">[</span><span class="s1">&#39;lon&#39;</span><span class="p">])</span> <span class="o">&lt;</span> <span class="o">-</span><span class="mi">150</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">plot_obj</span><span class="o">.</span><span class="n">create_cartopy</span><span class="p">(</span><span class="n">proj</span><span class="o">=</span><span class="s1">&#39;PlateCarree&#39;</span><span class="p">,</span><span class="n">central_longitude</span><span class="o">=</span><span class="mf">180.0</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">plot_obj</span><span class="o">.</span><span class="n">create_cartopy</span><span class="p">(</span><span class="n">proj</span><span class="o">=</span><span class="s1">&#39;PlateCarree&#39;</span><span class="p">,</span><span class="n">central_longitude</span><span class="o">=</span><span class="mf">0.0</span><span class="p">)</span>
        
        <span class="c1">#-------------------------------------------------------------------------</span>
        
        <span class="c1">#Get forecasts dict saved into storm object, if it hasn&#39;t been already</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">forecast_dict</span>
        <span class="k">except</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">get_operational_forecasts</span><span class="p">()</span>
        
        <span class="c1">#Create dict to store all data in</span>
        <span class="n">ds</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;gfs&#39;</span><span class="p">:{</span><span class="s1">&#39;fhr&#39;</span><span class="p">:[],</span><span class="s1">&#39;lat&#39;</span><span class="p">:[],</span><span class="s1">&#39;lon&#39;</span><span class="p">:[],</span><span class="s1">&#39;vmax&#39;</span><span class="p">:[],</span><span class="s1">&#39;mslp&#39;</span><span class="p">:[],</span><span class="s1">&#39;date&#39;</span><span class="p">:[]},</span>
              <span class="s1">&#39;gefs&#39;</span><span class="p">:{</span><span class="s1">&#39;fhr&#39;</span><span class="p">:[],</span><span class="s1">&#39;lat&#39;</span><span class="p">:[],</span><span class="s1">&#39;lon&#39;</span><span class="p">:[],</span><span class="s1">&#39;vmax&#39;</span><span class="p">:[],</span><span class="s1">&#39;mslp&#39;</span><span class="p">:[],</span><span class="s1">&#39;date&#39;</span><span class="p">:[],</span>
                      <span class="s1">&#39;members&#39;</span><span class="p">:[],</span><span class="s1">&#39;ellipse_lat&#39;</span><span class="p">:[],</span><span class="s1">&#39;ellipse_lon&#39;</span><span class="p">:[]}</span>
              <span class="p">}</span>
        
        <span class="c1">#String formatting for ensembles</span>
        <span class="k">def</span> <span class="nf">str2</span><span class="p">(</span><span class="n">ens</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">ens</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span> <span class="k">return</span> <span class="s2">&quot;AC00&quot;</span>
            <span class="k">if</span> <span class="n">ens</span> <span class="o">&lt;</span> <span class="mi">10</span><span class="p">:</span> <span class="k">return</span> <span class="sa">f</span><span class="s2">&quot;AP0</span><span class="si">{</span><span class="n">ens</span><span class="si">}</span><span class="s2">&quot;</span>
            <span class="k">return</span> <span class="sa">f</span><span class="s2">&quot;AP</span><span class="si">{</span><span class="n">ens</span><span class="si">}</span><span class="s2">&quot;</span>

        <span class="c1">#Get GFS forecast entry (AVNX is valid for RAL a-deck source)</span>
        <span class="n">gfs_key</span> <span class="o">=</span> <span class="s1">&#39;AVNO&#39;</span> <span class="k">if</span> <span class="s1">&#39;AVNO&#39;</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">forecast_dict</span><span class="o">.</span><span class="n">keys</span><span class="p">()</span> <span class="k">else</span> <span class="s1">&#39;AVNX&#39;</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">forecast_gfs</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">forecast_dict</span><span class="p">[</span><span class="n">gfs_key</span><span class="p">][</span><span class="n">forecast</span><span class="o">.</span><span class="n">strftime</span><span class="p">(</span><span class="s2">&quot;%Y%m</span><span class="si">%d</span><span class="s2">%H&quot;</span><span class="p">)]</span>
        <span class="k">except</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span><span class="s2">&quot;The requested GFS initialization isn&#39;t available for this storm.&quot;</span><span class="p">)</span>
        
        <span class="c1">#Enter into dict entry</span>
        <span class="n">ds</span><span class="p">[</span><span class="s1">&#39;gfs&#39;</span><span class="p">][</span><span class="s1">&#39;fhr&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="nb">int</span><span class="p">(</span><span class="n">i</span><span class="p">)</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">forecast_gfs</span><span class="p">[</span><span class="s1">&#39;fhr&#39;</span><span class="p">]]</span>
        <span class="n">ds</span><span class="p">[</span><span class="s1">&#39;gfs&#39;</span><span class="p">][</span><span class="s1">&#39;lat&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">round</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="mi">1</span><span class="p">)</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">forecast_gfs</span><span class="p">[</span><span class="s1">&#39;lat&#39;</span><span class="p">]]</span>
        <span class="n">ds</span><span class="p">[</span><span class="s1">&#39;gfs&#39;</span><span class="p">][</span><span class="s1">&#39;lon&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">round</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="mi">1</span><span class="p">)</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">forecast_gfs</span><span class="p">[</span><span class="s1">&#39;lon&#39;</span><span class="p">]]</span>
        <span class="n">ds</span><span class="p">[</span><span class="s1">&#39;gfs&#39;</span><span class="p">][</span><span class="s1">&#39;vmax&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="nb">float</span><span class="p">(</span><span class="n">i</span><span class="p">)</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">forecast_gfs</span><span class="p">[</span><span class="s1">&#39;vmax&#39;</span><span class="p">]]</span>
        <span class="n">ds</span><span class="p">[</span><span class="s1">&#39;gfs&#39;</span><span class="p">][</span><span class="s1">&#39;mslp&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">forecast_gfs</span><span class="p">[</span><span class="s1">&#39;mslp&#39;</span><span class="p">]</span>
        <span class="n">ds</span><span class="p">[</span><span class="s1">&#39;gfs&#39;</span><span class="p">][</span><span class="s1">&#39;date&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="n">forecast</span><span class="o">+</span><span class="n">timedelta</span><span class="p">(</span><span class="n">hours</span><span class="o">=</span><span class="n">i</span><span class="p">)</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">forecast_gfs</span><span class="p">[</span><span class="s1">&#39;fhr&#39;</span><span class="p">]]</span>
        
        <span class="c1">#Retrieve GEFS ensemble data (30 members 2019-present, 20 members prior)</span>
        <span class="n">nens</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="k">for</span> <span class="n">ens</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">31</span><span class="p">):</span>
            
            <span class="c1">#Create dict entry</span>
            <span class="n">ds</span><span class="p">[</span><span class="sa">f</span><span class="s1">&#39;gefs_</span><span class="si">{</span><span class="n">ens</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;fhr&#39;</span><span class="p">:[],</span><span class="s1">&#39;lat&#39;</span><span class="p">:[],</span><span class="s1">&#39;lon&#39;</span><span class="p">:[],</span><span class="s1">&#39;vmax&#39;</span><span class="p">:[],</span><span class="s1">&#39;mslp&#39;</span><span class="p">:[],</span><span class="s1">&#39;date&#39;</span><span class="p">:[]}</span>

            <span class="c1">#Retrieve ensemble member data</span>
            <span class="n">ens_str</span> <span class="o">=</span> <span class="n">str2</span><span class="p">(</span><span class="n">ens</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">ens_str</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">forecast_dict</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span> <span class="k">continue</span>
            <span class="n">forecast_ens</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">forecast_dict</span><span class="p">[</span><span class="n">ens_str</span><span class="p">][</span><span class="n">forecast</span><span class="o">.</span><span class="n">strftime</span><span class="p">(</span><span class="s2">&quot;%Y%m</span><span class="si">%d</span><span class="s2">%H&quot;</span><span class="p">)]</span>

            <span class="c1">#Enter into dict entry</span>
            <span class="n">ds</span><span class="p">[</span><span class="sa">f</span><span class="s1">&#39;gefs_</span><span class="si">{</span><span class="n">ens</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">][</span><span class="s1">&#39;fhr&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="nb">int</span><span class="p">(</span><span class="n">i</span><span class="p">)</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">forecast_ens</span><span class="p">[</span><span class="s1">&#39;fhr&#39;</span><span class="p">]]</span>
            <span class="n">ds</span><span class="p">[</span><span class="sa">f</span><span class="s1">&#39;gefs_</span><span class="si">{</span><span class="n">ens</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">][</span><span class="s1">&#39;lat&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">round</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="mi">1</span><span class="p">)</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">forecast_ens</span><span class="p">[</span><span class="s1">&#39;lat&#39;</span><span class="p">]]</span>
            <span class="n">ds</span><span class="p">[</span><span class="sa">f</span><span class="s1">&#39;gefs_</span><span class="si">{</span><span class="n">ens</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">][</span><span class="s1">&#39;lon&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">round</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="mi">1</span><span class="p">)</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">forecast_ens</span><span class="p">[</span><span class="s1">&#39;lon&#39;</span><span class="p">]]</span>
            <span class="n">ds</span><span class="p">[</span><span class="sa">f</span><span class="s1">&#39;gefs_</span><span class="si">{</span><span class="n">ens</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">][</span><span class="s1">&#39;vmax&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="nb">float</span><span class="p">(</span><span class="n">i</span><span class="p">)</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">forecast_ens</span><span class="p">[</span><span class="s1">&#39;vmax&#39;</span><span class="p">]]</span>
            <span class="n">ds</span><span class="p">[</span><span class="sa">f</span><span class="s1">&#39;gefs_</span><span class="si">{</span><span class="n">ens</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">][</span><span class="s1">&#39;mslp&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">forecast_ens</span><span class="p">[</span><span class="s1">&#39;mslp&#39;</span><span class="p">]</span>
            <span class="n">ds</span><span class="p">[</span><span class="sa">f</span><span class="s1">&#39;gefs_</span><span class="si">{</span><span class="n">ens</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">][</span><span class="s1">&#39;date&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="n">forecast</span><span class="o">+</span><span class="n">timedelta</span><span class="p">(</span><span class="n">hours</span><span class="o">=</span><span class="n">i</span><span class="p">)</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">forecast_ens</span><span class="p">[</span><span class="s1">&#39;fhr&#39;</span><span class="p">]]</span>
            <span class="n">nens</span> <span class="o">+=</span> <span class="mi">1</span>

        <span class="c1">#Construct ensemble mean data</span>
        <span class="c1">#Iterate through all forecast hours</span>
        <span class="k">for</span> <span class="n">iter_fhr</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">246</span><span class="p">,</span><span class="mi">6</span><span class="p">):</span>

            <span class="c1">#Temporary data arrays</span>
            <span class="n">temp_data</span> <span class="o">=</span> <span class="p">{}</span>
            <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="n">ds</span><span class="p">[</span><span class="s1">&#39;gfs&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
                <span class="k">if</span> <span class="n">key</span> <span class="ow">not</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;date&#39;</span><span class="p">,</span><span class="s1">&#39;fhr&#39;</span><span class="p">]:</span> <span class="n">temp_data</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span>

            <span class="c1">#Iterate through ensemble member</span>
            <span class="k">for</span> <span class="n">ens</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">nens</span><span class="p">):</span>

                <span class="c1">#Determine if member has data valid at this forecast hour</span>
                <span class="k">if</span> <span class="n">iter_fhr</span> <span class="ow">in</span> <span class="n">ds</span><span class="p">[</span><span class="sa">f</span><span class="s1">&#39;gefs_</span><span class="si">{</span><span class="n">ens</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">][</span><span class="s1">&#39;fhr&#39;</span><span class="p">]:</span>

                    <span class="c1">#Retrieve index</span>
                    <span class="n">idx</span> <span class="o">=</span> <span class="n">ds</span><span class="p">[</span><span class="sa">f</span><span class="s1">&#39;gefs_</span><span class="si">{</span><span class="n">ens</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">][</span><span class="s1">&#39;fhr&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="n">iter_fhr</span><span class="p">)</span>

                    <span class="c1">#Append data</span>
                    <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="n">ds</span><span class="p">[</span><span class="s1">&#39;gfs&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
                        <span class="k">if</span> <span class="n">key</span> <span class="ow">not</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;date&#39;</span><span class="p">,</span><span class="s1">&#39;fhr&#39;</span><span class="p">]:</span> <span class="n">temp_data</span><span class="p">[</span><span class="n">key</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">ds</span><span class="p">[</span><span class="sa">f</span><span class="s1">&#39;gefs_</span><span class="si">{</span><span class="n">ens</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">][</span><span class="n">key</span><span class="p">][</span><span class="n">idx</span><span class="p">])</span>

            <span class="c1">#Proceed if 20 or more ensemble members</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">temp_data</span><span class="p">[</span><span class="s1">&#39;lat&#39;</span><span class="p">])</span> <span class="o">&gt;=</span> <span class="mi">10</span><span class="p">:</span>

                <span class="c1">#Append data</span>
                <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="n">ds</span><span class="p">[</span><span class="s1">&#39;gfs&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
                    <span class="k">if</span> <span class="n">key</span> <span class="ow">not</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;date&#39;</span><span class="p">,</span><span class="s1">&#39;fhr&#39;</span><span class="p">]:</span>
                        <span class="n">ds</span><span class="p">[</span><span class="s1">&#39;gefs&#39;</span><span class="p">][</span><span class="n">key</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">nanmean</span><span class="p">(</span><span class="n">temp_data</span><span class="p">[</span><span class="n">key</span><span class="p">]))</span>
                <span class="n">ds</span><span class="p">[</span><span class="s1">&#39;gefs&#39;</span><span class="p">][</span><span class="s1">&#39;fhr&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">iter_fhr</span><span class="p">)</span>
                <span class="n">ds</span><span class="p">[</span><span class="s1">&#39;gefs&#39;</span><span class="p">][</span><span class="s1">&#39;date&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">forecast</span><span class="o">+</span><span class="n">timedelta</span><span class="p">(</span><span class="n">hours</span><span class="o">=</span><span class="n">iter_fhr</span><span class="p">))</span>
                <span class="n">ds</span><span class="p">[</span><span class="s1">&#39;gefs&#39;</span><span class="p">][</span><span class="s1">&#39;members&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">temp_data</span><span class="p">[</span><span class="s1">&#39;lat&#39;</span><span class="p">]))</span>

                <span class="c1">#Calculate ellipse data</span>
                <span class="k">if</span> <span class="n">prop_ellipse</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                    <span class="n">ellipse_data</span> <span class="o">=</span> <span class="n">plot_ellipse</span><span class="p">(</span><span class="n">temp_data</span><span class="p">[</span><span class="s1">&#39;lat&#39;</span><span class="p">],</span><span class="n">temp_data</span><span class="p">[</span><span class="s1">&#39;lon&#39;</span><span class="p">])</span>
                    <span class="n">ds</span><span class="p">[</span><span class="s1">&#39;gefs&#39;</span><span class="p">][</span><span class="s1">&#39;ellipse_lon&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">ellipse_data</span><span class="p">[</span><span class="s1">&#39;xell&#39;</span><span class="p">])</span>
                    <span class="n">ds</span><span class="p">[</span><span class="s1">&#39;gefs&#39;</span><span class="p">][</span><span class="s1">&#39;ellipse_lat&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">ellipse_data</span><span class="p">[</span><span class="s1">&#39;yell&#39;</span><span class="p">])</span>
        
        <span class="c1">#Convert fhr to list</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">fhr</span><span class="p">,</span><span class="nb">int</span><span class="p">)</span> <span class="o">==</span> <span class="kc">True</span> <span class="ow">or</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">fhr</span><span class="p">,</span><span class="nb">float</span><span class="p">)</span> <span class="o">==</span> <span class="kc">True</span><span class="p">:</span>
            <span class="n">fhr</span> <span class="o">=</span> <span class="p">[</span><span class="n">fhr</span><span class="p">]</span>
        
        <span class="c1">#Plot storm</span>
        <span class="n">plot_ax</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">plot_obj</span><span class="o">.</span><span class="n">plot_ensembles</span><span class="p">(</span><span class="n">forecast</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">dict</span><span class="p">,</span><span class="n">fhr</span><span class="p">,</span><span class="n">prop_members</span><span class="p">,</span><span class="n">prop_mean</span><span class="p">,</span><span class="n">prop_gfs</span><span class="p">,</span><span class="n">prop_ellipse</span><span class="p">,</span><span class="n">prop_density</span><span class="p">,</span><span class="n">nens</span><span class="p">,</span><span class="n">domain</span><span class="p">,</span><span class="n">ds</span><span class="p">,</span><span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">,</span><span class="n">map_prop</span><span class="o">=</span><span class="n">map_prop</span><span class="p">,</span><span class="n">save_path</span><span class="o">=</span><span class="n">save_path</span><span class="p">)</span>
        
        <span class="c1">#Return axis</span>
        <span class="k">return</span> <span class="n">plot_ax</span></div>
    
<div class="viewcode-block" id="Storm.list_nhc_discussions"><a class="viewcode-back" href="../../../api/generated/tropycal.tracks.Storm.list_nhc_discussions.html#tropycal.tracks.Storm.list_nhc_discussions">[docs]</a>    <span class="k">def</span> <span class="nf">list_nhc_discussions</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        
        <span class="sa">r</span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Retrieves a list of NHC forecast discussions for this storm, archived on https://ftp.nhc.noaa.gov/atcf/archive/.</span>
<span class="sd">        </span>
<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        dict</span>
<span class="sd">            Dictionary containing entries for each forecast discussion for this storm.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        
        <span class="c1">#Check to ensure the data source is HURDAT</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">source</span> <span class="o">!=</span> <span class="s2">&quot;hurdat&quot;</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span><span class="s2">&quot;Error: NHC data can only be accessed when HURDAT is used as the data source.&quot;</span><span class="p">)</span>
        
        <span class="c1">#Check to ensure storm is not an invest</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">invest</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span><span class="s2">&quot;Error: NHC does not issue advisories for invests that have not been designated as Potential Tropical Cyclones.&quot;</span><span class="p">)</span>
        
        <span class="c1">#Get storm ID &amp; corresponding data URL</span>
        <span class="n">storm_id</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">dict</span><span class="p">[</span><span class="s1">&#39;operational_id&#39;</span><span class="p">]</span>
        <span class="n">storm_year</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">dict</span><span class="p">[</span><span class="s1">&#39;year&#39;</span><span class="p">]</span>
        
        <span class="c1">#Error check</span>
        <span class="k">if</span> <span class="n">storm_id</span> <span class="o">==</span> <span class="s1">&#39;&#39;</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span><span class="s2">&quot;Error: This storm was identified post-operationally. No NHC operational data is available.&quot;</span><span class="p">)</span>
        
        <span class="c1">#Get list of available NHC advisories &amp; map discussions</span>
        <span class="k">if</span> <span class="n">storm_year</span> <span class="o">==</span> <span class="p">(</span><span class="n">dt</span><span class="o">.</span><span class="n">now</span><span class="p">())</span><span class="o">.</span><span class="n">year</span><span class="p">:</span>
            
            <span class="c1">#Get list of all discussions for all storms this year</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">url_disco</span> <span class="o">=</span> <span class="s1">&#39;https://ftp.nhc.noaa.gov/atcf/dis/&#39;</span>
                <span class="n">page</span> <span class="o">=</span> <span class="n">requests</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">url_disco</span><span class="p">)</span><span class="o">.</span><span class="n">text</span>
                <span class="n">content</span> <span class="o">=</span> <span class="n">page</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
                <span class="n">files</span> <span class="o">=</span> <span class="p">[]</span>
                <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="n">content</span><span class="p">:</span>
                    <span class="k">if</span> <span class="s2">&quot;.discus.&quot;</span> <span class="ow">in</span> <span class="n">line</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">id</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="ow">in</span> <span class="n">line</span><span class="p">:</span>
                        <span class="n">filename</span> <span class="o">=</span> <span class="n">line</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;&quot;&gt;&#39;</span><span class="p">)[</span><span class="mi">1</span><span class="p">]</span>
                        <span class="n">filename</span> <span class="o">=</span> <span class="n">filename</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;&lt;/a&gt;&quot;</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
                        <span class="n">files</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">filename</span><span class="p">)</span>
                <span class="k">del</span> <span class="n">content</span>
            <span class="k">except</span><span class="p">:</span>
                <span class="n">ftp</span> <span class="o">=</span> <span class="n">FTP</span><span class="p">(</span><span class="s1">&#39;ftp.nhc.noaa.gov&#39;</span><span class="p">)</span>
                <span class="n">ftp</span><span class="o">.</span><span class="n">login</span><span class="p">()</span>
                <span class="n">ftp</span><span class="o">.</span><span class="n">cwd</span><span class="p">(</span><span class="s1">&#39;atcf/dis&#39;</span><span class="p">)</span>
                <span class="n">files</span> <span class="o">=</span> <span class="n">ftp</span><span class="o">.</span><span class="n">nlst</span><span class="p">()</span>
                <span class="n">files</span> <span class="o">=</span> <span class="p">[</span><span class="n">i</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">files</span> <span class="k">if</span> <span class="s2">&quot;.discus.&quot;</span> <span class="ow">in</span> <span class="n">i</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">id</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="ow">in</span> <span class="n">i</span><span class="p">]</span>
                <span class="n">out</span> <span class="o">=</span> <span class="n">ftp</span><span class="o">.</span><span class="n">quit</span><span class="p">()</span>
            
            <span class="c1">#Read in all NHC forecast discussions</span>
            <span class="n">discos</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;id&#39;</span><span class="p">:[],</span><span class="s1">&#39;utc_date&#39;</span><span class="p">:[],</span><span class="s1">&#39;url&#39;</span><span class="p">:[],</span><span class="s1">&#39;mode&#39;</span><span class="p">:</span><span class="mi">0</span><span class="p">}</span>
            <span class="k">for</span> <span class="n">file</span> <span class="ow">in</span> <span class="n">files</span><span class="p">:</span>
                
                <span class="c1">#Get info about forecast</span>
                <span class="n">file_info</span> <span class="o">=</span> <span class="n">file</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;.&quot;</span><span class="p">)</span>
                <span class="n">disco_number</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">file_info</span><span class="p">[</span><span class="mi">2</span><span class="p">])</span>
                
                <span class="c1">#Open file to get info about time issued</span>
                <span class="n">f</span> <span class="o">=</span> <span class="n">urllib</span><span class="o">.</span><span class="n">request</span><span class="o">.</span><span class="n">urlopen</span><span class="p">(</span><span class="n">url_disco</span> <span class="o">+</span> <span class="n">file</span><span class="p">)</span>
                <span class="n">content</span> <span class="o">=</span> <span class="n">f</span><span class="o">.</span><span class="n">read</span><span class="p">()</span>
                <span class="n">content</span> <span class="o">=</span> <span class="n">content</span><span class="o">.</span><span class="n">decode</span><span class="p">(</span><span class="s2">&quot;utf-8&quot;</span><span class="p">)</span>
                <span class="n">content</span> <span class="o">=</span> <span class="n">content</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
                <span class="n">f</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
                
                <span class="c1">#Figure out time issued</span>
                <span class="n">hr</span> <span class="o">=</span> <span class="n">content</span><span class="p">[</span><span class="mi">5</span><span class="p">]</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot; &quot;</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
                <span class="n">zone</span> <span class="o">=</span> <span class="n">content</span><span class="p">[</span><span class="mi">5</span><span class="p">]</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot; &quot;</span><span class="p">)[</span><span class="mi">2</span><span class="p">]</span>
                <span class="n">disco_time</span> <span class="o">=</span> <span class="n">num_to_str2</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">hr</span><span class="p">))</span> <span class="o">+</span> <span class="s1">&#39; &#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">content</span><span class="p">[</span><span class="mi">5</span><span class="p">]</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot; &quot;</span><span class="p">)[</span><span class="mi">1</span><span class="p">:])</span>
                
                <span class="n">format_time</span> <span class="o">=</span> <span class="n">content</span><span class="p">[</span><span class="mi">5</span><span class="p">]</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot; &quot;</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
                <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">format_time</span><span class="p">)</span> <span class="o">==</span> <span class="mi">3</span><span class="p">:</span> <span class="n">format_time</span> <span class="o">=</span> <span class="s2">&quot;0&quot;</span> <span class="o">+</span> <span class="n">format_time</span>
                <span class="n">format_time</span> <span class="o">=</span> <span class="n">format_time</span> <span class="o">+</span> <span class="s2">&quot; &quot;</span> <span class="o">+</span>  <span class="s1">&#39; &#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">content</span><span class="p">[</span><span class="mi">5</span><span class="p">]</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot; &quot;</span><span class="p">)[</span><span class="mi">1</span><span class="p">:])</span>
                <span class="n">disco_date</span> <span class="o">=</span> <span class="n">dt</span><span class="o">.</span><span class="n">strptime</span><span class="p">(</span><span class="n">format_time</span><span class="p">,</span><span class="sa">f</span><span class="s1">&#39;%I00 %p </span><span class="si">{</span><span class="n">zone</span><span class="si">}</span><span class="s1"> %a %b %d %Y&#39;</span><span class="p">)</span>
                
                <span class="n">time_zones</span> <span class="o">=</span> <span class="p">{</span>
                <span class="s1">&#39;ADT&#39;</span><span class="p">:</span><span class="o">-</span><span class="mi">3</span><span class="p">,</span>
                <span class="s1">&#39;AST&#39;</span><span class="p">:</span><span class="o">-</span><span class="mi">4</span><span class="p">,</span>
                <span class="s1">&#39;EDT&#39;</span><span class="p">:</span><span class="o">-</span><span class="mi">4</span><span class="p">,</span>
                <span class="s1">&#39;EST&#39;</span><span class="p">:</span><span class="o">-</span><span class="mi">5</span><span class="p">,</span>
                <span class="s1">&#39;CDT&#39;</span><span class="p">:</span><span class="o">-</span><span class="mi">5</span><span class="p">,</span>
                <span class="s1">&#39;CST&#39;</span><span class="p">:</span><span class="o">-</span><span class="mi">6</span><span class="p">,</span>
                <span class="s1">&#39;MDT&#39;</span><span class="p">:</span><span class="o">-</span><span class="mi">6</span><span class="p">,</span>
                <span class="s1">&#39;MST&#39;</span><span class="p">:</span><span class="o">-</span><span class="mi">7</span><span class="p">,</span>
                <span class="s1">&#39;PDT&#39;</span><span class="p">:</span><span class="o">-</span><span class="mi">7</span><span class="p">,</span>
                <span class="s1">&#39;PST&#39;</span><span class="p">:</span><span class="o">-</span><span class="mi">8</span><span class="p">,</span>
                <span class="s1">&#39;HDT&#39;</span><span class="p">:</span><span class="o">-</span><span class="mi">9</span><span class="p">,</span>
                <span class="s1">&#39;HST&#39;</span><span class="p">:</span><span class="o">-</span><span class="mi">10</span><span class="p">}</span>
                <span class="n">offset</span> <span class="o">=</span> <span class="n">time_zones</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">zone</span><span class="p">,</span><span class="mi">0</span><span class="p">)</span>
                <span class="n">disco_date</span> <span class="o">=</span> <span class="n">disco_date</span> <span class="o">+</span> <span class="n">timedelta</span><span class="p">(</span><span class="n">hours</span><span class="o">=</span><span class="n">offset</span><span class="o">*-</span><span class="mi">1</span><span class="p">)</span>
                
                <span class="c1">#Add times issued</span>
                <span class="n">discos</span><span class="p">[</span><span class="s1">&#39;id&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">disco_number</span><span class="p">)</span>
                <span class="n">discos</span><span class="p">[</span><span class="s1">&#39;utc_date&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">disco_date</span><span class="p">)</span>
                <span class="n">discos</span><span class="p">[</span><span class="s1">&#39;url&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">url_disco</span> <span class="o">+</span> <span class="n">file</span><span class="p">)</span>
            
        <span class="k">elif</span> <span class="n">storm_year</span> <span class="o">&lt;</span> <span class="mi">1992</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span><span class="s2">&quot;NHC discussion data is unavailable.&quot;</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">storm_year</span> <span class="o">&lt;</span> <span class="mi">2000</span><span class="p">:</span>
            <span class="c1">#Get directory path of storm and read it in</span>
            <span class="n">url_disco</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;https://ftp.nhc.noaa.gov/atcf/archive/</span><span class="si">{</span><span class="n">storm_year</span><span class="si">}</span><span class="s2">/messages/&quot;</span>
            <span class="n">url</span> <span class="o">=</span> <span class="n">url_disco</span> <span class="o">+</span> <span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">storm_id</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span><span class="si">}</span><span class="s1">_msg.zip&#39;</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">request</span> <span class="o">=</span> <span class="n">urllib</span><span class="o">.</span><span class="n">request</span><span class="o">.</span><span class="n">Request</span><span class="p">(</span><span class="n">url</span><span class="p">)</span>
                <span class="n">response</span> <span class="o">=</span> <span class="n">urllib</span><span class="o">.</span><span class="n">request</span><span class="o">.</span><span class="n">urlopen</span><span class="p">(</span><span class="n">request</span><span class="p">)</span>
                <span class="n">file_like_object</span> <span class="o">=</span> <span class="n">BytesIO</span><span class="p">(</span><span class="n">response</span><span class="o">.</span><span class="n">read</span><span class="p">())</span>
                <span class="n">tar</span> <span class="o">=</span> <span class="n">zipfile</span><span class="o">.</span><span class="n">ZipFile</span><span class="p">(</span><span class="n">file_like_object</span><span class="p">)</span>
            <span class="k">except</span><span class="p">:</span>
                <span class="k">try</span><span class="p">:</span>
                    <span class="n">url_disco</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;ftp://ftp.nhc.noaa.gov/atcf/archive/</span><span class="si">{</span><span class="n">storm_year</span><span class="si">}</span><span class="s2">/messages/&quot;</span>
                    <span class="n">url</span> <span class="o">=</span> <span class="n">url_disco</span> <span class="o">+</span> <span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">storm_id</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span><span class="si">}</span><span class="s1">_msg.zip&#39;</span>
                    <span class="n">request</span> <span class="o">=</span> <span class="n">urllib</span><span class="o">.</span><span class="n">request</span><span class="o">.</span><span class="n">Request</span><span class="p">(</span><span class="n">url</span><span class="p">)</span>
                    <span class="n">response</span> <span class="o">=</span> <span class="n">urllib</span><span class="o">.</span><span class="n">request</span><span class="o">.</span><span class="n">urlopen</span><span class="p">(</span><span class="n">request</span><span class="p">)</span>
                    <span class="n">file_like_object</span> <span class="o">=</span> <span class="n">BytesIO</span><span class="p">(</span><span class="n">response</span><span class="o">.</span><span class="n">read</span><span class="p">())</span>
                    <span class="n">tar</span> <span class="o">=</span> <span class="n">zipfile</span><span class="o">.</span><span class="n">ZipFile</span><span class="p">(</span><span class="n">file_like_object</span><span class="p">)</span>
                <span class="k">except</span><span class="p">:</span>
                    <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span><span class="s2">&quot;NHC discussion data is unavailable.&quot;</span><span class="p">)</span>
            
            <span class="c1">#Get file list</span>
            <span class="n">members</span> <span class="o">=</span> <span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="n">i</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">tar</span><span class="o">.</span><span class="n">namelist</span><span class="p">()])</span>
            <span class="n">nums</span> <span class="o">=</span> <span class="s2">&quot;[0123456789]&quot;</span>
            <span class="n">search_pattern</span> <span class="o">=</span> <span class="sa">f</span><span class="s1">&#39;n</span><span class="si">{</span><span class="n">storm_id</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="mi">4</span><span class="p">]</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span><span class="si">}{</span><span class="nb">str</span><span class="p">(</span><span class="n">storm_year</span><span class="p">)[</span><span class="mi">2</span><span class="p">:]</span><span class="si">}</span><span class="s1">.[01]</span><span class="si">{</span><span class="n">nums</span><span class="si">}{</span><span class="n">nums</span><span class="si">}</span><span class="s1">&#39;</span>
            <span class="n">pattern</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">compile</span><span class="p">(</span><span class="n">search_pattern</span><span class="p">)</span>
            <span class="n">filelist</span> <span class="o">=</span> <span class="n">pattern</span><span class="o">.</span><span class="n">findall</span><span class="p">(</span><span class="n">members</span><span class="p">)</span>
            <span class="n">files</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="k">for</span> <span class="n">file</span> <span class="ow">in</span> <span class="n">filelist</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">file</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">files</span><span class="p">:</span> <span class="n">files</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">file</span><span class="p">)</span> <span class="c1">#remove duplicates</span>
            
            <span class="c1">#Read in all NHC forecast discussions</span>
            <span class="n">discos</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;id&#39;</span><span class="p">:[],</span><span class="s1">&#39;utc_date&#39;</span><span class="p">:[],</span><span class="s1">&#39;url&#39;</span><span class="p">:[],</span><span class="s1">&#39;mode&#39;</span><span class="p">:</span><span class="mi">4</span><span class="p">}</span>
            <span class="k">for</span> <span class="n">file</span> <span class="ow">in</span> <span class="n">files</span><span class="p">:</span>
                
                <span class="c1">#Get info about forecast</span>
                <span class="n">file_info</span> <span class="o">=</span> <span class="n">file</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;.&quot;</span><span class="p">)</span>
                <span class="n">disco_number</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">file_info</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
                
                <span class="c1">#Open file to get info about time issued</span>
                <span class="n">members</span> <span class="o">=</span> <span class="n">tar</span><span class="o">.</span><span class="n">namelist</span><span class="p">()</span>
                <span class="n">members_names</span> <span class="o">=</span> <span class="p">[</span><span class="n">i</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">members</span><span class="p">]</span>
                <span class="n">idx</span> <span class="o">=</span> <span class="n">members_names</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="n">file</span><span class="p">)</span>
                <span class="n">content</span> <span class="o">=</span> <span class="p">(</span><span class="n">tar</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="n">members</span><span class="p">[</span><span class="n">idx</span><span class="p">]))</span><span class="o">.</span><span class="n">decode</span><span class="p">()</span>
                <span class="n">content</span> <span class="o">=</span> <span class="n">content</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
                
                <span class="c1">#Figure out time issued</span>
                <span class="n">slice_idx</span> <span class="o">=</span> <span class="mi">5</span> <span class="k">if</span> <span class="n">storm_year</span> <span class="o">&lt;</span> <span class="mi">1998</span> <span class="k">else</span> <span class="mi">4</span>
                <span class="k">for</span> <span class="n">temp_idx</span> <span class="ow">in</span> <span class="p">[</span><span class="n">slice_idx</span><span class="p">,</span><span class="n">slice_idx</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="n">slice_idx</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span><span class="n">slice_idx</span><span class="o">-</span><span class="mi">2</span><span class="p">,</span><span class="n">slice_idx</span><span class="o">+</span><span class="mi">2</span><span class="p">]:</span>
                    <span class="k">try</span><span class="p">:</span>
                        <span class="n">hr</span> <span class="o">=</span> <span class="n">content</span><span class="p">[</span><span class="n">temp_idx</span><span class="p">]</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot; &quot;</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
                        <span class="k">if</span> <span class="s1">&#39;NOON&#39;</span> <span class="ow">in</span> <span class="n">content</span><span class="p">[</span><span class="n">temp_idx</span><span class="p">]:</span>
                            <span class="n">temp_line</span> <span class="o">=</span> <span class="n">content</span><span class="p">[</span><span class="n">temp_idx</span><span class="p">]</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;NOON&quot;</span><span class="p">,</span><span class="s2">&quot;12 PM&quot;</span><span class="p">)</span>
                            <span class="n">zone</span> <span class="o">=</span> <span class="n">temp_line</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot; &quot;</span><span class="p">)[</span><span class="mi">1</span><span class="p">]</span>
                            <span class="n">disco_date</span> <span class="o">=</span> <span class="n">dt</span><span class="o">.</span><span class="n">strptime</span><span class="p">(</span><span class="n">temp_line</span><span class="o">.</span><span class="n">rstrip</span><span class="p">(),</span><span class="sa">f</span><span class="s1">&#39;%I %p </span><span class="si">{</span><span class="n">zone</span><span class="si">}</span><span class="s1"> %a %b %d %Y&#39;</span><span class="p">)</span>
                        <span class="k">else</span><span class="p">:</span>
                            <span class="n">zone</span> <span class="o">=</span> <span class="n">content</span><span class="p">[</span><span class="n">temp_idx</span><span class="p">]</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot; &quot;</span><span class="p">)[</span><span class="mi">2</span><span class="p">]</span>
                            <span class="n">disco_date</span> <span class="o">=</span> <span class="n">dt</span><span class="o">.</span><span class="n">strptime</span><span class="p">(</span><span class="n">content</span><span class="p">[</span><span class="n">temp_idx</span><span class="p">]</span><span class="o">.</span><span class="n">rstrip</span><span class="p">(),</span><span class="sa">f</span><span class="s1">&#39;%I %p </span><span class="si">{</span><span class="n">zone</span><span class="si">}</span><span class="s1"> %a %b %d %Y&#39;</span><span class="p">)</span>
                    <span class="k">except</span><span class="p">:</span>
                        <span class="k">pass</span>
                
                <span class="n">time_zones</span> <span class="o">=</span> <span class="p">{</span>
                <span class="s1">&#39;ADT&#39;</span><span class="p">:</span><span class="o">-</span><span class="mi">3</span><span class="p">,</span>
                <span class="s1">&#39;AST&#39;</span><span class="p">:</span><span class="o">-</span><span class="mi">4</span><span class="p">,</span>
                <span class="s1">&#39;EDT&#39;</span><span class="p">:</span><span class="o">-</span><span class="mi">4</span><span class="p">,</span>
                <span class="s1">&#39;EST&#39;</span><span class="p">:</span><span class="o">-</span><span class="mi">5</span><span class="p">,</span>
                <span class="s1">&#39;CDT&#39;</span><span class="p">:</span><span class="o">-</span><span class="mi">5</span><span class="p">,</span>
                <span class="s1">&#39;CST&#39;</span><span class="p">:</span><span class="o">-</span><span class="mi">6</span><span class="p">,</span>
                <span class="s1">&#39;MDT&#39;</span><span class="p">:</span><span class="o">-</span><span class="mi">6</span><span class="p">,</span>
                <span class="s1">&#39;MST&#39;</span><span class="p">:</span><span class="o">-</span><span class="mi">7</span><span class="p">,</span>
                <span class="s1">&#39;PDT&#39;</span><span class="p">:</span><span class="o">-</span><span class="mi">7</span><span class="p">,</span>
                <span class="s1">&#39;PST&#39;</span><span class="p">:</span><span class="o">-</span><span class="mi">8</span><span class="p">,</span>
                <span class="s1">&#39;HDT&#39;</span><span class="p">:</span><span class="o">-</span><span class="mi">9</span><span class="p">,</span>
                <span class="s1">&#39;HST&#39;</span><span class="p">:</span><span class="o">-</span><span class="mi">10</span><span class="p">}</span>
                <span class="n">offset</span> <span class="o">=</span> <span class="n">time_zones</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">zone</span><span class="p">,</span><span class="mi">0</span><span class="p">)</span>
                <span class="n">disco_date</span> <span class="o">=</span> <span class="n">disco_date</span> <span class="o">+</span> <span class="n">timedelta</span><span class="p">(</span><span class="n">hours</span><span class="o">=</span><span class="n">offset</span><span class="o">*-</span><span class="mi">1</span><span class="p">)</span>
                
                <span class="c1">#Add times issued</span>
                <span class="n">discos</span><span class="p">[</span><span class="s1">&#39;id&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">disco_number</span><span class="p">)</span>
                <span class="n">discos</span><span class="p">[</span><span class="s1">&#39;utc_date&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">disco_date</span><span class="p">)</span>
                <span class="n">discos</span><span class="p">[</span><span class="s1">&#39;url&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">file</span><span class="p">)</span>
                
            <span class="n">response</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
            <span class="n">tar</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
            
        <span class="k">elif</span> <span class="n">storm_year</span> <span class="o">==</span> <span class="mi">2000</span><span class="p">:</span>
            <span class="c1">#Get directory path of storm and read it in</span>
            <span class="n">url_disco</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;https://ftp.nhc.noaa.gov/atcf/archive/</span><span class="si">{</span><span class="n">storm_year</span><span class="si">}</span><span class="s2">/messages/&quot;</span>
            <span class="n">url</span> <span class="o">=</span> <span class="n">url_disco</span> <span class="o">+</span> <span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">storm_id</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span><span class="si">}</span><span class="s1">.msgs.tar.gz&#39;</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">request</span> <span class="o">=</span> <span class="n">urllib</span><span class="o">.</span><span class="n">request</span><span class="o">.</span><span class="n">Request</span><span class="p">(</span><span class="n">url</span><span class="p">)</span>
                <span class="n">response</span> <span class="o">=</span> <span class="n">urllib</span><span class="o">.</span><span class="n">request</span><span class="o">.</span><span class="n">urlopen</span><span class="p">(</span><span class="n">request</span><span class="p">)</span>
                <span class="n">file_like_object</span> <span class="o">=</span> <span class="n">BytesIO</span><span class="p">(</span><span class="n">response</span><span class="o">.</span><span class="n">read</span><span class="p">())</span>
                <span class="n">tar</span> <span class="o">=</span> <span class="n">tarfile</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="n">fileobj</span><span class="o">=</span><span class="n">file_like_object</span><span class="p">)</span>
            <span class="k">except</span><span class="p">:</span>
                <span class="k">try</span><span class="p">:</span>
                    <span class="n">url_disco</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;ftp://ftp.nhc.noaa.gov/atcf/archive/</span><span class="si">{</span><span class="n">storm_year</span><span class="si">}</span><span class="s2">/messages/&quot;</span>
                    <span class="n">url</span> <span class="o">=</span> <span class="n">url_disco</span> <span class="o">+</span> <span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">storm_id</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span><span class="si">}</span><span class="s1">.msgs.tar.gz&#39;</span>
                    <span class="n">request</span> <span class="o">=</span> <span class="n">urllib</span><span class="o">.</span><span class="n">request</span><span class="o">.</span><span class="n">Request</span><span class="p">(</span><span class="n">url</span><span class="p">)</span>
                    <span class="n">response</span> <span class="o">=</span> <span class="n">urllib</span><span class="o">.</span><span class="n">request</span><span class="o">.</span><span class="n">urlopen</span><span class="p">(</span><span class="n">request</span><span class="p">)</span>
                    <span class="n">file_like_object</span> <span class="o">=</span> <span class="n">BytesIO</span><span class="p">(</span><span class="n">response</span><span class="o">.</span><span class="n">read</span><span class="p">())</span>
                    <span class="n">tar</span> <span class="o">=</span> <span class="n">tarfile</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="n">fileobj</span><span class="o">=</span><span class="n">file_like_object</span><span class="p">)</span>
                <span class="k">except</span><span class="p">:</span>
                    <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span><span class="s2">&quot;NHC discussion data is unavailable.&quot;</span><span class="p">)</span>
            
            <span class="c1">#Get file list</span>
            <span class="n">members</span> <span class="o">=</span> <span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="n">i</span><span class="o">.</span><span class="n">name</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">tar</span><span class="o">.</span><span class="n">getmembers</span><span class="p">()])</span>
            <span class="n">nums</span> <span class="o">=</span> <span class="s2">&quot;[0123456789]&quot;</span>
            <span class="n">search_pattern</span> <span class="o">=</span> <span class="sa">f</span><span class="s1">&#39;N</span><span class="si">{</span><span class="n">storm_id</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="mi">4</span><span class="p">]</span><span class="si">}{</span><span class="nb">str</span><span class="p">(</span><span class="n">storm_year</span><span class="p">)[</span><span class="mi">2</span><span class="p">:]</span><span class="si">}</span><span class="s1">.[01]</span><span class="si">{</span><span class="n">nums</span><span class="si">}{</span><span class="n">nums</span><span class="si">}</span><span class="s1">&#39;</span>
            <span class="n">pattern</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">compile</span><span class="p">(</span><span class="n">search_pattern</span><span class="p">)</span>
            <span class="n">filelist</span> <span class="o">=</span> <span class="n">pattern</span><span class="o">.</span><span class="n">findall</span><span class="p">(</span><span class="n">members</span><span class="p">)</span>
            <span class="n">files</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="k">for</span> <span class="n">file</span> <span class="ow">in</span> <span class="n">filelist</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">file</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">files</span><span class="p">:</span> <span class="n">files</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">file</span><span class="p">)</span> <span class="c1">#remove duplicates</span>
            
            <span class="c1">#Read in all NHC forecast discussions</span>
            <span class="n">discos</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;id&#39;</span><span class="p">:[],</span><span class="s1">&#39;utc_date&#39;</span><span class="p">:[],</span><span class="s1">&#39;url&#39;</span><span class="p">:[],</span><span class="s1">&#39;mode&#39;</span><span class="p">:</span><span class="mi">3</span><span class="p">}</span>
            <span class="k">for</span> <span class="n">file</span> <span class="ow">in</span> <span class="n">files</span><span class="p">:</span>

                <span class="c1">#Get info about forecast</span>
                <span class="n">file_info</span> <span class="o">=</span> <span class="n">file</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;.&quot;</span><span class="p">)</span>
                <span class="n">disco_number</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">file_info</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
                
                <span class="c1">#Open file to get info about time issued</span>
                <span class="n">members</span> <span class="o">=</span> <span class="n">tar</span><span class="o">.</span><span class="n">getmembers</span><span class="p">()</span>
                <span class="n">members_names</span> <span class="o">=</span> <span class="p">[</span><span class="n">i</span><span class="o">.</span><span class="n">name</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">members</span><span class="p">]</span>
                <span class="n">idx</span> <span class="o">=</span> <span class="n">members_names</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="n">file</span><span class="p">)</span>
                <span class="n">f</span> <span class="o">=</span> <span class="n">tar</span><span class="o">.</span><span class="n">extractfile</span><span class="p">(</span><span class="n">members</span><span class="p">[</span><span class="n">idx</span><span class="p">])</span>
                <span class="n">content</span> <span class="o">=</span> <span class="p">(</span><span class="n">f</span><span class="o">.</span><span class="n">read</span><span class="p">())</span><span class="o">.</span><span class="n">decode</span><span class="p">()</span>
                <span class="n">f</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
                <span class="n">content</span> <span class="o">=</span> <span class="n">content</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
                
                <span class="c1">#Figure out time issued</span>
                <span class="n">hr</span> <span class="o">=</span> <span class="n">content</span><span class="p">[</span><span class="mi">4</span><span class="p">]</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot; &quot;</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
                <span class="n">zone</span> <span class="o">=</span> <span class="n">content</span><span class="p">[</span><span class="mi">4</span><span class="p">]</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot; &quot;</span><span class="p">)[</span><span class="mi">2</span><span class="p">]</span>
                <span class="n">disco_time</span> <span class="o">=</span> <span class="n">num_to_str2</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">hr</span><span class="p">))</span> <span class="o">+</span> <span class="s1">&#39; &#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">content</span><span class="p">[</span><span class="mi">4</span><span class="p">]</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot; &quot;</span><span class="p">)[</span><span class="mi">1</span><span class="p">:])</span>
                <span class="n">disco_date</span> <span class="o">=</span> <span class="n">dt</span><span class="o">.</span><span class="n">strptime</span><span class="p">(</span><span class="n">content</span><span class="p">[</span><span class="mi">4</span><span class="p">],</span><span class="sa">f</span><span class="s1">&#39;%I %p </span><span class="si">{</span><span class="n">zone</span><span class="si">}</span><span class="s1"> %a %b %d %Y&#39;</span><span class="p">)</span>
                
                <span class="n">time_zones</span> <span class="o">=</span> <span class="p">{</span>
                <span class="s1">&#39;ADT&#39;</span><span class="p">:</span><span class="o">-</span><span class="mi">3</span><span class="p">,</span>
                <span class="s1">&#39;AST&#39;</span><span class="p">:</span><span class="o">-</span><span class="mi">4</span><span class="p">,</span>
                <span class="s1">&#39;EDT&#39;</span><span class="p">:</span><span class="o">-</span><span class="mi">4</span><span class="p">,</span>
                <span class="s1">&#39;EST&#39;</span><span class="p">:</span><span class="o">-</span><span class="mi">5</span><span class="p">,</span>
                <span class="s1">&#39;CDT&#39;</span><span class="p">:</span><span class="o">-</span><span class="mi">5</span><span class="p">,</span>
                <span class="s1">&#39;CST&#39;</span><span class="p">:</span><span class="o">-</span><span class="mi">6</span><span class="p">,</span>
                <span class="s1">&#39;MDT&#39;</span><span class="p">:</span><span class="o">-</span><span class="mi">6</span><span class="p">,</span>
                <span class="s1">&#39;MST&#39;</span><span class="p">:</span><span class="o">-</span><span class="mi">7</span><span class="p">,</span>
                <span class="s1">&#39;PDT&#39;</span><span class="p">:</span><span class="o">-</span><span class="mi">7</span><span class="p">,</span>
                <span class="s1">&#39;PST&#39;</span><span class="p">:</span><span class="o">-</span><span class="mi">8</span><span class="p">,</span>
                <span class="s1">&#39;HDT&#39;</span><span class="p">:</span><span class="o">-</span><span class="mi">9</span><span class="p">,</span>
                <span class="s1">&#39;HST&#39;</span><span class="p">:</span><span class="o">-</span><span class="mi">10</span><span class="p">}</span>
                <span class="n">offset</span> <span class="o">=</span> <span class="n">time_zones</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">zone</span><span class="p">,</span><span class="mi">0</span><span class="p">)</span>
                <span class="n">disco_date</span> <span class="o">=</span> <span class="n">disco_date</span> <span class="o">+</span> <span class="n">timedelta</span><span class="p">(</span><span class="n">hours</span><span class="o">=</span><span class="n">offset</span><span class="o">*-</span><span class="mi">1</span><span class="p">)</span>
                
                <span class="c1">#Add times issued</span>
                <span class="n">discos</span><span class="p">[</span><span class="s1">&#39;id&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">disco_number</span><span class="p">)</span>
                <span class="n">discos</span><span class="p">[</span><span class="s1">&#39;utc_date&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">disco_date</span><span class="p">)</span>
                <span class="n">discos</span><span class="p">[</span><span class="s1">&#39;url&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">file</span><span class="p">)</span>
                
            <span class="n">response</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
            <span class="n">tar</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
            
        <span class="k">elif</span> <span class="n">storm_year</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">2001</span><span class="p">,</span><span class="mi">2006</span><span class="p">):</span>
            <span class="c1">#Get directory path of storm and read it in</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">url_disco</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;https://ftp.nhc.noaa.gov/atcf/archive/</span><span class="si">{</span><span class="n">storm_year</span><span class="si">}</span><span class="s2">/messages/&quot;</span>
                <span class="n">url</span> <span class="o">=</span> <span class="n">url_disco</span> <span class="o">+</span> <span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">storm_id</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span><span class="si">}</span><span class="s1">_msgs.tar.gz&#39;</span>
                <span class="k">if</span> <span class="n">storm_year</span> <span class="o">&lt;</span> <span class="mi">2003</span><span class="p">:</span> <span class="n">url</span> <span class="o">=</span> <span class="n">url_disco</span> <span class="o">+</span> <span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">storm_id</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span><span class="si">}</span><span class="s1">.msgs.tar.gz&#39;</span>
                <span class="n">request</span> <span class="o">=</span> <span class="n">urllib</span><span class="o">.</span><span class="n">request</span><span class="o">.</span><span class="n">Request</span><span class="p">(</span><span class="n">url</span><span class="p">)</span>
                <span class="n">response</span> <span class="o">=</span> <span class="n">urllib</span><span class="o">.</span><span class="n">request</span><span class="o">.</span><span class="n">urlopen</span><span class="p">(</span><span class="n">request</span><span class="p">)</span>
                <span class="n">file_like_object</span> <span class="o">=</span> <span class="n">BytesIO</span><span class="p">(</span><span class="n">response</span><span class="o">.</span><span class="n">read</span><span class="p">())</span>
                <span class="n">tar</span> <span class="o">=</span> <span class="n">tarfile</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="n">fileobj</span><span class="o">=</span><span class="n">file_like_object</span><span class="p">)</span>
            <span class="k">except</span><span class="p">:</span>
                <span class="k">try</span><span class="p">:</span>
                    <span class="n">url_disco</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;ftp://ftp.nhc.noaa.gov/atcf/archive/</span><span class="si">{</span><span class="n">storm_year</span><span class="si">}</span><span class="s2">/messages/&quot;</span>
                    <span class="n">url</span> <span class="o">=</span> <span class="n">url_disco</span> <span class="o">+</span> <span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">storm_id</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span><span class="si">}</span><span class="s1">_msgs.tar.gz&#39;</span>
                    <span class="k">if</span> <span class="n">storm_year</span> <span class="o">&lt;</span> <span class="mi">2003</span><span class="p">:</span> <span class="n">url</span> <span class="o">=</span> <span class="n">url_disco</span> <span class="o">+</span> <span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">storm_id</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span><span class="si">}</span><span class="s1">.msgs.tar.gz&#39;</span>
                    <span class="n">request</span> <span class="o">=</span> <span class="n">urllib</span><span class="o">.</span><span class="n">request</span><span class="o">.</span><span class="n">Request</span><span class="p">(</span><span class="n">url</span><span class="p">)</span>
                    <span class="n">response</span> <span class="o">=</span> <span class="n">urllib</span><span class="o">.</span><span class="n">request</span><span class="o">.</span><span class="n">urlopen</span><span class="p">(</span><span class="n">request</span><span class="p">)</span>
                    <span class="n">file_like_object</span> <span class="o">=</span> <span class="n">BytesIO</span><span class="p">(</span><span class="n">response</span><span class="o">.</span><span class="n">read</span><span class="p">())</span>
                    <span class="n">tar</span> <span class="o">=</span> <span class="n">tarfile</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="n">fileobj</span><span class="o">=</span><span class="n">file_like_object</span><span class="p">)</span>
                <span class="k">except</span><span class="p">:</span>
                    <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span><span class="s2">&quot;NHC discussion data is unavailable.&quot;</span><span class="p">)</span>

            <span class="c1">#Get file list</span>
            <span class="n">members</span> <span class="o">=</span> <span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="n">i</span><span class="o">.</span><span class="n">name</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">tar</span><span class="o">.</span><span class="n">getmembers</span><span class="p">()])</span>
            <span class="n">nums</span> <span class="o">=</span> <span class="s2">&quot;[0123456789]&quot;</span>
            <span class="n">search_pattern</span> <span class="o">=</span> <span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">storm_id</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span><span class="si">}</span><span class="s1">.discus.[01]</span><span class="si">{</span><span class="n">nums</span><span class="si">}{</span><span class="n">nums</span><span class="si">}</span><span class="s1">.</span><span class="si">{</span><span class="n">nums</span><span class="si">}{</span><span class="n">nums</span><span class="si">}{</span><span class="n">nums</span><span class="si">}{</span><span class="n">nums</span><span class="si">}{</span><span class="n">nums</span><span class="si">}{</span><span class="n">nums</span><span class="si">}{</span><span class="n">nums</span><span class="si">}{</span><span class="n">nums</span><span class="si">}</span><span class="s1">&#39;</span>
            <span class="n">pattern</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">compile</span><span class="p">(</span><span class="n">search_pattern</span><span class="p">)</span>
            <span class="n">filelist</span> <span class="o">=</span> <span class="n">pattern</span><span class="o">.</span><span class="n">findall</span><span class="p">(</span><span class="n">members</span><span class="p">)</span>
            <span class="n">files</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="k">for</span> <span class="n">file</span> <span class="ow">in</span> <span class="n">filelist</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">file</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">files</span><span class="p">:</span> <span class="n">files</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">file</span><span class="p">)</span> <span class="c1">#remove duplicates</span>
            <span class="n">response</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
            <span class="n">tar</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
            
            <span class="c1">#Read in all NHC forecast discussions</span>
            <span class="n">discos</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;id&#39;</span><span class="p">:[],</span><span class="s1">&#39;utc_date&#39;</span><span class="p">:[],</span><span class="s1">&#39;url&#39;</span><span class="p">:[],</span><span class="s1">&#39;mode&#39;</span><span class="p">:</span><span class="mi">1</span><span class="p">}</span>
            <span class="k">for</span> <span class="n">file</span> <span class="ow">in</span> <span class="n">files</span><span class="p">:</span>

                <span class="c1">#Get info about forecast</span>
                <span class="n">file_info</span> <span class="o">=</span> <span class="n">file</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;.&quot;</span><span class="p">)</span>
                <span class="n">disco_number</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">file_info</span><span class="p">[</span><span class="mi">2</span><span class="p">])</span>
                <span class="n">disco_time</span> <span class="o">=</span> <span class="n">file_info</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span>
                <span class="n">disco_year</span> <span class="o">=</span> <span class="n">storm_year</span>
                <span class="k">if</span> <span class="n">disco_time</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="mi">2</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;01&quot;</span> <span class="ow">and</span> <span class="nb">int</span><span class="p">(</span><span class="n">storm_id</span><span class="p">[</span><span class="mi">2</span><span class="p">:</span><span class="mi">4</span><span class="p">])</span> <span class="o">&gt;</span> <span class="mi">3</span><span class="p">:</span>
                    <span class="n">disco_year</span> <span class="o">=</span> <span class="n">storm_year</span> <span class="o">+</span> <span class="mi">1</span>
                <span class="n">disco_date</span> <span class="o">=</span> <span class="n">dt</span><span class="o">.</span><span class="n">strptime</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">disco_year</span><span class="p">)</span><span class="o">+</span><span class="n">disco_time</span><span class="p">,</span><span class="s1">&#39;%Y%m</span><span class="si">%d</span><span class="s1">%H%M&#39;</span><span class="p">)</span>

                <span class="n">discos</span><span class="p">[</span><span class="s1">&#39;id&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">disco_number</span><span class="p">)</span>
                <span class="n">discos</span><span class="p">[</span><span class="s1">&#39;utc_date&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">disco_date</span><span class="p">)</span>
                <span class="n">discos</span><span class="p">[</span><span class="s1">&#39;url&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">file</span><span class="p">)</span>
                
            <span class="k">if</span> <span class="n">storm_year</span> <span class="o">&lt;</span> <span class="mi">2003</span><span class="p">:</span> <span class="n">discos</span><span class="p">[</span><span class="s1">&#39;mode&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">2</span>
            
        <span class="k">else</span><span class="p">:</span>
            <span class="c1">#Retrieve list of NHC discussions for this storm</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">url_disco</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;https://ftp.nhc.noaa.gov/atcf/archive/</span><span class="si">{</span><span class="n">storm_year</span><span class="si">}</span><span class="s2">/messages/&quot;</span>
                <span class="n">path_disco</span> <span class="o">=</span> <span class="n">urllib</span><span class="o">.</span><span class="n">request</span><span class="o">.</span><span class="n">urlopen</span><span class="p">(</span><span class="n">url_disco</span><span class="p">)</span>
                <span class="n">string</span> <span class="o">=</span> <span class="n">path_disco</span><span class="o">.</span><span class="n">read</span><span class="p">()</span><span class="o">.</span><span class="n">decode</span><span class="p">(</span><span class="s1">&#39;utf-8&#39;</span><span class="p">)</span>
                <span class="n">nums</span> <span class="o">=</span> <span class="s2">&quot;[0123456789]&quot;</span>
                <span class="n">search_pattern</span> <span class="o">=</span> <span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">storm_id</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span><span class="si">}</span><span class="s1">.discus.[01]</span><span class="si">{</span><span class="n">nums</span><span class="si">}{</span><span class="n">nums</span><span class="si">}</span><span class="s1">.</span><span class="si">{</span><span class="n">nums</span><span class="si">}{</span><span class="n">nums</span><span class="si">}{</span><span class="n">nums</span><span class="si">}{</span><span class="n">nums</span><span class="si">}{</span><span class="n">nums</span><span class="si">}{</span><span class="n">nums</span><span class="si">}{</span><span class="n">nums</span><span class="si">}{</span><span class="n">nums</span><span class="si">}</span><span class="s1">&#39;</span>
                <span class="n">pattern</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">compile</span><span class="p">(</span><span class="n">search_pattern</span><span class="p">)</span>
                <span class="n">filelist</span> <span class="o">=</span> <span class="n">pattern</span><span class="o">.</span><span class="n">findall</span><span class="p">(</span><span class="n">string</span><span class="p">)</span>
                <span class="n">files</span> <span class="o">=</span> <span class="p">[]</span>
                <span class="k">for</span> <span class="n">file</span> <span class="ow">in</span> <span class="n">filelist</span><span class="p">:</span>
                    <span class="k">if</span> <span class="n">file</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">files</span><span class="p">:</span> <span class="n">files</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">file</span><span class="p">)</span> <span class="c1">#remove duplicates</span>
                <span class="n">path_disco</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
            <span class="k">except</span><span class="p">:</span>
                <span class="k">try</span><span class="p">:</span>
                    <span class="n">url_disco</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;ftp://ftp.nhc.noaa.gov/atcf/archive/</span><span class="si">{</span><span class="n">storm_year</span><span class="si">}</span><span class="s2">/messages/&quot;</span>
                    <span class="n">path_disco</span> <span class="o">=</span> <span class="n">urllib</span><span class="o">.</span><span class="n">request</span><span class="o">.</span><span class="n">urlopen</span><span class="p">(</span><span class="n">url_disco</span><span class="p">)</span>
                    <span class="n">string</span> <span class="o">=</span> <span class="n">path_disco</span><span class="o">.</span><span class="n">read</span><span class="p">()</span><span class="o">.</span><span class="n">decode</span><span class="p">(</span><span class="s1">&#39;utf-8&#39;</span><span class="p">)</span>
                    <span class="n">nums</span> <span class="o">=</span> <span class="s2">&quot;[0123456789]&quot;</span>
                    <span class="n">search_pattern</span> <span class="o">=</span> <span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">storm_id</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span><span class="si">}</span><span class="s1">.discus.[01]</span><span class="si">{</span><span class="n">nums</span><span class="si">}{</span><span class="n">nums</span><span class="si">}</span><span class="s1">.</span><span class="si">{</span><span class="n">nums</span><span class="si">}{</span><span class="n">nums</span><span class="si">}{</span><span class="n">nums</span><span class="si">}{</span><span class="n">nums</span><span class="si">}{</span><span class="n">nums</span><span class="si">}{</span><span class="n">nums</span><span class="si">}{</span><span class="n">nums</span><span class="si">}{</span><span class="n">nums</span><span class="si">}</span><span class="s1">&#39;</span>
                    <span class="n">pattern</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">compile</span><span class="p">(</span><span class="n">search_pattern</span><span class="p">)</span>
                    <span class="n">filelist</span> <span class="o">=</span> <span class="n">pattern</span><span class="o">.</span><span class="n">findall</span><span class="p">(</span><span class="n">string</span><span class="p">)</span>
                    <span class="n">files</span> <span class="o">=</span> <span class="p">[]</span>
                    <span class="k">for</span> <span class="n">file</span> <span class="ow">in</span> <span class="n">filelist</span><span class="p">:</span>
                        <span class="k">if</span> <span class="n">file</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">files</span><span class="p">:</span> <span class="n">files</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">file</span><span class="p">)</span> <span class="c1">#remove duplicates</span>
                    <span class="n">path_disco</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
                <span class="k">except</span><span class="p">:</span>
                    <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span><span class="s2">&quot;NHC discussion data is unavailable.&quot;</span><span class="p">)</span>

            <span class="c1">#Read in all NHC forecast discussions</span>
            <span class="n">discos</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;id&#39;</span><span class="p">:[],</span><span class="s1">&#39;utc_date&#39;</span><span class="p">:[],</span><span class="s1">&#39;url&#39;</span><span class="p">:[],</span><span class="s1">&#39;mode&#39;</span><span class="p">:</span><span class="mi">0</span><span class="p">}</span>
            <span class="k">for</span> <span class="n">file</span> <span class="ow">in</span> <span class="n">files</span><span class="p">:</span>

                <span class="c1">#Get info about forecast</span>
                <span class="n">file_info</span> <span class="o">=</span> <span class="n">file</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;.&quot;</span><span class="p">)</span>
                <span class="n">disco_number</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">file_info</span><span class="p">[</span><span class="mi">2</span><span class="p">])</span>
                <span class="n">disco_time</span> <span class="o">=</span> <span class="n">file_info</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span>
                <span class="n">disco_year</span> <span class="o">=</span> <span class="n">storm_year</span>
                <span class="k">if</span> <span class="n">disco_time</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="mi">2</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;01&quot;</span> <span class="ow">and</span> <span class="nb">int</span><span class="p">(</span><span class="n">storm_id</span><span class="p">[</span><span class="mi">2</span><span class="p">:</span><span class="mi">4</span><span class="p">])</span> <span class="o">&gt;</span> <span class="mi">3</span><span class="p">:</span>
                    <span class="n">disco_year</span> <span class="o">=</span> <span class="n">storm_year</span> <span class="o">+</span> <span class="mi">1</span>
                <span class="n">disco_date</span> <span class="o">=</span> <span class="n">dt</span><span class="o">.</span><span class="n">strptime</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">disco_year</span><span class="p">)</span><span class="o">+</span><span class="n">disco_time</span><span class="p">,</span><span class="s1">&#39;%Y%m</span><span class="si">%d</span><span class="s1">%H%M&#39;</span><span class="p">)</span>

                <span class="n">discos</span><span class="p">[</span><span class="s1">&#39;id&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">disco_number</span><span class="p">)</span>
                <span class="n">discos</span><span class="p">[</span><span class="s1">&#39;utc_date&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">disco_date</span><span class="p">)</span>
                <span class="n">discos</span><span class="p">[</span><span class="s1">&#39;url&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">url_disco</span> <span class="o">+</span> <span class="n">file</span><span class="p">)</span>
                
        <span class="c1">#Return dict entry</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">discos</span>
        <span class="k">except</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span><span class="s2">&quot;NHC discussion data is unavailable.&quot;</span><span class="p">)</span>
            
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">discos</span><span class="p">[</span><span class="s1">&#39;id&#39;</span><span class="p">])</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span><span class="s2">&quot;NHC discussion data is unavailable.&quot;</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">discos</span></div>
        
<div class="viewcode-block" id="Storm.get_nhc_discussion"><a class="viewcode-back" href="../../../api/generated/tropycal.tracks.Storm.get_nhc_discussion.html#tropycal.tracks.Storm.get_nhc_discussion">[docs]</a>    <span class="k">def</span> <span class="nf">get_nhc_discussion</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">forecast</span><span class="p">,</span><span class="n">save_path</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        
        <span class="sa">r</span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Retrieves a single NHC forecast discussion.</span>
<span class="sd">        </span>
<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        forecast : datetime.datetime or int</span>
<span class="sd">            Datetime object representing the desired forecast discussion time (in UTC), or integer representing the forecast discussion ID. If -1 is passed, the latest forecast discussion is returned.</span>
<span class="sd">        save_path : str, optional</span>
<span class="sd">            Directory path to save the forecast discussion text to. If None (default), forecast won&#39;t be saved.</span>
<span class="sd">        </span>
<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        dict</span>
<span class="sd">            Dictionary containing the forecast discussion text and accompanying information about this discussion.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        
        <span class="c1">#Check to ensure the data source is HURDAT</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">source</span> <span class="o">!=</span> <span class="s2">&quot;hurdat&quot;</span><span class="p">:</span>
            <span class="n">msg</span> <span class="o">=</span> <span class="s2">&quot;Error: NHC data can only be accessed when HURDAT is used as the data source.&quot;</span>
            <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>
        
        <span class="c1">#Check to ensure storm is not an invest</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">invest</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span><span class="s2">&quot;Error: NHC does not issue advisories for invests that have not been designated as Potential Tropical Cyclones.&quot;</span><span class="p">)</span>
        
        <span class="c1">#Get storm ID &amp; corresponding data URL</span>
        <span class="n">storm_id</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">dict</span><span class="p">[</span><span class="s1">&#39;operational_id&#39;</span><span class="p">]</span>
        <span class="n">storm_year</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">dict</span><span class="p">[</span><span class="s1">&#39;year&#39;</span><span class="p">]</span>
        
        <span class="c1">#Error check</span>
        <span class="k">if</span> <span class="n">storm_id</span> <span class="o">==</span> <span class="s1">&#39;&#39;</span><span class="p">:</span>
            <span class="n">msg</span> <span class="o">=</span> <span class="s2">&quot;No NHC operational data is available for this storm.&quot;</span>
            <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>
        
        <span class="c1">#Error check</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">forecast</span><span class="p">,</span><span class="nb">int</span><span class="p">)</span> <span class="o">==</span> <span class="kc">False</span> <span class="ow">and</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">forecast</span><span class="p">,</span><span class="n">dt</span><span class="p">)</span> <span class="o">==</span> <span class="kc">False</span><span class="p">:</span>
            <span class="n">msg</span> <span class="o">=</span> <span class="s2">&quot;forecast must be of type int or datetime.datetime&quot;</span>
            <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>
        
        <span class="c1">#Get list of storm discussions</span>
        <span class="n">disco_dict</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">list_nhc_discussions</span><span class="p">()</span>
        
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">forecast</span><span class="p">,</span><span class="n">dt</span><span class="p">):</span>
            <span class="c1">#Find closest discussion to the time provided</span>
            <span class="n">disco_times</span> <span class="o">=</span> <span class="n">disco_dict</span><span class="p">[</span><span class="s1">&#39;utc_date&#39;</span><span class="p">]</span>
            <span class="n">disco_ids</span> <span class="o">=</span> <span class="p">[</span><span class="nb">int</span><span class="p">(</span><span class="n">i</span><span class="p">)</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">disco_dict</span><span class="p">[</span><span class="s1">&#39;id&#39;</span><span class="p">]]</span>
            <span class="n">disco_diff</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([(</span><span class="n">i</span><span class="o">-</span><span class="n">forecast</span><span class="p">)</span><span class="o">.</span><span class="n">days</span> <span class="o">+</span> <span class="p">(</span><span class="n">i</span><span class="o">-</span><span class="n">forecast</span><span class="p">)</span><span class="o">.</span><span class="n">seconds</span><span class="o">/</span><span class="mi">86400</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">disco_times</span><span class="p">])</span>
            <span class="n">closest_idx</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">disco_diff</span><span class="p">)</span><span class="o">.</span><span class="n">argmin</span><span class="p">()</span>
            <span class="n">closest_diff</span> <span class="o">=</span> <span class="n">disco_diff</span><span class="p">[</span><span class="n">closest_idx</span><span class="p">]</span>
            <span class="n">closest_id</span> <span class="o">=</span> <span class="n">disco_ids</span><span class="p">[</span><span class="n">closest_idx</span><span class="p">]</span>
            <span class="n">closest_time</span> <span class="o">=</span> <span class="n">disco_times</span><span class="p">[</span><span class="n">closest_idx</span><span class="p">]</span>
        
            <span class="c1">#Raise warning if difference is &gt;=1 day</span>
            <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">closest_diff</span><span class="p">)</span> <span class="o">&gt;=</span> <span class="mf">1.0</span><span class="p">:</span>
                <span class="n">warnings</span><span class="o">.</span><span class="n">warn</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;The date provided is unavailable or outside of the duration of the storm. Use the </span><span class="se">\&quot;</span><span class="s2">list_nhc_discussions()</span><span class="se">\&quot;</span><span class="s2"> function to retrieve a list of available NHC discussions for this storm. Returning the closest available NHC discussion.&quot;</span><span class="p">)</span>
                
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">forecast</span><span class="p">,</span><span class="nb">int</span><span class="p">):</span>
            <span class="c1">#Find closest discussion ID to the one provided</span>
            <span class="n">disco_times</span> <span class="o">=</span> <span class="n">disco_dict</span><span class="p">[</span><span class="s1">&#39;utc_date&#39;</span><span class="p">]</span>
            <span class="n">disco_ids</span> <span class="o">=</span> <span class="p">[</span><span class="nb">int</span><span class="p">(</span><span class="n">i</span><span class="p">)</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">disco_dict</span><span class="p">[</span><span class="s1">&#39;id&#39;</span><span class="p">]]</span>
            <span class="k">if</span> <span class="n">forecast</span> <span class="o">==</span> <span class="o">-</span><span class="mi">1</span><span class="p">:</span>
                <span class="n">closest_idx</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">disco_diff</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">i</span><span class="o">-</span><span class="n">forecast</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">disco_ids</span><span class="p">])</span>
                <span class="n">closest_idx</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">disco_diff</span><span class="p">)</span><span class="o">.</span><span class="n">argmin</span><span class="p">()</span>
                <span class="n">closest_diff</span> <span class="o">=</span> <span class="n">disco_diff</span><span class="p">[</span><span class="n">closest_idx</span><span class="p">]</span>
                
                <span class="c1">#Raise warning if difference is &gt;=1 ids</span>
                <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">closest_diff</span><span class="p">)</span> <span class="o">&gt;=</span> <span class="mf">2.0</span><span class="p">:</span>
                    <span class="n">msg</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;The ID provided is unavailable or outside of the duration of the storm. Use the </span><span class="se">\&quot;</span><span class="s2">list_nhc_discussions()</span><span class="se">\&quot;</span><span class="s2"> function to retrieve a list of available NHC discussions for this storm. Returning the closest available NHC discussion.&quot;</span>
                    <span class="n">warnings</span><span class="o">.</span><span class="n">warn</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>

            <span class="n">closest_id</span> <span class="o">=</span> <span class="n">disco_ids</span><span class="p">[</span><span class="n">closest_idx</span><span class="p">]</span>
            <span class="n">closest_time</span> <span class="o">=</span> <span class="n">disco_times</span><span class="p">[</span><span class="n">closest_idx</span><span class="p">]</span>
        
            
        <span class="c1">#Read content of NHC forecast discussion</span>
        <span class="k">if</span> <span class="n">disco_dict</span><span class="p">[</span><span class="s1">&#39;mode&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">url_disco</span> <span class="o">=</span> <span class="n">disco_dict</span><span class="p">[</span><span class="s1">&#39;url&#39;</span><span class="p">][</span><span class="n">closest_idx</span><span class="p">]</span>
            <span class="k">if</span> <span class="n">requests</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">url_disco</span><span class="p">)</span><span class="o">.</span><span class="n">status_code</span> <span class="o">!=</span> <span class="mi">200</span><span class="p">:</span> <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span><span class="s2">&quot;NHC discussion data is unavailable.&quot;</span><span class="p">)</span>
            <span class="n">f</span> <span class="o">=</span> <span class="n">urllib</span><span class="o">.</span><span class="n">request</span><span class="o">.</span><span class="n">urlopen</span><span class="p">(</span><span class="n">url_disco</span><span class="p">)</span>
            <span class="n">content</span> <span class="o">=</span> <span class="n">f</span><span class="o">.</span><span class="n">read</span><span class="p">()</span>
            <span class="n">content</span> <span class="o">=</span> <span class="n">content</span><span class="o">.</span><span class="n">decode</span><span class="p">(</span><span class="s2">&quot;utf-8&quot;</span><span class="p">)</span>
            <span class="n">f</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
            
        <span class="k">elif</span> <span class="n">disco_dict</span><span class="p">[</span><span class="s1">&#39;mode&#39;</span><span class="p">]</span> <span class="ow">in</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">3</span><span class="p">]:</span>
            <span class="c1">#Get directory path of storm and read it in</span>
            <span class="n">url_disco</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;https://ftp.nhc.noaa.gov/atcf/archive/</span><span class="si">{</span><span class="n">storm_year</span><span class="si">}</span><span class="s2">/messages/&quot;</span>
            <span class="n">url</span> <span class="o">=</span> <span class="n">url_disco</span> <span class="o">+</span> <span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">storm_id</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span><span class="si">}</span><span class="s1">_msgs.tar.gz&#39;</span>
            <span class="k">if</span> <span class="n">disco_dict</span><span class="p">[</span><span class="s1">&#39;mode&#39;</span><span class="p">]</span> <span class="ow">in</span> <span class="p">[</span><span class="mi">2</span><span class="p">,</span><span class="mi">3</span><span class="p">]:</span> <span class="n">url</span> <span class="o">=</span> <span class="n">url_disco</span> <span class="o">+</span> <span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">storm_id</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span><span class="si">}</span><span class="s1">.msgs.tar.gz&#39;</span>
            <span class="k">if</span> <span class="n">requests</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">url</span><span class="p">)</span><span class="o">.</span><span class="n">status_code</span> <span class="o">!=</span> <span class="mi">200</span><span class="p">:</span> <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span><span class="s2">&quot;NHC discussion data is unavailable.&quot;</span><span class="p">)</span>
            <span class="n">request</span> <span class="o">=</span> <span class="n">urllib</span><span class="o">.</span><span class="n">request</span><span class="o">.</span><span class="n">Request</span><span class="p">(</span><span class="n">url</span><span class="p">)</span>
            <span class="n">response</span> <span class="o">=</span> <span class="n">urllib</span><span class="o">.</span><span class="n">request</span><span class="o">.</span><span class="n">urlopen</span><span class="p">(</span><span class="n">request</span><span class="p">)</span>
            <span class="n">file_like_object</span> <span class="o">=</span> <span class="n">BytesIO</span><span class="p">(</span><span class="n">response</span><span class="o">.</span><span class="n">read</span><span class="p">())</span>
            <span class="n">tar</span> <span class="o">=</span> <span class="n">tarfile</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="n">fileobj</span><span class="o">=</span><span class="n">file_like_object</span><span class="p">)</span>
            
            <span class="n">members</span> <span class="o">=</span> <span class="n">tar</span><span class="o">.</span><span class="n">getmembers</span><span class="p">()</span>
            <span class="n">members_names</span> <span class="o">=</span> <span class="p">[</span><span class="n">i</span><span class="o">.</span><span class="n">name</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">members</span><span class="p">]</span>
            <span class="n">idx</span> <span class="o">=</span> <span class="n">members_names</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="n">disco_dict</span><span class="p">[</span><span class="s1">&#39;url&#39;</span><span class="p">][</span><span class="n">closest_idx</span><span class="p">])</span>
            <span class="n">f</span> <span class="o">=</span> <span class="n">tar</span><span class="o">.</span><span class="n">extractfile</span><span class="p">(</span><span class="n">members</span><span class="p">[</span><span class="n">idx</span><span class="p">])</span>
            <span class="n">content</span> <span class="o">=</span> <span class="p">(</span><span class="n">f</span><span class="o">.</span><span class="n">read</span><span class="p">())</span><span class="o">.</span><span class="n">decode</span><span class="p">()</span>
            <span class="n">f</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
            <span class="n">tar</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
            <span class="n">response</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
            
        <span class="k">elif</span> <span class="n">disco_dict</span><span class="p">[</span><span class="s1">&#39;mode&#39;</span><span class="p">]</span> <span class="ow">in</span> <span class="p">[</span><span class="mi">4</span><span class="p">]:</span>
            <span class="c1">#Get directory path of storm and read it in</span>
            <span class="n">url_disco</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;https://ftp.nhc.noaa.gov/atcf/archive/</span><span class="si">{</span><span class="n">storm_year</span><span class="si">}</span><span class="s2">/messages/&quot;</span>
            <span class="n">url</span> <span class="o">=</span> <span class="n">url_disco</span> <span class="o">+</span> <span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">storm_id</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span><span class="si">}</span><span class="s1">_msg.zip&#39;</span>
            <span class="k">if</span> <span class="n">requests</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">url</span><span class="p">)</span><span class="o">.</span><span class="n">status_code</span> <span class="o">!=</span> <span class="mi">200</span><span class="p">:</span> <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span><span class="s2">&quot;NHC discussion data is unavailable.&quot;</span><span class="p">)</span>
            <span class="n">request</span> <span class="o">=</span> <span class="n">urllib</span><span class="o">.</span><span class="n">request</span><span class="o">.</span><span class="n">Request</span><span class="p">(</span><span class="n">url</span><span class="p">)</span>
            <span class="n">response</span> <span class="o">=</span> <span class="n">urllib</span><span class="o">.</span><span class="n">request</span><span class="o">.</span><span class="n">urlopen</span><span class="p">(</span><span class="n">request</span><span class="p">)</span>
            <span class="n">file_like_object</span> <span class="o">=</span> <span class="n">BytesIO</span><span class="p">(</span><span class="n">response</span><span class="o">.</span><span class="n">read</span><span class="p">())</span>
            <span class="n">tar</span> <span class="o">=</span> <span class="n">zipfile</span><span class="o">.</span><span class="n">ZipFile</span><span class="p">(</span><span class="n">file_like_object</span><span class="p">)</span>
            
            <span class="n">members</span> <span class="o">=</span> <span class="n">tar</span><span class="o">.</span><span class="n">namelist</span><span class="p">()</span>
            <span class="n">members_names</span> <span class="o">=</span> <span class="p">[</span><span class="n">i</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">members</span><span class="p">]</span>
            <span class="n">idx</span> <span class="o">=</span> <span class="n">members_names</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="n">disco_dict</span><span class="p">[</span><span class="s1">&#39;url&#39;</span><span class="p">][</span><span class="n">closest_idx</span><span class="p">])</span>
            <span class="n">content</span> <span class="o">=</span> <span class="p">(</span><span class="n">tar</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="n">members</span><span class="p">[</span><span class="n">idx</span><span class="p">]))</span><span class="o">.</span><span class="n">decode</span><span class="p">()</span>
            <span class="n">tar</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
            <span class="n">response</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
        
        <span class="c1">#Save file, if specified</span>
        <span class="k">if</span> <span class="n">save_path</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">closest_time</span> <span class="o">=</span> <span class="n">disco_times</span><span class="p">[</span><span class="n">closest_idx</span><span class="p">]</span><span class="o">.</span><span class="n">strftime</span><span class="p">(</span><span class="s2">&quot;%Y%m</span><span class="si">%d</span><span class="s2">_%H%M&quot;</span><span class="p">)</span>
            <span class="n">fname</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;nhc_disco_</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span><span class="si">}</span><span class="s2">_</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">year</span><span class="si">}</span><span class="s2">_</span><span class="si">{</span><span class="n">closest_time</span><span class="si">}</span><span class="s2">.txt&quot;</span>
            <span class="n">o</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span><span class="n">save_path</span><span class="o">+</span><span class="n">fname</span><span class="p">,</span><span class="s2">&quot;w&quot;</span><span class="p">)</span>
            <span class="n">o</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">content</span><span class="p">)</span>
            <span class="n">o</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
        
        <span class="c1">#Return text of NHC forecast discussion</span>
        <span class="k">return</span> <span class="p">{</span><span class="s1">&#39;id&#39;</span><span class="p">:</span><span class="n">closest_id</span><span class="p">,</span><span class="s1">&#39;time_issued&#39;</span><span class="p">:</span><span class="n">closest_time</span><span class="p">,</span><span class="s1">&#39;text&#39;</span><span class="p">:</span><span class="n">content</span><span class="p">}</span></div>
    
    
<div class="viewcode-block" id="Storm.query_nhc_discussions"><a class="viewcode-back" href="../../../api/generated/tropycal.tracks.Storm.query_nhc_discussions.html#tropycal.tracks.Storm.query_nhc_discussions">[docs]</a>    <span class="k">def</span> <span class="nf">query_nhc_discussions</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">query</span><span class="p">):</span>
        
        <span class="sa">r</span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Searches for the given word or phrase through all NHC forecast discussions for this storm.</span>
<span class="sd">        </span>
<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        query : str or list</span>
<span class="sd">            String or list representing a word(s) or phrase(s) to search for within the NHC forecast discussions (e.g., &quot;rapid intensification&quot;). Query is case insensitive.</span>
<span class="sd">        </span>
<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        list</span>
<span class="sd">            List of dictionaries containing all relevant forecast discussions.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        
        <span class="c1">#Check to ensure the data source is HURDAT</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">source</span> <span class="o">!=</span> <span class="s2">&quot;hurdat&quot;</span><span class="p">:</span>
            <span class="n">msg</span> <span class="o">=</span> <span class="s2">&quot;Error: NHC data can only be accessed when HURDAT is used as the data source.&quot;</span>
            <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>
        
        <span class="c1">#Check to ensure storm is not an invest</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">invest</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span><span class="s2">&quot;Error: NHC does not issue advisories for invests that have not been designated as Potential Tropical Cyclones.&quot;</span><span class="p">)</span>
        
        <span class="c1">#Get storm ID &amp; corresponding data URL</span>
        <span class="n">storm_id</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">dict</span><span class="p">[</span><span class="s1">&#39;operational_id&#39;</span><span class="p">]</span>
        <span class="n">storm_year</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">dict</span><span class="p">[</span><span class="s1">&#39;year&#39;</span><span class="p">]</span>
        
        <span class="c1">#Error check</span>
        <span class="k">if</span> <span class="n">storm_id</span> <span class="o">==</span> <span class="s1">&#39;&#39;</span><span class="p">:</span>
            <span class="n">msg</span> <span class="o">=</span> <span class="s2">&quot;No NHC operational data is available for this storm.&quot;</span>
            <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">query</span><span class="p">,</span><span class="nb">str</span><span class="p">)</span> <span class="o">==</span> <span class="kc">False</span> <span class="ow">and</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">query</span><span class="p">,</span><span class="nb">list</span><span class="p">)</span> <span class="o">==</span> <span class="kc">False</span><span class="p">:</span>
            <span class="n">msg</span> <span class="o">=</span> <span class="s2">&quot;&#39;query&#39; must be of type str or list.&quot;</span>
            <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">query</span><span class="p">,</span><span class="nb">list</span><span class="p">):</span>
            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">query</span><span class="p">:</span>
                <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="nb">str</span><span class="p">)</span> <span class="o">==</span> <span class="kc">False</span><span class="p">:</span>
                    <span class="n">msg</span> <span class="o">=</span> <span class="s2">&quot;Entries of list &#39;query&#39; must be of type str.&quot;</span>
                    <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>
        
        <span class="c1">#Get list of storm discussions</span>
        <span class="n">disco_dict</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">list_nhc_discussions</span><span class="p">()</span>
        
        <span class="c1">#Iterate over every entry to retrieve its discussion text</span>
        <span class="n">output</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">idx</span><span class="p">,</span><span class="n">forecast_date</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">disco_dict</span><span class="p">[</span><span class="s1">&#39;utc_date&#39;</span><span class="p">]):</span>
            
            <span class="c1">#Get forecast discussion</span>
            <span class="n">forecast</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_nhc_discussion</span><span class="p">(</span><span class="n">forecast</span><span class="o">=</span><span class="n">forecast_date</span><span class="p">)</span>
            
            <span class="c1">#Get forecast text and query for word</span>
            <span class="n">text</span> <span class="o">=</span> <span class="n">forecast</span><span class="p">[</span><span class="s1">&#39;text&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span>
            
            <span class="c1">#If found, add into list</span>
            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">query</span><span class="p">,</span><span class="nb">str</span><span class="p">):</span>
                <span class="k">if</span> <span class="n">text</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="n">query</span><span class="o">.</span><span class="n">lower</span><span class="p">())</span> <span class="o">&gt;=</span> <span class="mi">0</span><span class="p">:</span> <span class="n">output</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">forecast</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">found</span> <span class="o">=</span> <span class="kc">False</span>
                <span class="k">for</span> <span class="n">i_query</span> <span class="ow">in</span> <span class="n">query</span><span class="p">:</span>
                    <span class="k">if</span> <span class="n">text</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="n">i_query</span><span class="o">.</span><span class="n">lower</span><span class="p">())</span> <span class="o">&gt;=</span> <span class="mi">0</span><span class="p">:</span> <span class="n">found</span> <span class="o">=</span> <span class="kc">True</span>
                <span class="k">if</span> <span class="n">found</span><span class="p">:</span> <span class="n">output</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">forecast</span><span class="p">)</span>
            
        <span class="c1">#Return list</span>
        <span class="k">return</span> <span class="n">output</span></div>
    

<div class="viewcode-block" id="Storm.get_operational_forecasts"><a class="viewcode-back" href="../../../api/generated/tropycal.tracks.Storm.get_operational_forecasts.html#tropycal.tracks.Storm.get_operational_forecasts">[docs]</a>    <span class="k">def</span> <span class="nf">get_operational_forecasts</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>

        <span class="sa">r</span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Retrieves operational model and NHC forecasts throughout the entire life duration of the storm.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        dict</span>
<span class="sd">            Dictionary containing all forecast entries.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        
        <span class="c1">#Real time ensemble data:</span>
        <span class="c1">#https://www.ftp.ncep.noaa.gov/data/nccf/com/ens_tracker/prod/</span>
        
        <span class="c1">#If forecasts dict already exist, simply return the dict</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">forecast_dict</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">forecast_dict</span>
        <span class="k">except</span><span class="p">:</span>
            <span class="k">pass</span>
        
        <span class="c1">#Follow HURDAT procedure</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">source</span> <span class="o">==</span> <span class="s2">&quot;hurdat&quot;</span><span class="p">:</span>
            
            <span class="c1">#Get storm ID &amp; corresponding data URL</span>
            <span class="n">storm_id</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">dict</span><span class="p">[</span><span class="s1">&#39;operational_id&#39;</span><span class="p">]</span>
            <span class="n">storm_year</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">dict</span><span class="p">[</span><span class="s1">&#39;year&#39;</span><span class="p">]</span>
            <span class="k">if</span> <span class="n">storm_year</span> <span class="o">&lt;=</span> <span class="mi">2006</span><span class="p">:</span> <span class="n">storm_id</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">dict</span><span class="p">[</span><span class="s1">&#39;id&#39;</span><span class="p">]</span>
            <span class="k">if</span> <span class="n">storm_year</span> <span class="o">&lt;</span> <span class="mi">1954</span><span class="p">:</span>
                <span class="n">msg</span> <span class="o">=</span> <span class="s2">&quot;Forecast data is unavailable for storms prior to 1954.&quot;</span>
                <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>

            <span class="c1">#Error check</span>
            <span class="k">if</span> <span class="n">storm_id</span> <span class="o">==</span> <span class="s1">&#39;&#39;</span><span class="p">:</span>
                <span class="n">msg</span> <span class="o">=</span> <span class="s2">&quot;No NHC operational data is available for this storm.&quot;</span>
                <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>

            <span class="c1">#Check if archive directory exists for requested year, if not redirect to realtime directory</span>
            <span class="n">url_models</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;https://ftp.nhc.noaa.gov/atcf/archive/</span><span class="si">{</span><span class="n">storm_year</span><span class="si">}</span><span class="s2">/a</span><span class="si">{</span><span class="n">storm_id</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span><span class="si">}</span><span class="s2">.dat.gz&quot;</span>
            <span class="k">if</span> <span class="n">requests</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">url_models</span><span class="p">)</span><span class="o">.</span><span class="n">status_code</span> <span class="o">!=</span> <span class="mi">200</span><span class="p">:</span>
                <span class="n">url_models</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;https://ftp.nhc.noaa.gov/atcf/aid_public/a</span><span class="si">{</span><span class="n">storm_id</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span><span class="si">}</span><span class="s2">.dat.gz&quot;</span>
        
            <span class="c1">#Retrieve model data text</span>
            <span class="k">if</span> <span class="n">requests</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">url_models</span><span class="p">)</span><span class="o">.</span><span class="n">status_code</span> <span class="o">==</span> <span class="mi">200</span><span class="p">:</span>
                <span class="n">request</span> <span class="o">=</span> <span class="n">urllib</span><span class="o">.</span><span class="n">request</span><span class="o">.</span><span class="n">Request</span><span class="p">(</span><span class="n">url_models</span><span class="p">)</span>
                <span class="n">response</span> <span class="o">=</span> <span class="n">urllib</span><span class="o">.</span><span class="n">request</span><span class="o">.</span><span class="n">urlopen</span><span class="p">(</span><span class="n">request</span><span class="p">)</span>
                <span class="n">sio_buffer</span> <span class="o">=</span> <span class="n">BytesIO</span><span class="p">(</span><span class="n">response</span><span class="o">.</span><span class="n">read</span><span class="p">())</span>
                <span class="n">gzf</span> <span class="o">=</span> <span class="n">gzip</span><span class="o">.</span><span class="n">GzipFile</span><span class="p">(</span><span class="n">fileobj</span> <span class="o">=</span> <span class="n">sio_buffer</span><span class="p">)</span>
                <span class="n">data</span> <span class="o">=</span> <span class="n">gzf</span><span class="o">.</span><span class="n">read</span><span class="p">()</span>
                <span class="n">content</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">splitlines</span><span class="p">()</span>
                <span class="n">content</span> <span class="o">=</span> <span class="p">[(</span><span class="n">i</span><span class="o">.</span><span class="n">decode</span><span class="p">())</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;,&quot;</span><span class="p">)</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">content</span><span class="p">]</span>
                <span class="n">content</span> <span class="o">=</span> <span class="p">[</span><span class="n">i</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">content</span> <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">i</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">10</span><span class="p">]</span>
                <span class="n">response</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span><span class="s2">&quot;No operational model data is available for this storm.&quot;</span><span class="p">)</span>
        
        <span class="c1">#Follow JTWC procedure</span>
        <span class="k">else</span><span class="p">:</span>
            
            <span class="c1">#Get storm ID &amp; corresponding data URL</span>
            <span class="n">storm_year</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">dict</span><span class="p">[</span><span class="s1">&#39;year&#39;</span><span class="p">]</span>
            <span class="k">if</span> <span class="n">storm_year</span> <span class="o">&lt;</span> <span class="mi">2016</span><span class="p">:</span>
                <span class="n">msg</span> <span class="o">=</span> <span class="s2">&quot;Forecast data is unavailable for JTWC storms prior to 2016.&quot;</span>
                <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>
            <span class="n">url_models</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;http://hurricanes.ral.ucar.edu/repository/data/adecks_open/a</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">id</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span><span class="si">}</span><span class="s2">.dat&quot;</span>
            
            <span class="c1">#Retrieve model data text</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">f</span> <span class="o">=</span> <span class="n">urllib</span><span class="o">.</span><span class="n">request</span><span class="o">.</span><span class="n">urlopen</span><span class="p">(</span><span class="n">url_models</span><span class="p">)</span>
                <span class="n">content</span> <span class="o">=</span> <span class="n">f</span><span class="o">.</span><span class="n">read</span><span class="p">()</span>
                <span class="n">content</span> <span class="o">=</span> <span class="n">content</span><span class="o">.</span><span class="n">decode</span><span class="p">(</span><span class="s2">&quot;utf-8&quot;</span><span class="p">)</span>
                <span class="n">content</span> <span class="o">=</span> <span class="n">content</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
                <span class="n">content</span> <span class="o">=</span> <span class="p">[</span><span class="n">i</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;,&quot;</span><span class="p">)</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">content</span><span class="p">]</span>
                <span class="n">content</span> <span class="o">=</span> <span class="p">[</span><span class="n">i</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">content</span> <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">i</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">10</span><span class="p">]</span>
                <span class="n">f</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
            <span class="k">except</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span><span class="s2">&quot;No operational model data is available for this storm.&quot;</span><span class="p">)</span>

        <span class="c1">#Iterate through every line in content:</span>
        <span class="n">forecasts</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="n">content</span><span class="p">:</span>

            <span class="c1">#Get basic components</span>
            <span class="n">lineArray</span> <span class="o">=</span> <span class="p">[</span><span class="n">i</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot; &quot;</span><span class="p">,</span><span class="s2">&quot;&quot;</span><span class="p">)</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">line</span><span class="p">]</span>
            <span class="n">basin</span><span class="p">,</span><span class="n">number</span><span class="p">,</span><span class="n">run_init</span><span class="p">,</span><span class="n">n_a</span><span class="p">,</span><span class="n">model</span><span class="p">,</span><span class="n">fhr</span><span class="p">,</span><span class="n">lat</span><span class="p">,</span><span class="n">lon</span><span class="p">,</span><span class="n">vmax</span><span class="p">,</span><span class="n">mslp</span><span class="p">,</span><span class="n">stype</span> <span class="o">=</span> <span class="n">lineArray</span><span class="p">[:</span><span class="mi">11</span><span class="p">]</span>

            <span class="c1">#Enter into forecast dict</span>
            <span class="k">if</span> <span class="n">model</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">forecasts</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span> <span class="n">forecasts</span><span class="p">[</span><span class="n">model</span><span class="p">]</span> <span class="o">=</span> <span class="p">{}</span>
            <span class="k">if</span> <span class="n">run_init</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">forecasts</span><span class="p">[</span><span class="n">model</span><span class="p">]</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span> <span class="n">forecasts</span><span class="p">[</span><span class="n">model</span><span class="p">][</span><span class="n">run_init</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span>
                <span class="s1">&#39;fhr&#39;</span><span class="p">:[],</span><span class="s1">&#39;lat&#39;</span><span class="p">:[],</span><span class="s1">&#39;lon&#39;</span><span class="p">:[],</span><span class="s1">&#39;vmax&#39;</span><span class="p">:[],</span><span class="s1">&#39;mslp&#39;</span><span class="p">:[],</span><span class="s1">&#39;type&#39;</span><span class="p">:[],</span><span class="s1">&#39;init&#39;</span><span class="p">:</span><span class="n">dt</span><span class="o">.</span><span class="n">strptime</span><span class="p">(</span><span class="n">run_init</span><span class="p">,</span><span class="s1">&#39;%Y%m</span><span class="si">%d</span><span class="s1">%H&#39;</span><span class="p">)</span>
            <span class="p">}</span>

            <span class="c1">#Format lat &amp; lon</span>
            <span class="n">fhr</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">fhr</span><span class="p">)</span>
            <span class="k">if</span> <span class="s2">&quot;N&quot;</span> <span class="ow">in</span> <span class="n">lat</span><span class="p">:</span>
                <span class="n">lat_temp</span> <span class="o">=</span> <span class="n">lat</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;N&quot;</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
                <span class="n">lat</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">lat_temp</span><span class="p">)</span> <span class="o">*</span> <span class="mf">0.1</span>
            <span class="k">elif</span> <span class="s2">&quot;S&quot;</span> <span class="ow">in</span> <span class="n">lat</span><span class="p">:</span>
                <span class="n">lat_temp</span> <span class="o">=</span> <span class="n">lat</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;S&quot;</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
                <span class="n">lat</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">lat_temp</span><span class="p">)</span> <span class="o">*</span> <span class="o">-</span><span class="mf">0.1</span>
            <span class="k">if</span> <span class="s2">&quot;W&quot;</span> <span class="ow">in</span> <span class="n">lon</span><span class="p">:</span>
                <span class="n">lon_temp</span> <span class="o">=</span> <span class="n">lon</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;W&quot;</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
                <span class="n">lon</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">lon_temp</span><span class="p">)</span> <span class="o">*</span> <span class="o">-</span><span class="mf">0.1</span>
            <span class="k">elif</span> <span class="s2">&quot;E&quot;</span> <span class="ow">in</span> <span class="n">lon</span><span class="p">:</span>
                <span class="n">lon_temp</span> <span class="o">=</span> <span class="n">lon</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;E&quot;</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
                <span class="n">lon</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">lon_temp</span><span class="p">)</span> <span class="o">*</span> <span class="mf">0.1</span>
            
            <span class="c1">#Format vmax &amp; MSLP</span>
            <span class="k">if</span> <span class="n">vmax</span> <span class="o">==</span> <span class="s1">&#39;&#39;</span><span class="p">:</span>
                <span class="n">vmax</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nan</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">vmax</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">vmax</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">vmax</span> <span class="o">&lt;</span> <span class="mi">10</span> <span class="ow">or</span> <span class="n">vmax</span> <span class="o">&gt;</span> <span class="mi">300</span><span class="p">:</span> <span class="n">vmax</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nan</span>
            <span class="k">if</span> <span class="n">mslp</span> <span class="o">==</span> <span class="s1">&#39;&#39;</span><span class="p">:</span>
                <span class="n">mslp</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nan</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">mslp</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">mslp</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">mslp</span> <span class="o">&lt;</span> <span class="mi">1</span><span class="p">:</span> <span class="n">mslp</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nan</span>

            <span class="c1">#Add forecast data to dict if forecast hour isn&#39;t already there</span>
            <span class="k">if</span> <span class="n">fhr</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">forecasts</span><span class="p">[</span><span class="n">model</span><span class="p">][</span><span class="n">run_init</span><span class="p">][</span><span class="s1">&#39;fhr&#39;</span><span class="p">]:</span>
                <span class="k">if</span> <span class="n">model</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;OFCL&#39;</span><span class="p">,</span><span class="s1">&#39;OFCI&#39;</span><span class="p">]</span> <span class="ow">and</span> <span class="n">fhr</span> <span class="o">&gt;</span> <span class="mi">120</span><span class="p">:</span>
                    <span class="k">pass</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="k">if</span> <span class="n">lat</span> <span class="o">==</span> <span class="mf">0.0</span> <span class="ow">and</span> <span class="n">lon</span> <span class="o">==</span> <span class="mf">0.0</span><span class="p">:</span>
                        <span class="k">continue</span>
                    <span class="n">forecasts</span><span class="p">[</span><span class="n">model</span><span class="p">][</span><span class="n">run_init</span><span class="p">][</span><span class="s1">&#39;fhr&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">fhr</span><span class="p">)</span>
                    <span class="n">forecasts</span><span class="p">[</span><span class="n">model</span><span class="p">][</span><span class="n">run_init</span><span class="p">][</span><span class="s1">&#39;lat&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">lat</span><span class="p">)</span>
                    <span class="n">forecasts</span><span class="p">[</span><span class="n">model</span><span class="p">][</span><span class="n">run_init</span><span class="p">][</span><span class="s1">&#39;lon&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">lon</span><span class="p">)</span>
                    <span class="n">forecasts</span><span class="p">[</span><span class="n">model</span><span class="p">][</span><span class="n">run_init</span><span class="p">][</span><span class="s1">&#39;vmax&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">vmax</span><span class="p">)</span>
                    <span class="n">forecasts</span><span class="p">[</span><span class="n">model</span><span class="p">][</span><span class="n">run_init</span><span class="p">][</span><span class="s1">&#39;mslp&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">mslp</span><span class="p">)</span>
                    
                    <span class="c1">#Get storm type, if it can be determined</span>
                    <span class="k">if</span> <span class="n">stype</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;&#39;</span><span class="p">,</span><span class="s1">&#39;DB&#39;</span><span class="p">]</span> <span class="ow">and</span> <span class="n">vmax</span> <span class="o">!=</span> <span class="mi">0</span> <span class="ow">and</span> <span class="n">np</span><span class="o">.</span><span class="n">isnan</span><span class="p">(</span><span class="n">vmax</span><span class="p">)</span> <span class="o">==</span> <span class="kc">False</span><span class="p">:</span>
                        <span class="n">stype</span> <span class="o">=</span> <span class="n">get_storm_type</span><span class="p">(</span><span class="n">vmax</span><span class="p">,</span><span class="kc">False</span><span class="p">)</span>
                    <span class="n">forecasts</span><span class="p">[</span><span class="n">model</span><span class="p">][</span><span class="n">run_init</span><span class="p">][</span><span class="s1">&#39;type&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">stype</span><span class="p">)</span>

        <span class="c1">#Save dict locally</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">forecast_dict</span> <span class="o">=</span> <span class="n">forecasts</span>
        
        <span class="c1">#Return dict</span>
        <span class="k">return</span> <span class="n">forecasts</span></div>

    
<div class="viewcode-block" id="Storm.get_nhc_forecast_dict"><a class="viewcode-back" href="../../../api/generated/tropycal.tracks.Storm.get_nhc_forecast_dict.html#tropycal.tracks.Storm.get_nhc_forecast_dict">[docs]</a>    <span class="k">def</span> <span class="nf">get_nhc_forecast_dict</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">time</span><span class="p">):</span>
        
        <span class="sa">r</span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Retreive a dictionary of official NHC forecasts for a valid time.</span>
<span class="sd">        </span>
<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        time : datetime.datetime</span>
<span class="sd">            Time of requested forecast.</span>
<span class="sd">        </span>
<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        dict</span>
<span class="sd">            Dictionary containing forecast data.</span>
<span class="sd">        </span>
<span class="sd">        Notes</span>
<span class="sd">        -----</span>
<span class="sd">        This dict can be provided to ``utils.generate_nhc_cone()`` to generate the cone of uncertainty.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        
        <span class="c1">#Check to ensure the data source is HURDAT</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">source</span> <span class="o">!=</span> <span class="s2">&quot;hurdat&quot;</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span><span class="s2">&quot;Error: NHC data can only be accessed when HURDAT is used as the data source.&quot;</span><span class="p">)</span>
        
        <span class="c1">#Check to ensure storm is not an invest</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">invest</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span><span class="s2">&quot;Error: NHC does not issue advisories for invests that have not been designated as Potential Tropical Cyclones.&quot;</span><span class="p">)</span>
        
        <span class="c1">#Get forecasts dict saved into storm object, if it hasn&#39;t been already</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">forecast_dict</span>
        <span class="k">except</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">get_operational_forecasts</span><span class="p">()</span>

        <span class="c1">#Get all NHC forecast entries</span>
        <span class="n">nhc_forecasts</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">forecast_dict</span><span class="p">[</span><span class="s1">&#39;OFCL&#39;</span><span class="p">]</span>

        <span class="c1">#Get list of all NHC forecast initializations</span>
        <span class="n">nhc_forecast_init</span> <span class="o">=</span> <span class="p">[</span><span class="n">k</span> <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="n">nhc_forecasts</span><span class="o">.</span><span class="n">keys</span><span class="p">()]</span>

        <span class="c1">#Find closest matching time to the provided forecast time</span>
        <span class="n">nhc_forecast_init_dt</span> <span class="o">=</span> <span class="p">[</span><span class="n">dt</span><span class="o">.</span><span class="n">strptime</span><span class="p">(</span><span class="n">k</span><span class="p">,</span><span class="s1">&#39;%Y%m</span><span class="si">%d</span><span class="s1">%H&#39;</span><span class="p">)</span> <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="n">nhc_forecast_init</span><span class="p">]</span>
        <span class="n">time_diff</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([(</span><span class="n">i</span><span class="o">-</span><span class="n">time</span><span class="p">)</span><span class="o">.</span><span class="n">days</span> <span class="o">+</span> <span class="p">(</span><span class="n">i</span><span class="o">-</span><span class="n">time</span><span class="p">)</span><span class="o">.</span><span class="n">seconds</span><span class="o">/</span><span class="mi">86400</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">nhc_forecast_init_dt</span><span class="p">])</span>
        <span class="n">closest_idx</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">time_diff</span><span class="p">)</span><span class="o">.</span><span class="n">argmin</span><span class="p">()</span>
        <span class="n">forecast_dict</span> <span class="o">=</span> <span class="n">nhc_forecasts</span><span class="p">[</span><span class="n">nhc_forecast_init</span><span class="p">[</span><span class="n">closest_idx</span><span class="p">]]</span>
        <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">time_diff</span><span class="p">[</span><span class="n">closest_idx</span><span class="p">])</span> <span class="o">&gt;=</span> <span class="mf">1.0</span><span class="p">:</span>
            <span class="n">warnings</span><span class="o">.</span><span class="n">warn</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;The date provided is outside of the duration of the storm. Returning the closest available NHC forecast.&quot;</span><span class="p">)</span>
        
        <span class="k">return</span> <span class="n">forecast_dict</span></div>
    
    
<div class="viewcode-block" id="Storm.download_tcr"><a class="viewcode-back" href="../../../api/generated/tropycal.tracks.Storm.download_tcr.html#tropycal.tracks.Storm.download_tcr">[docs]</a>    <span class="k">def</span> <span class="nf">download_tcr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">save_path</span><span class="o">=</span><span class="s2">&quot;&quot;</span><span class="p">):</span>
        
        <span class="sa">r</span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Downloads the NHC offical Tropical Cyclone Report (TCR) for the requested storm to the requested directory. Available only for storms with advisories issued by the National Hurricane Center.</span>
<span class="sd">        </span>
<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        save_path : str</span>
<span class="sd">            Path of directory to download the TCR into. Default is current working directory.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        
        <span class="c1">#Check to ensure storm is not an invest</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">invest</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span><span class="s2">&quot;Error: NHC does not issue advisories for invests that have not been designated as Potential Tropical Cyclones.&quot;</span><span class="p">)</span>
        
        <span class="c1">#Error check</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">source</span> <span class="o">!=</span> <span class="s2">&quot;hurdat&quot;</span><span class="p">:</span>
            <span class="n">msg</span> <span class="o">=</span> <span class="s2">&quot;NHC data can only be accessed when HURDAT is used as the data source.&quot;</span>
            <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">year</span> <span class="o">&lt;</span> <span class="mi">1995</span><span class="p">:</span>
            <span class="n">msg</span> <span class="o">=</span> <span class="s2">&quot;Tropical Cyclone Reports are unavailable prior to 1995.&quot;</span>
            <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">save_path</span><span class="p">,</span><span class="nb">str</span><span class="p">)</span> <span class="o">==</span> <span class="kc">False</span><span class="p">:</span>
            <span class="n">msg</span> <span class="o">=</span> <span class="s2">&quot;&#39;save_path&#39; must be of type str.&quot;</span>
            <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>
        
        <span class="c1">#Format URL</span>
        <span class="n">storm_id</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">dict</span><span class="p">[</span><span class="s1">&#39;id&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">upper</span><span class="p">()</span>
        <span class="n">storm_name</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">dict</span><span class="p">[</span><span class="s1">&#39;name&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">title</span><span class="p">()</span>
        <span class="n">url</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;https://www.nhc.noaa.gov/data/tcr/</span><span class="si">{</span><span class="n">storm_id</span><span class="si">}</span><span class="s2">_</span><span class="si">{</span><span class="n">storm_name</span><span class="si">}</span><span class="s2">.pdf&quot;</span>
        
        <span class="c1">#Check to make sure PDF is available</span>
        <span class="n">request</span> <span class="o">=</span> <span class="n">requests</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">url</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">request</span><span class="o">.</span><span class="n">status_code</span> <span class="o">!=</span> <span class="mi">200</span><span class="p">:</span>
            <span class="n">msg</span> <span class="o">=</span> <span class="s2">&quot;This tropical cyclone does not have a Tropical Cyclone Report (TCR) available.&quot;</span>
            <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>
        
        <span class="c1">#Retrieve PDF</span>
        <span class="n">response</span> <span class="o">=</span> <span class="n">requests</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">url</span><span class="p">)</span>
        <span class="n">full_path</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">save_path</span><span class="p">,</span><span class="sa">f</span><span class="s2">&quot;TCR_</span><span class="si">{</span><span class="n">storm_id</span><span class="si">}</span><span class="s2">_</span><span class="si">{</span><span class="n">storm_name</span><span class="si">}</span><span class="s2">.pdf&quot;</span><span class="p">)</span>
        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">full_path</span><span class="p">,</span> <span class="s1">&#39;wb&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
            <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">response</span><span class="o">.</span><span class="n">content</span><span class="p">)</span></div>

            
<div class="viewcode-block" id="Storm.plot_tors"><a class="viewcode-back" href="../../../api/generated/tropycal.tracks.Storm.plot_tors.html#tropycal.tracks.Storm.plot_tors">[docs]</a>    <span class="k">def</span> <span class="nf">plot_tors</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">dist_thresh</span><span class="o">=</span><span class="mi">1000</span><span class="p">,</span><span class="n">Tors</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span><span class="n">domain</span><span class="o">=</span><span class="s2">&quot;dynamic&quot;</span><span class="p">,</span><span class="n">plotPPH</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span><span class="n">plot_all</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>\
                  <span class="n">ax</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span><span class="n">cartopy_proj</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span><span class="n">save_path</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span><span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
                
        <span class="sa">r</span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Creates a plot of the storm and associated tornado tracks.</span>
<span class="sd">        </span>
<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        dist_thresh : int</span>
<span class="sd">            Distance threshold (in kilometers) from the tropical cyclone track over which to attribute tornadoes to the TC. Default is 1000 km.</span>
<span class="sd">        Tors : pandas.DataFrame</span>
<span class="sd">            DataFrame containing tornado data associated with the storm. If None, data is automatically retrieved from TornadoDatabase. A dataframe of tornadoes associated with the TC will then be saved to this instance of storm</span>
<span class="sd">                for future use.</span>
<span class="sd">        domain : str</span>
<span class="sd">            Domain for the plot. Default is &quot;dynamic&quot;. Please refer to :ref:`options-domain` for available domain options.</span>
<span class="sd">        plotPPH : bool or str</span>
<span class="sd">            Whether to plot practically perfect forecast (PPH). True defaults to &quot;daily&quot;. Default is False.</span>

<span class="sd">            * **False** - no PPH plot.</span>
<span class="sd">            * **True** - defaults to &quot;daily&quot;.</span>
<span class="sd">            * **&quot;total&quot;** - probability of a tornado within 25mi of a point during the period of time selected.</span>
<span class="sd">            * **&quot;daily&quot;** - average probability of a tornado within 25mi of a point during a day starting at 12 UTC.</span>
<span class="sd">        plot_all : bool</span>
<span class="sd">            Whether to plot dots for all observations along the track. If false, dots will be plotted every 6 hours. Default is false.</span>
<span class="sd">        ax : axes</span>
<span class="sd">            Instance of axes to plot on. If none, one will be generated. Default is none.</span>
<span class="sd">        cartopy_proj : ccrs</span>
<span class="sd">            Instance of a cartopy projection to use. If none, one will be generated. Default is none.</span>
<span class="sd">        save_path : str</span>
<span class="sd">            Relative or full path of directory to save the image in. If none, image will not be saved.</span>
<span class="sd">        </span>
<span class="sd">        Other Parameters</span>
<span class="sd">        ----------------</span>
<span class="sd">        prop : dict</span>
<span class="sd">            Customization properties of plot.</span>
<span class="sd">        map_prop : dict</span>
<span class="sd">            Customization properties of Cartopy map. Please refer to :ref:`options-map-prop` for available options.</span>
<span class="sd">        </span>
<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        ax</span>
<span class="sd">            Instance of axes containing the plot is returned.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        
        <span class="c1">#Retrieve kwargs</span>
        <span class="n">prop</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;prop&#39;</span><span class="p">,{})</span>
        <span class="n">map_prop</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;map_prop&#39;</span><span class="p">,{})</span>
        
        <span class="c1">#Set default colormap for TC plots to Wistia</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">prop</span><span class="p">[</span><span class="s1">&#39;PPHcolors&#39;</span><span class="p">]</span>
        <span class="k">except</span><span class="p">:</span>
            <span class="n">prop</span><span class="p">[</span><span class="s1">&#39;PPHcolors&#39;</span><span class="p">]</span><span class="o">=</span><span class="s1">&#39;Wistia&#39;</span>
        
        <span class="k">if</span> <span class="n">Tors</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">stormTors</span>
            <span class="k">except</span><span class="p">:</span>
                <span class="n">warn_message</span> <span class="o">=</span> <span class="s2">&quot;Reading in tornado data for this storm. If you seek to analyze tornado data for multiple storms, run </span><span class="se">\&quot;</span><span class="s2">TrackDataset.assign_storm_tornadoes()</span><span class="se">\&quot;</span><span class="s2"> to avoid this warning in the future.&quot;</span>
                <span class="n">warnings</span><span class="o">.</span><span class="n">warn</span><span class="p">(</span><span class="n">warn_message</span><span class="p">)</span>
                <span class="n">Tors</span> <span class="o">=</span> <span class="n">TornadoDataset</span><span class="p">()</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">stormTors</span> <span class="o">=</span> <span class="n">Tors</span><span class="o">.</span><span class="n">get_storm_tornadoes</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">dist_thresh</span><span class="p">)</span>
    
        <span class="c1">#Error check if no tornadoes are found</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">stormTors</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span><span class="s2">&quot;No tornadoes were found with this storm.&quot;</span><span class="p">)</span>
    
        <span class="c1">#Warning if few tornadoes were found</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">stormTors</span><span class="p">)</span> <span class="o">&lt;</span> <span class="mi">5</span><span class="p">:</span>
            <span class="n">warn_message</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">stormTors</span><span class="p">)</span><span class="si">}</span><span class="s2"> tornadoes were found with this storm. Default domain to east_conus.&quot;</span>
            <span class="n">warnings</span><span class="o">.</span><span class="n">warn</span><span class="p">(</span><span class="n">warn_message</span><span class="p">)</span>
            <span class="n">domain</span> <span class="o">=</span> <span class="s1">&#39;east_conus&#39;</span>
    
        <span class="c1">#Create instance of plot object</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">plot_obj_tc</span> <span class="o">=</span> <span class="n">TrackPlot</span><span class="p">()</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">plot_obj_tor</span> <span class="o">=</span> <span class="n">TornadoPlot</span><span class="p">()</span>
        <span class="k">except</span><span class="p">:</span>
            <span class="kn">from</span> <span class="nn">..tornado.plot</span> <span class="kn">import</span> <span class="n">TornadoPlot</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">plot_obj_tor</span> <span class="o">=</span> <span class="n">TornadoPlot</span><span class="p">()</span>
        
        <span class="c1">#Create cartopy projection</span>
        <span class="k">if</span> <span class="n">cartopy_proj</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">if</span> <span class="nb">max</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">dict</span><span class="p">[</span><span class="s1">&#39;lon&#39;</span><span class="p">])</span> <span class="o">&gt;</span> <span class="mi">150</span> <span class="ow">or</span> <span class="nb">min</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">dict</span><span class="p">[</span><span class="s1">&#39;lon&#39;</span><span class="p">])</span> <span class="o">&lt;</span> <span class="o">-</span><span class="mi">150</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">plot_obj_tor</span><span class="o">.</span><span class="n">create_cartopy</span><span class="p">(</span><span class="n">proj</span><span class="o">=</span><span class="s1">&#39;PlateCarree&#39;</span><span class="p">,</span><span class="n">central_longitude</span><span class="o">=</span><span class="mf">180.0</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">plot_obj_tc</span><span class="o">.</span><span class="n">create_cartopy</span><span class="p">(</span><span class="n">proj</span><span class="o">=</span><span class="s1">&#39;PlateCarree&#39;</span><span class="p">,</span><span class="n">central_longitude</span><span class="o">=</span><span class="mf">180.0</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">plot_obj_tor</span><span class="o">.</span><span class="n">create_cartopy</span><span class="p">(</span><span class="n">proj</span><span class="o">=</span><span class="s1">&#39;PlateCarree&#39;</span><span class="p">,</span><span class="n">central_longitude</span><span class="o">=</span><span class="mf">0.0</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">plot_obj_tc</span><span class="o">.</span><span class="n">create_cartopy</span><span class="p">(</span><span class="n">proj</span><span class="o">=</span><span class="s1">&#39;PlateCarree&#39;</span><span class="p">,</span><span class="n">central_longitude</span><span class="o">=</span><span class="mf">0.0</span><span class="p">)</span>
                
        <span class="c1">#Plot tornadoes</span>
        <span class="n">plot_ax</span><span class="p">,</span><span class="n">leg_tor</span><span class="p">,</span><span class="n">domain</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">plot_obj_tor</span><span class="o">.</span><span class="n">plot_tornadoes</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">stormTors</span><span class="p">,</span><span class="n">domain</span><span class="p">,</span><span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">,</span><span class="n">return_ax</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span><span class="n">return_domain</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>\
                                             <span class="n">plotPPH</span><span class="o">=</span><span class="n">plotPPH</span><span class="p">,</span><span class="n">prop</span><span class="o">=</span><span class="n">prop</span><span class="p">,</span><span class="n">map_prop</span><span class="o">=</span><span class="n">map_prop</span><span class="p">)</span>
        <span class="n">tor_title</span> <span class="o">=</span> <span class="n">plot_ax</span><span class="o">.</span><span class="n">get_title</span><span class="p">(</span><span class="s1">&#39;left&#39;</span><span class="p">)</span>

        <span class="c1">#Plot storm</span>
        <span class="n">plot_ax</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">plot_obj_tc</span><span class="o">.</span><span class="n">plot_storms</span><span class="p">([</span><span class="bp">self</span><span class="o">.</span><span class="n">dict</span><span class="p">],</span><span class="n">domain</span><span class="o">=</span><span class="n">domain</span><span class="p">,</span><span class="n">ax</span><span class="o">=</span><span class="n">plot_ax</span><span class="p">,</span><span class="n">prop</span><span class="o">=</span><span class="n">prop</span><span class="p">,</span><span class="n">map_prop</span><span class="o">=</span><span class="n">map_prop</span><span class="p">)</span>
        
        <span class="n">plot_ax</span><span class="o">.</span><span class="n">add_artist</span><span class="p">(</span><span class="n">leg_tor</span><span class="p">)</span>
        
        <span class="n">storm_title</span> <span class="o">=</span> <span class="n">plot_ax</span><span class="o">.</span><span class="n">get_title</span><span class="p">(</span><span class="s1">&#39;left&#39;</span><span class="p">)</span>
        <span class="n">plot_ax</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">storm_title</span><span class="si">}</span><span class="se">\n</span><span class="si">{</span><span class="n">tor_title</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">,</span><span class="n">loc</span><span class="o">=</span><span class="s1">&#39;left&#39;</span><span class="p">,</span><span class="n">fontsize</span><span class="o">=</span><span class="mi">17</span><span class="p">,</span><span class="n">fontweight</span><span class="o">=</span><span class="s1">&#39;bold&#39;</span><span class="p">)</span>
        
        <span class="c1">#Save plot</span>
        <span class="k">if</span> <span class="n">save_path</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">save_path</span><span class="p">,</span><span class="nb">str</span><span class="p">):</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="n">save_path</span><span class="p">,</span><span class="n">bbox_inches</span><span class="o">=</span><span class="s1">&#39;tight&#39;</span><span class="p">)</span>
        
        <span class="c1">#Return axis</span>
        <span class="k">return</span> <span class="n">plot_ax</span></div>

<div class="viewcode-block" id="Storm.plot_TCtors_rotated"><a class="viewcode-back" href="../../../api/generated/tropycal.tracks.Storm.plot_TCtors_rotated.html#tropycal.tracks.Storm.plot_TCtors_rotated">[docs]</a>    <span class="k">def</span> <span class="nf">plot_TCtors_rotated</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">dist_thresh</span><span class="o">=</span><span class="mi">1000</span><span class="p">,</span><span class="n">save_path</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        
        <span class="sa">r</span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Plot tracks of tornadoes relative to the storm motion vector of the tropical cyclone.</span>
<span class="sd">        </span>
<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        dist_thresh : int</span>
<span class="sd">            Distance threshold (in kilometers) from the tropical cyclone track over which to attribute tornadoes to the TC. Default is 1000 km. Ignored if tornado data was passed into Storm from TrackDataset.</span>
<span class="sd">        save_path : str</span>
<span class="sd">            Relative or full path of directory to save the image in. If none, image will not be saved.</span>
<span class="sd">        </span>
<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        ax</span>
<span class="sd">            Instance of axes containing the plot is returned.</span>
<span class="sd">        </span>
<span class="sd">        Notes</span>
<span class="sd">        -----</span>
<span class="sd">        The motion vector is oriented upwards (in the +y direction).</span>
<span class="sd">        &quot;&quot;&quot;</span>
        
        <span class="c1">#Checks to see if stormTors exists</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">stormTors</span>
            <span class="n">dist_thresh</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">tornado_dist_thresh</span>
        <span class="k">except</span><span class="p">:</span>
            <span class="n">warn_message</span> <span class="o">=</span> <span class="s2">&quot;Reading in tornado data for this storm. If you seek to analyze tornado data for multiple storms, run </span><span class="se">\&quot;</span><span class="s2">TrackDataset.assign_storm_tornadoes()</span><span class="se">\&quot;</span><span class="s2"> to avoid this warning in the future.&quot;</span>
            <span class="n">warnings</span><span class="o">.</span><span class="n">warn</span><span class="p">(</span><span class="n">warn_message</span><span class="p">)</span>
            <span class="n">Tors</span> <span class="o">=</span> <span class="n">TornadoDataset</span><span class="p">()</span>
            <span class="n">stormTors</span> <span class="o">=</span> <span class="n">Tors</span><span class="o">.</span><span class="n">get_storm_tornadoes</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">dist_thresh</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">stormTors</span> <span class="o">=</span> <span class="n">Tors</span><span class="o">.</span><span class="n">rotateToHeading</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">stormTors</span><span class="p">)</span>
        
        <span class="c1">#Create figure for plotting</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">9</span><span class="p">,</span><span class="mi">9</span><span class="p">),</span><span class="n">dpi</span><span class="o">=</span><span class="mi">150</span><span class="p">)</span>
        <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplot</span><span class="p">()</span>
        
        <span class="c1">#Default EF color scale</span>
        <span class="n">EFcolors</span> <span class="o">=</span> <span class="n">get_colors_ef</span><span class="p">(</span><span class="s1">&#39;default&#39;</span><span class="p">)</span>
        
        <span class="c1">#Plot all tornado tracks in motion relative coords</span>
        <span class="k">for</span> <span class="n">_</span><span class="p">,</span><span class="n">row</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">stormTors</span><span class="o">.</span><span class="n">iterrows</span><span class="p">():</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">([</span><span class="n">row</span><span class="p">[</span><span class="s1">&#39;rot_xdist_s&#39;</span><span class="p">],</span><span class="n">row</span><span class="p">[</span><span class="s1">&#39;rot_xdist_e&#39;</span><span class="p">]</span><span class="o">+</span><span class="mf">.01</span><span class="p">],[</span><span class="n">row</span><span class="p">[</span><span class="s1">&#39;rot_ydist_s&#39;</span><span class="p">],</span><span class="n">row</span><span class="p">[</span><span class="s1">&#39;rot_ydist_e&#39;</span><span class="p">]</span><span class="o">+</span><span class="mf">.01</span><span class="p">],</span>\
                     <span class="n">lw</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span><span class="n">c</span><span class="o">=</span><span class="n">EFcolors</span><span class="p">[</span><span class="n">row</span><span class="p">[</span><span class="s1">&#39;mag&#39;</span><span class="p">]])</span>
            
        <span class="c1">#Plot dist_thresh radius</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">set_facecolor</span><span class="p">(</span><span class="s1">&#39;#F6F6F6&#39;</span><span class="p">)</span>
        <span class="n">circle</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">Circle</span><span class="p">((</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">),</span> <span class="n">dist_thresh</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;w&#39;</span><span class="p">)</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">add_artist</span><span class="p">(</span><span class="n">circle</span><span class="p">)</span>
        <span class="n">an</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="p">,</span> <span class="mi">100</span><span class="p">)</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">dist_thresh</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">an</span><span class="p">),</span> <span class="n">dist_thresh</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">an</span><span class="p">),</span><span class="s1">&#39;k&#39;</span><span class="p">)</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">([</span><span class="o">-</span><span class="n">dist_thresh</span><span class="p">,</span><span class="n">dist_thresh</span><span class="p">],[</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">],</span><span class="s1">&#39;k--&#39;</span><span class="p">,</span><span class="n">lw</span><span class="o">=</span><span class="mf">.5</span><span class="p">)</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">],[</span><span class="o">-</span><span class="n">dist_thresh</span><span class="p">,</span><span class="n">dist_thresh</span><span class="p">],</span><span class="s1">&#39;k--&#39;</span><span class="p">,</span><span class="n">lw</span><span class="o">=</span><span class="mf">.5</span><span class="p">)</span>
        
        <span class="c1">#Plot motion vector</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">arrow</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="o">-</span><span class="n">dist_thresh</span><span class="o">*</span><span class="mf">.1</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">dist_thresh</span><span class="o">*</span><span class="mf">.2</span><span class="p">,</span> <span class="n">length_includes_head</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
          <span class="n">head_width</span><span class="o">=</span><span class="mi">45</span><span class="p">,</span> <span class="n">head_length</span><span class="o">=</span><span class="mi">45</span><span class="p">,</span><span class="n">fc</span><span class="o">=</span><span class="s1">&#39;k&#39;</span><span class="p">,</span><span class="n">lw</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span><span class="n">zorder</span><span class="o">=</span><span class="mi">100</span><span class="p">)</span>
        
        <span class="c1">#Labels</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">set_aspect</span><span class="p">(</span><span class="s1">&#39;equal&#39;</span><span class="p">,</span> <span class="s1">&#39;box&#39;</span><span class="p">)</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;Left/Right of Storm Heading (km)&#39;</span><span class="p">,</span><span class="n">fontsize</span><span class="o">=</span><span class="mi">13</span><span class="p">)</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;Behind/Ahead of Storm Heading (km)&#39;</span><span class="p">,</span><span class="n">fontsize</span><span class="o">=</span><span class="mi">13</span><span class="p">)</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s1"> </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">year</span><span class="si">}</span><span class="s1"> tornadoes relative to heading&#39;</span><span class="p">,</span><span class="n">fontsize</span><span class="o">=</span><span class="mi">17</span><span class="p">)</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">tick_params</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="s1">&#39;both&#39;</span><span class="p">,</span> <span class="n">which</span><span class="o">=</span><span class="s1">&#39;major&#39;</span><span class="p">,</span> <span class="n">labelsize</span><span class="o">=</span><span class="mf">11.5</span><span class="p">)</span>
        
        <span class="c1">#Add legend</span>
        <span class="n">handles</span><span class="o">=</span><span class="p">[]</span>
        <span class="k">for</span> <span class="n">ef</span><span class="p">,</span><span class="n">color</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">EFcolors</span><span class="p">):</span>
            <span class="n">count</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">stormTors</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">stormTors</span><span class="p">[</span><span class="s1">&#39;mag&#39;</span><span class="p">]</span><span class="o">==</span><span class="n">ef</span><span class="p">])</span>
            <span class="n">handles</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">mlines</span><span class="o">.</span><span class="n">Line2D</span><span class="p">([],</span> <span class="p">[],</span> <span class="n">linestyle</span><span class="o">=</span><span class="s1">&#39;-&#39;</span><span class="p">,</span><span class="n">color</span><span class="o">=</span><span class="n">color</span><span class="p">,</span><span class="n">label</span><span class="o">=</span><span class="sa">f</span><span class="s1">&#39;EF-</span><span class="si">{</span><span class="n">ef</span><span class="si">}</span><span class="s1"> (</span><span class="si">{</span><span class="n">count</span><span class="si">}</span><span class="s1">)&#39;</span><span class="p">))</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">handles</span><span class="o">=</span><span class="n">handles</span><span class="p">,</span><span class="n">loc</span><span class="o">=</span><span class="s1">&#39;lower left&#39;</span><span class="p">,</span><span class="n">fontsize</span><span class="o">=</span><span class="mf">11.5</span><span class="p">)</span>
        
        <span class="c1">#Add attribution</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">text</span><span class="p">(</span><span class="mf">0.99</span><span class="p">,</span><span class="mf">0.01</span><span class="p">,</span><span class="n">plot_credit</span><span class="p">(),</span><span class="n">fontsize</span><span class="o">=</span><span class="mi">8</span><span class="p">,</span><span class="n">color</span><span class="o">=</span><span class="s1">&#39;k&#39;</span><span class="p">,</span><span class="n">alpha</span><span class="o">=</span><span class="mf">0.7</span><span class="p">,</span>
                <span class="n">transform</span><span class="o">=</span><span class="n">ax</span><span class="o">.</span><span class="n">transAxes</span><span class="p">,</span><span class="n">ha</span><span class="o">=</span><span class="s1">&#39;right&#39;</span><span class="p">,</span><span class="n">va</span><span class="o">=</span><span class="s1">&#39;bottom&#39;</span><span class="p">,</span><span class="n">zorder</span><span class="o">=</span><span class="mi">10</span><span class="p">)</span>
        
        <span class="c1">#Save plot</span>
        <span class="k">if</span> <span class="n">save_path</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">save_path</span><span class="p">,</span><span class="nb">str</span><span class="p">):</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="n">save_path</span><span class="p">,</span><span class="n">bbox_inches</span><span class="o">=</span><span class="s1">&#39;tight&#39;</span><span class="p">)</span>
        
        <span class="c1">#Return axis or show figure</span>
        <span class="k">return</span> <span class="n">ax</span></div>
            
<div class="viewcode-block" id="Storm.get_recon"><a class="viewcode-back" href="../../../api/generated/tropycal.tracks.Storm.get_recon.html#tropycal.tracks.Storm.get_recon">[docs]</a>    <span class="k">def</span> <span class="nf">get_recon</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">deltap_thresh</span><span class="o">=</span><span class="mi">8</span><span class="p">,</span><span class="n">save_path</span><span class="o">=</span><span class="s2">&quot;&quot;</span><span class="p">,</span><span class="n">read_path</span><span class="o">=</span><span class="s2">&quot;&quot;</span><span class="p">,</span><span class="n">mission_url_list</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span><span class="n">update</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
        
        <span class="sa">r</span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Creates an instance of ReconDataset for this storm&#39;s data. Saves it as an attribute of this object (storm.recon).</span>
<span class="sd">        </span>
<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        storm : tropycal.tracks.Storm</span>
<span class="sd">            Requested storm as an instance of a Storm object.</span>
<span class="sd">        save_path : str, optional</span>
<span class="sd">            Filepath to save recon data in. Recommended in order to avoid having to re-read in the data.</span>
<span class="sd">        read_path : str, optional</span>
<span class="sd">            Filepath to read saved recon data from. If specified, &quot;save_path&quot; cannot be passed as an argument.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        
        <span class="bp">self</span><span class="o">.</span><span class="n">recon</span> <span class="o">=</span> <span class="n">ReconDataset</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">deltap_thresh</span><span class="p">,</span><span class="n">mission_url_list</span><span class="p">,</span><span class="n">save_path</span><span class="p">,</span><span class="n">read_path</span><span class="p">,</span><span class="n">update</span><span class="p">)</span></div>
                
<div class="viewcode-block" id="Storm.get_archer"><a class="viewcode-back" href="../../../api/generated/tropycal.tracks.Storm.get_archer.html#tropycal.tracks.Storm.get_archer">[docs]</a>    <span class="k">def</span> <span class="nf">get_archer</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        
        <span class="sa">r</span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Retrieves satellite-derived Archer track data for this storm, if available. Saves it as an attribute of this object (storm.archer).</span>
<span class="sd">        &quot;&quot;&quot;</span>
        
        <span class="c1">#Format URL</span>
        <span class="n">url</span> <span class="o">=</span> <span class="sa">f</span><span class="s1">&#39;http://tropic.ssec.wisc.edu/real-time/adt/archive</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">year</span><span class="si">}</span><span class="s1">/</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">id</span><span class="p">[</span><span class="mi">2</span><span class="p">:</span><span class="mi">4</span><span class="p">]</span><span class="si">}{</span><span class="bp">self</span><span class="o">.</span><span class="n">id</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="si">}</span><span class="s1">-list.txt&#39;</span>
        
        <span class="c1">#Read in data</span>
        <span class="n">a</span> <span class="o">=</span> <span class="n">requests</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">url</span><span class="p">)</span><span class="o">.</span><span class="n">content</span><span class="o">.</span><span class="n">decode</span><span class="p">(</span><span class="s2">&quot;utf-8&quot;</span><span class="p">)</span> 
        <span class="n">content</span> <span class="o">=</span> <span class="p">[[</span><span class="n">c</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span> <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="n">b</span><span class="o">.</span><span class="n">split</span><span class="p">()]</span> <span class="k">for</span> <span class="n">b</span> <span class="ow">in</span> <span class="n">a</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)]</span>
        <span class="c1">#data = [[dt.strptime(line[0]+&#39;/&#39;+line[1][:4],&#39;%Y%b%d/%H%M&#39;),-1*float(line[-4]),float(line[-5])] for line in content[-100:-3]]</span>
        <span class="n">archer</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="k">for</span> <span class="n">name</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;time&#39;</span><span class="p">,</span><span class="s1">&#39;lat&#39;</span><span class="p">,</span><span class="s1">&#39;lon&#39;</span><span class="p">,</span><span class="s1">&#39;mnCldTmp&#39;</span><span class="p">]:</span>
            <span class="n">archer</span><span class="p">[</span><span class="n">name</span><span class="p">]</span><span class="o">=</span><span class="p">[]</span>
        <span class="k">for</span> <span class="n">i</span><span class="p">,</span><span class="n">line</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">content</span><span class="p">):</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">ndx</span> <span class="o">=</span> <span class="p">(</span><span class="s1">&#39;MWinit&#39;</span> <span class="ow">in</span> <span class="n">line</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span>
                <span class="n">archer</span><span class="p">[</span><span class="s1">&#39;time&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">dt</span><span class="o">.</span><span class="n">strptime</span><span class="p">(</span><span class="n">line</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">+</span><span class="s1">&#39;/&#39;</span><span class="o">+</span><span class="n">line</span><span class="p">[</span><span class="mi">1</span><span class="p">][:</span><span class="mi">4</span><span class="p">],</span><span class="s1">&#39;%Y%b</span><span class="si">%d</span><span class="s1">/%H%M&#39;</span><span class="p">))</span>
                <span class="n">archer</span><span class="p">[</span><span class="s1">&#39;lat&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">float</span><span class="p">(</span><span class="n">line</span><span class="p">[</span><span class="o">-</span><span class="mi">5</span><span class="o">-</span><span class="n">ndx</span><span class="p">]))</span>
                <span class="n">archer</span><span class="p">[</span><span class="s1">&#39;lon&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="o">*</span><span class="nb">float</span><span class="p">(</span><span class="n">line</span><span class="p">[</span><span class="o">-</span><span class="mi">4</span><span class="o">-</span><span class="n">ndx</span><span class="p">]))</span>
                <span class="n">archer</span><span class="p">[</span><span class="s1">&#39;mnCldTmp&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">float</span><span class="p">(</span><span class="n">line</span><span class="p">[</span><span class="o">-</span><span class="mi">9</span><span class="o">-</span><span class="n">ndx</span><span class="p">]))</span>
            <span class="k">except</span><span class="p">:</span>
                <span class="k">continue</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">archer</span> <span class="o">=</span> <span class="n">archer</span></div></div>
    
</pre></div>

           </div>
          </div>
          <footer>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2021, Tropycal Developers.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>